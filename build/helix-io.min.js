!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.pako=e()}}(function(){return function e(t,n,i){function a(o,s){if(!n[o]){if(!t[o]){var l="function"==typeof require&&require;if(!s&&l)return l(o,!0);if(r)return r(o,!0);var h=new Error("Cannot find module '"+o+"'");throw h.code="MODULE_NOT_FOUND",h}var c=n[o]={exports:{}};t[o][0].call(c.exports,function(e){var n=t[o][1][e];return a(n?n:e)},c,c.exports,e,t,n,i)}return n[o].exports}for(var r="function"==typeof require&&require,o=0;o<i.length;o++)a(i[o]);return a}({1:[function(e,t,n){"use strict";var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;n.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var i in n)n.hasOwnProperty(i)&&(e[i]=n[i])}}return e},n.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var a={arraySet:function(e,t,n,i,a){if(t.subarray&&e.subarray)return void e.set(t.subarray(n,n+i),a);for(var r=0;i>r;r++)e[a+r]=t[n+r]},flattenChunks:function(e){var t,n,i,a,r,o;for(i=0,t=0,n=e.length;n>t;t++)i+=e[t].length;for(o=new Uint8Array(i),a=0,t=0,n=e.length;n>t;t++)r=e[t],o.set(r,a),a+=r.length;return o}},r={arraySet:function(e,t,n,i,a){for(var r=0;i>r;r++)e[a+r]=t[n+r]},flattenChunks:function(e){return[].concat.apply([],e)}};n.setTyped=function(e){e?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,a)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,r))},n.setTyped(i)},{}],2:[function(e,t,n){"use strict";function i(e,t){if(65537>t&&(e.subarray&&o||!e.subarray&&r))return String.fromCharCode.apply(null,a.shrinkBuf(e,t));for(var n="",i=0;t>i;i++)n+=String.fromCharCode(e[i]);return n}var a=e("./common"),r=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch(s){r=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(s){o=!1}for(var l=new a.Buf8(256),h=0;256>h;h++)l[h]=h>=252?6:h>=248?5:h>=240?4:h>=224?3:h>=192?2:1;l[254]=l[254]=1,n.string2buf=function(e){var t,n,i,r,o,s=e.length,l=0;for(r=0;s>r;r++)n=e.charCodeAt(r),55296===(64512&n)&&s>r+1&&(i=e.charCodeAt(r+1),56320===(64512&i)&&(n=65536+(n-55296<<10)+(i-56320),r++)),l+=128>n?1:2048>n?2:65536>n?3:4;for(t=new a.Buf8(l),o=0,r=0;l>o;r++)n=e.charCodeAt(r),55296===(64512&n)&&s>r+1&&(i=e.charCodeAt(r+1),56320===(64512&i)&&(n=65536+(n-55296<<10)+(i-56320),r++)),128>n?t[o++]=n:2048>n?(t[o++]=192|n>>>6,t[o++]=128|63&n):65536>n?(t[o++]=224|n>>>12,t[o++]=128|n>>>6&63,t[o++]=128|63&n):(t[o++]=240|n>>>18,t[o++]=128|n>>>12&63,t[o++]=128|n>>>6&63,t[o++]=128|63&n);return t},n.buf2binstring=function(e){return i(e,e.length)},n.binstring2buf=function(e){for(var t=new a.Buf8(e.length),n=0,i=t.length;i>n;n++)t[n]=e.charCodeAt(n);return t},n.buf2string=function(e,t){var n,a,r,o,s=t||e.length,h=new Array(2*s);for(a=0,n=0;s>n;)if(r=e[n++],128>r)h[a++]=r;else if(o=l[r],o>4)h[a++]=65533,n+=o-1;else{for(r&=2===o?31:3===o?15:7;o>1&&s>n;)r=r<<6|63&e[n++],o--;o>1?h[a++]=65533:65536>r?h[a++]=r:(r-=65536,h[a++]=55296|r>>10&1023,h[a++]=56320|1023&r)}return i(h,a)},n.utf8border=function(e,t){var n;for(t=t||e.length,t>e.length&&(t=e.length),n=t-1;n>=0&&128===(192&e[n]);)n--;return 0>n?t:0===n?t:n+l[e[n]]>t?n:t}},{"./common":1}],3:[function(e,t,n){"use strict";function i(e,t,n,i){for(var a=65535&e|0,r=e>>>16&65535|0,o=0;0!==n;){o=n>2e3?2e3:n,n-=o;do a=a+t[i++]|0,r=r+a|0;while(--o);a%=65521,r%=65521}return a|r<<16|0}t.exports=i},{}],4:[function(e,t,n){t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],5:[function(e,t,n){"use strict";function i(){for(var e,t=[],n=0;256>n;n++){e=n;for(var i=0;8>i;i++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}function a(e,t,n,i){var a=r,o=i+n;e=-1^e;for(var s=i;o>s;s++)e=e>>>8^a[255&(e^t[s])];return-1^e}var r=i();t.exports=a},{}],6:[function(e,t,n){"use strict";function i(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}t.exports=i},{}],7:[function(e,t,n){"use strict";var i=30,a=12;t.exports=function(e,t){var n,r,o,s,l,h,c,u,d,f,p,_,m,b,v,x,X,g,y,F,H,w,k,D,M;n=e.state,r=e.next_in,D=e.input,o=r+(e.avail_in-5),s=e.next_out,M=e.output,l=s-(t-e.avail_out),h=s+(e.avail_out-257),c=n.dmax,u=n.wsize,d=n.whave,f=n.wnext,p=n.window,_=n.hold,m=n.bits,b=n.lencode,v=n.distcode,x=(1<<n.lenbits)-1,X=(1<<n.distbits)-1;e:do{15>m&&(_+=D[r++]<<m,m+=8,_+=D[r++]<<m,m+=8),g=b[_&x];t:for(;;){if(y=g>>>24,_>>>=y,m-=y,y=g>>>16&255,0===y)M[s++]=65535&g;else{if(!(16&y)){if(0===(64&y)){g=b[(65535&g)+(_&(1<<y)-1)];continue t}if(32&y){n.mode=a;break e}e.msg="invalid literal/length code",n.mode=i;break e}F=65535&g,y&=15,y&&(y>m&&(_+=D[r++]<<m,m+=8),F+=_&(1<<y)-1,_>>>=y,m-=y),15>m&&(_+=D[r++]<<m,m+=8,_+=D[r++]<<m,m+=8),g=v[_&X];n:for(;;){if(y=g>>>24,_>>>=y,m-=y,y=g>>>16&255,!(16&y)){if(0===(64&y)){g=v[(65535&g)+(_&(1<<y)-1)];continue n}e.msg="invalid distance code",n.mode=i;break e}if(H=65535&g,y&=15,y>m&&(_+=D[r++]<<m,m+=8,y>m&&(_+=D[r++]<<m,m+=8)),H+=_&(1<<y)-1,H>c){e.msg="invalid distance too far back",n.mode=i;break e}if(_>>>=y,m-=y,y=s-l,H>y){if(y=H-y,y>d&&n.sane){e.msg="invalid distance too far back",n.mode=i;break e}if(w=0,k=p,0===f){if(w+=u-y,F>y){F-=y;do M[s++]=p[w++];while(--y);w=s-H,k=M}}else if(y>f){if(w+=u+f-y,y-=f,F>y){F-=y;do M[s++]=p[w++];while(--y);if(w=0,F>f){y=f,F-=y;do M[s++]=p[w++];while(--y);w=s-H,k=M}}}else if(w+=f-y,F>y){F-=y;do M[s++]=p[w++];while(--y);w=s-H,k=M}for(;F>2;)M[s++]=k[w++],M[s++]=k[w++],M[s++]=k[w++],F-=3;F&&(M[s++]=k[w++],F>1&&(M[s++]=k[w++]))}else{w=s-H;do M[s++]=M[w++],M[s++]=M[w++],M[s++]=M[w++],F-=3;while(F>2);F&&(M[s++]=M[w++],F>1&&(M[s++]=M[w++]))}break}}break}}while(o>r&&h>s);F=m>>3,r-=F,m-=F<<3,_&=(1<<m)-1,e.next_in=r,e.next_out=s,e.avail_in=o>r?5+(o-r):5-(r-o),e.avail_out=h>s?257+(h-s):257-(s-h),n.hold=_,n.bits=m}},{}],8:[function(e,t,n){"use strict";function i(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function a(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new b.Buf16(320),this.work=new b.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function r(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=C,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new b.Buf32(pe),t.distcode=t.distdyn=new b.Buf32(_e),t.sane=1,t.back=-1,M):T}function o(e){var t;return e&&e.state?(t=e.state,t.wsize=0,t.whave=0,t.wnext=0,r(e)):T}function s(e,t){var n,i;return e&&e.state?(i=e.state,0>t?(n=0,t=-t):(n=(t>>4)+1,48>t&&(t&=15)),t&&(8>t||t>15)?T:(null!==i.window&&i.wbits!==t&&(i.window=null),i.wrap=n,i.wbits=t,o(e))):T}function l(e,t){var n,i;return e?(i=new a,e.state=i,i.window=null,n=s(e,t),n!==M&&(e.state=null),n):T}function h(e){return l(e,be)}function c(e){if(ve){var t;for(_=new b.Buf32(512),m=new b.Buf32(32),t=0;144>t;)e.lens[t++]=8;for(;256>t;)e.lens[t++]=9;for(;280>t;)e.lens[t++]=7;for(;288>t;)e.lens[t++]=8;for(g(F,e.lens,0,288,_,0,e.work,{bits:9}),t=0;32>t;)e.lens[t++]=5;g(H,e.lens,0,32,m,0,e.work,{bits:5}),ve=!1}e.lencode=_,e.lenbits=9,e.distcode=m,e.distbits=5}function u(e,t,n,i){var a,r=e.state;return null===r.window&&(r.wsize=1<<r.wbits,r.wnext=0,r.whave=0,r.window=new b.Buf8(r.wsize)),i>=r.wsize?(b.arraySet(r.window,t,n-r.wsize,r.wsize,0),r.wnext=0,r.whave=r.wsize):(a=r.wsize-r.wnext,a>i&&(a=i),b.arraySet(r.window,t,n-i,a,r.wnext),i-=a,i?(b.arraySet(r.window,t,n-i,i,0),r.wnext=i,r.whave=r.wsize):(r.wnext+=a,r.wnext===r.wsize&&(r.wnext=0),r.whave<r.wsize&&(r.whave+=a))),0}function d(e,t){var n,a,r,o,s,l,h,d,f,p,_,m,pe,_e,me,be,ve,xe,Xe,ge,ye,Fe,He,we,ke=0,De=new b.Buf8(4),Me=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return T;n=e.state,n.mode===Z&&(n.mode=Y),s=e.next_out,r=e.output,h=e.avail_out,o=e.next_in,a=e.input,l=e.avail_in,d=n.hold,f=n.bits,p=l,_=h,Fe=M;e:for(;;)switch(n.mode){case C:if(0===n.wrap){n.mode=Y;break}for(;16>f;){if(0===l)break e;l--,d+=a[o++]<<f,f+=8}if(2&n.wrap&&35615===d){n.check=0,De[0]=255&d,De[1]=d>>>8&255,n.check=x(n.check,De,2,0),d=0,f=0,n.mode=E;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&d)<<8)+(d>>8))%31){e.msg="incorrect header check",n.mode=ue;break}if((15&d)!==S){e.msg="unknown compression method",n.mode=ue;break}if(d>>>=4,f-=4,ye=(15&d)+8,0===n.wbits)n.wbits=ye;else if(ye>n.wbits){e.msg="invalid window size",n.mode=ue;break}n.dmax=1<<ye,e.adler=n.check=1,n.mode=512&d?V:Z,d=0,f=0;break;case E:for(;16>f;){if(0===l)break e;l--,d+=a[o++]<<f,f+=8}if(n.flags=d,(255&n.flags)!==S){e.msg="unknown compression method",n.mode=ue;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=ue;break}n.head&&(n.head.text=d>>8&1),512&n.flags&&(De[0]=255&d,De[1]=d>>>8&255,n.check=x(n.check,De,2,0)),d=0,f=0,n.mode=P;case P:for(;32>f;){if(0===l)break e;l--,d+=a[o++]<<f,f+=8}n.head&&(n.head.time=d),512&n.flags&&(De[0]=255&d,De[1]=d>>>8&255,De[2]=d>>>16&255,De[3]=d>>>24&255,n.check=x(n.check,De,4,0)),d=0,f=0,n.mode=j;case j:for(;16>f;){if(0===l)break e;l--,d+=a[o++]<<f,f+=8}n.head&&(n.head.xflags=255&d,n.head.os=d>>8),512&n.flags&&(De[0]=255&d,De[1]=d>>>8&255,n.check=x(n.check,De,2,0)),d=0,f=0,n.mode=R;case R:if(1024&n.flags){for(;16>f;){if(0===l)break e;l--,d+=a[o++]<<f,f+=8}n.length=d,n.head&&(n.head.extra_len=d),512&n.flags&&(De[0]=255&d,De[1]=d>>>8&255,n.check=x(n.check,De,2,0)),d=0,f=0}else n.head&&(n.head.extra=null);n.mode=L;case L:if(1024&n.flags&&(m=n.length,m>l&&(m=l),m&&(n.head&&(ye=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),b.arraySet(n.head.extra,a,o,m,ye)),512&n.flags&&(n.check=x(n.check,a,m,o)),l-=m,o+=m,n.length-=m),n.length))break e;n.length=0,n.mode=U;case U:if(2048&n.flags){if(0===l)break e;m=0;do ye=a[o+m++],n.head&&ye&&n.length<65536&&(n.head.name+=String.fromCharCode(ye));while(ye&&l>m);if(512&n.flags&&(n.check=x(n.check,a,m,o)),l-=m,o+=m,ye)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=z;case z:if(4096&n.flags){if(0===l)break e;m=0;do ye=a[o+m++],n.head&&ye&&n.length<65536&&(n.head.comment+=String.fromCharCode(ye));while(ye&&l>m);if(512&n.flags&&(n.check=x(n.check,a,m,o)),l-=m,o+=m,ye)break e}else n.head&&(n.head.comment=null);n.mode=G;case G:if(512&n.flags){for(;16>f;){if(0===l)break e;l--,d+=a[o++]<<f,f+=8}if(d!==(65535&n.check)){e.msg="header crc mismatch",n.mode=ue;break}d=0,f=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=Z;break;case V:for(;32>f;){if(0===l)break e;l--,d+=a[o++]<<f,f+=8}e.adler=n.check=i(d),d=0,f=0,n.mode=J;case J:if(0===n.havedict)return e.next_out=s,e.avail_out=h,e.next_in=o,e.avail_in=l,n.hold=d,n.bits=f,A;e.adler=n.check=1,n.mode=Z;case Z:if(t===k||t===D)break e;case Y:if(n.last){d>>>=7&f,f-=7&f,n.mode=le;break}for(;3>f;){if(0===l)break e;l--,d+=a[o++]<<f,f+=8}switch(n.last=1&d,d>>>=1,f-=1,3&d){case 0:n.mode=K;break;case 1:if(c(n),n.mode=te,t===D){d>>>=2,f-=2;break e}break;case 2:n.mode=q;break;case 3:e.msg="invalid block type",n.mode=ue}d>>>=2,f-=2;break;case K:for(d>>>=7&f,f-=7&f;32>f;){if(0===l)break e;l--,d+=a[o++]<<f,f+=8}if((65535&d)!==(d>>>16^65535)){e.msg="invalid stored block lengths",n.mode=ue;break}if(n.length=65535&d,d=0,f=0,n.mode=W,t===D)break e;case W:n.mode=Q;case Q:if(m=n.length){if(m>l&&(m=l),m>h&&(m=h),0===m)break e;b.arraySet(r,a,o,m,s),l-=m,o+=m,h-=m,s+=m,n.length-=m;break}n.mode=Z;break;case q:for(;14>f;){if(0===l)break e;l--,d+=a[o++]<<f,f+=8}if(n.nlen=(31&d)+257,d>>>=5,f-=5,n.ndist=(31&d)+1,d>>>=5,f-=5,n.ncode=(15&d)+4,d>>>=4,f-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=ue;break}n.have=0,n.mode=$;case $:for(;n.have<n.ncode;){for(;3>f;){if(0===l)break e;l--,d+=a[o++]<<f,f+=8}n.lens[Me[n.have++]]=7&d,d>>>=3,f-=3}for(;n.have<19;)n.lens[Me[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,He={bits:n.lenbits},Fe=g(y,n.lens,0,19,n.lencode,0,n.work,He),n.lenbits=He.bits,Fe){e.msg="invalid code lengths set",n.mode=ue;break}n.have=0,n.mode=ee;case ee:for(;n.have<n.nlen+n.ndist;){for(;ke=n.lencode[d&(1<<n.lenbits)-1],me=ke>>>24,be=ke>>>16&255,ve=65535&ke,!(f>=me);){if(0===l)break e;l--,d+=a[o++]<<f,f+=8}if(16>ve)d>>>=me,f-=me,n.lens[n.have++]=ve;else{if(16===ve){for(we=me+2;we>f;){if(0===l)break e;l--,d+=a[o++]<<f,f+=8}if(d>>>=me,f-=me,0===n.have){e.msg="invalid bit length repeat",n.mode=ue;break}ye=n.lens[n.have-1],m=3+(3&d),d>>>=2,f-=2}else if(17===ve){for(we=me+3;we>f;){if(0===l)break e;l--,d+=a[o++]<<f,f+=8}d>>>=me,f-=me,ye=0,m=3+(7&d),d>>>=3,f-=3}else{for(we=me+7;we>f;){if(0===l)break e;l--,d+=a[o++]<<f,f+=8}d>>>=me,f-=me,ye=0,m=11+(127&d),d>>>=7,f-=7}if(n.have+m>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=ue;break}for(;m--;)n.lens[n.have++]=ye}}if(n.mode===ue)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=ue;break}if(n.lenbits=9,He={bits:n.lenbits},Fe=g(F,n.lens,0,n.nlen,n.lencode,0,n.work,He),n.lenbits=He.bits,Fe){e.msg="invalid literal/lengths set",n.mode=ue;break}if(n.distbits=6,n.distcode=n.distdyn,He={bits:n.distbits},Fe=g(H,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,He),n.distbits=He.bits,Fe){e.msg="invalid distances set",n.mode=ue;break}if(n.mode=te,t===D)break e;case te:n.mode=ne;case ne:if(l>=6&&h>=258){e.next_out=s,e.avail_out=h,e.next_in=o,e.avail_in=l,n.hold=d,n.bits=f,X(e,_),s=e.next_out,r=e.output,h=e.avail_out,o=e.next_in,a=e.input,l=e.avail_in,d=n.hold,f=n.bits,n.mode===Z&&(n.back=-1);break}for(n.back=0;ke=n.lencode[d&(1<<n.lenbits)-1],me=ke>>>24,be=ke>>>16&255,ve=65535&ke,!(f>=me);){if(0===l)break e;l--,d+=a[o++]<<f,f+=8}if(be&&0===(240&be)){for(xe=me,Xe=be,ge=ve;ke=n.lencode[ge+((d&(1<<xe+Xe)-1)>>xe)],me=ke>>>24,be=ke>>>16&255,ve=65535&ke,!(f>=xe+me);){if(0===l)break e;l--,d+=a[o++]<<f,f+=8}d>>>=xe,f-=xe,n.back+=xe}if(d>>>=me,f-=me,n.back+=me,n.length=ve,0===be){n.mode=se;break}if(32&be){n.back=-1,n.mode=Z;break}if(64&be){e.msg="invalid literal/length code",n.mode=ue;break}n.extra=15&be,n.mode=ie;case ie:if(n.extra){for(we=n.extra;we>f;){if(0===l)break e;l--,d+=a[o++]<<f,f+=8}n.length+=d&(1<<n.extra)-1,d>>>=n.extra,f-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=ae;case ae:for(;ke=n.distcode[d&(1<<n.distbits)-1],me=ke>>>24,be=ke>>>16&255,ve=65535&ke,!(f>=me);){if(0===l)break e;l--,d+=a[o++]<<f,f+=8}if(0===(240&be)){for(xe=me,Xe=be,ge=ve;ke=n.distcode[ge+((d&(1<<xe+Xe)-1)>>xe)],me=ke>>>24,be=ke>>>16&255,ve=65535&ke,!(f>=xe+me);){if(0===l)break e;l--,d+=a[o++]<<f,f+=8}d>>>=xe,f-=xe,n.back+=xe}if(d>>>=me,f-=me,n.back+=me,64&be){e.msg="invalid distance code",n.mode=ue;break}n.offset=ve,n.extra=15&be,n.mode=re;case re:if(n.extra){for(we=n.extra;we>f;){if(0===l)break e;l--,d+=a[o++]<<f,f+=8}n.offset+=d&(1<<n.extra)-1,d>>>=n.extra,f-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=ue;break}n.mode=oe;case oe:if(0===h)break e;if(m=_-h,n.offset>m){if(m=n.offset-m,m>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=ue;break}m>n.wnext?(m-=n.wnext,pe=n.wsize-m):pe=n.wnext-m,m>n.length&&(m=n.length),_e=n.window}else _e=r,pe=s-n.offset,m=n.length;m>h&&(m=h),h-=m,n.length-=m;do r[s++]=_e[pe++];while(--m);0===n.length&&(n.mode=ne);break;case se:if(0===h)break e;r[s++]=n.length,h--,n.mode=ne;break;case le:if(n.wrap){for(;32>f;){if(0===l)break e;l--,d|=a[o++]<<f,f+=8}if(_-=h,e.total_out+=_,n.total+=_,_&&(e.adler=n.check=n.flags?x(n.check,r,_,s-_):v(n.check,r,_,s-_)),_=h,(n.flags?d:i(d))!==n.check){e.msg="incorrect data check",n.mode=ue;break}d=0,f=0}n.mode=he;case he:if(n.wrap&&n.flags){for(;32>f;){if(0===l)break e;l--,d+=a[o++]<<f,f+=8}if(d!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=ue;break}d=0,f=0}n.mode=ce;case ce:Fe=B;break e;case ue:Fe=O;break e;case de:return I;case fe:default:return T}return e.next_out=s,e.avail_out=h,e.next_in=o,e.avail_in=l,n.hold=d,n.bits=f,(n.wsize||_!==e.avail_out&&n.mode<ue&&(n.mode<le||t!==w))&&u(e,e.output,e.next_out,_-e.avail_out)?(n.mode=de,I):(p-=e.avail_in,_-=e.avail_out,e.total_in+=p,e.total_out+=_,n.total+=_,n.wrap&&_&&(e.adler=n.check=n.flags?x(n.check,r,_,e.next_out-_):v(n.check,r,_,e.next_out-_)),e.data_type=n.bits+(n.last?64:0)+(n.mode===Z?128:0)+(n.mode===te||n.mode===W?256:0),(0===p&&0===_||t===w)&&Fe===M&&(Fe=N),Fe)}function f(e){if(!e||!e.state)return T;var t=e.state;return t.window&&(t.window=null),e.state=null,M}function p(e,t){var n;return e&&e.state?(n=e.state,0===(2&n.wrap)?T:(n.head=t,t.done=!1,M)):T}var _,m,b=e("../utils/common"),v=e("./adler32"),x=e("./crc32"),X=e("./inffast"),g=e("./inftrees"),y=0,F=1,H=2,w=4,k=5,D=6,M=0,B=1,A=2,T=-2,O=-3,I=-4,N=-5,S=8,C=1,E=2,P=3,j=4,R=5,L=6,U=7,z=8,G=9,V=10,J=11,Z=12,Y=13,K=14,W=15,Q=16,q=17,$=18,ee=19,te=20,ne=21,ie=22,ae=23,re=24,oe=25,se=26,le=27,he=28,ce=29,ue=30,de=31,fe=32,pe=852,_e=592,me=15,be=me,ve=!0;n.inflateReset=o,n.inflateReset2=s,n.inflateResetKeep=r,n.inflateInit=h,n.inflateInit2=l,n.inflate=d,n.inflateEnd=f,n.inflateGetHeader=p,n.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":1,"./adler32":3,"./crc32":5,"./inffast":7,"./inftrees":9}],9:[function(e,t,n){"use strict";var i=e("../utils/common"),a=15,r=852,o=592,s=0,l=1,h=2,c=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],u=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],d=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],f=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,n,p,_,m,b,v){var x,X,g,y,F,H,w,k,D,M=v.bits,B=0,A=0,T=0,O=0,I=0,N=0,S=0,C=0,E=0,P=0,j=null,R=0,L=new i.Buf16(a+1),U=new i.Buf16(a+1),z=null,G=0;for(B=0;a>=B;B++)L[B]=0;for(A=0;p>A;A++)L[t[n+A]]++;for(I=M,O=a;O>=1&&0===L[O];O--);if(I>O&&(I=O),0===O)return _[m++]=20971520,_[m++]=20971520,v.bits=1,0;for(T=1;O>T&&0===L[T];T++);for(T>I&&(I=T),C=1,B=1;a>=B;B++)if(C<<=1,C-=L[B],0>C)return-1;if(C>0&&(e===s||1!==O))return-1;for(U[1]=0,B=1;a>B;B++)U[B+1]=U[B]+L[B];for(A=0;p>A;A++)0!==t[n+A]&&(b[U[t[n+A]]++]=A);if(e===s?(j=z=b,H=19):e===l?(j=c,R-=257,z=u,G-=257,H=256):(j=d,z=f,H=-1),P=0,A=0,B=T,F=m,N=I,S=0,g=-1,E=1<<I,y=E-1,e===l&&E>r||e===h&&E>o)return 1;for(var V=0;;){V++,w=B-S,b[A]<H?(k=0,D=b[A]):b[A]>H?(k=z[G+b[A]],D=j[R+b[A]]):(k=96,D=0),x=1<<B-S,X=1<<N,T=X;do X-=x,_[F+(P>>S)+X]=w<<24|k<<16|D|0;while(0!==X);for(x=1<<B-1;P&x;)x>>=1;if(0!==x?(P&=x-1,P+=x):P=0,A++,0===--L[B]){if(B===O)break;B=t[n+b[A]]}if(B>I&&(P&y)!==g){for(0===S&&(S=I),F+=T,N=B-S,C=1<<N;O>N+S&&(C-=L[N+S],!(0>=C));)N++,C<<=1;if(E+=1<<N,e===l&&E>r||e===h&&E>o)return 1;g=P&y,_[g]=I<<24|N<<16|F-m|0}}return 0!==P&&(_[F+P]=B-S<<24|64<<16|0),v.bits=I,0}},{"../utils/common":1}],10:[function(e,t,n){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],11:[function(e,t,n){"use strict";function i(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}t.exports=i},{}],"/lib/inflate.js":[function(e,t,n){"use strict";function i(e,t){var n=new f(t);if(n.push(e,!0),n.err)throw n.msg;return n.result}function a(e,t){return t=t||{},t.raw=!0,i(e,t)}var r=e("./zlib/inflate.js"),o=e("./utils/common"),s=e("./utils/strings"),l=e("./zlib/constants"),h=e("./zlib/messages"),c=e("./zlib/zstream"),u=e("./zlib/gzheader"),d=Object.prototype.toString,f=function(e){this.options=o.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0===(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var n=r.inflateInit2(this.strm,t.windowBits);if(n!==l.Z_OK)throw new Error(h[n]);this.header=new u,r.inflateGetHeader(this.strm,this.header)};f.prototype.push=function(e,t){var n,i,a,h,c,u=this.strm,f=this.options.chunkSize,p=!1;if(this.ended)return!1;i=t===~~t?t:t===!0?l.Z_FINISH:l.Z_NO_FLUSH,u.input="string"==typeof e?s.binstring2buf(e):"[object ArrayBuffer]"===d.call(e)?new Uint8Array(e):e,u.next_in=0,u.avail_in=u.input.length;do{if(0===u.avail_out&&(u.output=new o.Buf8(f),u.next_out=0,u.avail_out=f),n=r.inflate(u,l.Z_NO_FLUSH),n===l.Z_BUF_ERROR&&p===!0&&(n=l.Z_OK,p=!1),n!==l.Z_STREAM_END&&n!==l.Z_OK)return this.onEnd(n),this.ended=!0,!1;u.next_out&&(0===u.avail_out||n===l.Z_STREAM_END||0===u.avail_in&&(i===l.Z_FINISH||i===l.Z_SYNC_FLUSH))&&("string"===this.options.to?(a=s.utf8border(u.output,u.next_out),h=u.next_out-a,c=s.buf2string(u.output,a),u.next_out=h,u.avail_out=f-h,h&&o.arraySet(u.output,u.output,a,h,0),this.onData(c)):this.onData(o.shrinkBuf(u.output,u.next_out))),0===u.avail_in&&0===u.avail_out&&(p=!0)}while((u.avail_in>0||0===u.avail_out)&&n!==l.Z_STREAM_END);return n===l.Z_STREAM_END&&(i=l.Z_FINISH),i===l.Z_FINISH?(n=r.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===l.Z_OK):i===l.Z_SYNC_FLUSH?(this.onEnd(l.Z_OK),u.avail_out=0,!0):!0},f.prototype.onData=function(e){this.chunks.push(e)},f.prototype.onEnd=function(e){e===l.Z_OK&&(this.result="string"===this.options.to?this.chunks.join(""):o.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},n.Inflate=f,n.inflate=i,n.inflateRaw=a,n.ungzip=i},{"./utils/common":1,"./utils/strings":2,"./zlib/constants":4,"./zlib/gzheader":6,"./zlib/inflate.js":8,"./zlib/messages":10,"./zlib/zstream":11}]},{},[])("/lib/inflate.js")}),HX.FbxObject=function(){this.name=null,this.UID=null,this.parent=null,this.data=null},HX.FbxObject.prototype={connectObject:function(e){throw new Error("Unhandled object connection "+e.toString()+" -> "+this.toString())},connectProperty:function(e,t){},copyProperties:function(e){for(var t in e)if(this.hasOwnProperty(t)&&void 0!==e[t]&&null!==e[t]){var n=t.charAt(0);n.toUpperCase()===n&&(this[t]=e[t])}}},HX.FbxObject.prototype.toString=function(){return"[FbxObject(name="+this.name+")]"},HX.FbxNode=function(){HX.FbxObject.call(this),this.RotationOffset=null,this.RotationPivot=null,this.ScalingOffset=null,this.ScalingPivot=null,this.RotationOrder=0,this.PreRotation=null,this.PostRotation=null,this.InheritType=0,this.GeometricTranslation=null,this.GeometricRotation=null,this.GeometricScaling=null,this["Lcl Translation"]=null,this["Lcl Rotation"]=null,this["Lcl Scaling"]=null,this.Visibility=!0,this.type=null,this.children=null,this.skeleton=null,this.defaultAttribute=null,this.attributes=null,this.mesh=null,this.materials=null,this.animationCurveNodes=null},HX.FbxNode.prototype=Object.create(HX.FbxObject.prototype,{numChildren:{get:function(){return this.children?this.children.length:0}}}),HX.FbxNode.prototype.getChild=function(e){return this.children[e]},HX.FbxNode.prototype.connectObject=function(e){if(e instanceof HX.FbxNode)"Root"===e.type?this.skeleton=e:(this.children=this.children||[],this.children.push(e),e.parent=this);else if(e instanceof HX.FbxNodeAttribute)this.defaultAttribute=this.defaultAttribute||e,this.attributes=this.attributes||[],this.attributes.push(e);else if(e instanceof HX.FbxMesh)this.mesh=e;else if(e instanceof HX.FbxMaterial)this.materials=this.materials||[],this.materials.push(e);else if(!(e instanceof HX.FbxTrashNode))throw new Error("Incompatible child object "+e.toString()+" for "+this.type)},HX.FbxNode.prototype.connectProperty=function(e,t){e instanceof HX.FbxAnimationCurveNode&&(this.animationCurveNodes=this.animationCurveNodes||{},this.animationCurveNodes[t]=e,e.propertyName=t)},HX.FbxNode.prototype.toString=function(){return"[FbxNode(name="+this.name+", type="+this.type+")]"},HX.FBX=function(){HX.Importer.call(this,HX.GroupNode,HX.Importer.TYPE_BINARY),this._rootNode=null},HX.FBX.prototype=Object.create(HX.Importer.prototype),HX.FBX.prototype.parse=function(e,t){var n=new HX.DataStream(e),i=new HX.FBXBinaryDeserializer,a=new HX.FBXGraphBuilder,r=new HX.FBXConverter,o=new HX.FBXSettings;try{var s,l=Date.now(),h=i.deserialize(n);if(s=Date.now(),console.log("Serialization: "+(s-l)),l=s,o.init(h),i.version<7e3)throw new Error("Unsupported FBX version!");a.build(h,o),s=Date.now(),console.log("Graph building: "+(s-l)),l=s,r.convert(a.sceneRoot,a.animationStack,a.bindPoses,t,o),s=Date.now(),console.log("Conversion: "+(s-l))}catch(c){return console.log(c.stack),void this._notifyFailure(c.message)}r.textureTokens.length>0?this._loadTextures(r.textureTokens,r.textureMaterialMap,t):this._notifyComplete(t)},HX.FBX.prototype._loadTextures=function(e,t,n){for(var i=[],a=e.length,r=0;a>r;++r){var o=e[r];o.filename=i[r]=this._correctURL(o.filename)}var s=this,l=new HX.BulkAssetLoader;l.onFail=function(e){s._notifyFailure(e)},l.onComplete=function(){for(var e=t.length,i=0;e>i;++i){var a=t[i],r=a.token,o=l.getAsset(r.filename);switch(o.name=r.name,a.mapType){case HX.FBXConverter._TextureToken.NORMAL_MAP:a.material.normalMap=o;break;case HX.FBXConverter._TextureToken.SPECULAR_MAP:a.material.specularMap=o;break;case HX.FBXConverter._TextureToken.DIFFUSE_MAP:a.material.colorMap=o}}s._notifyComplete(n)},l.load(i,HX.JPG)},HX.FBXAnimationConverter=function(){this._skinningData=null,this._jointUIDLookUp=null,this._skeleton=null,this._fakeJointIndex=-1,this._animationClips=null,this._bindPoses=null,this._bindPosesByIndex=null},HX.FBXAnimationConverter.prototype={get skeleton(){return this._skeleton},get animationClips(){return this._animationClips},get fakeJointIndex(){return this._fakeJointIndex},getJointBinding:function(e){return this._skinningData[e]},convertSkin:function(e,t){this._skeleton=new HX.Skeleton,this._skinningData=[],this._jointUIDLookUp={},this._bindPoses={},t&&this._convertBindPoses(t);var n=e.clusters.length;this._bindPosesByIndex=[];for(var i=0;n>i;++i){var a=e.clusters[i];this._addJointsToSkeleton(this._getRootNodeForCluster(a));var r=this._jointUIDLookUp[a.limbNode.UID];this._assignInverseBindPose(this._bindPoses[a.limbNode.UID],r.joint,a),this._bindPosesByIndex[r.index]=this._bindPoses[a.limbNode.UID],this._assignJointBinding(a,r.index)}this._localizeBindPoses();var o=new HX.SkeletonJoint;this._fakeJointIndex=this._skeleton.numJoints,this._skeleton.addJoint(o),this._bindPosesByIndex[this._fakeJointIndex]=new HX.Matrix4x4},_localizeBindPoses:function(){for(var e=[],t=0;t<this._skeleton.numJoints;++t){var n=this._bindPosesByIndex[t];if(n){var i=this._skeleton.getJoint(t);if(-1===i.parentIndex)e[t]=n;else{var a=new HX.Matrix4x4;a.inverseOf(this._bindPosesByIndex[i.parentIndex]),a.prepend(n),e[t]=a}}}this._bindPosesByIndex=e},convertClips:function(e,t){this._frameRate=t.frameRate,this._animationClips=[];for(var n=0;n<e.layers.length;++n)for(var i=e.LocalStop.getFrameCount(this._frameRate)-e.LocalStart.getFrameCount(this._frameRate)+1,a=e.layers,r=0;r<a.length;++r){var o=this._convertLayer(a[r],i);this._animationClips.push(o)}},_convertBindPoses:function(e){for(var t=0;t<e.length;++t)for(var n=e[t],i=0;i<n.poseNodes.length;++i){var a=n.poseNodes[i];this._bindPoses[a.targetUID]=a.matrix}},_addJointsToSkeleton:function(e){e.data!==!0&&(e.data=!0,this._convertSkeletonNode(e,-1))},_convertSkeletonNode:function(e,t){var n=new HX.SkeletonJoint;n.parentIndex=t;var i=this._skeleton.numJoints;if(this._skeleton.addJoint(n),this._jointUIDLookUp[e.UID]={joint:n,index:i},e.animationCurveNodes)for(var a in e.animationCurveNodes)if(e.animationCurveNodes.hasOwnProperty(a)){var r=e.animationCurveNodes[a];r.data=i}for(var o=0;o<e.numChildren;++o)this._convertSkeletonNode(e.getChild(o),i)},_assignJointBinding:function(e,t){if(e.indices)for(var n=e.indices.length,i=0;n>i;++i)if(e.weights[i]>0){var a=e.indices[i],r=this._skinningData[a]=this._skinningData[a]||[],o=new HX.FBXModelInstanceConverter._JointBinding;o.jointIndex=t,o.jointWeight=e.weights[i],r.push(o)}},_assignInverseBindPose:function(e,t,n){e?(t.inverseBindPose.copyFrom(e),t.inverseBindPose.invert()):(t.inverseBindPose.copyFrom(n.transformLink),t.inverseBindPose.invert(),t.inverseBindPose.prepend(n.transform))},_getRootNodeForCluster:function(e){for(var t=e.limbNode;t;){if("Root"===t.type)return t;t=t.parent}throw new Error("No Root node found!")},_convertLayer:function(e,t){var n=new HX.SkeletonClip;n.frameRate=this._frameRate,this._convertToFrames(e,t);for(var i=0;t>i;++i)n.addFrame(this._convertFrame(e,i));return n},_convertToFrames:function(e,t){for(var n=e.curveNodes.length,i=0;n>i;++i){var a=e.curveNodes[i];for(var r in a.curves)if(a.curves.hasOwnProperty(r)){var o=a.curves[r];this._convertCurveToFrames(o,t)}}},_convertCurveToFrames:function(e,t){for(var n=0,i=0,a=1e3/this._frameRate,r=e.KeyTime.length,o=[],s=0;t>s;++s){for(n+=a;r>i&&e.KeyTime[i].milliseconds<n;)++i;if(0===i)o.push(e.KeyValueFloat[i]);else if(i===r)o.push(e.KeyValueFloat[i-1]);else{var l=e.KeyTime[i].milliseconds,h=e.KeyTime[i-1].milliseconds,c=(n-h)/(l-h),u=e.KeyValueFloat[i],d=e.KeyValueFloat[i-1];o.push(d+(u-d)*c)}}e.data=o},_convertFrame:function(e,t){for(var n=new HX.SkeletonPose,i=this._skeleton.numJoints,a=e.curveNodes.length,r=[],o=[],s=0;i>s;++s)r[s]=new HX.FBXAnimationConverter._JointPose,o[s]=!1;for(var s=0;a>s;++s){var l=e.curveNodes[s],h=l.data;if(null!==h){var c=r[h][l.propertyName];o[h]=!0;for(var u in l.curves)if(l.curves.hasOwnProperty(u)){var d=l.curves[u].data[t];switch(u){case"d|X":c.x=d;break;case"d|Y":c.y=d;break;case"d|Z":c.z=d}}}}for(var s=0;i>s;++s){var f=new HX.SkeletonJointPose;if(!o[s]&&this._bindPosesByIndex[s])this._bindPosesByIndex[s].decompose(f);else{var p=r[s];f.position.copyFrom(p["Lcl Translation"]),f.scale=p["Lcl Scaling"].x;var _=p["Lcl Rotation"];f.rotation.fromEuler(_.x*HX.DEG_TO_RAD,_.y*HX.DEG_TO_RAD,_.z*HX.DEG_TO_RAD),n.jointPoses[s]=f}}return n.jointPoses[this._fakeJointIndex]=new HX.SkeletonJointPose,n}},HX.FBXAnimationConverter._JointPose=function(){this["Lcl Translation"]=new HX.Float4(0,0,0),this["Lcl Rotation"]=new HX.Float4(0,0,0),this["Lcl Scaling"]=new HX.Float4(1,1,1)},HX.FBXBinaryDeserializer=function(){this._version=0},HX.FBXBinaryDeserializer.prototype={get version(){return this._version},deserialize:function(e){this._data=e,this._verifyHeader(),26!==this._data.getUint16()&&console.log("Suspected oddity with FBX file"),this._version=this._data.getUint32();var t=new HX.FBXRecord;return t.name="[root]",this._deserializeNode(t),t},_verifyHeader:function(){if("Kaydara FBX Binary  \x00"!==this._data.getString(21))throw new Error("Incorrect FBX file header!")},_deserializeNode:function(e){var t;do t=this._importNode(),t&&e.children.push(t);while(t)},_importNode:function(){var e=this._data,t=e.getUint32(),n=e.getUint32(),i=e.getUint32(),a=e.getUint8();if(0===t){if(0!==n||0!==i||0!==a)throw new Error("Invalid null node!");return null}var r=new HX.FBXRecord;r.name=e.getString(a);for(var o=0;n>o;++o){var s=this._parseDataElement();r.data.push(s)}return e.offset!==t&&this._deserializeNode(r),
r},_parseDataElement:function(){var e=this._data.getChar();switch(e){case HX.FBXBinaryDeserializer.BOOLEAN:return this._data.getUint8();case HX.FBXBinaryDeserializer.INT16:return this._data.getInt16();case HX.FBXBinaryDeserializer.INT32:return this._data.getInt32();case HX.FBXBinaryDeserializer.INT64:return this._data.getInt64AsFloat64();case HX.FBXBinaryDeserializer.FLOAT:return this._data.getFloat32();case HX.FBXBinaryDeserializer.DOUBLE:return this._data.getFloat64();case HX.FBXBinaryDeserializer.STRING:var t=this._data.getUint32();return this._data.getString(t);case HX.FBXBinaryDeserializer.RAW:var t=this._data.getUint32();return this._data.getUint8Array(t);default:return this._parseArray(e)}},_parseArray:function(e){var t=this._data.getUint32(),n=this._data.getUint32(),i=this._data.getUint32();if(0===n)switch(e){case HX.FBXBinaryDeserializer.BOOLEAN_ARRAY:return this._data.getUint8Array(t);case HX.FBXBinaryDeserializer.INT32_ARRAY:return this._data.getInt32Array(t);case HX.FBXBinaryDeserializer.INT64_ARRAY:return this._data.getInt64AsFloat64Array(t);case HX.FBXBinaryDeserializer.FLOAT_ARRAY:return this._data.getFloat32Array(t);case HX.FBXBinaryDeserializer.DOUBLE_ARRAY:return this._data.getFloat64Array(t);default:throw new Error("Unknown data type code "+e)}else{var a=this._data.getUint8Array(i);switch(a=pako.inflate(a).buffer,e){case HX.FBXBinaryDeserializer.BOOLEAN_ARRAY:return new Uint8Array(a.buffer);case HX.FBXBinaryDeserializer.INT32_ARRAY:return new Int32Array(a);case HX.FBXBinaryDeserializer.INT64_ARRAY:var a=new HX.DataStream(new DataView(a));return a.getInt64AsFloat64Array(a.byteLength/8);case HX.FBXBinaryDeserializer.FLOAT_ARRAY:return new Float32Array(a);case HX.FBXBinaryDeserializer.DOUBLE_ARRAY:return new Float64Array(a);default:throw new Error("Unknown data type code "+e)}}}},HX.FBXBinaryDeserializer.INT16="Y",HX.FBXBinaryDeserializer.BOOLEAN="C",HX.FBXBinaryDeserializer.INT32="I",HX.FBXBinaryDeserializer.FLOAT="F",HX.FBXBinaryDeserializer.DOUBLE="D",HX.FBXBinaryDeserializer.INT64="L",HX.FBXBinaryDeserializer.BOOLEAN_ARRAY="b",HX.FBXBinaryDeserializer.INT32_ARRAY="i",HX.FBXBinaryDeserializer.FLOAT_ARRAY="f",HX.FBXBinaryDeserializer.DOUBLE_ARRAY="d",HX.FBXBinaryDeserializer.INT64_ARRAY="l",HX.FBXBinaryDeserializer.STRING="S",HX.FBXBinaryDeserializer.RAW="R",HX.FBXConverter=function(){this._settings=null,this._objects=null,this._textureTokens=null,this._textureMaterialMap=null,this._rootNode=null},HX.FBXConverter.prototype={get textureTokens(){return this._textureTokens},get textureMaterialMap(){return this._textureMaterialMap},convert:function(e,t,n,i,a){this._settings=a,this._objects=[],this._textureTokens=[],this._textureMaterialMap=[],this._rootNode=e,this._animationStack=t,this._bindPoses=n,this._convertGroupNode(e,i)},_convertNode:function(e){var t;if(e.mesh)t=this._convertModelMesh(e);else{if(!(e.children&&e.children.length>1))return null;t=new HX.GroupNode,this._convertGroupNode(e,t)}return t.name=e.name,this._convertSceneGraphObject(e,t),t},_convertGroupNode:function(e,t){for(var n=e.children.length,i=0;n>i;++i){var a=this._convertNode(e.children[i]);a&&t.attach(a)}},_convertModelMesh:function(e){var t;if(e.GeometricRotation||e.GeometricScaling||e.GeometricTranslation){var n=new HX.Transform;n.GeometricRotation&&(n.rotation=this._convertRotation(e.GeometricRotation)),n.GeometricScaling&&(n.scale=e.GeometricScaling),n.GeometricTranslation&&(n.position=e.GeometricTranslation),t=n.transformationMatrix}else t=this._settings.transformationMatrix;for(var i=this._convertGeometry(e.mesh,t),a=[],r=e.materials.length,o=0;r>o;++o)a[o]=this._convertMaterial(e.materials[o]);return i.createModelInstance(a)},_convertSceneGraphObject:function(e,t){var n=new HX.Matrix4x4;e.ScalingPivot&&n.appendTranslation(HX.Float4.negate(e.ScalingPivot));var i=e["Lcl Scaling"];i&&n.appendScale(i.x,i.y,i.z),e.ScalingPivot&&n.appendTranslation(e.ScalingPivot),e.ScalingOffset&&n.appendTranslation(e.ScalingOffset),e.RotationPivot&&n.appendTranslation(HX.Float4.negate(e.RotationPivot)),e.PreRotation&&n.appendQuaternion(this._convertRotation(e.PreRotation)),e["Lcl Rotation"]&&n.appendQuaternion(this._convertRotation(e["Lcl Rotation"])),e.PostRotation&&n.appendQuaternion(this._convertRotation(e.PostRotation)),e.RotationPivot&&n.appendTranslation(e.RotationPivot),e.RotationOffset&&n.appendTranslation(e.RotationOffset),e["Lcl Translation"]&&n.appendTranslation(e["Lcl Translation"]),t.transformationMatrix=n},_convertRotation:function(e){var t=new HX.Quaternion;return t.fromEuler(e.x*HX.DEG_TO_RAD,e.y*HX.DEG_TO_RAD,e.z*HX.DEG_TO_RAD),t},_convertGeometry:function(e,t){if(this._objects[e.UID])return this._objects[e.UID];var n=new HX.FBXModelInstanceConverter;return n.convertToModel(e,this._animationStack,this._bindPoses,t,this._settings),this._objects[e.UID]=n,n},_convertMaterial:function(e){if(this._objects[e.UID])return this._objects[e.UID];var t=new HX.PBRMaterial;return t.name=e.name,e.DiffuseColor&&(t.color=e.DiffuseColor),e.Shininess&&(e.ShininessExponent=e.Shininess),e.ShininessExponent&&(t.roughness=Math.sqrt(2/(e.Shininess+2))),e.textures&&(e.textures.NormalMap&&this._convertTexture(e.textures.NormalMap,t,HX.FBXConverter._TextureToken.NORMAL_MAP),e.textures.SpecularColor&&this._convertTexture(e.textures.SpecularColor,t,HX.FBXConverter._TextureToken.SPECULAR_MAP),e.textures.DiffuseColor&&this._convertTexture(e.textures.DiffuseColor,t,HX.FBXConverter._TextureToken.DIFFUSE_MAP)),this._objects[e.UID]=t,t},_convertTexture:function(e,t,n){var i;this._objects[e.UID]?i=this._objects[e.UID]:(i=new HX.FBXConverter._TextureToken,i.name=e.name,i.mapType=n,i.filename=e.relativeFilename?e.relativeFilename:e.video.relativeFilename,this._textureTokens.push(i),this._objects[e.UID]=i);var a=new HX.FBXConverter._TextureMaterialMapping(t,i,n);this._textureMaterialMap.push(a)}},HX.FBXConverter._TextureMaterialMapping=function(e,t,n){this.material=e,this.token=t,this.mapType=n},HX.FBXConverter._TextureToken=function(){this.filename=null,this.name=null,this.UID=null},HX.FBXConverter._TextureToken.NORMAL_MAP=0,HX.FBXConverter._TextureToken.SPECULAR_MAP=1,HX.FBXConverter._TextureToken.DIFFUSE_MAP=2,HX.FBXGraphBuilder=function(){this._settings=null,this._templates=null,this._objects=null,this._rootNode=null,this._animationStack=null,this._bindPoses=null},HX.FBXGraphBuilder.prototype={get bindPoses(){return this._bindPoses},get sceneRoot(){return this._rootNode},get animationStack(){return this._animationStack},build:function(e,t){this._settings=t,this._templates={},this._objects={},this._bindPoses=null,this._rootNode=new HX.FbxNode,this._rootNode.name="hx_rootNode",this._animationStack=null,this._processTemplates(e.getChildByName("Definitions")),this._processObjects(e.getChildByName("Objects")),this._processConnections(e.getChildByName("Connections"))},_processTemplates:function(e){for(var t=e.children.length,n=0;t>n;++n){var i=e.children[n];if("ObjectType"===i.name){var a=i.getChildByName("PropertyTemplate");if(!a)continue;var r=a.data[0],o=i.data[0],s=this._createNode(o,r,a);s&&this._assignProperties(s,a.getChildByName("Properties70")),this._templates[o]=s}}},_processObjects:function(e){for(var t=e.children.length,n=0;t>n;++n){var i=null,a=e.children[n];switch(a.name){case"Geometry":i=this._processGeometry(a);break;case"NodeAttribute":i=new HX.FbxNodeAttribute,i.type=a.data[2];break;case"Model":i=new HX.FbxNode,i.type=a.data[2];break;case"Material":i=new HX.FbxMaterial;break;case"Video":i=new HX.FbxVideo;var r=a.getChildByName("RelativeFilename");i.relativeFilename=r?r.data[0]:null;break;case"Texture":i=new HX.FbxFileTexture;var r=a.getChildByName("RelativeFilename");i.relativeFilename=r?r.data[0]:null;break;case"Pose":i=this._processPose(a),this._bindPoses=this._bindPoses||[],this._bindPoses.push(i);break;case"Deformer":i="Skin"===a.data[2]?new HX.FbxSkin:this._processCluster(a);break;case"AnimationStack":i=new HX.FbxAnimStack,this._animationStack=i;break;case"AnimationLayer":i=new HX.FbxAnimLayer;break;case"AnimationCurve":i=new HX.FbxAnimationCurve,this._assignFlatData(i,a);for(var o=[],s=0;s<i.KeyTime.length;++s)o[s]=new HX.FbxTime(i.KeyTime[s]);i.KeyTime=o;break;case"AnimationCurveNode":i=new HX.FbxAnimationCurveNode;break;default:i=new HX.FbxTrashNode}if(i){var l=a.data[0];i.name=this._getObjectDefName(a),i.UID=l,this._templates[a.name]&&i.copyProperties(this._templates[a.name]),this._assignProperties(i,a.getChildByName("Properties70")),this._objects[l]=i}}},_processPose:function(e){var t=new HX.FbxPose;t.type=e.data[2];for(var n=0;n<e.children.length;++n){var i=e.children[n];if("PoseNode"===i.name){var a=new HX.FbxPoseNode;a.targetUID=i.getChildByName("Node").data[0],a.matrix=new HX.Matrix4x4(i.getChildByName("Matrix").data[0]),t.poseNodes.push(a)}}return t},_processConnections:function(e){for(var t=e.children.length,n=0;t>n;++n){var i=e.children[n],a=i.data[0],r=this._objects[i.data[1]],o=this._objects[i.data[2]]||this._rootNode;"OO"===a?o.connectObject(r):"OP"===a&&o.connectProperty(r,i.data[3])}},_createNode:function(e,t){return"Material"===e?new HX.FbxMaterial:HX[t]?new HX[t]:void 0},_assignFlatData:function(e,t){for(var n=t.children.length,i=0;n>i;++i){var a=t.children[i];e.hasOwnProperty(a.name)&&(e[a.name]=a.data[0])}},_assignProperties:function(e,t){if(t)for(var n=t.children.length,i=0;n>i;++i){var a=t.children[i];e.hasOwnProperty(a.data[0])&&(e[a.data[0]]=this._getPropertyValue(a))}},_getPropertyValue:function(e){var t=e.data;switch(t[1]){case"Vector3D":case"Lcl Translation":case"Lcl Scaling":case"Lcl Rotatfion":return new HX.Float4(t[4],t[5],t[6]);case"bool":case"Visibility":case"Visibility Inheritance":return 0!==t[4];case"ColorRGB":case"Color":return new HX.Color(t[4],t[5],t[6]);case"enum":case"double":case"float":case"int":case"KString":return t[4];case"KTime":return new HX.FbxTime(t[4]);case"object":return null}},_processGeometry:function(e){for(var t=new HX.FbxMesh,n=e.children.length,i={},a=0;n>a;++a){var r=e.children[a];switch(r.name){case"Vertices":t.vertices=r.data[0];break;case"PolygonVertexIndex":t.indices=r.data[0];break;case"Layer":t.layerElements=t.layerElements||{},this._processLayer(r,i,t.layerElements);break;default:i[r.name]||(i[r.name]=r)}}return t},_processLayer:function(e,t,n){for(var i=e.children.length,a=0;i>a;++a){var r=e.children[a];if("LayerElement"===r.name){var o=r.getChildByName("Type").data[0];if(!n[r.type]){var r=this._processLayerElement(t[o]);n[r.type]=r}}}},_processLayerElement:function(e){for(var t=new HX.FbxLayerElement,n=e.children.length,i=0;n>i;++i){var a=e.children[i];switch(a.name){case"MappingInformationType":var r=a.data[0];t.mappingInformationType="ByPolygonVertex"===r?HX.FbxLayerElement.MAPPING_TYPE.BY_POLYGON_VERTEX:"ByPolygon"===r?HX.FbxLayerElement.MAPPING_TYPE.BY_POLYGON:"AllSame"===r?HX.FbxLayerElement.MAPPING_TYPE.ALL_SAME:HX.FbxLayerElement.MAPPING_TYPE.BY_CONTROL_POINT;break;case"ReferenceInformationType":t.referenceInformationType="Direct"===a.data[0]?HX.FbxLayerElement.REFERENCE_TYPE.DIRECT:HX.FbxLayerElement.REFERENCE_TYPE.INDEX_TO_DIRECT;break;case"Normals":case"Colors":case"UV":case"Smoothing":t.type=a.name,t.directData=a.data[0];break;case"NormalsIndex":case"ColorIndex":case"UVIndex":case"SmoothingIndex":t.indexData=a.data[0];break;case"Materials":t.type=a.name,t.indexData=a.data[0]}}return t},_getObjectDefName:function(e){return e.data[1].split(HX.FBXGraphBuilder._STRING_DEMARCATION)[0]},_processCluster:function(e){for(var t=new HX.FbxCluster,n=e.children.length,i=0;n>i;++i){var a=e.children[i];switch(a.name){case"Transform":t.transform=new HX.Matrix4x4(a.data[0]);break;case"TransformLink":t.transformLink=new HX.Matrix4x4(a.data[0]);break;case"Indexes":t.indices=a.data[0];break;case"Weights":t.weights=a.data[0]}}return t}},HX.FBXGraphBuilder._STRING_DEMARCATION=String.fromCharCode(0,1),HX.FBXModelInstanceConverter=function(){this._perMaterialData=null,this._expandedMesh=null,this._vertexStride=0,this._ctrlPointLookUp=null,this._model=null,this._animationConverter=null,this._fakeJointIndex=-1,this._useSkinning=!1},HX.FBXModelInstanceConverter.prototype={createModelInstance:function(e){for(var t=[],n=this._modelMaterialIDs.length,i=0;n>i;++i)t[i]=e[this._modelMaterialIDs[i]];var a=new HX.ModelInstance(this._model,t),r=this._animationConverter.animationClips;if(r){if(1!==r.length)throw new Error("TODO! Implement blend node");a.addComponent(new HX.SkeletonAnimation(r[0]))}return a},convertToModel:function(e,t,n,i,a){this._perMaterialData=[],this._ctrlPointLookUp=[],this._modelMaterialIDs=[],this._useSkinning=!1,this._modelData=new HX.ModelData,this._animationConverter=new HX.FBXAnimationConverter,this._generateSkinningData(e,n),this._generateExpandedMeshData(e,i),this._vertexStride=HX.MeshData.DEFAULT_VERTEX_SIZE,this._expandedMesh.hasColor&&(this._vertexStride+=3),this._splitPerMaterial(),this._generateModel(),this._animationConverter.convertClips(t,a),this._model.name=e.name},_generateExpandedMeshData:function(e,t){this._expandedMesh=new HX.FBXModelInstanceConverter._ExpandedMesh;var n,i,a,r,o=e.indices,s=e.vertices,l=e.layerElements;l&&(n=l.Normals,i=l.Colors,a=l.UV,r=l.Materials);var h=[],c=0,u=0;n&&(this._expandedMesh.hasNormals=!0),i&&(this._expandedMesh.hasColor=!0),a&&(this._expandedMesh.hasUVs=!0);for(var d=o.length,f=0;d>f;++f){var p=o[f],_=new HX.FBXModelInstanceConverter._Vertex;if(0>p&&(p=-p-1,_.lastVertex=!0),_.pos.x=s[3*p],_.pos.y=s[3*p+1],_.pos.z=s[3*p+2],t&&t.transformPoint(_.pos,_.pos),this._modelData.skeleton&&(_.jointBindings=this._animationConverter.getJointBinding(p)),_.ctrlPointIndex=p,n&&(_.normal=this._extractLayerData(n,p,f,3),t&&t.transformVector(_.normal,_.normal)),i&&(_.color=this._extractLayerData(i,p,f,3)),a&&(_.uv=this._extractLayerData(a,p,f,2)),r&&r.mappingInformationType!==HX.FbxLayerElement.MAPPING_TYPE.ALL_SAME){var m=r.indexData[c];_.materialIndex=m,m>u&&(u=m)}_.lastVertex&&++c,h[f]=_}this._expandedMesh.vertices=h,this._expandedMesh.numMaterials=u+1},_extractLayerData:function(e,t,n,i){var a=i>2?new HX.Float4:new HX.Float2;if(e.referenceInformationType===HX.FbxLayerElement.REFERENCE_TYPE.DIRECT){var r=e.mappingInformationType===HX.FbxLayerElement.MAPPING_TYPE.BY_CONTROL_POINT?t:n;a.x=e.directData[r*i],a.y=e.directData[r*i+1],i>2&&(a.z=e.directData[r*i+2])}else{var r=e.mappingInformationType===HX.FbxLayerElement.MAPPING_TYPE.BY_CONTROL_POINT?e.indexData[t]:e.indexData[n];a.x=e.directData[r*i],a.y=e.directData[r*i+1],i>2&&(a.z=e.directData[r*i+2])}return a},_splitPerMaterial:function(){for(var e=0;e<this._expandedMesh.numMaterials;++e)this._perMaterialData[e]=new HX.FBXModelInstanceConverter._PerMaterialData;for(var t,n,i,e=0,a=0,r=this._expandedMesh.vertices,o=r.length,s=!0;o>e;){var l=this._perMaterialData[r[e].materialIndex];if(l.vertices||(s=!0),s&&(s=!1,l.indexCounter=0,l.indices=[],l.vertices=[],l.ctrlPointIndices=[],l.indexLookUp={},l.indexStack.push(l.indices),l.vertexStack.push(l.vertices),l.ctrlPointStack.push(l.ctrlPointIndices),this._useSkinning&&(l.skinning=[],l.skinningStack.push(l.skinning))),t=this._getOrAddIndex(r[e]),0>t)s=!0;else if(n=this._getOrAddIndex(r[e+1]),0>n)s=!0;else{e+=2;var h;do if(h=r[e],i=this._getOrAddIndex(h),0>i)s=!0;else{++e;var c=this._perMaterialData[h.materialIndex].indices;c[a]=t,c[a+1]=n,c[a+2]=i,a+=3,n=i}while(!h.lastVertex&&!s)}}},_getOrAddIndex:function(e){var t=e.getHash(),n=this._perMaterialData[e.materialIndex],i=n.indexLookUp;if(i.hasOwnProperty(t))return i[t];if(n.indexCounter>65535)return-1;var a=n.skinning,r=n.vertices,o=n.indexCounter++,s=o*this._vertexStride,l=8*o;if(n.ctrlPointIndices[e.ctrlPointIndex]=o,i[t]=o,r[s]=e.pos.x,r[s+1]=e.pos.y,r[s+2]=e.pos.z,a){var h=e.jointBindings,c=h?h.length:0;c>4&&(c=4,console.warn("Warning: more than 4 joints not supported. Model will not animate correctly"),h.sort(function(e,t){return t.jointWeight-e.jointWeight}));for(var u=0,d=0;c>d;++d){var f=h[d].jointWeight;a[l+d]=h[d].jointIndex,a[l+d+4]=f,u+=f}u=u>=1?0:1-u;for(var d=c;4>d;++d)a[l+d]=this._fakeJointIndex,a[l+d+4]=d===c?u:0}return this._expandedMesh.hasNormals?(r[s+3]=e.normal.x,r[s+4]=e.normal.y,r[s+5]=e.normal.z):r[s+3]=r[s+4]=r[s+5]=0,r[s+6]=r[s+7]=r[s+8]=r[s+9]=0,this._expandedMesh.hasUVs?(r[s+10]=e.uv.x,r[s+11]=e.uv.y):r[s+10]=r[s+11]=0,this._expandedMesh.hasColor&&(r[s+12]=e.color.x,r[s+13]=e.color.y,r[s+14]=e.color.z),o},_generateModel:function(){for(var e=0,t=this._expandedMesh.numMaterials,n=0;t>n;++n)for(var i=this._perMaterialData[n],a=i.indexStack.length,r=0;a>r;++r){var o=HX.MeshData.createDefaultEmpty();this._expandedMesh.hasColor&&o.addVertexAttribute("hx_vertexColor",3),o.setVertexData(i.vertexStack[r],0),o.setIndexData(i.indexStack[r]),this._useSkinning&&(o.addVertexAttribute("hx_boneIndices",4,1),o.addVertexAttribute("hx_boneWeights",4,1),o.setVertexData(i.skinningStack[r],1));for(var s=i.ctrlPointStack[r],l=s.length,h=0;l>h;++h)this._ctrlPointLookUp[s[h]]={index:h,meshIndex:e};++e,this._modelMaterialIDs.push(n);var c=HX.NormalTangentGenerator.MODE_TANGENTS;this._expandedMesh.hasNormals||(c|=HX.NormalTangentGenerator.MODE_NORMALS);var u=new HX.NormalTangentGenerator;u.generate(o,c),this._modelData.addMeshData(o)}this._model=new HX.Model(this._modelData)},_generateSkinningData:function(e,t){var n=e.deformers.length;if(0!==n){if(n>1)throw new Error("Multiple skins not supported");this._animationConverter.convertSkin(e.deformers[0],t),this._modelData.skeleton=this._animationConverter.skeleton,this._useSkinning=!0}}},HX.FBXModelInstanceConverter._ExpandedMesh=function(){this.vertices=null,this.hasColor=!1,this.hasUVs=!1,this.hasNormals=!1,this.numMaterials=0},HX.FBXModelInstanceConverter._JointBinding=function(){this.jointIndex=0,this.jointWeight=0},HX.FBXModelInstanceConverter._Vertex=function(){this.pos=new HX.Float4,this.uv=null,this.normal=null,this.color=null,this.materialIndex=0,this.ctrlPointIndex=-1,this.jointBindings=null,this._hash=null,this.lastVertex=!1},HX.FBXModelInstanceConverter._Vertex.prototype={getHash:function(){if(!this._hash){var e=this.ctrlPointIndex+"/"+this.materialIndex+"/"+this.pos.x+"/"+this.pos.y+"/"+this.pos.z;this.normal&&(e=e+"/"+this.normal.x+"/"+this.normal.y+"/"+this.normal.z),this.uv&&(e=e+"/"+this.uv.x+"/"+this.uv.y),this.color&&(e=e+"/"+this.color.x+"/"+this.color.y+"/"+this.color.z),this._hash=e}return this._hash}},HX.FBXModelInstanceConverter._PerMaterialData=function(){this.indexCounter=0,this.vertexStack=[],this.skinningStack=[],this.indexStack=[],this.ctrlPointStack=[],this.vertices=null,this.indices=null,this.skinning=null,this.ctrlPointIndices=null,this.indexLookUp={}},HX.FBXRecord=function(){this.name="",this.data=[],this.children=[]},HX.FBXRecord.prototype={getChildByName:function(e){for(var t=this.children.length,n=0;t>n;++n){var i=this.children[n];if(i.name===e)return i}},printDebug:function(e,t){void 0===e&&(e=!0),void 0===t&&(t=0);for(var n="",i=0;t>i;++i)n+="	";if(console.log(n+this.name),e&&this.data.length>0){console.log(n+"	[data] {");for(var i=0;i<this.data.length;++i)console.log(n+"		["+i+"] : "+this.data[i]);console.log(n+"}")}for(var i=0;i<this.children.length;++i)this.children[i].printDebug(e,t+1)}},HX.FBXSettings=function(){this._matrix=new HX.Matrix4x4,this._frameRate=24},HX.FBXSettings.prototype={get orientationMatrix(){return this._matrix},get frameRate(){return this._frameRate},init:function(e){for(var t=1,n=1,i=2,a=1,r=e.getChildByName("GlobalSettings"),o=r.getChildByName("Properties70"),s=o.children.length,l=[0,120,100,60,50,48,30],h=0;s>h;++h){var c=o.children[h];switch(c.data[0]){case"UpAxis":t=c.data[4];break;case"UpAxisSign":n=c.data[4];break;case"FrontAxis":i=c.data[4];break;case"FrontAxisSign":a=c.data[4];break;case"TimeMode":this._frameRate=l[c.data[4]]}}var u=[HX.Float4.X_AXIS,HX.Float4.Y_AXIS,HX.Float4.Z_AXIS],d=u[i].clone(),f=u[t].clone();d.scale(a),f.scale(n),this._matrix.lookAt(d,HX.Float4.ORIGIN_POINT,f),this._matrix.invert()}},HX.MD5Anim=function(){HX.Importer.call(this,HX.SkeletonClip),this._hierarchy=null,this._baseFrame=null,this._activeFrame=null,this._numJoints=0,this._correctionQuad=new HX.Quaternion,this._correctionQuad.fromAxisAngle(HX.Float4.X_AXIS,.5*-Math.PI)},HX.MD5Anim.prototype=Object.create(HX.Importer.prototype),HX.MD5Anim.prototype.parse=function(e,t){this._hierarchy=[],this._baseFrame=[],this._target=t;for(var n=e.split("\n"),i=n.length,a=null,r=0;i>r;++r){var o=n[r].replace(/^\s+|\s+$/g,""),s=o.split(/\s+/);if("//"!==s[0]&&""!==s[0])if(a)a.call(this,s),"}"===s[0]&&(a=null);else switch(s[0]){case"commandline":case"numFrames":case"MD5Version":case"numAnimatedComponents":break;case"numJoints":this._numJoints=parseInt(s[1]);break;case"frameRate":t.frameRate=parseInt(s[1]);break;case"hierarchy":a=this._parseHierarchy;break;case"bounds":a=this._parseBounds;break;case"baseframe":a=this._parseBaseFrame;break;case"frame":this._activeFrame=new HX.MD5Anim._FrameData,a=this._parseFrame}}this._notifyComplete(t)},HX.MD5Anim.prototype._parseHierarchy=function(e){if("}"!==e[0]){var t=new HX.MD5Anim._HierachyData;t.name=e[0].substring(1,e[0].length-1),t.parent=parseInt(e[1]),t.flags=parseInt(e[2]),t.startIndex=parseInt(e[3]),this._hierarchy.push(t)}},HX.MD5Anim.prototype._parseBounds=function(e){},HX.MD5Anim.prototype._parseBaseFrame=function(e){if("}"!==e[0]){var t=new HX.MD5Anim._BaseFrameData,n=t.pos;n.x=parseFloat(e[1]),n.y=parseFloat(e[2]),n.z=parseFloat(e[3]);var i=t.quat;i.x=parseFloat(e[6]),i.y=parseFloat(e[7]),i.z=parseFloat(e[8]),i.w=1-i.x*i.x-i.y*i.y-i.z*i.z,i.w=i.w<0?0:-Math.sqrt(i.w),this._baseFrame.push(t)}},HX.MD5Anim.prototype._parseFrame=function(e){if("}"===e[0])return void this._translateFrame();for(var t=e.length,n=0;t>n;++n)this._activeFrame.components.push(parseFloat(e[n]))},HX.MD5Anim.prototype._translateFrame=function(){for(var e=new HX.SkeletonPose,t=0;t<this._numJoints;++t){var n=new HX.SkeletonJointPose,i=this._hierarchy[t],a=this._baseFrame[t],r=i.flags,o=a.pos,s=a.quat,l=this._activeFrame.components,h=i.startIndex;1&r&&(o.x=l[h]),2&r&&(o.y=l[h+1]),4&r&&(o.z=l[h+2]),8&r&&(s.x=l[h+3]),16&r&&(s.y=l[h+4]),32&r&&(s.z=l[h+5]);var c=1-s.x*s.x-s.y*s.y-s.z*s.z;s.w=0>c?0:-Math.sqrt(c),i.parent<0?(n.rotation.multiply(this._correctionQuad,s),n.position=this._correctionQuad.rotate(o)):(n.rotation.copyFrom(s),n.position.copyFrom(o)),e.jointPoses.push(n)}this._target.addFrame(e)},HX.MD5Anim._HierachyData=function(){this.name=null,this.parent=-1,this.flags=0,this.startIndex=0},HX.MD5Anim._BaseFrameData=function(){this.pos=new HX.Float4,this.quat=new HX.Quaternion},HX.MD5Anim._FrameData=function(){this.components=[]},HX.MD5Mesh=function(){HX.Importer.call(this,HX.Model),this._target=null,this._meshData=null,this._jointData=null,this._skeleton=null,this._correctionQuad=new HX.Quaternion,this._correctionQuad.fromAxisAngle(HX.Float4.X_AXIS,.5*-Math.PI)},HX.MD5Mesh.prototype=Object.create(HX.Importer.prototype),HX.MD5Mesh.prototype.parse=function(e,t){this._modelData=new HX.ModelData,this._skeleton=new HX.Skeleton,this._jointData=[];for(var n=e.split("\n"),i=n.length,a=null,r=0;i>r;++r){var o=n[r].replace(/^\s+|\s+$/g,""),s=o.split(/\s+/);if("//"!==s[0]&&""!==s[0])if(a)a.call(this,s),"}"===s[0]&&(a=null);else switch(s[0]){case"commandline":case"numMeshes":case"numJoints":case"MD5Version":break;case"joints":a=this._parseJoint;break;case"mesh":this._meshData=new HX.MD5Mesh._MeshData,a=this._parseMesh}}t._setModelData(this._modelData),t.skeleton=this._skeleton,this._notifyComplete(t)},HX.MD5Mesh.prototype._parseJoint=function(e){if("}"!==e[0]){var t=new HX.MD5Mesh._Joint,n=t.pos,i=t.quat;t.name=e[0].substring(1,e[0].length-1),t.parentIndex=parseInt(e[1]),n.x=parseFloat(e[3]),n.y=parseFloat(e[4]),n.z=parseFloat(e[5]),this._correctionQuad.rotate(t.pos,t.pos),i.x=parseFloat(e[8]),i.y=parseFloat(e[9]),i.z=parseFloat(e[10]),i.w=1-i.x*i.x-i.y*i.y-i.z*i.z,i.w=i.w<0?0:-Math.sqrt(i.w),i.multiply(this._correctionQuad,i),this._jointData.push(t);var a=new HX.SkeletonJoint;a.inverseBindPose.fromQuaternion(i);var n=t.pos;a.inverseBindPose.appendTranslation(n),a.inverseBindPose.invertAffine(),a.parentIndex=t.parentIndex,this._skeleton.addJoint(a)}},HX.MD5Mesh.prototype._parseMesh=function(e){switch(e[0]){case"shader":case"numVerts":case"numWeights":break;case"tri":this._meshData.indices.push(parseInt(e[2]),parseInt(e[4]),parseInt(e[3]));break;case"vert":this._parseVert(e);break;case"weight":this._parseWeight(e);break;case"}":this._translateMesh()}},HX.MD5Mesh.prototype._parseVert=function(e){var t=new HX.MD5Mesh._VertexData;t.u=parseFloat(e[3]),t.v=parseFloat(e[4]),t.startWeight=parseInt(e[6]),t.countWeight=parseInt(e[7]),this._meshData.vertexData.push(t)},HX.MD5Mesh.prototype._parseWeight=function(e){var t=new HX.MD5Mesh._WeightData;t.joint=parseInt(e[2]),t.bias=parseFloat(e[3]),t.pos.x=parseFloat(e[5]),t.pos.y=parseFloat(e[6]),t.pos.z=parseFloat(e[7]),this._meshData.weightData.push(t)},HX.MD5Mesh.prototype._translateMesh=function(){var e=new HX.MeshData.createDefaultEmpty;e.addVertexAttribute("hx_boneIndices",4,1),e.addVertexAttribute("hx_boneWeights",4,1);for(var t,n,i,a=[],r=[],o=this._meshData.vertexData,s=o.length,l=0,h=0,c=0;s>c;++c){var u=o[c];t=n=i=0,u.countWeight>4&&console.warn("Warning: more than 4 weights assigned. Mesh will not animate correctly");for(var d=0;d<u.countWeight;++d){var f=this._meshData.weightData[u.startWeight+d],p=this._jointData[f.joint],_=p.quat.rotate(f.pos),m=p.pos,b=f.bias;t+=(_.x+m.x)*b,n+=(_.y+m.y)*b,i+=(_.z+m.z)*b,4>d&&(r[h+d]=f.joint,r[h+4+d]=f.bias)}a[l]=t,a[l+1]=n,a[l+2]=i,a[l+10]=u.u,a[l+11]=1-u.v;for(var d=u.countWeight;4>d;++d)r[h+d]=0,r[h+4+d]=0;h+=8,l+=12}e.setVertexData(a,0),e.setVertexData(r,1),e.setIndexData(this._meshData.indices);var v=new HX.NormalTangentGenerator;v.generate(e),this._modelData.addMeshData(e)},HX.MD5Mesh._Joint=function(){this.name=null,this.parentIndex=-1,this.quat=new HX.Quaternion,this.pos=new HX.Float4},HX.MD5Mesh._MeshData=function(){this.vertexData=[],this.weightData=[],this.indices=[]},HX.MD5Mesh._VertexData=function(){this.u=0,this.v=0,this.startWeight=0,this.countWeight=0},HX.MD5Mesh._WeightData=function(){this.joint=0,this.bias=0,this.pos=new HX.Float4},HX.MTL=function(){HX.Importer.call(this,Object,HX.URLLoader.DATA_TEXT),this._textures=[],this._texturesToLoad=[],this._activeMaterial=null},HX.MTL.prototype=Object.create(HX.Importer.prototype),HX.MTL.prototype.parse=function(e,t){for(var n=e.split("\n"),i=n.length,a=0;i>a;++a){var r=n[a].replace(/^\s+|\s+$/g,"");this._parseLine(r,t)}return this._loadTextures(t),t},HX.MTL.prototype._parseLine=function(e,t){if(0!==e.length&&"#"!==e.charAt(0)){var n=e.split(/\s+/);switch(n[0].toLowerCase()){case"newmtl":this._activeMaterial=new HX.PBRMaterial,this._activeMaterial.name=n[1],t[n[1]]=this._activeMaterial;break;case"ns":var i=parseFloat(n[1]);this._activeMaterial.roughness=Math.sqrt(2/(i+2));break;case"kd":this._activeMaterial.color=new HX.Color(parseFloat(n[1]),parseFloat(n[2]),parseFloat(n[3]));break;case"map_kd":this._activeMaterial.colorMap=this._getTexture(n[1]);break;case"map_d":this._activeMaterial.maskMap=this._getTexture(n[1]),this._activeMaterial.alphaThreshold=.5;break;case"map_ns":this._activeMaterial.specularMap=this._getTexture(n[1]);break;case"map_bump":case"bump":this._activeMaterial.normalMap=this._getTexture(n[1])}}},HX.MTL.prototype._getTexture=function(e){return this._textures[e]||(this._textures[e]=new HX.Texture2D,this._texturesToLoad.push({file:this._correctURL(e),importer:HX.JPG,target:this._textures[e]})),this._textures[e]},HX.MTL.prototype._loadTextures=function(e){var t=this._texturesToLoad,n=t.length;if(0===n)return void this._notifyComplete(e);var i=this,a=new HX.BulkAssetLoader;a.onComplete=function(){i._notifyComplete(e)},a.onFail=function(e){i._notifyFailure(e)},a.load(t)},HX.OBJ=function(){HX.Importer.call(this,HX.GroupNode),this._objects=[],this._vertices=[],this._normals=[],this._uvs=[],this._hasNormals=!1,this._defaultMaterial=new HX.PBRMaterial,this._target=null,this._mtlLibFile=null},HX.OBJ.prototype=Object.create(HX.Importer.prototype),HX.OBJ.prototype.parse=function(e,t){this._groupsAsObjects=void 0===this.options.groupsAsObjects?!0:this._groupsAsObjects,this._target=t;var n=e.split("\n"),i=n.length;this._pushNewObject("hx_default");for(var a=0;i>a;++a){var r=n[a].replace(/^\s+|\s+$/g,"");this._parseLine(r)}this._mtlLibFile?this._loadMTLLib(this._mtlLibFile):this._finish(null)},HX.OBJ.prototype._finish=function(e){this._translate(e),this._notifyComplete(this._target)},HX.OBJ.prototype._loadMTLLib=function(e){var t=new HX.AssetLoader(HX.MTL),n=this;t.onComplete=function(e){n._finish(e)},t.onFail=function(e){n._notifyFailure(e)},t.load(e)},HX.OBJ.prototype._parseLine=function(e){if(0!==e.length&&"#"!==e.charAt(0)){var t=e.split(/\s+/);switch(t[0].toLowerCase()){case"mtllib":this._mtlLibFile=this._correctURL(t[1]);break;case"usemtl":this._setActiveSubGroup(t[1]);break;case"v":this._vertices.push(parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3]));break;case"vt":this._uvs.push(parseFloat(t[1]),parseFloat(t[2]));break;case"vn":this._normals.push(parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3]));break;case"o":this._pushNewObject(t[1]);break;case"g":this._groupsAsObjects?this._pushNewObject(t[1]):this._pushNewGroup(t[1]);break;case"f":this._parseFaceData(t)}}},HX.OBJ.prototype._pushNewObject=function(e){this._activeObject=new HX.OBJ._ObjectData,this._objects.push(this._activeObject),this._pushNewGroup("hx_default")},HX.OBJ.prototype._pushNewGroup=function(e){this._activeGroup=new HX.OBJ._GroupData,this._activeGroup.name=e||"Group"+this._activeGroup.length,this._activeObject.groups.push(this._activeGroup),this._setActiveSubGroup("hx_default")},HX.OBJ.prototype._setActiveSubGroup=function(e){this._activeGroup.subgroups[e]=this._activeGroup.subgroups[e]||new HX.OBJ._SubGroupData,this._activeSubGroup=this._activeGroup.subgroups[e]},HX.OBJ.prototype._parseFaceData=function(e){for(var t=new HX.OBJ._FaceData,n=e.length,i=1;n>i;++i){var a=new HX.OBJ._FaceVertexData;t.vertices.push(a);var r=e[i].split("/"),o=3*(r[0]-1);a.posX=this._vertices[o],a.posY=this._vertices[o+1],a.posZ=this._vertices[o+2],r.length>1&&(o=2*(r[1]-1),a.uvU=this._uvs[o],a.uvV=this._uvs[o+1],r.length>2&&(o=3*(r[2]-1),this._hasNormals=!0,a.normalX=this._normals[o],a.normalY=this._normals[o+1],a.normalZ=this._normals[o+2]))}this._activeSubGroup.faces.push(t),this._activeSubGroup.numIndices+=4===e.length?3:6},HX.OBJ.prototype._translate=function(e){for(var t=this._objects.length,n=0;t>n;++n)this._translateObject(this._objects[n],e)},HX.OBJ.prototype._translateObject=function(e,t){var n=e.groups.length;if(0!==n){for(var i=new HX.ModelData,a=[],r=new HX.Model,o=0;n>o;++o){var s=e.groups[o];for(var l in s.subgroups)if(s.subgroups.hasOwnProperty(l)){var h=s.subgroups[l];if(0===h.numIndices)continue;i.addMeshData(this._translateMeshData(h));var c=t?t[l]:null;c=c||this._defaultMaterial,a.push(c)}}r._setModelData(i);var u=new HX.ModelInstance(r,a);u.name=e.name,this._target.attach(u)}},HX.OBJ.prototype._translateMeshData=function(e){for(var t=HX.MeshData.createDefaultEmpty(),n=[],i=new Array(e.numIndices),a=0,r=0,o=e.faces,s=o.length,l=0;s>l;++l){for(var h=o[l],c=h.vertices,u=c.length,d=0;u>d;++d){var f=c[d],p=f.getHash();n.hasOwnProperty(p)||(n[p]={index:a++,vertex:f})}i[r]=n[c[0].getHash()].index,i[r+1]=n[c[1].getHash()].index,i[r+2]=n[c[2].getHash()].index,r+=3,4===u&&(i[r]=n[c[0].getHash()].index,i[r+1]=n[c[2].getHash()].index,i[r+2]=n[c[3].getHash()].index,r+=3)}var _=new Array(a*HX.MeshData.DEFAULT_VERTEX_SIZE);for(var p in n)if(n.hasOwnProperty(p)){var m=n[p],b=m.vertex,v=m.index*HX.MeshData.DEFAULT_VERTEX_SIZE;_[v]=b.posX,_[v+1]=b.posY,_[v+2]=b.posZ,_[v+3]=b.normalX,_[v+4]=b.normalY,_[v+5]=b.normalZ,_[v+6]=0,_[v+7]=0,_[v+8]=0,_[v+9]=1,_[v+10]=b.uvU,_[v+11]=b.uvV}t.setVertexData(_,0),t.setIndexData(i);var x=HX.NormalTangentGenerator.MODE_TANGENTS;this._hasNormals||(x|=HX.NormalTangentGenerator.MODE_NORMALS);var X=new HX.NormalTangentGenerator;return X.generate(t,x,!0),
t},HX.OBJ._FaceVertexData=function(){this.posX=0,this.posY=0,this.posZ=0,this.uvU=0,this.uvV=0,this.normalX=0,this.normalY=0,this.normalZ=0,this._hash=""},HX.OBJ._FaceVertexData.prototype={getHash:function(){return this._hash||(this._hash=this.posX+"/"+this.posY+"/"+this.posZ+"/"+this.uvU+"/"+this.uvV+"/"+this.normalX+"/"+this.normalY+"/"+this.normalZ+"/"),this._hash}},HX.OBJ._FaceData=function(){this.vertices=[]},HX.OBJ._SubGroupData=function(){this.numIndices=0,this.faces=[]},HX.OBJ._GroupData=function(){this.subgroups=[],this.name="",this._activeMaterial=null},HX.OBJ._ObjectData=function(){this.name="",this.groups=[],this._activeGroup=null},HX.FbxAnimationCurve=function(){HX.FbxObject.call(this),this.Default=0,this.KeyVer=0,this.KeyTime=0,this.KeyValueFloat=null,this.KeyAttrFlags=0,this.KeyAttrDataFloat=null,this.KeyAttrRefCount=0},HX.FbxAnimationCurve.prototype=Object.create(HX.FbxObject.prototype),HX.FbxAnimationCurve.prototype.toString=function(){return"[FbxAnimationCurve(name="+this.name+")]"},HX.FbxAnimationCurveNode=function(){HX.FbxObject.call(this),this.curves=null,this["d|X"]=0,this["d|Y"]=0,this["d|Z"]=0,this.propertyName=null},HX.FbxAnimationCurveNode.prototype=Object.create(HX.FbxObject.prototype),HX.FbxAnimationCurveNode.prototype.toString=function(){return"[FbxAnimationCurveNode(name="+this.name+")]"},HX.FbxAnimationCurveNode.prototype.connectProperty=function(e,t){e instanceof HX.FbxAnimationCurve&&(this.curves=this.curves||{},this.curves[t]=e)},HX.FbxAnimLayer=function(){HX.FbxObject.call(this),this.curveNodes=null},HX.FbxAnimLayer.prototype=Object.create(HX.FbxObject.prototype),HX.FbxAnimLayer.prototype.toString=function(){return"[FbxAnimLayer(name="+this.name+")]"},HX.FbxAnimLayer.prototype.connectObject=function(e){if(!(e instanceof HX.FbxAnimationCurveNode))throw new Error("Incompatible child object "+e.toString());this.curveNodes=this.curveNodes||[],this.curveNodes.push(e)},HX.FbxAnimStack=function(){HX.FbxObject.call(this),this.LocalStart=0,this.LocalStop=0,this.ReferenceStart=0,this.ReferenceStop=0,this.layers=null},HX.FbxAnimStack.prototype=Object.create(HX.FbxObject.prototype),HX.FbxAnimStack.prototype.connectObject=function(e){if(!(e instanceof HX.FbxAnimLayer))throw new Error("Incompatible child object "+e.toString());this.layers=this.layers||[],this.layers.push(e)},HX.FbxAnimStack.prototype.toString=function(){return"[FbxAnimStack(name="+this.name+")]"},HX.FbxCluster=function(){HX.FbxObject.call(this),this.limbNode=null,this.transform=null,this.transformLink=null,this.indices=null,this.weights=null},HX.FbxCluster.prototype=Object.create(HX.FbxObject.prototype),HX.FbxCluster.prototype.toString=function(){return"[FbxCluster(name="+this.name+")]"},HX.FbxCluster.prototype.connectObject=function(e){if(!(e instanceof HX.FbxNode))throw new Error("Unhandled object connection "+e.toString());this.limbNode=e},HX.FbxFileTexture=function(){HX.FbxObject.call(this),this.WrapModeU=0,this.WrapModeV=0,this.relativeFilename=null,this.video=null},HX.FbxFileTexture.prototype=Object.create(HX.FbxObject.prototype),HX.FbxFileTexture.prototype.connectObject=function(e){if(!(e instanceof HX.FbxVideo))throw new Error("Incompatible child object!");this.video=e},HX.FbxFileTexture.prototype.toString=function(){return"[FbxFileTexture(name="+this.name+")]"},HX.FbxLayerElement=function(){HX.FbxObject.call(this),this.directData=null,this.indexData=null,this.type=null,this.mappingInformationType=0,this.referenceInformationType=0},HX.FbxLayerElement.prototype=Object.create(HX.FbxObject.prototype),HX.FbxLayerElement.MAPPING_TYPE={NONE:0,BY_POLYGON_VERTEX:1,BY_CONTROL_POINT:2,BY_POLYGON:3,ALL_SAME:4},HX.FbxLayerElement.REFERENCE_TYPE={DIRECT:1,INDEX_TO_DIRECT:2},HX.FbxLayerElement.prototype.toString=function(){return"[FbxLayerElement(name="+this.name+")]"},HX.FbxMaterial=function(){HX.FbxObject.call(this),this.EmissiveColor=null,this.EmissiveFactor=1,this.DiffuseColor=null,this.DiffuseFactor=1,this.ShininessExponent=void 0,this.Shininess=void 0,this.textures=null},HX.FbxMaterial.prototype=Object.create(HX.FbxObject.prototype),HX.FbxMaterial.prototype.connectProperty=function(e,t){if(!(e instanceof HX.FbxFileTexture))throw new Error("Unknown object property!");this.textures=this.textures||{},this.textures[t]=e},HX.FbxMaterial.prototype.toString=function(){return"[FbxMaterial(name="+this.name+")]"},HX.FbxMesh=function(){HX.FbxObject.call(this),this.Color=null,this["Casts Shadows"]=!0,this.vertices=null,this.layerElements=null,this.deformers=null},HX.FbxMesh.prototype=Object.create(HX.FbxObject.prototype),HX.FbxMesh.prototype.toString=function(){return"[FbxMesh(name="+this.name+")]"},HX.FbxMesh.prototype.connectObject=function(e){if(!(e instanceof HX.FbxSkin))throw new Error("Unhandled object connection "+e.toString());this.deformers=this.deformers||[],this.deformers.push(e)},HX.FbxNodeAttribute=function(){HX.FbxObject.call(this),this.type=null},HX.FbxNodeAttribute.prototype=Object.create(HX.FbxObject.prototype),HX.FbxNodeAttribute.prototype.toString=function(){return"[FbxNodeAttribute(name="+this.name+", type="+this.type+")]"},HX.FbxPose=function(){HX.FbxObject.call(this),this.type=null,this.poseNodes=[]},HX.FbxPose.prototype=Object.create(HX.FbxObject.prototype),HX.FbxPose.prototype.toString=function(){return"[FbxPose(name="+this.name+")]"},HX.FbxPoseNode=function(){this.targetUID=null,this.matrix=null},HX.FbxSkin=function(){HX.FbxObject.call(this),this.clusters=null},HX.FbxSkin.prototype=Object.create(HX.FbxObject.prototype),HX.FbxSkin.prototype.toString=function(){return"[FbxSkin(name="+this.name+")]"},HX.FbxSkin.prototype.connectObject=function(e){if(!(e instanceof HX.FbxCluster))throw new Error("Unhandled object connection "+e.toString());this.clusters=this.clusters||[],this.clusters.push(e)},HX.FbxTime=function(e){this._value=e},HX.FbxTime.getSpan=function(e,t){return new HX.FbxTime(t._value-e._value)},HX.FbxTime.TC_MILLISECOND=46186158,HX.FbxTime.prototype={get milliseconds(){return this._value/HX.FbxTime.TC_MILLISECOND},set milliseconds(e){this._value=e*HX.FbxTime.TC_MILLISECOND},getFrameCount:function(e){return Math.floor(this.milliseconds/1e3*e)},toString:function(){return"[FbxTime(name="+this._value+")]"}},HX.FbxTrashNode=function(){HX.FbxObject.call(this)},HX.FbxTrashNode.prototype=Object.create(HX.FbxObject.prototype),HX.FbxTrashNode.prototype.toString=function(){return"[FbxTrashNode(name="+this.name+")]"},HX.FbxTrashNode.prototype.connectObject=function(e){},HX.FbxVideo=function(){HX.FbxObject.call(this),this.relativeFilename=null},HX.FbxVideo.prototype=Object.create(HX.FbxObject.prototype),HX.FbxVideo.prototype.toString=function(){return"[FbxVideo(name="+this.name+")]"};