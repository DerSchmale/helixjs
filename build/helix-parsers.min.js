!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.pako=e()}}(function(){return function e(t,a,r){function n(s,o){if(!a[s]){if(!t[s]){var l="function"==typeof require&&require;if(!o&&l)return l(s,!0);if(i)return i(s,!0);var h=new Error("Cannot find module '"+s+"'");throw h.code="MODULE_NOT_FOUND",h}var c=a[s]={exports:{}};t[s][0].call(c.exports,function(e){var a=t[s][1][e];return n(a?a:e)},c,c.exports,e,t,a,r)}return a[s].exports}for(var i="function"==typeof require&&require,s=0;s<r.length;s++)n(r[s]);return n}({1:[function(e,t,a){"use strict";var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;a.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var a=t.shift();if(a){if("object"!=typeof a)throw new TypeError(a+"must be non-object");for(var r in a)a.hasOwnProperty(r)&&(e[r]=a[r])}}return e},a.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var n={arraySet:function(e,t,a,r,n){if(t.subarray&&e.subarray)return void e.set(t.subarray(a,a+r),n);for(var i=0;r>i;i++)e[n+i]=t[a+i]},flattenChunks:function(e){var t,a,r,n,i,s;for(r=0,t=0,a=e.length;a>t;t++)r+=e[t].length;for(s=new Uint8Array(r),n=0,t=0,a=e.length;a>t;t++)i=e[t],s.set(i,n),n+=i.length;return s}},i={arraySet:function(e,t,a,r,n){for(var i=0;r>i;i++)e[n+i]=t[a+i]},flattenChunks:function(e){return[].concat.apply([],e)}};a.setTyped=function(e){e?(a.Buf8=Uint8Array,a.Buf16=Uint16Array,a.Buf32=Int32Array,a.assign(a,n)):(a.Buf8=Array,a.Buf16=Array,a.Buf32=Array,a.assign(a,i))},a.setTyped(r)},{}],2:[function(e,t,a){"use strict";function r(e,t){if(65537>t&&(e.subarray&&s||!e.subarray&&i))return String.fromCharCode.apply(null,n.shrinkBuf(e,t));for(var a="",r=0;t>r;r++)a+=String.fromCharCode(e[r]);return a}var n=e("./common"),i=!0,s=!0;try{String.fromCharCode.apply(null,[0])}catch(o){i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(o){s=!1}for(var l=new n.Buf8(256),h=0;256>h;h++)l[h]=h>=252?6:h>=248?5:h>=240?4:h>=224?3:h>=192?2:1;l[254]=l[254]=1,a.string2buf=function(e){var t,a,r,i,s,o=e.length,l=0;for(i=0;o>i;i++)a=e.charCodeAt(i),55296===(64512&a)&&o>i+1&&(r=e.charCodeAt(i+1),56320===(64512&r)&&(a=65536+(a-55296<<10)+(r-56320),i++)),l+=128>a?1:2048>a?2:65536>a?3:4;for(t=new n.Buf8(l),s=0,i=0;l>s;i++)a=e.charCodeAt(i),55296===(64512&a)&&o>i+1&&(r=e.charCodeAt(i+1),56320===(64512&r)&&(a=65536+(a-55296<<10)+(r-56320),i++)),128>a?t[s++]=a:2048>a?(t[s++]=192|a>>>6,t[s++]=128|63&a):65536>a?(t[s++]=224|a>>>12,t[s++]=128|a>>>6&63,t[s++]=128|63&a):(t[s++]=240|a>>>18,t[s++]=128|a>>>12&63,t[s++]=128|a>>>6&63,t[s++]=128|63&a);return t},a.buf2binstring=function(e){return r(e,e.length)},a.binstring2buf=function(e){for(var t=new n.Buf8(e.length),a=0,r=t.length;r>a;a++)t[a]=e.charCodeAt(a);return t},a.buf2string=function(e,t){var a,n,i,s,o=t||e.length,h=new Array(2*o);for(n=0,a=0;o>a;)if(i=e[a++],128>i)h[n++]=i;else if(s=l[i],s>4)h[n++]=65533,a+=s-1;else{for(i&=2===s?31:3===s?15:7;s>1&&o>a;)i=i<<6|63&e[a++],s--;s>1?h[n++]=65533:65536>i?h[n++]=i:(i-=65536,h[n++]=55296|i>>10&1023,h[n++]=56320|1023&i)}return r(h,n)},a.utf8border=function(e,t){var a;for(t=t||e.length,t>e.length&&(t=e.length),a=t-1;a>=0&&128===(192&e[a]);)a--;return 0>a?t:0===a?t:a+l[e[a]]>t?a:t}},{"./common":1}],3:[function(e,t,a){"use strict";function r(e,t,a,r){for(var n=65535&e|0,i=e>>>16&65535|0,s=0;0!==a;){s=a>2e3?2e3:a,a-=s;do n=n+t[r++]|0,i=i+n|0;while(--s);n%=65521,i%=65521}return n|i<<16|0}t.exports=r},{}],4:[function(e,t,a){t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],5:[function(e,t,a){"use strict";function r(){for(var e,t=[],a=0;256>a;a++){e=a;for(var r=0;8>r;r++)e=1&e?3988292384^e>>>1:e>>>1;t[a]=e}return t}function n(e,t,a,r){var n=i,s=r+a;e=-1^e;for(var o=r;s>o;o++)e=e>>>8^n[255&(e^t[o])];return-1^e}var i=r();t.exports=n},{}],6:[function(e,t,a){"use strict";function r(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}t.exports=r},{}],7:[function(e,t,a){"use strict";var r=30,n=12;t.exports=function(e,t){var a,i,s,o,l,h,c,u,d,_,p,f,m,X,v,b,x,y,g,H,F,w,D,k,B;a=e.state,i=e.next_in,k=e.input,s=i+(e.avail_in-5),o=e.next_out,B=e.output,l=o-(t-e.avail_out),h=o+(e.avail_out-257),c=a.dmax,u=a.wsize,d=a.whave,_=a.wnext,p=a.window,f=a.hold,m=a.bits,X=a.lencode,v=a.distcode,b=(1<<a.lenbits)-1,x=(1<<a.distbits)-1;e:do{15>m&&(f+=k[i++]<<m,m+=8,f+=k[i++]<<m,m+=8),y=X[f&b];t:for(;;){if(g=y>>>24,f>>>=g,m-=g,g=y>>>16&255,0===g)B[o++]=65535&y;else{if(!(16&g)){if(0===(64&g)){y=X[(65535&y)+(f&(1<<g)-1)];continue t}if(32&g){a.mode=n;break e}e.msg="invalid literal/length code",a.mode=r;break e}H=65535&y,g&=15,g&&(g>m&&(f+=k[i++]<<m,m+=8),H+=f&(1<<g)-1,f>>>=g,m-=g),15>m&&(f+=k[i++]<<m,m+=8,f+=k[i++]<<m,m+=8),y=v[f&x];a:for(;;){if(g=y>>>24,f>>>=g,m-=g,g=y>>>16&255,!(16&g)){if(0===(64&g)){y=v[(65535&y)+(f&(1<<g)-1)];continue a}e.msg="invalid distance code",a.mode=r;break e}if(F=65535&y,g&=15,g>m&&(f+=k[i++]<<m,m+=8,g>m&&(f+=k[i++]<<m,m+=8)),F+=f&(1<<g)-1,F>c){e.msg="invalid distance too far back",a.mode=r;break e}if(f>>>=g,m-=g,g=o-l,F>g){if(g=F-g,g>d&&a.sane){e.msg="invalid distance too far back",a.mode=r;break e}if(w=0,D=p,0===_){if(w+=u-g,H>g){H-=g;do B[o++]=p[w++];while(--g);w=o-F,D=B}}else if(g>_){if(w+=u+_-g,g-=_,H>g){H-=g;do B[o++]=p[w++];while(--g);if(w=0,H>_){g=_,H-=g;do B[o++]=p[w++];while(--g);w=o-F,D=B}}}else if(w+=_-g,H>g){H-=g;do B[o++]=p[w++];while(--g);w=o-F,D=B}for(;H>2;)B[o++]=D[w++],B[o++]=D[w++],B[o++]=D[w++],H-=3;H&&(B[o++]=D[w++],H>1&&(B[o++]=D[w++]))}else{w=o-F;do B[o++]=B[w++],B[o++]=B[w++],B[o++]=B[w++],H-=3;while(H>2);H&&(B[o++]=B[w++],H>1&&(B[o++]=B[w++]))}break}}break}}while(s>i&&h>o);H=m>>3,i-=H,m-=H<<3,f&=(1<<m)-1,e.next_in=i,e.next_out=o,e.avail_in=s>i?5+(s-i):5-(i-s),e.avail_out=h>o?257+(h-o):257-(o-h),a.hold=f,a.bits=m}},{}],8:[function(e,t,a){"use strict";function r(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function n(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new X.Buf16(320),this.work=new X.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function i(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=S,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new X.Buf32(pe),t.distcode=t.distdyn=new X.Buf32(fe),t.sane=1,t.back=-1,B):N}function s(e){var t;return e&&e.state?(t=e.state,t.wsize=0,t.whave=0,t.wnext=0,i(e)):N}function o(e,t){var a,r;return e&&e.state?(r=e.state,0>t?(a=0,t=-t):(a=(t>>4)+1,48>t&&(t&=15)),t&&(8>t||t>15)?N:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=a,r.wbits=t,s(e))):N}function l(e,t){var a,r;return e?(r=new n,e.state=r,r.window=null,a=o(e,t),a!==B&&(e.state=null),a):N}function h(e){return l(e,Xe)}function c(e){if(ve){var t;for(f=new X.Buf32(512),m=new X.Buf32(32),t=0;144>t;)e.lens[t++]=8;for(;256>t;)e.lens[t++]=9;for(;280>t;)e.lens[t++]=7;for(;288>t;)e.lens[t++]=8;for(y(H,e.lens,0,288,f,0,e.work,{bits:9}),t=0;32>t;)e.lens[t++]=5;y(F,e.lens,0,32,m,0,e.work,{bits:5}),ve=!1}e.lencode=f,e.lenbits=9,e.distcode=m,e.distbits=5}function u(e,t,a,r){var n,i=e.state;return null===i.window&&(i.wsize=1<<i.wbits,i.wnext=0,i.whave=0,i.window=new X.Buf8(i.wsize)),r>=i.wsize?(X.arraySet(i.window,t,a-i.wsize,i.wsize,0),i.wnext=0,i.whave=i.wsize):(n=i.wsize-i.wnext,n>r&&(n=r),X.arraySet(i.window,t,a-r,n,i.wnext),r-=n,r?(X.arraySet(i.window,t,a-r,r,0),i.wnext=r,i.whave=i.wsize):(i.wnext+=n,i.wnext===i.wsize&&(i.wnext=0),i.whave<i.wsize&&(i.whave+=n))),0}function d(e,t){var a,n,i,s,o,l,h,d,_,p,f,m,pe,fe,me,Xe,ve,be,xe,ye,ge,He,Fe,we,De=0,ke=new X.Buf8(4),Be=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return N;a=e.state,a.mode===Z&&(a.mode=J),o=e.next_out,i=e.output,h=e.avail_out,s=e.next_in,n=e.input,l=e.avail_in,d=a.hold,_=a.bits,p=l,f=h,He=B;e:for(;;)switch(a.mode){case S:if(0===a.wrap){a.mode=J;break}for(;16>_;){if(0===l)break e;l--,d+=n[s++]<<_,_+=8}if(2&a.wrap&&35615===d){a.check=0,ke[0]=255&d,ke[1]=d>>>8&255,a.check=b(a.check,ke,2,0),d=0,_=0,a.mode=R;break}if(a.flags=0,a.head&&(a.head.done=!1),!(1&a.wrap)||(((255&d)<<8)+(d>>8))%31){e.msg="incorrect header check",a.mode=ue;break}if((15&d)!==I){e.msg="unknown compression method",a.mode=ue;break}if(d>>>=4,_-=4,ge=(15&d)+8,0===a.wbits)a.wbits=ge;else if(ge>a.wbits){e.msg="invalid window size",a.mode=ue;break}a.dmax=1<<ge,e.adler=a.check=1,a.mode=512&d?V:Z,d=0,_=0;break;case R:for(;16>_;){if(0===l)break e;l--,d+=n[s++]<<_,_+=8}if(a.flags=d,(255&a.flags)!==I){e.msg="unknown compression method",a.mode=ue;break}if(57344&a.flags){e.msg="unknown header flags set",a.mode=ue;break}a.head&&(a.head.text=d>>8&1),512&a.flags&&(ke[0]=255&d,ke[1]=d>>>8&255,a.check=b(a.check,ke,2,0)),d=0,_=0,a.mode=C;case C:for(;32>_;){if(0===l)break e;l--,d+=n[s++]<<_,_+=8}a.head&&(a.head.time=d),512&a.flags&&(ke[0]=255&d,ke[1]=d>>>8&255,ke[2]=d>>>16&255,ke[3]=d>>>24&255,a.check=b(a.check,ke,4,0)),d=0,_=0,a.mode=L;case L:for(;16>_;){if(0===l)break e;l--,d+=n[s++]<<_,_+=8}a.head&&(a.head.xflags=255&d,a.head.os=d>>8),512&a.flags&&(ke[0]=255&d,ke[1]=d>>>8&255,a.check=b(a.check,ke,2,0)),d=0,_=0,a.mode=P;case P:if(1024&a.flags){for(;16>_;){if(0===l)break e;l--,d+=n[s++]<<_,_+=8}a.length=d,a.head&&(a.head.extra_len=d),512&a.flags&&(ke[0]=255&d,ke[1]=d>>>8&255,a.check=b(a.check,ke,2,0)),d=0,_=0}else a.head&&(a.head.extra=null);a.mode=j;case j:if(1024&a.flags&&(m=a.length,m>l&&(m=l),m&&(a.head&&(ge=a.head.extra_len-a.length,a.head.extra||(a.head.extra=new Array(a.head.extra_len)),X.arraySet(a.head.extra,n,s,m,ge)),512&a.flags&&(a.check=b(a.check,n,m,s)),l-=m,s+=m,a.length-=m),a.length))break e;a.length=0,a.mode=U;case U:if(2048&a.flags){if(0===l)break e;m=0;do ge=n[s+m++],a.head&&ge&&a.length<65536&&(a.head.name+=String.fromCharCode(ge));while(ge&&l>m);if(512&a.flags&&(a.check=b(a.check,n,m,s)),l-=m,s+=m,ge)break e}else a.head&&(a.head.name=null);a.length=0,a.mode=G;case G:if(4096&a.flags){if(0===l)break e;m=0;do ge=n[s+m++],a.head&&ge&&a.length<65536&&(a.head.comment+=String.fromCharCode(ge));while(ge&&l>m);if(512&a.flags&&(a.check=b(a.check,n,m,s)),l-=m,s+=m,ge)break e}else a.head&&(a.head.comment=null);a.mode=z;case z:if(512&a.flags){for(;16>_;){if(0===l)break e;l--,d+=n[s++]<<_,_+=8}if(d!==(65535&a.check)){e.msg="header crc mismatch",a.mode=ue;break}d=0,_=0}a.head&&(a.head.hcrc=a.flags>>9&1,a.head.done=!0),e.adler=a.check=0,a.mode=Z;break;case V:for(;32>_;){if(0===l)break e;l--,d+=n[s++]<<_,_+=8}e.adler=a.check=r(d),d=0,_=0,a.mode=Y;case Y:if(0===a.havedict)return e.next_out=o,e.avail_out=h,e.next_in=s,e.avail_in=l,a.hold=d,a.bits=_,A;e.adler=a.check=1,a.mode=Z;case Z:if(t===D||t===k)break e;case J:if(a.last){d>>>=7&_,_-=7&_,a.mode=le;break}for(;3>_;){if(0===l)break e;l--,d+=n[s++]<<_,_+=8}switch(a.last=1&d,d>>>=1,_-=1,3&d){case 0:a.mode=W;break;case 1:if(c(a),a.mode=te,t===k){d>>>=2,_-=2;break e}break;case 2:a.mode=K;break;case 3:e.msg="invalid block type",a.mode=ue}d>>>=2,_-=2;break;case W:for(d>>>=7&_,_-=7&_;32>_;){if(0===l)break e;l--,d+=n[s++]<<_,_+=8}if((65535&d)!==(d>>>16^65535)){e.msg="invalid stored block lengths",a.mode=ue;break}if(a.length=65535&d,d=0,_=0,a.mode=Q,t===k)break e;case Q:a.mode=q;case q:if(m=a.length){if(m>l&&(m=l),m>h&&(m=h),0===m)break e;X.arraySet(i,n,s,m,o),l-=m,s+=m,h-=m,o+=m,a.length-=m;break}a.mode=Z;break;case K:for(;14>_;){if(0===l)break e;l--,d+=n[s++]<<_,_+=8}if(a.nlen=(31&d)+257,d>>>=5,_-=5,a.ndist=(31&d)+1,d>>>=5,_-=5,a.ncode=(15&d)+4,d>>>=4,_-=4,a.nlen>286||a.ndist>30){e.msg="too many length or distance symbols",a.mode=ue;break}a.have=0,a.mode=$;case $:for(;a.have<a.ncode;){for(;3>_;){if(0===l)break e;l--,d+=n[s++]<<_,_+=8}a.lens[Be[a.have++]]=7&d,d>>>=3,_-=3}for(;a.have<19;)a.lens[Be[a.have++]]=0;if(a.lencode=a.lendyn,a.lenbits=7,Fe={bits:a.lenbits},He=y(g,a.lens,0,19,a.lencode,0,a.work,Fe),a.lenbits=Fe.bits,He){e.msg="invalid code lengths set",a.mode=ue;break}a.have=0,a.mode=ee;case ee:for(;a.have<a.nlen+a.ndist;){for(;De=a.lencode[d&(1<<a.lenbits)-1],me=De>>>24,Xe=De>>>16&255,ve=65535&De,!(_>=me);){if(0===l)break e;l--,d+=n[s++]<<_,_+=8}if(16>ve)d>>>=me,_-=me,a.lens[a.have++]=ve;else{if(16===ve){for(we=me+2;we>_;){if(0===l)break e;l--,d+=n[s++]<<_,_+=8}if(d>>>=me,_-=me,0===a.have){e.msg="invalid bit length repeat",a.mode=ue;break}ge=a.lens[a.have-1],m=3+(3&d),d>>>=2,_-=2}else if(17===ve){for(we=me+3;we>_;){if(0===l)break e;l--,d+=n[s++]<<_,_+=8}d>>>=me,_-=me,ge=0,m=3+(7&d),d>>>=3,_-=3}else{for(we=me+7;we>_;){if(0===l)break e;l--,d+=n[s++]<<_,_+=8}d>>>=me,_-=me,ge=0,m=11+(127&d),d>>>=7,_-=7}if(a.have+m>a.nlen+a.ndist){e.msg="invalid bit length repeat",a.mode=ue;break}for(;m--;)a.lens[a.have++]=ge}}if(a.mode===ue)break;if(0===a.lens[256]){e.msg="invalid code -- missing end-of-block",a.mode=ue;break}if(a.lenbits=9,Fe={bits:a.lenbits},He=y(H,a.lens,0,a.nlen,a.lencode,0,a.work,Fe),a.lenbits=Fe.bits,He){e.msg="invalid literal/lengths set",a.mode=ue;break}if(a.distbits=6,a.distcode=a.distdyn,Fe={bits:a.distbits},He=y(F,a.lens,a.nlen,a.ndist,a.distcode,0,a.work,Fe),a.distbits=Fe.bits,He){e.msg="invalid distances set",a.mode=ue;break}if(a.mode=te,t===k)break e;case te:a.mode=ae;case ae:if(l>=6&&h>=258){e.next_out=o,e.avail_out=h,e.next_in=s,e.avail_in=l,a.hold=d,a.bits=_,x(e,f),o=e.next_out,i=e.output,h=e.avail_out,s=e.next_in,n=e.input,l=e.avail_in,d=a.hold,_=a.bits,a.mode===Z&&(a.back=-1);break}for(a.back=0;De=a.lencode[d&(1<<a.lenbits)-1],me=De>>>24,Xe=De>>>16&255,ve=65535&De,!(_>=me);){if(0===l)break e;l--,d+=n[s++]<<_,_+=8}if(Xe&&0===(240&Xe)){for(be=me,xe=Xe,ye=ve;De=a.lencode[ye+((d&(1<<be+xe)-1)>>be)],me=De>>>24,Xe=De>>>16&255,ve=65535&De,!(_>=be+me);){if(0===l)break e;l--,d+=n[s++]<<_,_+=8}d>>>=be,_-=be,a.back+=be}if(d>>>=me,_-=me,a.back+=me,a.length=ve,0===Xe){a.mode=oe;break}if(32&Xe){a.back=-1,a.mode=Z;break}if(64&Xe){e.msg="invalid literal/length code",a.mode=ue;break}a.extra=15&Xe,a.mode=re;case re:if(a.extra){for(we=a.extra;we>_;){if(0===l)break e;l--,d+=n[s++]<<_,_+=8}a.length+=d&(1<<a.extra)-1,d>>>=a.extra,_-=a.extra,a.back+=a.extra}a.was=a.length,a.mode=ne;case ne:for(;De=a.distcode[d&(1<<a.distbits)-1],me=De>>>24,Xe=De>>>16&255,ve=65535&De,!(_>=me);){if(0===l)break e;l--,d+=n[s++]<<_,_+=8}if(0===(240&Xe)){for(be=me,xe=Xe,ye=ve;De=a.distcode[ye+((d&(1<<be+xe)-1)>>be)],me=De>>>24,Xe=De>>>16&255,ve=65535&De,!(_>=be+me);){if(0===l)break e;l--,d+=n[s++]<<_,_+=8}d>>>=be,_-=be,a.back+=be}if(d>>>=me,_-=me,a.back+=me,64&Xe){e.msg="invalid distance code",a.mode=ue;break}a.offset=ve,a.extra=15&Xe,a.mode=ie;case ie:if(a.extra){for(we=a.extra;we>_;){if(0===l)break e;l--,d+=n[s++]<<_,_+=8}a.offset+=d&(1<<a.extra)-1,d>>>=a.extra,_-=a.extra,a.back+=a.extra}if(a.offset>a.dmax){e.msg="invalid distance too far back",a.mode=ue;break}a.mode=se;case se:if(0===h)break e;if(m=f-h,a.offset>m){if(m=a.offset-m,m>a.whave&&a.sane){e.msg="invalid distance too far back",a.mode=ue;break}m>a.wnext?(m-=a.wnext,pe=a.wsize-m):pe=a.wnext-m,m>a.length&&(m=a.length),fe=a.window}else fe=i,pe=o-a.offset,m=a.length;m>h&&(m=h),h-=m,a.length-=m;do i[o++]=fe[pe++];while(--m);0===a.length&&(a.mode=ae);break;case oe:if(0===h)break e;i[o++]=a.length,h--,a.mode=ae;break;case le:if(a.wrap){for(;32>_;){if(0===l)break e;l--,d|=n[s++]<<_,_+=8}if(f-=h,e.total_out+=f,a.total+=f,f&&(e.adler=a.check=a.flags?b(a.check,i,f,o-f):v(a.check,i,f,o-f)),f=h,(a.flags?d:r(d))!==a.check){e.msg="incorrect data check",a.mode=ue;break}d=0,_=0}a.mode=he;case he:if(a.wrap&&a.flags){for(;32>_;){if(0===l)break e;l--,d+=n[s++]<<_,_+=8}if(d!==(4294967295&a.total)){e.msg="incorrect length check",a.mode=ue;break}d=0,_=0}a.mode=ce;case ce:He=M;break e;case ue:He=E;break e;case de:return O;case _e:default:return N}return e.next_out=o,e.avail_out=h,e.next_in=s,e.avail_in=l,a.hold=d,a.bits=_,(a.wsize||f!==e.avail_out&&a.mode<ue&&(a.mode<le||t!==w))&&u(e,e.output,e.next_out,f-e.avail_out)?(a.mode=de,O):(p-=e.avail_in,f-=e.avail_out,e.total_in+=p,e.total_out+=f,a.total+=f,a.wrap&&f&&(e.adler=a.check=a.flags?b(a.check,i,f,e.next_out-f):v(a.check,i,f,e.next_out-f)),e.data_type=a.bits+(a.last?64:0)+(a.mode===Z?128:0)+(a.mode===te||a.mode===Q?256:0),(0===p&&0===f||t===w)&&He===B&&(He=T),He)}function _(e){if(!e||!e.state)return N;var t=e.state;return t.window&&(t.window=null),e.state=null,B}function p(e,t){var a;return e&&e.state?(a=e.state,0===(2&a.wrap)?N:(a.head=t,t.done=!1,B)):N}var f,m,X=e("../utils/common"),v=e("./adler32"),b=e("./crc32"),x=e("./inffast"),y=e("./inftrees"),g=0,H=1,F=2,w=4,D=5,k=6,B=0,M=1,A=2,N=-2,E=-3,O=-4,T=-5,I=8,S=1,R=2,C=3,L=4,P=5,j=6,U=7,G=8,z=9,V=10,Y=11,Z=12,J=13,W=14,Q=15,q=16,K=17,$=18,ee=19,te=20,ae=21,re=22,ne=23,ie=24,se=25,oe=26,le=27,he=28,ce=29,ue=30,de=31,_e=32,pe=852,fe=592,me=15,Xe=me,ve=!0;a.inflateReset=s,a.inflateReset2=o,a.inflateResetKeep=i,a.inflateInit=h,a.inflateInit2=l,a.inflate=d,a.inflateEnd=_,a.inflateGetHeader=p,a.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":1,"./adler32":3,"./crc32":5,"./inffast":7,"./inftrees":9}],9:[function(e,t,a){"use strict";var r=e("../utils/common"),n=15,i=852,s=592,o=0,l=1,h=2,c=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],u=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],d=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],_=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,a,p,f,m,X,v){var b,x,y,g,H,F,w,D,k,B=v.bits,M=0,A=0,N=0,E=0,O=0,T=0,I=0,S=0,R=0,C=0,L=null,P=0,j=new r.Buf16(n+1),U=new r.Buf16(n+1),G=null,z=0;for(M=0;n>=M;M++)j[M]=0;for(A=0;p>A;A++)j[t[a+A]]++;for(O=B,E=n;E>=1&&0===j[E];E--);if(O>E&&(O=E),0===E)return f[m++]=20971520,f[m++]=20971520,v.bits=1,0;for(N=1;E>N&&0===j[N];N++);for(N>O&&(O=N),S=1,M=1;n>=M;M++)if(S<<=1,S-=j[M],0>S)return-1;if(S>0&&(e===o||1!==E))return-1;for(U[1]=0,M=1;n>M;M++)U[M+1]=U[M]+j[M];for(A=0;p>A;A++)0!==t[a+A]&&(X[U[t[a+A]]++]=A);if(e===o?(L=G=X,F=19):e===l?(L=c,P-=257,G=u,z-=257,F=256):(L=d,G=_,F=-1),C=0,A=0,M=N,H=m,T=O,I=0,y=-1,R=1<<O,g=R-1,e===l&&R>i||e===h&&R>s)return 1;for(var V=0;;){V++,w=M-I,X[A]<F?(D=0,k=X[A]):X[A]>F?(D=G[z+X[A]],k=L[P+X[A]]):(D=96,k=0),b=1<<M-I,x=1<<T,N=x;do x-=b,f[H+(C>>I)+x]=w<<24|D<<16|k|0;while(0!==x);for(b=1<<M-1;C&b;)b>>=1;if(0!==b?(C&=b-1,C+=b):C=0,A++,0===--j[M]){if(M===E)break;M=t[a+X[A]]}if(M>O&&(C&g)!==y){for(0===I&&(I=O),H+=N,T=M-I,S=1<<T;E>T+I&&(S-=j[T+I],!(0>=S));)T++,S<<=1;if(R+=1<<T,e===l&&R>i||e===h&&R>s)return 1;y=C&g,f[y]=O<<24|T<<16|H-m|0}}return 0!==C&&(f[H+C]=M-I<<24|64<<16|0),v.bits=O,0}},{"../utils/common":1}],10:[function(e,t,a){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],11:[function(e,t,a){"use strict";function r(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}t.exports=r},{}],"/lib/inflate.js":[function(e,t,a){"use strict";function r(e,t){var a=new _(t);if(a.push(e,!0),a.err)throw a.msg;return a.result}function n(e,t){return t=t||{},t.raw=!0,r(e,t)}var i=e("./zlib/inflate.js"),s=e("./utils/common"),o=e("./utils/strings"),l=e("./zlib/constants"),h=e("./zlib/messages"),c=e("./zlib/zstream"),u=e("./zlib/gzheader"),d=Object.prototype.toString,_=function(e){this.options=s.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0===(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var a=i.inflateInit2(this.strm,t.windowBits);if(a!==l.Z_OK)throw new Error(h[a]);this.header=new u,i.inflateGetHeader(this.strm,this.header)};_.prototype.push=function(e,t){var a,r,n,h,c,u=this.strm,_=this.options.chunkSize,p=!1;if(this.ended)return!1;r=t===~~t?t:t===!0?l.Z_FINISH:l.Z_NO_FLUSH,u.input="string"==typeof e?o.binstring2buf(e):"[object ArrayBuffer]"===d.call(e)?new Uint8Array(e):e,u.next_in=0,u.avail_in=u.input.length;do{if(0===u.avail_out&&(u.output=new s.Buf8(_),u.next_out=0,u.avail_out=_),a=i.inflate(u,l.Z_NO_FLUSH),a===l.Z_BUF_ERROR&&p===!0&&(a=l.Z_OK,p=!1),a!==l.Z_STREAM_END&&a!==l.Z_OK)return this.onEnd(a),this.ended=!0,!1;u.next_out&&(0===u.avail_out||a===l.Z_STREAM_END||0===u.avail_in&&(r===l.Z_FINISH||r===l.Z_SYNC_FLUSH))&&("string"===this.options.to?(n=o.utf8border(u.output,u.next_out),h=u.next_out-n,c=o.buf2string(u.output,n),u.next_out=h,u.avail_out=_-h,h&&s.arraySet(u.output,u.output,n,h,0),this.onData(c)):this.onData(s.shrinkBuf(u.output,u.next_out))),0===u.avail_in&&0===u.avail_out&&(p=!0)}while((u.avail_in>0||0===u.avail_out)&&a!==l.Z_STREAM_END);return a===l.Z_STREAM_END&&(r=l.Z_FINISH),r===l.Z_FINISH?(a=i.inflateEnd(this.strm),this.onEnd(a),this.ended=!0,a===l.Z_OK):r===l.Z_SYNC_FLUSH?(this.onEnd(l.Z_OK),u.avail_out=0,!0):!0},_.prototype.onData=function(e){this.chunks.push(e)},_.prototype.onEnd=function(e){e===l.Z_OK&&(this.result="string"===this.options.to?this.chunks.join(""):s.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},a.Inflate=_,a.inflate=r,a.inflateRaw=n,a.ungzip=r},{"./utils/common":1,"./utils/strings":2,"./zlib/constants":4,"./zlib/gzheader":6,"./zlib/inflate.js":8,"./zlib/messages":10,"./zlib/zstream":11}]},{},[])("/lib/inflate.js")}),HX.FbxObject=function(){this.name=null,this.UID=null},HX.FbxObject.prototype={get numChildren(){return this._children.length},getChild:function(e){return this._children[e]},connectObject:function(e){throw new Error("Unhandled object connection "+e.toString()+" -> "+this.toString())},connectProperty:function(e,t){},copyProperties:function(e){for(var t in e)if(this.hasOwnProperty(t)&&void 0!==e[t]&&null!==e[t]){var a=t.charAt(0);a.toUpperCase()===a&&(this[t]=e[t])}}},HX.FbxObject.prototype.toString=function(){return"[FbxObject(name="+this.name+")]"},HX.FbxNode=function(){HX.FbxObject.call(this),this.RotationOffset=null,this.RotationPivot=null,this.ScalingOffset=null,this.ScalingPivot=null,this.RotationOrder=0,this.PreRotation=null,this.PostRotation=null,this.InheritType=0,this.GeometricTranslation=null,this.GeometricRotation=null,this.GeometricScaling=null,this["Lcl Translation"]=null,this["Lcl Rotation"]=null,this["Lcl Scaling"]=null,this.Visibility=!0,this.type=null,this.children=null,this.limbNodes=null,this.defaultAttribute=null,this.attributes=null,this.mesh=null,this.materials=null},HX.FbxNode.prototype=Object.create(HX.FbxObject.prototype),HX.FbxNode.prototype.connectObject=function(e){if(e instanceof HX.FbxNode){if("Null"===e.type)return;"LimbNode"===e.type?(this.limbNodes=this.limbNodes||[],this.limbNodes.push(e)):(this.children=this.children||[],this.children.push(e))}else if(e instanceof HX.FbxNodeAttribute)this.defaultAttribute=this.defaultAttribute||e,this.attributes=this.attributes||[],this.attributes.push(e);else if(e instanceof HX.FbxMesh)this.mesh=e;else{if(!(e instanceof HX.FbxMaterial))throw new Error("Incompatible child object!");this.materials=this.materials||[],this.materials.push(e)}},HX.FbxNode.prototype.toString=function(){return"[FbxNode(name="+this.name+")]"},HX.MD5Anim=function(){HX.AssetParser.call(this,HX.SkeletonClip),this._hierarchy=null,this._baseFrame=null,this._activeFrame=null,this._numJoints=0,this._correctionQuad=new HX.Quaternion,this._correctionQuad.fromAxisAngle(HX.Float4.X_AXIS,.5*-Math.PI)},HX.MD5Anim.prototype=Object.create(HX.AssetParser.prototype),HX.MD5Anim.prototype.parse=function(e,t){this._hierarchy=[],this._baseFrame=[],this._target=t;for(var a=e.split("\n"),r=a.length,n=null,i=0;r>i;++i){var s=a[i].replace(/^\s+|\s+$/g,""),o=s.split(/\s+/);if("//"!==o[0]&&""!==o[0])if(n)n.call(this,o),"}"===o[0]&&(n=null);else switch(o[0]){case"commandline":case"numFrames":case"MD5Version":case"numAnimatedComponents":break;case"numJoints":this._numJoints=parseInt(o[1]);break;case"frameRate":t.frameRate=parseInt(o[1]);break;case"hierarchy":n=this._parseHierarchy;break;case"bounds":n=this._parseBounds;break;case"baseframe":n=this._parseBaseFrame;break;case"frame":this._activeFrame=new HX.MD5Anim._FrameData,n=this._parseFrame}}this._notifyComplete(t)},HX.MD5Anim.prototype._parseHierarchy=function(e){if("}"!==e[0]){var t=new HX.MD5Anim._HierachyData;t.name=e[0].substring(1,e[0].length-1),t.parent=parseInt(e[1]),t.flags=parseInt(e[2]),t.startIndex=parseInt(e[3]),this._hierarchy.push(t)}},HX.MD5Anim.prototype._parseBounds=function(e){},HX.MD5Anim.prototype._parseBaseFrame=function(e){if("}"!==e[0]){var t=new HX.MD5Anim._BaseFrameData,a=t.pos;a.x=parseFloat(e[1]),a.y=parseFloat(e[2]),a.z=parseFloat(e[3]);var r=t.quat;r.x=parseFloat(e[6]),r.y=parseFloat(e[7]),r.z=parseFloat(e[8]),r.w=1-r.x*r.x-r.y*r.y-r.z*r.z,r.w=r.w<0?0:-Math.sqrt(r.w),this._baseFrame.push(t)}},HX.MD5Anim.prototype._parseFrame=function(e){if("}"===e[0])return void this._translateFrame();for(var t=e.length,a=0;t>a;++a)this._activeFrame.components.push(parseFloat(e[a]))},HX.MD5Anim.prototype._translateFrame=function(){for(var e=new HX.SkeletonPose,t=0;t<this._numJoints;++t){var a=new HX.SkeletonJointPose,r=this._hierarchy[t],n=this._baseFrame[t],i=r.flags,s=n.pos,o=n.quat,l=this._activeFrame.components,h=r.startIndex;1&i&&(s.x=l[h]),2&i&&(s.y=l[h+1]),4&i&&(s.z=l[h+2]),8&i&&(o.x=l[h+3]),16&i&&(o.y=l[h+4]),32&i&&(o.z=l[h+5]);var c=1-o.x*o.x-o.y*o.y-o.z*o.z;o.w=0>c?0:-Math.sqrt(c),r.parent<0?(a.orientation.multiply(this._correctionQuad,o),a.translation=this._correctionQuad.rotate(s)):(a.orientation.copyFrom(o),a.translation.copyFrom(s)),e.jointPoses.push(a)}this._target.addFrame(e)},HX.MD5Anim._HierachyData=function(){this.name=null,this.parent=-1,this.flags=0,this.startIndex=0},HX.MD5Anim._BaseFrameData=function(){this.pos=new HX.Float4,this.quat=new HX.Quaternion},HX.MD5Anim._FrameData=function(){this.components=[]},HX.MD5Mesh=function(){HX.AssetParser.call(this,HX.Model),this._target=null,this._meshData=null,this._jointData=null,this._skeleton=null,this._correctionQuad=new HX.Quaternion,this._correctionQuad.fromAxisAngle(HX.Float4.X_AXIS,.5*-Math.PI)},HX.MD5Mesh.prototype=Object.create(HX.AssetParser.prototype),HX.MD5Mesh.prototype.parse=function(e,t){this._modelData=new HX.ModelData,this._skeleton=new HX.Skeleton,this._jointData=[];for(var a=e.split("\n"),r=a.length,n=null,i=0;r>i;++i){var s=a[i].replace(/^\s+|\s+$/g,""),o=s.split(/\s+/);if("//"!==o[0]&&""!==o[0])if(n)n.call(this,o),"}"===o[0]&&(n=null);else switch(o[0]){case"commandline":case"numMeshes":case"numJoints":case"MD5Version":break;case"joints":n=this._parseJoint;break;case"mesh":this._meshData=new HX.MD5Mesh._MeshData,n=this._parseMesh}}t._setModelData(this._modelData),t.skeleton=this._skeleton,this._notifyComplete(t)},HX.MD5Mesh.prototype._parseJoint=function(e){if("}"!==e[0]){var t=new HX.MD5Mesh._Joint,a=t.pos,r=t.quat;t.name=e[0].substring(1,e[0].length-1),t.parentIndex=parseInt(e[1]),a.x=parseFloat(e[3]),a.y=parseFloat(e[4]),a.z=parseFloat(e[5]),this._correctionQuad.rotate(t.pos,t.pos),r.x=parseFloat(e[8]),r.y=parseFloat(e[9]),r.z=parseFloat(e[10]),r.w=1-r.x*r.x-r.y*r.y-r.z*r.z,r.w=r.w<0?0:-Math.sqrt(r.w),r.multiply(this._correctionQuad,r),this._jointData.push(t);var n=new HX.SkeletonJoint;n.inverseBindPose.fromQuaternion(r);var a=t.pos;n.inverseBindPose.appendTranslation(a),n.inverseBindPose.invertAffine(),n.parentIndex=t.parentIndex,this._skeleton.addJoint(n)}},HX.MD5Mesh.prototype._parseMesh=function(e){switch(e[0]){case"shader":case"numVerts":case"numWeights":break;case"tri":this._meshData.indices.push(parseInt(e[2]),parseInt(e[4]),parseInt(e[3]));break;case"vert":this._parseVert(e);break;case"weight":this._parseWeight(e);break;case"}":this._translateMesh()}},HX.MD5Mesh.prototype._parseVert=function(e){var t=new HX.MD5Mesh._VertexData;t.u=parseFloat(e[3]),t.v=parseFloat(e[4]),t.startWeight=parseInt(e[6]),t.countWeight=parseInt(e[7]),this._meshData.vertexData.push(t)},HX.MD5Mesh.prototype._parseWeight=function(e){var t=new HX.MD5Mesh._WeightData;t.joint=parseInt(e[2]),t.bias=parseFloat(e[3]),t.pos.x=parseFloat(e[5]),t.pos.y=parseFloat(e[6]),t.pos.z=parseFloat(e[7]),this._meshData.weightData.push(t)},HX.MD5Mesh.prototype._translateMesh=function(){var e=new HX.MeshData.createDefaultEmpty;e.addVertexAttribute("hx_boneIndices",4,1),e.addVertexAttribute("hx_boneWeights",4,1);for(var t,a,r,n=[],i=[],s=this._meshData.vertexData,o=s.length,l=0,h=0,c=0;o>c;++c){var u=s[c];t=a=r=0,u.countWeight>4&&console.warn("Warning: more than 4 weights assigned. Mesh will not animate correctly");for(var d=0;d<u.countWeight;++d){var _=this._meshData.weightData[u.startWeight+d],p=this._jointData[_.joint],f=p.quat.rotate(_.pos),m=p.pos,X=_.bias;t+=(f.x+m.x)*X,a+=(f.y+m.y)*X,r+=(f.z+m.z)*X,4>d&&(i[h+d]=_.joint,i[h+4+d]=_.bias)}n[l]=t,n[l+1]=a,n[l+2]=r,n[l+10]=u.u,n[l+11]=1-u.v;for(var d=u.countWeight;4>d;++d)i[h+d]=0,i[h+4+d]=0;h+=8,l+=12}e.setVertexData(n,0),e.setVertexData(i,1),e.setIndexData(this._meshData.indices);var v=new HX.NormalTangentGenerator;v.generate(e),this._modelData.addMeshData(e)},HX.MD5Mesh._Joint=function(){this.name=null,this.parentIndex=-1,this.quat=new HX.Quaternion,this.pos=new HX.Float4},HX.MD5Mesh._MeshData=function(){this.vertexData=[],this.weightData=[],this.indices=[]},HX.MD5Mesh._VertexData=function(){this.u=0,this.v=0,this.startWeight=0,this.countWeight=0},HX.MD5Mesh._WeightData=function(){this.joint=0,this.bias=0,this.pos=new HX.Float4},HX.FBX=function(){HX.AssetParser.call(this,HX.GroupNode,HX.URLLoader.DATA_BINARY),this._rootNode=null},HX.FBX.prototype=Object.create(HX.AssetParser.prototype),HX.FBX.prototype.parse=function(e,t){var a=new HX.DataStream(e),r=new HX.FBXBinaryDeserializer,n=new HX.FBXGraphBuilder,i=new HX.FBXConverter;try{var s,o=Date.now(),l=r.deserialize(a);s=Date.now(),console.log("Serialization: "+(s-o)),o=s;var h=n.build(l);s=Date.now(),console.log("Graph building: "+(s-o)),o=s,i.convert(h,t),s=Date.now(),console.log("Conversion: "+(s-o))}catch(c){return console.log(c.stack),void this._notifyFailure(c.message)}i.textureTokens.length>0?this._loadTextures(i.textureTokens,i.textureMaterialMap,t):this._notifyComplete(t)},HX.FBX.prototype._loadTextures=function(e,t,a){for(var r=[],n=e.length,i=0;n>i;++i){var s=e[i];s.filename=r[i]=this._correctURL(s.filename)}var o=this,l=new HX.BulkAssetLoader;l.onFail=function(e){o._notifyFailure(e)},l.onComplete=function(){for(var e=t.length,r=0;e>r;++r){var n=t[r],i=n.token,s=l.getAsset(i.filename);switch(s.name=i.name,n.mapType){case HX.FBXConverter._TextureToken.NORMAL_MAP:n.material.normalMap=s;break;case HX.FBXConverter._TextureToken.SPECULAR_MAP:n.material.specularMap=s;break;case HX.FBXConverter._TextureToken.DIFFUSE_MAP:n.material.colorMap=s;

}}o._notifyComplete(a)},l.load(r,HX.JPG)},HX.FBXBinaryDeserializer=function(){},HX.FBXBinaryDeserializer.prototype={deserialize:function(e){this._data=e,this._verifyHeader(),26!==this._data.getUint16()&&console.log("Suspected oddity with FBX file");var t=(this._data.getUint32(),new HX.FBXRecord);return t.name="[root]",this._deserializeNode(t),t},_verifyHeader:function(){if("Kaydara FBX Binary  \x00"!==this._data.getString(21))throw new Error("Incorrect FBX file header!")},_deserializeNode:function(e){var t;do t=this._importNode(),t&&e.children.push(t);while(t)},_importNode:function(){var e=this._data,t=e.getUint32(),a=e.getUint32(),r=e.getUint32(),n=e.getUint8();if(0===t){if(0!==a||0!==r||0!==n)throw new Error("Invalid null node!");return null}var i=new HX.FBXRecord;i.name=e.getString(n);for(var s=0;a>s;++s){var o=this._parseDataElement();i.data.push(o)}return e.offset!==t&&this._deserializeNode(i),i},_parseDataElement:function(){var e=this._data.getChar();switch(e){case HX._FBX._DataElement.BOOLEAN:return this._data.getUint8();case HX._FBX._DataElement.INT16:return this._data.getInt16();case HX._FBX._DataElement.INT32:return this._data.getInt32();case HX._FBX._DataElement.INT64:return this._data.getInt32()+""+this._data.getInt32();case HX._FBX._DataElement.FLOAT:return this._data.getFloat32();case HX._FBX._DataElement.DOUBLE:return this._data.getFloat64();case HX._FBX._DataElement.STRING:var t=this._data.getUint32();return this._data.getString(t);case HX._FBX._DataElement.RAW:var t=this._data.getUint32();return this._data.getUint8Array(t);default:return this._parseArray(e)}},_parseArray:function(e){var t=this._data.getUint32(),a=this._data.getUint32(),r=this._data.getUint32();if(0===a)switch(e){case HX._FBX._DataElement.BOOLEAN_ARRAY:return this._data.getUint8Array(t);case HX._FBX._DataElement.INT32_ARRAY:return this._data.getInt32Array(t);case HX._FBX._DataElement.INT64_ARRAY:return this._data.getInt32Array(2*t);case HX._FBX._DataElement.FLOAT_ARRAY:return this._data.getFloat32Array(t);case HX._FBX._DataElement.DOUBLE_ARRAY:return this._data.getFloat64Array(t);default:throw new Error("Unknown data type code "+e)}else{var n=this._data.getUint8Array(r);switch(n=pako.inflate(n).buffer,e){case HX._FBX._DataElement.BOOLEAN_ARRAY:return new Uint8Array(n.buffer);case HX._FBX._DataElement.INT32_ARRAY:return new Int32Array(n);case HX._FBX._DataElement.INT64_ARRAY:return new Int32Array(n);case HX._FBX._DataElement.FLOAT_ARRAY:return new Float32Array(n);case HX._FBX._DataElement.DOUBLE_ARRAY:return new Float64Array(n);default:throw new Error("Unknown data type code "+e)}}}},HX.FBXBinaryDeserializer.INT16="Y",HX.FBXBinaryDeserializer.BOOLEAN="C",HX.FBXBinaryDeserializer.INT32="I",HX.FBXBinaryDeserializer.FLOAT="F",HX.FBXBinaryDeserializer.DOUBLE="D",HX.FBXBinaryDeserializer.INT64="L",HX.FBXBinaryDeserializer.BOOLEAN_ARRAY="b",HX.FBXBinaryDeserializer.INT32_ARRAY="i",HX.FBXBinaryDeserializer.FLOAT_ARRAY="f",HX.FBXBinaryDeserializer.DOUBLE_ARRAY="d",HX.FBXBinaryDeserializer.INT64_ARRAY="l",HX.FBXBinaryDeserializer.STRING="S",HX.FBXBinaryDeserializer.RAW="R",HX.FBXConverter=function(){this._objects=null,this._textureTokens=null,this._textureMaterialMap=null},HX.FBXConverter.prototype={get textureTokens(){return this._textureTokens},get textureMaterialMap(){return this._textureMaterialMap},convert:function(e,t){this._objects=[],this._textureTokens=[],this._textureMaterialMap=[],this._convertGroupNode(e,t)},_convertNode:function(e){var t;return e.mesh?t=this._convertModelMesh(e):e.children&&e.children.length>0?(t=new HX.GroupNode,this._convertGroupNode(e,t)):"LimbNode"===e.type&&(t=new HX.SceneNode),t.name=e.name,this._convertSceneGraphObject(e,t),t},_convertGroupNode:function(e,t){for(var a=e.children.length,r=0;a>r;++r){var n=this._convertNode(e.children[r]);t.attach(n)}},_convertModelMesh:function(e){var t;if(e.GeometricRotation||e.GeometricScaling||e.GeometricTranslation){var a=new HX.Transform;a.GeometricRotation&&(a.rotation=this._convertRotation(e.GeometricRotation)),a.GeometricScaling&&(a.scale=e.GeometricScaling),a.GeometricTranslation&&(a.position=e.GeometricTranslation),t=a.transformationMatrix}for(var r=this._convertGeometry(e.mesh,t),n=[],i=e.materials.length,s=0;i>s;++s)n[s]=this._convertMaterial(e.materials[s]);return r.createModelInstance(n)},_convertSceneGraphObject:function(e,t){var a=new HX.Matrix4x4;e.ScalingPivot&&a.appendTranslation(HX.Float4.negate(e.ScalingPivot));var r=e["Lcl Scaling"];r&&a.appendScale(r.x,r.y,r.z),e.ScalingPivot&&a.appendTranslation(e.ScalingPivot),e.ScalingOffset&&a.appendTranslation(e.ScalingOffset),e.RotationPivot&&a.appendTranslation(HX.Float4.negate(e.RotationPivot)),e.PreRotation&&a.appendRotationQuaternion(this._convertRotation(e.PreRotation)),e["Lcl Rotation"]&&a.appendRotationQuaternion(this._convertRotation(e["Lcl Rotation"])),e.PostRotation&&a.appendRotationQuaternion(this._convertRotation(e.PostRotation)),e.RotationPivot&&a.appendTranslation(e.RotationPivot),e.RotationOffset&&a.appendTranslation(e.RotationOffset),e["Lcl Translation"]&&a.appendTranslation(e["Lcl Translation"]),t.transformationMatrix=a},_convertRotation:function(e){var t=new HX.Quaternion;return t.fromXYZ(e.x*HX.DEG_TO_RAD,e.y*HX.DEG_TO_RAD,e.z*HX.DEG_TO_RAD),t},_convertGeometry:function(e,t){if(this._objects[e.UID])return this._objects[e.UID];var a=new HX.FBXGeometryConverter;return a.convertToModel(e,t),this._objects[e.UID]=a,a},_convertMaterial:function(e){if(this._objects[e.UID])return this._objects[e.UID];var t=new HX.PBRMaterial;return t.name=e.name,e.DiffuseColor&&(t.color=e.DiffuseColor),e.Shininess&&(e.ShininessExponent=e.Shininess),e.ShininessExponent&&(t.roughness=Math.sqrt(2/(e.Shininess+2))),e.textures&&(e.textures.NormalMap&&this._convertTexture(e.textures.NormalMap,t,HX.FBXConverter._TextureToken.NORMAL_MAP),e.textures.SpecularColor&&this._convertTexture(e.textures.SpecularColor,t,HX.FBXConverter._TextureToken.SPECULAR_MAP),e.textures.DiffuseColor&&this._convertTexture(e.textures.DiffuseColor,t,HX.FBXConverter._TextureToken.DIFFUSE_MAP)),this._objects[e.UID]=t,t},_convertTexture:function(e,t,a){var r;this._objects[e.UID]?r=this._objects[e.UID]:(r=new HX.FBXConverter._TextureToken,r.name=e.name,r.mapType=a,r.filename=e.relativeFilename?e.relativeFilename:e.video.relativeFilename,this._textureTokens.push(r),this._objects[e.UID]=r);var n=new HX.FBXConverter._TextureMaterialMapping(t,r,a);this._textureMaterialMap.push(n)}},HX.FBXConverter._TextureMaterialMapping=function(e,t,a){this.material=e,this.token=t,this.mapType=a},HX.FBXConverter._TextureToken=function(){this.filename=null,this.name=null,this.UID=null},HX.FBXConverter._TextureToken.NORMAL_MAP=0,HX.FBXConverter._TextureToken.SPECULAR_MAP=1,HX.FBXConverter._TextureToken.DIFFUSE_MAP=2,HX.FBXGeometryConverter=function(){this._perMaterialData=null,this._matrix=null,this._expandedMesh=null,this._vertexStride=0,this._ctrlPointLookUp=null,this._model=null},HX.FBXGeometryConverter.prototype={createModelInstance:function(e){for(var t=[],a=this._modelMaterialIDs.length,r=0;a>r;++r)t[r]=e[this._modelMaterialIDs[r]];return new HX.ModelInstance(this._model,t)},convertToModel:function(e,t){this._matrix=t,this._perMaterialData=[],this._ctrlPointLookUp=[],this._modelMaterialIDs=[],this._generateExpandedMeshData(e),this._vertexStride=HX.MeshData.DEFAULT_VERTEX_SIZE,this._splitPerMaterial(),this._generateModel(),this._model.name=e.name},_generateExpandedMeshData:function(e){this._expandedMesh=new HX.FBXGeometryConverter._ExpandedMesh;var t,a,r,n=e.indices,i=e.vertices,s=e.layerElements;s&&(t=s.Normals,a=s.UV,r=s.Materials);var o=[],l=0,h=0;t&&(this._expandedMesh.hasNormals=!0),a&&(this._expandedMesh.hasUVs=!0);for(var c=n.length,u=0;c>u;++u){var d=n[u],_=new HX.FBXGeometryConverter._Vertex;if(0>d&&(d=-d-1,_.lastVertex=!0),_.pos.x=i[3*d],_.pos.y=i[3*d+1],_.pos.z=i[3*d+2],_.ctrlPointIndex=d,t&&(_.normal=this._extractLayerData(t,d,u,3)),a&&(_.uv=this._extractLayerData(a,d,u,2)),r&&r.mappingInformationType!==HX.FbxLayerElement.MAPPING_TYPE.ALL_SAME){var p=r.indexData[l];_.materialIndex=p,p>h&&(h=p)}_.lastVertex&&++l,o[u]=_}this._expandedMesh.vertices=o,this._expandedMesh.numMaterials=h+1},_extractLayerData:function(e,t,a,r){var n=r>2?new HX.Float4:new HX.Float2;if(e.referenceInformationType===HX.FbxLayerElement.REFERENCE_TYPE.DIRECT){var i=e.mappingInformationType===HX.FbxLayerElement.MAPPING_TYPE.BY_CONTROL_POINT?t:a;n.x=e.directData[i*r],n.y=e.directData[i*r+1],r>2&&(n.z=e.directData[i*r+2])}else{var i=e.mappingInformationType===HX.FbxLayerElement.MAPPING_TYPE.BY_CONTROL_POINT?e.indexData[t]:e.indexData[a];n.x=e.directData[i*r],n.y=e.directData[i*r+1],r>2&&(n.z=e.directData[i*r+2])}return n},_splitPerMaterial:function(){for(var e=0;e<this._expandedMesh.numMaterials;++e)this._perMaterialData[e]=new HX.FBXGeometryConverter._PerMaterialData;for(var t,a,r,e=0,n=0,i=this._expandedMesh.vertices,s=i.length,o=!0;s>e;){var l=this._perMaterialData[i[e].materialIndex];if(l.vertices||(o=!0),o&&(o=!1,l.indexCounter=0,l.indices=[],l.vertices=[],l.ctrlPointIndices=[],l.indexLookUp={},l.indexStack.push(l.indices),l.vertexStack.push(l.vertices),l.ctrlPointStack.push(l.ctrlPointIndices)),t=this._getOrAddIndex(i[e]),0>t)o=!0;else if(a=this._getOrAddIndex(i[e+1]),0>a)o=!0;else{e+=2;var h;do if(h=i[e],r=this._getOrAddIndex(h),0>r)o=!0;else{++e;var c=this._perMaterialData[h.materialIndex].indices;c[n]=t,c[n+1]=a,c[n+2]=r,n+=3,a=r}while(!h.lastVertex&&!o)}}},_getOrAddIndex:function(e){var t=e.getHash(),a=this._perMaterialData[e.materialIndex],r=a.indexLookUp;if(r.hasOwnProperty(t))return r[t];if(a.indexCounter>65535)return-1;var n=a.vertices,i=a.indexCounter*this._vertexStride,s=a.indexCounter++;return a.ctrlPointIndices[s]=e.ctrlPointIndex,r[t]=s,n[i]=e.pos.x,n[i+1]=e.pos.y,n[i+2]=e.pos.z,this._expandedMesh.hasNormals?(n[i+3]=e.normal.x,n[i+4]=e.normal.y,n[i+5]=e.normal.z):n[i+3]=n[i+4]=n[i+5]=0,n[i+6]=n[i+7]=n[i+8]=n[i+9]=0,this._expandedMesh.hasUVs?(n[i+10]=e.uv.x,n[i+11]=e.uv.y):n[i+10]=n[i+11]=0,s},_generateModel:function(){for(var e=new HX.ModelData,t=0,a=this._expandedMesh.numMaterials,r=0;a>r;++r)for(var n=this._perMaterialData[r],i=n.indexStack.length,s=0;i>s;++s){var o=HX.MeshData.createDefaultEmpty();o.setVertexData(n.vertexStack[s],0),o.setIndexData(n.indexStack[s]);for(var l=n.ctrlPointStack[s],h=l.length,c=0;h>c;++c)this._ctrlPointLookUp[l[c]]={index:c,meshIndex:t};++t,this._modelMaterialIDs.push(r);var u=HX.NormalTangentGenerator.MODE_TANGENTS;this._expandedMesh.hasNormals||(u|=HX.NormalTangentGenerator.MODE_NORMALS);var d=new HX.NormalTangentGenerator;d.generate(o,u),e.addMeshData(o)}this._model=new HX.Model(e)}},HX.FBXGeometryConverter._ExpandedMesh=function(){this.vertices=null,this.hasUVs=!1,this.hasNormals=!1,this.numMaterials=0},HX.FBXGeometryConverter._Vertex=function(){this.pos=new HX.Float4,this.uv=null,this.normal=null,this.color=null,this.materialIndex=0,this.ctrlPointIndex=-1,this._hash=null,this.lastVertex=!1},HX.FBXGeometryConverter._Vertex.prototype={getHash:function(){if(!this._hash){var e=this.ctrlPointIndex+"/"+this.materialIndex+"/"+this.pos.x+"/"+this.pos.y+"/"+this.pos.z;this.normal&&(e=e+"/"+this.normal.x+"/"+this.normal.y+"/"+this.normal.z),this.uv&&(e=e+"/"+this.uv.x+"/"+this.uv.y),this.color&&(e=e+"/"+this.color.x+"/"+this.color.y+"/"+this.color.z),this._hash=e}return this._hash}},HX.FBXGeometryConverter._PerMaterialData=function(){this.indexCounter=0,this.vertexStack=[],this.indexStack=[],this.ctrlPointStack=[],this.vertices=null,this.indices=null,this.ctrlPointIndices=null,this.indexLookUp={}},HX.FBXGraphBuilder=function(){},HX.FBXGraphBuilder.prototype={build:function(e){this._templates={},this._objects={};var t=new HX.FbxNode;return this._objects["00"]=t,this._processTemplates(e.getChildByName("Definitions")),this._processObjects(e.getChildByName("Objects")),this._processConnections(e.getChildByName("Connections")),t},_processTemplates:function(e){for(var t=e.children.length,a=0;t>a;++a){var r=e.children[a];if("ObjectType"===r.name){var n=r.getChildByName("PropertyTemplate");if(!n)continue;var i=n.data[0],s=r.data[0],o=this._createNode(s,i,n);o&&this._assignProperties(o,n.getChildByName("Properties70")),this._templates[s]=o}}},_processObjects:function(e){for(var t=e.children.length,a=0;t>a;++a){var r=null,n=e.children[a];switch(n.name){case"Geometry":r=this._processGeometry(n);break;case"NodeAttribute":r=new HX.FbxNodeAttribute,r.type=n.data[2];break;case"Model":r=new HX.FbxNode,r.type=n.data[2];break;case"Material":r=new HX.FbxMaterial;break;case"Video":r=new HX.FbxVideo;var i=n.getChildByName("RelativeFilename");r.relativeFilename=i?i.data[0]:null;break;case"Texture":r=new HX.FbxFileTexture;var i=n.getChildByName("RelativeFilename");r.relativeFilename=i?i.data[0]:null;break;case"AnimationStack":r=new HX.FbxAnimStack;break;case"AnimationLayer":r=new HX.FbxAnimLayer;break;case"Pose":r=new HX.FbxPose;break;case"Deformer":r=new HX.FbxDeformer;break;case"AnimationCurve":r=new HX.FbxAnimationCurve;break;case"AnimationCurveNode":r=new HX.FbxAnimationCurveNode;break;default:n.printDebug(!1)}if(r){var s=n.data[0];r.name=this._getObjectDefName(n),r.UID=s,this._templates[n.name]&&r.copyProperties(this._templates[n.name]),this._assignProperties(r,n.getChildByName("Properties70")),this._objects[s]=r}}},_processConnections:function(e){for(var t=e.children.length,a=0;t>a;++a){var r=e.children[a],n=r.data[0],i=this._objects[r.data[1]],s=this._objects[r.data[2]];"OO"===n?s.connectObject(i):"OP"===n&&s.connectProperty(i,r.data[3])}},_createNode:function(e,t){return"Material"===e?new HX.FbxMaterial:HX[t]?new HX[t]:void 0},_assignProperties:function(e,t){if(t)for(var a=t.children.length,r=0;a>r;++r){var n=t.children[r];e.hasOwnProperty(n.data[0])&&(e[n.data[0]]=this._getPropertyValue(n))}},_getPropertyValue:function(e){var t=e.data;switch(t[1]){case"Vector3D":case"Lcl Translation":case"Lcl Scaling":case"Lcl Rotation":return new HX.Float4(t[4],t[5],t[6]);case"bool":case"Visibility":case"Visibility Inheritance":return 0!==t[4];case"ColorRGB":case"Color":return new HX.Color(t[4],t[5],t[6]);case"enum":case"double":case"float":case"int":case"KString":return t[4];case"object":return null}},_processGeometry:function(e){for(var t=new HX.FbxMesh,a=e.children.length,r={},n=0;a>n;++n){var i=e.children[n];switch(i.name){case"Vertices":t.vertices=i.data[0];break;case"PolygonVertexIndex":t.indices=i.data[0];break;case"Layer":e.printDebug(),t.layerElements=t.layerElements||{},this._processLayer(i,r,t.layerElements);break;default:r[i.name]||(r[i.name]=i)}}return t},_processLayer:function(e,t,a){for(var r=e.children.length,n=0;r>n;++n){var i=e.children[n];if("LayerElement"===i.name){var s=i.getChildByName("Type").data[0];if(!a[i.type]){var i=this._processLayerElement(t[s]);a[i.type]=i}}}},_processLayerElement:function(e){var t=new HX.FbxLayerElement,a=e.children.length;e.printDebug();for(var r=0;a>r;++r){var n=e.children[r];switch(n.name){case"MappingInformationType":var i=n.data[0];t.mappingInformationType="ByPolygonVertex"===i?HX.FbxLayerElement.MAPPING_TYPE.BY_POLYGON_VERTEX:"ByPolygon"===i?HX.FbxLayerElement.MAPPING_TYPE.BY_POLYGON:"AllSame"===i?HX.FbxLayerElement.MAPPING_TYPE.ALL_SAME:HX.FbxLayerElement.MAPPING_TYPE.BY_CONTROL_POINT;break;case"ReferenceInformationType":t.referenceInformationType="Direct"===n.data[0]?HX.FbxLayerElement.REFERENCE_TYPE.DIRECT:HX.FbxLayerElement.REFERENCE_TYPE.INDEX_TO_DIRECT;break;case"Normals":case"Colors":case"UV":case"Smoothing":t.type=n.name,t.directData=n.data[0];break;case"NormalsIndex":case"ColorIndex":case"UVIndex":case"SmoothingIndex":t.indexData=n.data[0];break;case"Materials":t.type=n.name,t.indexData=n.data[0]}}return t},_getObjectDefName:function(e){return e.data[1].split(HX.FBXGraphBuilder._STRING_DEMARCATION)[0]}},HX.FBXGraphBuilder._STRING_DEMARCATION=String.fromCharCode(0,1),HX.FBXRecord=function(){this.name="",this.data=[],this.children=[]},HX.FBXRecord.prototype={getChildByName:function(e){for(var t=this.children.length,a=0;t>a;++a){var r=this.children[a];if(r.name===e)return r}},printDebug:function(e,t){void 0===e&&(e=!0),void 0===t&&(t=0);for(var a="",r=0;t>r;++r)a+="	";if(console.log(a+this.name),e&&this.data.length>0){console.log(a+"	[data] {");for(var r=0;r<this.data.length;++r)console.log(a+"		["+r+"] : "+this.data[r]);console.log(a+"}")}for(var r=0;r<this.children.length;++r)this.children[r].printDebug(e,t+1)}},HX._FBX=function(){HX.AssetParser.call(this,HX.GroupNode,HX.URLLoader.DATA_BINARY),this._rootNode=null,this._templates=null,this._objects=null,this._target=null,this._modelInstanceSetups=null,this._skeletonSetups=null,this._animationStacks=null,this._ctrlPointLookUp=null},HX._FBX.prototype=Object.create(HX.AssetParser.prototype),HX._FBX.prototype.parse=function(e,t){if(this._data=new HX.DataStream(e),this._objects=[],this._modelMaterialIDs=[],this._modelInstanceSetups={},this._skeletonSetups={},this._animationStacks=[],this._ctrlPointLookUp={},this._objects["00"]=this._target=t,!this._verifyHeader())return void this._notifyFailure("Incorrect FBX header");26!==this._data.getUint16()&&console.log("Suspected oddity with FBX file");this._data.getUint32();try{this._rootNode=new HX._FBX._NodeRecord,this._parseChildren(this._rootNode,0),this._processTemplates(),this._processObjects(),this._processConnections()}catch(a){return console.error(a.stack),void this._notifyFailure(a.message)}this._notifyComplete(t)},HX._FBX.prototype._parseChildren=function(e,t){var a;do a=this._parseNode(t),a&&e.children.push(a);while(a)},HX._FBX.prototype._verifyHeader=function(){return"Kaydara FBX Binary  \x00"===this._data.getString(21)},HX._FBX.prototype._parseNode=function(e){void 0===e&&(e=0);var t=this._data,a=t.getUint32(),r=t.getUint32(),n=t.getUint32(),i=t.getUint8();if(0===a){if(0!==r||0!==n||0!==i)throw new Error("Invalid null node!");return null}var s=new HX._FBX._NodeRecord;if(s.name=t.getString(i),this._isIrrelevantNode(s.name))return t.offset=a,s;for(var o=0;r>o;++o){var l=this._parseDataElement();s.data.push(l)}return t.offset!==a&&this._parseChildren(s,e+1),s},HX._FBX.prototype._parseDataElement=function(){var e=new HX._FBX._DataElement;switch(e.typeCode=this._data.getChar(),e.typeCode){case HX._FBX._DataElement.BOOLEAN:e.value=this._data.getUint8();break;case HX._FBX._DataElement.INT16:e.value=this._data.getInt16();break;case HX._FBX._DataElement.INT32:e.value=this._data.getInt32();break;case HX._FBX._DataElement.INT64:e.value=this._data.getInt32()+""+this._data.getInt32();break;case HX._FBX._DataElement.FLOAT:e.value=this._data.getFloat32();break;case HX._FBX._DataElement.DOUBLE:e.value=this._data.getFloat64();break;case HX._FBX._DataElement.STRING:var t=this._data.getUint32();e.value=this._data.getString(t);break;case HX._FBX._DataElement.RAW:var t=this._data.getUint32();e.value=this._data.getUint8Array(t);break;default:e.value=this._parseArray(e.typeCode)}return e},HX._FBX.prototype._parseArray=function(e){var t=this._data.getUint32(),a=this._data.getUint32(),r=this._data.getUint32();if(0===a)switch(e){case HX._FBX._DataElement.BOOLEAN_ARRAY:return this._data.getUint8Array(t);case HX._FBX._DataElement.INT32_ARRAY:return this._data.getInt32Array(t);case HX._FBX._DataElement.INT64_ARRAY:return this._data.getInt32Array(2*t);case HX._FBX._DataElement.FLOAT_ARRAY:return this._data.getFloat32Array(t);case HX._FBX._DataElement.DOUBLE_ARRAY:return this._data.getFloat64Array(t);default:throw new Error("Unknown data type code "+e)}else{var n=this._data.getUint8Array(r);switch(n=pako.inflate(n).buffer,e){case HX._FBX._DataElement.BOOLEAN_ARRAY:return new Uint8Array(n.buffer);case HX._FBX._DataElement.INT32_ARRAY:return new Int32Array(n);case HX._FBX._DataElement.INT64_ARRAY:return new Int32Array(n);case HX._FBX._DataElement.FLOAT_ARRAY:return new Float32Array(n);case HX._FBX._DataElement.DOUBLE_ARRAY:return new Float64Array(n);default:throw new Error("Unknown data type code "+e)}}},HX._FBX.prototype._isIrrelevantNode=function(e){return"FBXHeaderExtension"===e||"CreationTime"===e||"Creator"===e||"Documents"===e||"FileId"===e||"References"===e||"GlobalSettings"===e},HX._FBX.prototype._processTemplates=function(){var e=this._rootNode.getChildNode("Definitions").children,t=e.length;this._templates=[];for(var a=0;t>a;++a){var r=e[a];if("ObjectType"===r.name){var n=r.data[0].value,i=r.getChildNode("PropertyTemplate");if(i){i=i.getChildNode("Properties70").children;for(var s=[],o=i.length,l=0;o>l;++l){var h=i[l];s[h.data[0].value]=h}this._templates[n]=s}}}},HX._FBX.prototype._processObjects=function(){for(var e=this._rootNode.getChildNode("Objects"),t=e.children,a=t.length,r=0;a>r;++r){var n=t[r],i=this._getObjectDefName(n),s=n.data[0].value,o=null;switch(n.name){case"NodeAttribute":o=this._processNodeAttribute(n,s);break;case"Geometry":o=this._processMeshGeometry(n,s);break;case"Model":o=this._processModel(n,s);break;case"Material":o=this._processMaterial(n,s);break;case"Video":o=this._processVideo(n,s);break;case"Texture":o=this._processTexture(n,s);break;case"AnimationStack":o={},this._animationStacks.push(o);break;case"Deformer":o=this._processDeformer(n,s);break;case"AnimationLayer":break;case"AnimationCurveNode":case"AnimationCurve":}o&&(o.name=i,this._objects[s]=o)}},HX._FBX.prototype._getObjectDefName=function(e){return e.data[1].value.split(HX._FBX._STRING_DEMARCATION)[0]},HX._FBX.prototype._processNodeAttribute=function(e,t){var a,r=e.data[2].value;switch(r){case"Light":a=this._processLight(e);break;case"Camera":a=this._processCamera(e)}return a?(this._templates.NodeAttribute&&this._applyModelProps(a,this._templates.NodeAttribute),a):null},HX._FBX.prototype._processModel=function(e,t){var a,r,n=e.data[2].value;switch(n){case"Camera":return new HX._FBX._DummyNode;case"Light":a=new HX._FBX._DummyNode,a.useTransform=!0,r=!0;break;case"Mesh":a=this._processMeshModel(e,t),this._templates.NodeAttribute&&this._applyModelProps(a,this._templates.NodeAttribute);break;case"LimbNode":console.log(JSON.stringify(e)),a=new HX._FBX._LimbNode}if(a){var i=e.getChildNode("Properties70");this._templates.Model&&this._applyModelProps(a,this._templates.Model),i&&this._applyModelProps(a,i.children),r&&a.scale.set(1,1,1)}return a},HX._FBX.prototype._applyModelProps=function(e,t){for(var a,r,n,i,s,o,l,h,c,u,d=t.length,_=0;d>_;++_){var p=t[_],f=p.data[0].value;switch(f){case"GeometricTranslation":u=new HX.Float4(p.data[4].value,p.data[5].value,p.data[6].value,0);break;case"Lcl Scaling":l=new HX.Float4(p.data[4].value,p.data[5].value,p.data[6].value,1);break;case"ScalingPivot":o=new HX.Float4(p.data[4].value,p.data[5].value,p.data[6].value,0);break;case"ScalingOffset":h=new HX.Float4(p.data[4].value,p.data[5].value,p.data[6].value,0);break;case"RotationPivot":s=new HX.Float4(p.data[4].value,p.data[5].value,p.data[6].value,0);break;case"PreRotation":r=new HX.Quaternion,r.fromXYZ(p.data[4].value*HX.DEG_TO_RAD,p.data[5].value*HX.DEG_TO_RAD,p.data[6].value*HX.DEG_TO_RAD,0);break;case"PostRotation":n=new HX.Quaternion,n.fromXYZ(p.data[4].value*HX.DEG_TO_RAD,p.data[5].value*HX.DEG_TO_RAD,p.data[6].value*HX.DEG_TO_RAD,0);break;case"Lcl Rotation":a=new HX.Quaternion,a.fromXYZ(p.data[4].value*HX.DEG_TO_RAD,p.data[5].value*HX.DEG_TO_RAD,p.data[6].value*HX.DEG_TO_RAD);break;case"RotationOffset":c=new HX.Float4(p.data[4].value,p.data[5].value,p.data[6].value,0);break;case"Lcl Translation":i=new HX.Float4(p.data[4].value,p.data[5].value,p.data[6].value,0);break;case"InheritType":if(1!=p.data[4].value)throw new Error("Unsupported InheritType (must be 1)")}}var m=new HX.Matrix4x4;o&&m.appendTranslation(-o.x,-o.y,-o.z),l&&m.appendScale(l.x,l.y,l.z),o&&m.appendTranslation(o.x,o.y,o.z),h&&m.appendTranslation(h.x,h.y,h.z),s&&m.appendTranslation(-s.x,-s.y,-s.z),r&&m.appendRotationQuaternion(r),a&&m.appendRotationQuaternion(a),n&&m.appendRotationQuaternion(n),s&&m.appendTranslation(s.x,s.y,s.z),c&&m.appendTranslation(c.x,c.y,c.z),i&&m.appendTranslation(i.x,i.y,i.z),u&&m.prependTranslation(u.x,u.y,u.z),e.transformationMatrix=m},HX._FBX.prototype._processLight=function(e){for(var t,a,r=e.getChildNode("Properties70").children,n=r.length,i=0;n>i;++i){var s=r[i];if("LightType"===s.data[0].value){if(a=s.data[4].value,0===a)t=new HX.PointLight;else{if(1!==a)throw new Error("Unsupported light type");t=new HX.DirectionalLight}break}}if(!t)throw new Error("Missing light type property");for(var n=r.length,i=0;n>i;++i){var s=r[i],o=s.data[0].value;switch(o){case"Color":t.color=new HX.Color(s.data[4].value,s.data[5].value,s.data[6].value);break;case"Intensity":if(t.intensity=s.data[4].value,t.type)break;case"CastShadows":1===t.type&&(t.castShadows=!0)}}return t},HX._FBX.prototype._processCamera=function(e){function t(e){for(var t,r=e.length,n=0;r>n;++n){var i=e[n],s=i.data[0].value;switch(s){case"NearPlane":a.nearDistance=i.data[4].value;break;case"FarPlane":a.farDistance=i.data[4].value;break;case"FieldOfViewY":a.verticalFOV=i.data[4].value*HX.DEG_TO_RAD;break;case"Position":a.position.x=i.data[4].value,a.position.y=i.data[5].value,a.position.z=i.data[6].value;break;case"InterestPosition":t=new HX.Float4(i.data[4].value,i.data[5].value,i.data[6].value),a.lookAt(t)}}}var a=new HX.PerspectiveCamera;this._templates.NodeAttribute&&(t(this._templates.NodeAttribute),this._applyModelProps(a,this._templates.NodeAttribute));var r=e.getChildNode("Properties70");r&&t(r.children),a.scale.set(1,1,1);var n=e.getChildNode("Position");return n&&(a.position.x=n.data[0].value,a.position.y=n.data[1].value,a.position.z=n.data[2].value),n=e.getChildNode("LookAt"),n&&a.lookAt(new HX.Float4(n.data[0].value,n.data[1].value,n.data[2].value)),a},HX._FBX.prototype._processMeshModel=function(e,t){var a=new HX.ModelInstance;return this._modelInstanceSetups[t]={modelData:null,materials:[],materialsIDs:null,modelInstance:a,parent:null},a},HX._FBX.prototype._extractMeshLayerData=function(e,t,a,r){var n=e.getChildNode(t);if(n){var i=n.getChildNode("MappingInformationType").data[0].value,s="Direct"===n.getChildNode("ReferenceInformationType").data[0].value?1:2;return{refMode:s,mapMode:"ByPolygonVertex"===i?HX._FBX._Mapping.BY_POLYGON_VERTEX:"ByPolygon"===i?HX._FBX._Mapping.BY_POLYGON:"AllSame"===i?HX._FBX._Mapping.ALL_SAME:HX._FBX._Mapping.BY_CONTROL_POINT,directData:a?n.getChildNode(a).data[0].value:null,indexData:2===s?n.getChildNode(r).data[0].value:null}}return null},HX._FBX.prototype._applyVertexData=function(e,t,a,r){var n=r>2?new HX.Float4:new HX.Float2;if(1===e.refMode){var i=2===e.mapMode?t:a;n.x=e.directData[i*r],n.y=e.directData[i*r+1],r>2&&(n.z=e.directData[i*r+2])}else{var i=2===e.mapMode?e.indexData[t]:e.indexData[a];n.x=e.directData[i*r],n.y=e.directData[i*r+1],r>2&&(n.z=e.directData[i*r+2])}return n},HX._FBX.prototype._generateExpandedMeshData=function(e){var t=new HX._FBX._MeshData,a=e.getChildNode("PolygonVertexIndex").data[0].value,r=e.getChildNode("Vertices").data[0].value,n=this._extractMeshLayerData(e,"LayerElementNormal","Normals","NormalsIndex"),i=this._extractMeshLayerData(e,"LayerElementColor","Colors","ColorIndex"),s=this._extractMeshLayerData(e,"LayerElementUV","UV","UVIndex"),o=this._extractMeshLayerData(e,"LayerElementMaterial",null,"Materials"),l=[],h=a.length,c=0,u=0;n&&(t.hasNormals=!0),i&&(t.hasColor=!0),s&&(t.hasUVs=!0);for(var d=0;h>d;++d){var _=a[d],p=new HX._FBX._Vertex;if(0>_&&(_=-_-1,p.lastVertex=!0),p.pos.x=r[3*_],p.pos.y=r[3*_+1],p.pos.z=r[3*_+2],p.ctrlPointIndex=_,n&&(p.normal=this._applyVertexData(n,_,d,3)),i&&(p.color=this._applyVertexData(i,_,d,3)),s&&(p.uv=this._applyVertexData(s,_,d,2)),o&&o.mapMode!==HX._FBX._Mapping.ALL_SAME){var f=o.indexData[c];p.materialIndex=f,f>u&&(u=f)}p.lastVertex&&++c,l[d]=p}return t.vertices=l,t.numMaterials=u+1,t},HX._FBX.prototype._processMeshGeometry=function(e,t){function a(e){var t=e.getHash(),a=n[e.materialIndex],r=a.indexLookUp;if(r.hasOwnProperty(t))return r[t];if(a.indexCounter>65535)return-1;var i=a.vertices,c=a.indexCounter*s,u=a.indexCounter++;return a.ctrlPointIndices[u]=e.ctrlPointIndex,r[t]=u,i[c]=e.pos.x,i[c+1]=e.pos.y,i[c+2]=e.pos.z,o?(i[c+3]=e.normal.x,i[c+4]=e.normal.y,i[c+5]=e.normal.z):i[c+3]=i[c+4]=i[c+5]=0,i[c+6]=i[c+7]=i[c+8]=i[c+9]=0,l?(i[c+10]=e.uv.x,i[c+11]=e.uv.y):i[c+10]=i[c+11]=0,h?(i[c+12]=e.color.x,i[c+13]=e.color.y,i[c+14]=e.color.z):i[c+12]=i[c+13]=i[c+14]=0,u}for(var r=this._generateExpandedMeshData(e),n=[],i=0;i<r.numMaterials;++i)n[i]={indexCounter:0,vertexStack:[],indexStack:[],ctrlPointStack:[],vertices:null,indices:null,ctrlPointIndices:null,indexLookUp:{}};var s=HX.MeshData.DEFAULT_VERTEX_SIZE,o=r.hasNormals,l=r.hasUVs,h=r.hasColor;h&&(s+=3);for(var c,u,d,i=0,_=0,p=r.vertices,f=p.length,m=!0;f>i;){var X=n[p[i].materialIndex];if(X.vertices||(m=!0),m&&(m=!1,X.indexCounter=0,X.indices=[],X.vertices=[],X.ctrlPointIndices=[],X.indexLookUp={},X.indexStack.push(X.indices),X.vertexStack.push(X.vertices),X.ctrlPointStack.push(X.ctrlPointIndices)),c=a(p[i]),0>c)m=!0;else if(u=a(p[i+1]),0>u)m=!0;else{i+=2;var v;do if(v=p[i],d=a(v),0>d)m=!0;else{++i;var b=n[v.materialIndex].indices;b[_]=c,b[_+1]=u,b[_+2]=d,_+=3,u=d}while(!v.lastVertex&&!m)}}var x=new HX.ModelData,y=0;this._modelMaterialIDs[t]=[];for(var i=0;i<r.numMaterials;++i)for(var X=n[i],_=0;_<X.indexStack.length;++_){var g=HX.MeshData.createDefaultEmpty();h&&g.addVertexAttribute("hx_vertexColor",3),g.setVertexData(X.vertexStack[_],0),g.setIndexData(X.indexStack[_]);var H=X.ctrlPointStack[_],F=H.length;this._ctrlPointLookUp[t]=[];for(var w=0;F>w;++w)this._ctrlPointLookUp[t][H[w]]={index:w,meshIndex:y};++y,this._modelMaterialIDs[t].push(i);var D=HX.NormalTangentGenerator.MODE_TANGENTS;o||(D|=HX.NormalTangentGenerator.MODE_NORMALS);var k=new HX.NormalTangentGenerator;k.generate(g,D),x.addMeshData(g)}return x},HX._FBX.prototype._processMaterial=function(e,t){var a=new HX.PBRMaterial,r=e.getChildNode("Properties70");return this._templates.Material&&this._applyMaterialProps(a,this._templates.Material),r&&this._applyMaterialProps(a,r.children),a},HX._FBX.prototype._applyMaterialProps=function(e,t){for(var a=t.length,r=0;a>r;++r){var n=t[r],i=n.data[0].value;switch(i){case"DiffuseColor":e.color=new HX.Color(n.data[4].value,n.data[5].value,n.data[6].value);break;case"Shininess":case"ShininessExponent":e.roughness=Math.sqrt(2/(n.data[4].value+2))}}},HX._FBX.prototype._processVideo=function(e,t){var a,r=e.getChildNode("RelativeFilename");if(r){var n=this._correctURL(r.data[0].value),i=new HX.AssetLoader(HX.JPG);a=i.load(n)}return a},HX._FBX.prototype._processPose=function(e,t){var a=e.data[2].value;switch(a){case"BindPose":return this._processBindPose(e,t)}},HX._FBX.prototype._processBindPose=function(e,t){for(var a=e.children,r=a.length,n=[],i=0;r>i;++i){var s=e.children[i];if("PoseNode"===s.children[0].value){var o=new HX._FBX._BindPoseElement,l=s.getChildNode("Matrix").data;o.id=s.getChildNode("Node").data[0].value,o.matrix.set(l[0],l[1],l[2],l[3],l[4],l[5],l[6],l[7],l[8],l[9],l[10],l[11],l[12],l[13],l[14],l[15]),n.push(o)}}return n},HX._FBX.prototype._processDeformer=function(e,t){var a=e.data[2].value;switch(a){case"Skin":var r=new HX.Skeleton;return this._skeletonSetups[t]={skeleton:r,modelData:null,modelUID:null,clusters:[]},r;case"Cluster":return this._processCluster(e,t)}},HX._FBX.prototype._processCluster=function(e,t){var a=e.getChildNode("Indexes"),r=e.getChildNode("Weights");if(!a||!r)return null;var n=new HX._FBX._Cluster;return n.indices=a.data[0].value,n.weights=r.data[0].value,n},HX._FBX.prototype._processTexture=function(e,t){return new HX._FBX._DummyTexture},HX._FBX.prototype._processConnections=function(){var e=this._rootNode.getChildNode("Connections");if(e){e=e.children;for(var t=e.length,a=0;t>a;++a){var r=e[a],n=r.data[0].value,i=r.data[1].value,s=r.data[2].value,o=r.data[3]?r.data[3].value:null,l=this._objects[i],h=this._objects[s];if(console.log(i+" -> "+s),l&&h)switch(console.log(l.toString()+" -> "+h.toString()),n){case"OO":case"OP":this._connectObject(l,h,i,s,o)}}this._finalizeSkinning(),this._finalizeModelInstances();

}},HX._FBX.prototype._connectObject=function(e,t,a,r,n){if(e instanceof HX._FBX._DummyNode||e instanceof HX._FBX._DummyTexture)e.child?this._connectObject(e.child,t,a,r,n):(e.parent=t,e.parentUID=r,n&&(e.textureType=n));else if(t instanceof HX._FBX._DummyNode||t instanceof HX._FBX._DummyTexture)t.useTransform&&(e.transformationMatrix=t.transformationMatrix),t.parent?this._connectObject(e,t.parent,a,t.parentUID,t.textureType):t.child=e;else if(e instanceof HX.ModelInstance)this._modelInstanceSetups[a].parent=t;else if(e instanceof HX.SceneNode)t.attach(e);else if(e instanceof HX.ModelData)this._modelInstanceSetups[r].materialsIDs=this._modelMaterialIDs[a],this._modelInstanceSetups[r].modelData=e;else if(e instanceof HX._FBX._Cluster)this._skeletonSetups[r].clusters.push(e);else if(e instanceof HX.Skeleton)this._skeletonSetups[a].modelData=t,this._skeletonSetups[a].modelUID=r;else if(e instanceof HX.Material)this._modelInstanceSetups[r].materials.push(e);else if(e instanceof HX.Texture2D)switch(n){case"DiffuseColor":t.colorMap=e;break;case"SpecularColor":t.specularMap=e;break;case"NormalMap":t.normalMap=e}},HX._FBX.prototype._finalizeModelInstances=function(){for(var e in this._modelInstanceSetups)if(this._modelInstanceSetups.hasOwnProperty(e)){for(var t=this._modelInstanceSetups[e],a=[],r=0;r<t.materialsIDs.length;++r){var n=t.materialsIDs[r];a.push(t.materials[n])}var i=new HX.Model(t.modelData);i.name=t.modelData.name,t.modelInstance.init(i,a),t.parent?t.parent.attach(t.modelInstance):this._target.attach(t.modelInstance)}},HX._FBX.prototype._finalizeSkinning=function(){for(var e in this._skeletonSetups)if(this._skeletonSetups.hasOwnProperty(e)){for(var t=this._skeletonSetups[e],a=this._ctrlPointLookUp[t.modelUID],r=[],n=t.modelData.numMeshes,i=0;n>i;++i){r[i]=[];for(var s=t.modelData.getMeshData(i).numVertices,o=0;8*s>o;++o)r[i][o]=-1}n=t.clusters.length;for(var i=0;n>i;++i)this._assignClusters(a,t.clusters[i],r);n=t.modelData.numMeshes;for(var i=0;n>i;++i){for(var l=t.modelData.getMeshData(i),s=r[i].length,o=0;s>o;++o)-1===r[i][o]&&(r[i][o]=0);l.addVertexAttribute("hx_boneIndices",4,1),l.addVertexAttribute("hx_boneWeights",4,1),l.setVertexData(r[i],1)}t.modelData.skeleton=t.skeleton}},HX._FBX.prototype._assignClusters=function(e,t,a){for(var r=t.indices.length,n=t.jointIndex,i=0;r>i;++i)for(var s=t.indices[i],o=t.weights[i],l=e[s],h=8*l.index,i=h;h+4>i;++i)-1===a[l.meshIndex][i]&&(a[l.meshIndex][i]=n,a[l.meshIndex][i+4]=o),i===h+4&&this._notifyFailure("Too many bones per matrix! (max 4)")},HX._FBX._NodeRecord=function(){this.name="",this.data=[],this.children=[]},HX._FBX._NodeRecord.prototype={getChildNode:function(e){for(var t=this.children,a=t.length,r=0;a>r;++r)if(t[r].name===e)return t[r]}},HX._FBX._DummyTexture=function(){this.name=null,this.child=null,this.parent=null,this.parentUID=null,this.textureType=null,this.toString=function(){return"[DummyTexture(name="+this.name+")"}},HX._FBX._DummyNode=function(){HX.Transform.call(this),this.name=null,this.child=null,this.parent=null,this.parentUID=null,this.useTransform=!1,this.toString=function(){return"[DummyNode(name="+this.name+")"}},HX._FBX._DummyNode.prototype=Object.create(HX.Transform.prototype),HX._FBX._DataElement=function(){this.typeCode=null,this.value=null},HX._FBX._DataElement.INT16="Y",HX._FBX._DataElement.BOOLEAN="C",HX._FBX._DataElement.INT32="I",HX._FBX._DataElement.FLOAT="F",HX._FBX._DataElement.DOUBLE="D",HX._FBX._DataElement.INT64="L",HX._FBX._DataElement.BOOLEAN_ARRAY="b",HX._FBX._DataElement.INT32_ARRAY="i",HX._FBX._DataElement.FLOAT_ARRAY="f",HX._FBX._DataElement.DOUBLE_ARRAY="d",HX._FBX._DataElement.INT64_ARRAY="l",HX._FBX._DataElement.STRING="S",HX._FBX._DataElement.RAW="R",HX._FBX._STRING_DEMARCATION=String.fromCharCode(0,1),HX._FBX._Mapping={NONE:0,BY_POLYGON_VERTEX:1,BY_CONTROL_POINT:2,BY_POLYGON:3,ALL_SAME:4},HX._FBX._MeshData=function(){this.vertices=null,this.hasColor=!1,this.hasUVs=!1,this.hasNormals=!1,this.numMaterials=0},HX._FBX._Vertex=function(){this.pos=new HX.Float4,this.uv=null,this.normal=null,this.color=null,this.materialIndex=0,this.ctrlPointIndex=-1,this._hash=null,this.lastVertex=!1},HX._FBX._Vertex.prototype={getHash:function(){if(!this._hash){var e=this.ctrlPointIndex+"/"+this.materialIndex+"/"+this.pos.x+"/"+this.pos.y+"/"+this.pos.z;this.normal&&(e=e+"/"+this.normal.x+"/"+this.normal.y+"/"+this.normal.z),this.uv&&(e=e+"/"+this.uv.x+"/"+this.uv.y),this.color&&(e=e+"/"+this.color.x+"/"+this.color.y+"/"+this.color.z),this._hash=e}return this._hash}},HX._FBX._LimbNode=function(){HX.GroupNode.call(this),this.name=null,this.toString=function(){return"[LimbNode(name="+this.name+")"}},HX._FBX._LimbNode.prototype=Object.create(HX.GroupNode.prototype),HX._FBX._BindPose=function(){this.bindPoseElements=[],this.name=null,this.toString=function(){return"[BindPose(name="+this.name+")"}},HX._FBX._BindPoseElement=function(){this.matrix=new HX.Matrix4x4},HX._FBX._Cluster=function(){this.name=null,this.limbNode=null,this.weights=null,this.jointIndex=0,this.joint=null,this.toString=function(){return"[Cluster(name="+this.name+")"}},HX.MTL=function(){HX.AssetParser.call(this,Object,HX.URLLoader.DATA_TEXT),this._textures=[],this._texturesToLoad=[],this._activeMaterial=null},HX.MTL.prototype=Object.create(HX.AssetParser.prototype),HX.MTL.prototype.parse=function(e,t){for(var a=e.split("\n"),r=a.length,n=0;r>n;++n){var i=a[n].replace(/^\s+|\s+$/g,"");this._parseLine(i,t)}return this._loadTextures(t),t},HX.MTL.prototype._parseLine=function(e,t){if(0!==e.length&&"#"!==e.charAt(0)){var a=e.split(/\s+/);switch(a[0].toLowerCase()){case"newmtl":this._activeMaterial=new HX.PBRMaterial,this._activeMaterial.name=a[1],t[a[1]]=this._activeMaterial;break;case"ns":var r=parseFloat(a[1]);this._activeMaterial.roughness=Math.sqrt(2/(r+2));break;case"kd":this._activeMaterial.color=new HX.Color(parseFloat(a[1]),parseFloat(a[2]),parseFloat(a[3]));break;case"map_kd":this._activeMaterial.colorMap=this._getTexture(a[1]);break;case"map_d":this._activeMaterial.maskMap=this._getTexture(a[1]),this._activeMaterial.alphaThreshold=.5;break;case"map_ns":this._activeMaterial.specularMap=this._getTexture(a[1]);break;case"map_bump":case"bump":this._activeMaterial.normalMap=this._getTexture(a[1])}}},HX.MTL.prototype._getTexture=function(e){return this._textures[e]||(this._textures[e]=new HX.Texture2D,this._texturesToLoad.push({file:this._correctURL(e),parser:HX.JPG,target:this._textures[e]})),this._textures[e]},HX.MTL.prototype._loadTextures=function(e){var t=this._texturesToLoad,a=t.length;if(0===a)return void this._notifyComplete(e);var r=this,n=new HX.BulkAssetLoader;n.onComplete=function(){r._notifyComplete(e)},n.onFail=function(e){r._notifyFailure(e)},n.load(t)},HX.OBJ=function(){HX.AssetParser.call(this,HX.GroupNode),this._objects=[],this._vertices=[],this._normals=[],this._uvs=[],this._hasNormals=!1,this._defaultMaterial=new HX.PBRMaterial,this._target=null,this._mtlLibFile=null},HX.OBJ.prototype=Object.create(HX.AssetParser.prototype),HX.OBJ.prototype.parse=function(e,t){this._groupsAsObjects=void 0===this.options.groupsAsObjects?!0:this._groupsAsObjects,this._target=t;var a=e.split("\n"),r=a.length;this._pushNewObject("hx_default");for(var n=0;r>n;++n){var i=a[n].replace(/^\s+|\s+$/g,"");this._parseLine(i)}this._mtlLibFile?this._loadMTLLib(this._mtlLibFile):this._finish(null)},HX.OBJ.prototype._finish=function(e){this._translate(e),this._notifyComplete(this._target)},HX.OBJ.prototype._loadMTLLib=function(e){var t=new HX.AssetLoader(HX.MTL),a=this;t.onComplete=function(e){a._finish(e)},t.onFail=function(e){a._notifyFailure(e)},t.load(e)},HX.OBJ.prototype._parseLine=function(e){if(0!==e.length&&"#"!==e.charAt(0)){var t=e.split(/\s+/);switch(t[0].toLowerCase()){case"mtllib":this._mtlLibFile=this._correctURL(t[1]);break;case"usemtl":this._setActiveSubGroup(t[1]);break;case"v":this._vertices.push(parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3]));break;case"vt":this._uvs.push(parseFloat(t[1]),parseFloat(t[2]));break;case"vn":this._normals.push(parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3]));break;case"o":this._pushNewObject(t[1]);break;case"g":this._groupsAsObjects?this._pushNewObject(t[1]):this._pushNewGroup(t[1]);break;case"f":this._parseFaceData(t)}}},HX.OBJ.prototype._pushNewObject=function(e){this._activeObject=new HX.OBJ._ObjectData,this._objects.push(this._activeObject),this._pushNewGroup("hx_default")},HX.OBJ.prototype._pushNewGroup=function(e){this._activeGroup=new HX.OBJ._GroupData,this._activeGroup.name=e||"Group"+this._activeGroup.length,this._activeObject.groups.push(this._activeGroup),this._setActiveSubGroup("hx_default")},HX.OBJ.prototype._setActiveSubGroup=function(e){this._activeGroup.subgroups[e]=this._activeGroup.subgroups[e]||new HX.OBJ._SubGroupData,this._activeSubGroup=this._activeGroup.subgroups[e]},HX.OBJ.prototype._parseFaceData=function(e){for(var t=new HX.OBJ._FaceData,a=e.length,r=1;a>r;++r){var n=new HX.OBJ._FaceVertexData;t.vertices.push(n);var i=e[r].split("/"),s=3*(i[0]-1);n.posX=this._vertices[s],n.posY=this._vertices[s+1],n.posZ=this._vertices[s+2],i.length>1&&(s=2*(i[1]-1),n.uvU=this._uvs[s],n.uvV=this._uvs[s+1],i.length>2&&(s=3*(i[2]-1),this._hasNormals=!0,n.normalX=this._normals[s],n.normalY=this._normals[s+1],n.normalZ=this._normals[s+2]))}this._activeSubGroup.faces.push(t),this._activeSubGroup.numIndices+=4===e.length?3:6},HX.OBJ.prototype._translate=function(e){for(var t=this._objects.length,a=0;t>a;++a)this._translateObject(this._objects[a],e)},HX.OBJ.prototype._translateObject=function(e,t){var a=e.groups.length;if(0!==a){for(var r=new HX.ModelData,n=[],i=new HX.Model,s=0;a>s;++s){var o=e.groups[s];for(var l in o.subgroups)if(o.subgroups.hasOwnProperty(l)){var h=o.subgroups[l];if(0===h.numIndices)continue;r.addMeshData(this._translateMeshData(h));var c=t?t[l]:null;c=c||this._defaultMaterial,n.push(c)}}i._setModelData(r);var u=new HX.ModelInstance(i,n);u.name=e.name,this._target.attach(u)}},HX.OBJ.prototype._translateMeshData=function(e){for(var t=HX.MeshData.createDefaultEmpty(),a=[],r=new Array(e.numIndices),n=0,i=0,s=e.faces,o=s.length,l=0;o>l;++l){for(var h=s[l],c=h.vertices,u=c.length,d=0;u>d;++d){var _=c[d],p=_.getHash();a.hasOwnProperty(p)||(a[p]={index:n++,vertex:_})}r[i]=a[c[0].getHash()].index,r[i+1]=a[c[1].getHash()].index,r[i+2]=a[c[2].getHash()].index,i+=3,4===u&&(r[i]=a[c[0].getHash()].index,r[i+1]=a[c[2].getHash()].index,r[i+2]=a[c[3].getHash()].index,i+=3)}var f=new Array(n*HX.MeshData.DEFAULT_VERTEX_SIZE);for(var p in a)if(a.hasOwnProperty(p)){var m=a[p],X=m.vertex,v=m.index*HX.MeshData.DEFAULT_VERTEX_SIZE;f[v]=X.posX,f[v+1]=X.posY,f[v+2]=X.posZ,f[v+3]=X.normalX,f[v+4]=X.normalY,f[v+5]=X.normalZ,f[v+6]=0,f[v+7]=0,f[v+8]=0,f[v+9]=1,f[v+10]=X.uvU,f[v+11]=X.uvV}t.setVertexData(f,0),t.setIndexData(r);var b=HX.NormalTangentGenerator.MODE_TANGENTS;this._hasNormals||(b|=HX.NormalTangentGenerator.MODE_NORMALS);var x=new HX.NormalTangentGenerator;return x.generate(t,b,!0),t},HX.OBJ._FaceVertexData=function(){this.posX=0,this.posY=0,this.posZ=0,this.uvU=0,this.uvV=0,this.normalX=0,this.normalY=0,this.normalZ=0,this._hash=""},HX.OBJ._FaceVertexData.prototype={getHash:function(){return this._hash||(this._hash=this.posX+"/"+this.posY+"/"+this.posZ+"/"+this.uvU+"/"+this.uvV+"/"+this.normalX+"/"+this.normalY+"/"+this.normalZ+"/"),this._hash}},HX.OBJ._FaceData=function(){this.vertices=[]},HX.OBJ._SubGroupData=function(){this.numIndices=0,this.faces=[]},HX.OBJ._GroupData=function(){this.subgroups=[],this.name="",this._activeMaterial=null},HX.OBJ._ObjectData=function(){this.name="",this.groups=[],this._activeGroup=null},HX.FbxAnimationCurve=function(){HX.FbxObject.call(this)},HX.FbxAnimationCurve.prototype=Object.create(HX.FbxObject.prototype),HX.FbxAnimationCurve.prototype.toString=function(){return"[FbxAnimationCurve(name="+this.name+")]"},HX.FbxAnimationCurveNode=function(){HX.FbxObject.call(this)},HX.FbxAnimationCurveNode.prototype=Object.create(HX.FbxObject.prototype),HX.FbxAnimationCurveNode.prototype.toString=function(){return"[FbxAnimationCurveNode(name="+this.name+")]"},HX.FbxAnimLayer=function(){HX.FbxObject.call(this),this.curveNodes=null},HX.FbxAnimLayer.prototype=Object.create(HX.FbxObject.prototype),HX.FbxAnimLayer.prototype.toString=function(){return"[FbxAnimLayer(name="+this.name+")]"},HX.FbxAnimLayer.prototype.connectObject=function(e){if(!(e instanceof HX.FbxAnimationCurveNode))throw new Error("Incompatible child object "+e.toString());this.curveNodes=this.curveNodes||[],this.curveNodes.push(e)},HX.FbxAnimStack=function(){HX.FbxObject.call(this),this.layers=null},HX.FbxAnimStack.prototype=Object.create(HX.FbxObject.prototype),HX.FbxAnimStack.prototype.connectObject=function(e){if(!(e instanceof HX.FbxAnimLayer))throw new Error("Incompatible child object "+e.toString());this.layers=this.layers||[],this.layers.push(e)},HX.FbxAnimStack.prototype.toString=function(){return"[FbxAnimStack(name="+this.name+")]"},HX.FbxDeformer=function(){HX.FbxObject.call(this),this.children=null},HX.FbxDeformer.prototype=Object.create(HX.FbxObject.prototype),HX.FbxDeformer.prototype.toString=function(){return"[FbxDeformer(name="+this.name+")]"},HX.FbxDeformer.prototype.connectObject=function(e){if(e instanceof HX.FbxDeformer)this.children=this.children||[],this.children.push(e);else if(!(e instanceof HX.FbxNode))throw new Error("Unhandled object connection "+e.toString())},HX.FbxFileTexture=function(){HX.FbxObject.call(this),this.WrapModeU=0,this.WrapModeV=0,this.relativeFilename=null,this.video=null},HX.FbxFileTexture.prototype=Object.create(HX.FbxObject.prototype),HX.FbxFileTexture.prototype.connectObject=function(e){if(!(e instanceof HX.FbxVideo))throw new Error("Incompatible child object!");this.video=e},HX.FbxFileTexture.prototype.toString=function(){return"[FbxFileTexture(name="+this.name+")]"},HX.FbxLayerElement=function(){HX.FbxObject.call(this),this.directData=null,this.indexData=null,this.type=null,this.mappingInformationType=0,this.referenceInformationType=0},HX.FbxLayerElement.prototype=Object.create(HX.FbxObject.prototype),HX.FbxLayerElement.MAPPING_TYPE={NONE:0,BY_POLYGON_VERTEX:1,BY_CONTROL_POINT:2,BY_POLYGON:3,ALL_SAME:4},HX.FbxLayerElement.REFERENCE_TYPE={DIRECT:1,INDEX_TO_DIRECT:2},HX.FbxLayerElement.prototype.toString=function(){return"[FbxLayerElement(name="+this.name+")]"},HX.FbxMaterial=function(){HX.FbxObject.call(this),this.EmissiveColor=null,this.EmissiveFactor=1,this.DiffuseColor=null,this.DiffuseFactor=1,this.ShininessExponent=void 0,this.Shininess=void 0,this.textures=null},HX.FbxMaterial.prototype=Object.create(HX.FbxObject.prototype),HX.FbxMaterial.prototype.connectProperty=function(e,t){if(!(e instanceof HX.FbxFileTexture))throw new Error("Unknown object property!");this.textures=this.textures||{},this.textures[t]=e},HX.FbxMaterial.prototype.toString=function(){return"[FbxMaterial(name="+this.name+")]"},HX.FbxMesh=function(){HX.FbxObject.call(this),this.Color=null,this["Casts Shadows"]=!0,this.vertices=null,this.layerElements=null},HX.FbxMesh.prototype=Object.create(HX.FbxObject.prototype),HX.FbxMesh.prototype.toString=function(){return"[FbxMesh(name="+this.name+")]"},HX.FbxMesh.prototype.connectObject=function(e){if(!(e instanceof HX.FbxDeformer))throw new Error("Unhandled object connection "+e.toString())},HX.FbxNodeAttribute=function(){HX.FbxObject.call(this),this.type=null},HX.FbxNodeAttribute.prototype=Object.create(HX.FbxObject.prototype),HX.FbxNodeAttribute.prototype.toString=function(){return"[FbxNodeAttribute(name="+this.name+")]"},HX.FbxPose=function(){HX.FbxObject.call(this)},HX.FbxPose.prototype=Object.create(HX.FbxObject.prototype),HX.FbxPose.prototype.toString=function(){return"[FbxPose(name="+this.name+")]"},HX.FbxVideo=function(){HX.FbxObject.call(this),this.relativeFilename=null},HX.FbxVideo.prototype=Object.create(HX.FbxObject.prototype),HX.FbxVideo.prototype.toString=function(){return"[FbxVideo(name="+this.name+")]"};