!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports,require("cannon"),require("helix")):"function"==typeof define&&define.amd?define("HX",["exports","cannon","helix"],i):i(t.HX=t.HX||{},t.CANNON,t.HX)}(this,function(t,i,n){"use strict";function e(t,i){n.Component.call(this),this._type=t||e.TYPE_AUTO,this._body=null,t===e.TYPE_INFINITE_PLANE&&(this._mass=0),this._linearDamping=.01,this._angularDamping=.01,this._mass=i}function o(){n.EntitySystem.call(this),this._world=new i.World,this._gravity=-9.81,this._world.gravity.set(0,this._gravity,0),this._world.solver.tolerance=.001,this._world.solver.iterations=10,this._fixedTimeStep=1e3/60,this._friction=0,this._world.broadphase=new i.SAPBroadphase(this._world),this._world.quatNormalizeFast=!0,this._world.quatNormalizeSkip=8,this._components=[]}e.TYPE_BOX=1,e.TYPE_SPHERE=2,e.TYPE_INFINITE_PLANE=3,e.TYPE_AUTO=4,n.Component.create(e,{body:{get:function(){return this._body}},mass:{get:function(){return this._mass},set:function(t){this._mass=t,this._body&&(this._body.mass=t)}},linearDamping:{get:function(){return this._linearDamping},set:function(t){this._linearDamping=t,this._body&&(this._body.linearDamping=t)}},angularDamping:{get:function(){return this._angularDamping},set:function(t){this._angularDamping=t,this._body&&(this._body.angularDamping=t)}}}),e.prototype.onAdded=function(){this._createBody()},e.prototype.onRemoved=function(){},e.prototype.applyTransform=function(){if(this._type!==e.TYPE_INFINITE_PLANE){var t=this._entity,i=this._body;t.position=i.position,t.rotation=i.quaternion}},e.prototype._createBody=function(){var t,o=this._entity,s=o.localBounds,r=this._type;switch(r===e.TYPE_AUTO&&(r=s instanceof n.BoundingAABB?e.TYPE_BOX:e.TYPE_SPHERE),r){case e.TYPE_BOX:var a=s.getHalfExtents(),d=8*(a.x*a.y*a.z),_=new i.Vec3(a);_.copy(a),t=new i.Box(_),void 0===this._mass&&(this._mass=10*d);break;case e.TYPE_SPHERE:var h=s.getRadius(),d=.75*Math.PI*h*h*h;t=new i.Sphere(h),void 0===this._mass&&(this._mass=10*d);break;case e.TYPE_INFINITE_PLANE:t=new i.Plane;break;default:throw new Error("Invalid enum!")}this._body=new i.Body({mass:this._mass}),this._body.linearDamping=this._linearDamping,this._body.angularDamping=this._angularDamping,this._body.addShape(t,s.center),this._body.position.copy(o.position),r===e.TYPE_INFINITE_PLANE?this._body.quaternion.setFromAxisAngle(n.Float4.X_AXIS,.5*-Math.PI):this._body.quaternion.copy(o.rotation)},o.prototype=Object.create(n.EntitySystem.prototype,{gravity:{get:function(){return this._gravity},set:function(t){this._gravity=t,t instanceof n.Float4?this._world.gravity.set(t.x,t.y,t.z):this._world.gravity.set(0,t,0)}},fixedTimeStep:{get:function(){return this._fixedTimeStep},set:function(t){this._fixedTimeStep=t}}}),o.prototype.onStarted=function(){this._colliders=this.getEntitySet([e]),this._colliders.onEntityAdded.bind(this._onEntityAdded,this),this._colliders.onEntityRemoved.bind(this._onEntityRemoved,this);for(var t=this._colliders.numEntities,i=0;i<t;++i){var n=this._colliders.getEntity(i);this._onEntityAdded(n)}},o.prototype.onStopped=function(){this._colliders.onEntityAdded.unbind(this._onEntityAdded),this._colliders.onEntityRemoved.unbind(this._onEntityRemoved)},o.prototype._onEntityAdded=function(t){var i=t.getFirstComponentByType(e);this._components.push(i),this._world.addBody(i.body)},o.prototype._onEntityRemoved=function(){var t=entity.getFirstComponentByType(e);this._world.removeBody(t.body);var i=this._components.indexOf(t);this._components.splice(i,1)},o.prototype.onUpdate=function(t){this._world.step(.001*this._fixedTimeStep);for(var i=this._components.length,n=0;n<i;++n)this._components[n].applyTransform()},t.PhysicsSystem=o,t.RigidBodyComponent=e,Object.defineProperty(t,"__esModule",{value:!0})});