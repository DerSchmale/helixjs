!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports,require("cannon"),require("helix")):"function"==typeof define&&define.amd?define("HX",["exports","cannon","helix"],i):i(t.HX=t.HX||{},t.CANNON,t.HX)}(this,function(t,i,n){"use strict";function e(){this._center=null,this._orientation=null}function s(t,i){e.call(this),t&&i&&(this._halfExtents=HX.Float.subtract(i,t).scale(.5),this._center=HX.Float.add(i,t).scale(.5))}function r(t,i){e.call(this),this._radius=t,this._center=i,void 0!==t&&void 0===i&&(this._center=new HX.Float4)}function o(t,i){n.Component.call(this),this._collider=t,this._body=null,this._mass=i,this._linearDamping=.01,this._angularDamping=.01}function h(){n.EntitySystem.call(this),this._world=new i.World,this._gravity=-9.81,this._world.gravity.set(0,0,this._gravity),this._world.solver.tolerance=.001,this._world.solver.iterations=10,this._fixedTimeStep=1e3/60,this._friction=0,this._world.broadphase=new i.SAPBroadphase(this._world),this._components=[]}function a(t,i,n,e){this.x=t||0,this.y=i||0,this.z=n||0,this.w=void 0===e?1:e}function c(){this._listeners=[],this._lookUp={}}function u(){this._enabled=!0,this.onChange=new c,this._targets=[]}function f(){this._position=new a(0,0,0,1),this._rotation=new _,this._euler=new a(0,0,0,0),this._scale=new a(1,1,1,1),this._matrix=new l,this._eulerInvalid=!0,this._eulerChangeListener=new u,this._eulerChangeListener.add(this._euler,"x"),this._eulerChangeListener.add(this._euler,"y"),this._eulerChangeListener.add(this._euler,"z"),this._eulerChangeListener.onChange.bind(this._onEulerChanged,this),this._changeListener=new u,this._changeListener.add(this._position,"x"),this._changeListener.add(this._position,"y"),this._changeListener.add(this._position,"z"),this._changeListener.add(this._scale,"x"),this._changeListener.add(this._scale,"y"),this._changeListener.add(this._scale,"z"),this._changeListener.onChange.bind(this._invalidateMatrix,this),this._rotationChangeListener=new u,this._rotationChangeListener.add(this._rotation,"x"),this._rotationChangeListener.add(this._rotation,"y"),this._rotationChangeListener.add(this._rotation,"z"),this._rotationChangeListener.add(this._rotation,"w"),this._rotationChangeListener.onChange.bind(this._onRotationChanged,this)}function l(t,i,n,e,s,r,o,h,a,c,u,f,l,_,y,d){if(void 0!==t&&isNaN(t))this._m=new Float32Array(t);else{var m=this._m=new Float32Array(16);m[0]=void 0===t?1:0,m[1]=s||0,m[2]=a||0,m[3]=l||0,m[4]=i||0,m[5]=void 0===r?1:0,m[6]=c||0,m[7]=_||0,m[8]=n||0,m[9]=o||0,m[10]=void 0===u?1:0,m[11]=y||0,m[12]=e||0,m[13]=h||0,m[14]=f||0,m[15]=void 0===d?1:0}}function _(t,i,n,e){this.x=t||0,this.y=i||0,this.z=n||0,this.w=void 0===e?1:e}function y(t){e.call(this),t&&(this._center=new HX.Float4(0,t,0))}e.prototype={createRigidBody:function(t){var n=this.createShape(t),e=new i.Body({mass:50*this.volume()});return this._center||(this._center=t.center),e.addShape(n,this._center,this._orientation),e},createShape:function(t){throw new Error("Abstract method called!")},volume:function(){throw new Error("Abstract method called!")}},s.prototype=Object.create(e.prototype),s.prototype.volume=function(){return 8*(this._halfExtents.x*this._halfExtents.y*this._halfExtents.z)},s.prototype.createShape=function(t){this._halfExtents||(this._halfExtents=t.getHalfExtents());var n=new i.Vec3;return n.copy(this._halfExtents),new i.Box(n)},r.prototype=Object.create(e.prototype),r.prototype.volume=function(){var t=this._radius;return.75*Math.PI*t*t*t},r.prototype.createShape=function(t){return this._radius=this._radius||t.getRadius(),new i.Sphere(this._radius)},n.Component.create(o,{body:{get:function(){return this._body}},mass:{get:function(){return this._mass},set:function(t){this._mass=t,this._body&&(this._body.mass=t)}},linearDamping:{get:function(){return this._linearDamping},set:function(t){this._linearDamping=t,this._body&&(this._body.linearDamping=t)}},angularDamping:{get:function(){return this._angularDamping},set:function(t){this._angularDamping=t,this._body&&(this._body.angularDamping=t)}}}),o.prototype.onAdded=function(){this._createBody()},o.prototype.onRemoved=function(){},o.prototype.applyTransform=function(){if(0!==this._mass){var t=this._entity,i=this._body;t.position=i.position,t.rotation=i.quaternion}},o.prototype._createBody=function(){var t,i=this._entity;if(i instanceof n.ModelInstance)t=i.localBounds;else{var e=new n.Matrix4x4;e.inverseAffineOf(i.worldMatrix),t=new n.BoundingAABB,t.transformFrom(i.worldBounds,e)}this._collider||(this._collider=t instanceof n.BoundingAABB?new s:new r),this._body=this._collider.createRigidBody(t),void 0!==this._mass&&(this._body.mass=this._mass),this._body.linearDamping=this._linearDamping,this._body.angularDamping=this._angularDamping,this._body.position.copy(i.position),this._body.quaternion.copy(i.rotation)},h.prototype=Object.create(n.EntitySystem.prototype,{gravity:{get:function(){return this._gravity},set:function(t){this._gravity=t,t instanceof n.Float4?this._world.gravity.set(t.x,t.y,t.z):this._world.gravity.set(0,t,0)}},fixedTimeStep:{get:function(){return this._fixedTimeStep},set:function(t){this._fixedTimeStep=t}}}),h.prototype.onStarted=function(){this._colliders=this.getEntitySet([o]),this._colliders.onEntityAdded.bind(this._onEntityAdded,this),this._colliders.onEntityRemoved.bind(this._onEntityRemoved,this);for(var t=this._colliders.numEntities,i=0;i<t;++i){var n=this._colliders.getEntity(i);this._onEntityAdded(n)}},h.prototype.onStopped=function(){this._colliders.onEntityAdded.unbind(this._onEntityAdded),this._colliders.onEntityRemoved.unbind(this._onEntityRemoved)},h.prototype._onEntityAdded=function(t){var i=t.getFirstComponentByType(o);this._components.push(i),this._world.addBody(i.body)},h.prototype._onEntityRemoved=function(){var t=entity.getFirstComponentByType(o);this._world.removeBody(t.body);var i=this._components.indexOf(t);this._components.splice(i,1)},h.prototype.onUpdate=function(t){this._world.step(.001*this._fixedTimeStep);for(var i=this._components.length,n=0;n<i;++n)this._components[n].applyTransform()},a.add=function(t,i,n){return n=n||new a,n.x=t.x+i.x,n.y=t.y+i.y,n.z=t.z+i.z,n.w=t.w+i.w,n},a.subtract=function(t,i,n){return n=n||new a,n.x=t.x-i.x,n.y=t.y-i.y,n.z=t.z-i.z,n.w=t.w-i.w,n},a.scale=function(t,i,n){return n=n||new a,n.x=t.x*i,n.y=t.y*i,n.z=t.z*i,n},a.scale4=function(t,i,n){return n=n||new a,n.x=t.x*i,n.y=t.y*i,n.z=t.z*i,n.w=t.w*i,n},a.cross=function(t,i,n){n=n||new a;var e=t.x,s=t.y,r=t.z,o=i.x,h=i.y,c=i.z;return n.x=s*c-r*h,n.y=r*o-e*c,n.z=e*h-s*o,n.w=0,n},a.prototype={set:function(t,i,n,e){return this.x=t,this.y=i,this.z=n,this.w=void 0===e?this.w:e,this},get lengthSqr(){return this.x*this.x+this.y*this.y+this.z*this.z},get length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},normalize:function(){var t=1/this.length;return this.x*=t,this.y*=t,this.z*=t,this},normalizeAsPlane:function(){var t=1/this.length;return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},clone:function(){return new a(this.x,this.y,this.z,this.w)},add:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},addScaled:function(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this.w+=t.w*i,this},subtract:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this},scale:function(t){return this.x*=t,this.y*=t,this.z*=t,this},scale4:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},negativeOf:function(t){return this.x=-t.x,this.y=-t.y,this.z=-t.z,this.w=-t.w,this},homogeneousProject:function(){var t=1/this.w;return this.x*=t,this.y*=t,this.z*=t,this.w=1,this},abs:function(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this.z=Math.abs(this.z),this.w=Math.abs(this.w),this},fromSphericalCoordinates:function(t,i,n){return this.x=t*Math.sin(n)*Math.cos(i),this.y=t*Math.sin(n)*Math.sin(i),this.z=t*Math.cos(n),this.w=1,this},copyFrom:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},maximize:function(t){return t.x>this.x&&(this.x=t.x),t.y>this.y&&(this.y=t.y),t.z>this.z&&(this.z=t.z),t.w>this.w&&(this.w=t.w),this},maximize3:function(t){return t.x>this.x&&(this.x=t.x),t.y>this.y&&(this.y=t.y),t.z>this.z&&(this.z=t.z),this},minimize:function(t){return t.x<this.x&&(this.x=t.x),t.y<this.y&&(this.y=t.y),t.z<this.z&&(this.z=t.z),t.w<this.w&&(this.w=t.w),this},minimize3:function(t){return t.x<this.x&&(this.x=t.x),t.y<this.y&&(this.y=t.y),t.z<this.z&&(this.z=t.z),this},planeFromNormalAndPoint:function(t,i){var n=t.x,e=t.y,s=t.z;return this.x=n,this.y=e,this.z=s,this.w=-(i.x*n+i.y*e+i.z*s),this},planeFromVectorsAndPoint:function(t,i,n){this.cross(t,i),this.normalize(),this.w=-(n.x*this.x+n.y*this.y+n.z*this.z)},planeFromPoints:function(t,i,n){var e=new a,s=new a;return function(t,i,n){a.subtract(t,n,e),a.subtract(i,n,s),this.planeFromVectorsAndPoint(e,s,n)}}(),planeIntersectRay:function(t,i){i=i||new HX.Float4;var n=this.dot3(t.direction);if(Math.abs(n)>1e-5){var e=-(this.dot3(t.origin)+this.w)/n;if(e>0)return i.copyFrom(t.origin),i.addScaled(t.direction,e),i}return null},angle:function(t){return Math.acos(this.dot3(t)/(this.length*t.length))},angleNormalized:function(t){return Math.acos(this.dot3(t))},distanceTo:function(t){var i=t.x-this.x,n=t.y-this.y,e=t.z-this.z;return Math.sqrt(i*i+n*n+e*e)},squareDistanceTo:function(t){var i=t.x-this.x,n=t.y-this.y,e=t.z-this.z;return i*i+n*n+e*e},dot3:function(t){return t.x*this.x+t.y*this.y+t.z*this.z},dot:function(t){return t.x*this.x+t.y*this.y+t.z*this.z},dot4:function(t){return t.x*this.x+t.y*this.y+t.z*this.z+t.w*this.w},lerp:function(t,i,n){var e=t.x,s=t.y,r=t.z,o=t.w;return this.x=e+(i.x-e)*n,this.y=s+(i.y-s)*n,this.z=r+(i.z-r)*n,this.w=o+(i.w-o)*n,this},cross:function(t,i){var n=t.x,e=t.y,s=t.z,r=i.x,o=i.y,h=i.z;return this.x=e*h-s*o,this.y=s*r-n*h,this.z=n*o-e*r,this.w=0,this},toString:function(){return"Float4("+this.x+", "+this.y+", "+this.z+", "+this.w+")"}},a.ORIGIN_POINT=new a(0,0,0,1),a.ZERO=new a(0,0,0,0),a.X_AXIS=new a(1,0,0,0),a.Y_AXIS=new a(0,1,0,0),a.Z_AXIS=new a(0,0,1,0);var d=1/Math.log(2),m={DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,sign:function(t){return 0===t?0:t>0?1:-1},isPowerOfTwo:function(t){return!!t&&(t&-t)===t},log2:function(t){return Math.log(t)*d},clamp:function(t,i,n){return t<i?i:t>n?n:t},saturate:function(t){return m.clamp(t,0,1)},lerp:function(t,i,n){return t+(i-t)*n},linearStep:function(t,i,n){return m.saturate((n-t)/(i-t))},estimateGaussianRadius:function(t,i){return Math.sqrt(-2*t*Math.log(i))},fract:function(t){return t-Math.floor(t)}};c.prototype={bind:function(t,i){this._lookUp[t]=this._listeners.length;var n=i?t.bind(i):t;this._listeners.push(n)},unbind:function(t){var i=this._lookUp[t];void 0!==i&&(this._listeners.splice(i,1),delete this._lookUp[t])},unbindAll:function(){this._listeners=[],this._lookUp={}},dispatch:function(t){for(var i=this._listeners.length,n=0;n<i;++n)this._listeners[n].apply(null,arguments)},get hasListeners(){return this._listeners.length>0}},u.prototype={get enabled(){return this._enabled},set enabled(t){this._enabled=t},add:function(t,i){var n=this._targets.length;this._targets.push({object:t,propertyName:i,value:t[i]});var e=this,s=e._targets[n];Object.defineProperty(t,i,{get:function(){return s.value},set:function(t){t!==s.value&&(s.value=t,e._enabled&&e.onChange.dispatch())}})},remove:function(t,i){for(var n=0;n<this._targets.length;++n){var e=this._targets[n];e.object===t&&e.propertyName===i&&(delete e.object[e.propertyName],e.object[e.propertyName]=e.value,this._targets.splice(n--,1))}}},f.prototype={get position(){return this._position},set position(t){this._position.copyFrom(t)},get rotation(){return this._rotation},set rotation(t){this._rotationChangeListener.enabled=!1,this._rotation.copyFrom(t),this._rotationChangeListener.enabled=!0,this._onRotationChanged()},get euler(){return this._eulerInvalid&&(this._eulerChangeListener.enabled=!1,this._rotation.toEuler(this._euler),this._eulerChangeListener.enabled=!0),this._euler},set euler(t){this._eulerChangeListener.enabled=!1,this._euler.copyFrom(t),this._eulerChangeListener.enabled=!0,this._onEulerChanged()},get scale(){return this._scale},set scale(t){this._scale.copyFrom(t)},lookAt:function(t){this._matrix.lookAt(t,this._position),this._matrix.appendScale(this._scale),this._applyMatrix()},copyTransform:function(t){this._changeListener.enabled=!1,this._rotationChangeListener.enabled=!1,this._position.copyFrom(t.position),this._rotation.copyFrom(t.rotation),this._scale.copyFrom(t.scale),this._changeListener.enabled=!0,this._rotationChangeListener.enabled=!0,this._eulerInvalid=!0,this._invalidateMatrix()},get matrix(){return this._matrixInvalid&&this._updateMatrix(),this._matrix},set matrix(t){this._matrix.copyFrom(t),this._applyMatrix()},_onEulerChanged:function(){this._rotationChangeListener.enabled=!1,this._rotation.fromEuler(this._euler),this._rotationChangeListener.enabled=!0,this._invalidateMatrix()},_onRotationChanged:function(){this._eulerInvalid=!0,this._invalidateMatrix()},_invalidateMatrix:function(){this._matrixInvalid=!0},_updateMatrix:function(){this._matrix.compose(this),this._matrixInvalid=!1},_applyMatrix:function(){this._matrixInvalid=!1,this._changeListener.enabled=!1,this._rotationChangeListener.enabled=!1,this._matrix.decompose(this),this._changeListener.enabled=!0,this._rotationChangeListener.enabled=!0,this._eulerInvalid=!0}},l.prototype={transform:function(t,i){i=i||new a;var n=t.x,e=t.y,s=t.z,r=t.w,o=this._m;return i.x=o[0]*n+o[4]*e+o[8]*s+o[12]*r,i.y=o[1]*n+o[5]*e+o[9]*s+o[13]*r,i.z=o[2]*n+o[6]*e+o[10]*s+o[14]*r,i.w=o[3]*n+o[7]*e+o[11]*s+o[15]*r,i},projectPoint:function(t,i){i=i||new a;var n=t.x,e=t.y,s=t.z,r=this._m,o=1/(r[3]*n+r[7]*e+r[11]*s+r[15]);return i.x=(r[0]*n+r[4]*e+r[8]*s+r[12])*o,i.y=(r[1]*n+r[5]*e+r[9]*s+r[13])*o,i.z=(r[2]*n+r[6]*e+r[10]*s+r[14])*o,i.w=1,i},transformPoint:function(t,i){i=i||new a;var n=t.x,e=t.y,s=t.z,r=this._m;return i.x=r[0]*n+r[4]*e+r[8]*s+r[12],i.y=r[1]*n+r[5]*e+r[9]*s+r[13],i.z=r[2]*n+r[6]*e+r[10]*s+r[14],i.w=1,i},transformNormal:function(t,i){var n=this._m,e=n[0],s=n[1],r=n[2],o=n[4],h=n[5],c=n[6],u=n[8],f=n[9],l=n[10],_=e*(h*l-f*c)-o*(s*l-f*r)+u*(s*c-h*r),y=1/_,d=(h*l-f*c)*y,m=(f*r-s*l)*y,p=(s*c-h*r)*y,x=(u*c-o*l)*y,w=(e*l-u*r)*y,z=(o*r-e*c)*y,v=(o*f-u*h)*y,g=(u*s-e*f)*y,b=(e*h-o*s)*y;i=i||new a;var M=t.x,j=t.y,A=t.z;return i.x=d*M+m*j+p*A,i.y=x*M+w*j+z*A,i.z=v*M+g*j+b*A,i.w=0,i},transformVector:function(t,i){i=i||new a;var n=t.x,e=t.y,s=t.z,r=this._m;return i.x=r[0]*n+r[4]*e+r[8]*s,i.y=r[1]*n+r[5]*e+r[9]*s,i.z=r[2]*n+r[6]*e+r[10]*s,i.w=0,i},transformExtent:function(t,i){i=i||new a;var n=t.x,e=t.y,s=t.z,r=this._m,o=r[0],h=r[1],c=r[2],u=r[4],f=r[5],l=r[6],_=r[8],y=r[9],d=r[10];return o<0&&(o=-o),h<0&&(h=-h),c<0&&(c=-c),u<0&&(u=-u),f<0&&(f=-f),l<0&&(l=-l),_<0&&(_=-_),y<0&&(y=-y),d<0&&(d=-d),i.x=o*n+u*e+_*s,i.y=h*n+f*e+y*s,i.z=c*n+l*e+d*s,i.w=0,i},copyFrom:function(t){var i=this._m,n=t._m;return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],i[9]=n[9],i[10]=n[10],i[11]=n[11],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15],this},fromQuaternion:function(t){var i=t.x,n=t.y,e=t.z,s=t.w,r=this._m;return r[0]=1-2*(n*n+e*e),r[1]=2*(i*n+s*e),r[2]=2*(i*e-s*n),r[3]=0,r[4]=2*(i*n-s*e),r[5]=1-2*(i*i+e*e),r[6]=2*(n*e+s*i),r[7]=0,r[8]=2*(i*e+s*n),r[9]=2*(n*e-s*i),r[10]=1-2*(i*i+n*n),r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,this},multiply:function(t,i){var n=t._m,e=i._m,s=n[0],r=n[1],o=n[2],h=n[3],a=n[4],c=n[5],u=n[6],f=n[7],l=n[8],_=n[9],y=n[10],d=n[11],m=n[12],p=n[13],x=n[14],w=n[15],z=e[0],v=e[1],g=e[2],b=e[3],M=e[4],j=e[5],A=e[6],C=e[7],E=e[8],O=e[9],S=e[10],L=e[11],R=e[12],F=e[13],P=e[14],I=e[15],D=this._m;return D[0]=s*z+a*v+l*g+m*b,D[1]=r*z+c*v+_*g+p*b,D[2]=o*z+u*v+y*g+x*b,D[3]=h*z+f*v+d*g+w*b,D[4]=s*M+a*j+l*A+m*C,D[5]=r*M+c*j+_*A+p*C,D[6]=o*M+u*j+y*A+x*C,D[7]=h*M+f*j+d*A+w*C,D[8]=s*E+a*O+l*S+m*L,D[9]=r*E+c*O+_*S+p*L,D[10]=o*E+u*O+y*S+x*L,D[11]=h*E+f*O+d*S+w*L,D[12]=s*R+a*F+l*P+m*I,D[13]=r*R+c*F+_*P+p*I,D[14]=o*R+u*F+y*P+x*I,D[15]=h*R+f*F+d*P+w*I,this},multiplyAffine:function(t,i){var n=t._m,e=i._m,s=n[0],r=n[1],o=n[2],h=n[4],a=n[5],c=n[6],u=n[8],f=n[9],l=n[10],_=n[12],y=n[13],d=n[14],m=e[0],p=e[1],x=e[2],w=e[4],z=e[5],v=e[6],g=e[8],b=e[9],M=e[10],j=e[12],A=e[13],C=e[14],E=this._m;return E[0]=s*m+h*p+u*x,E[1]=r*m+a*p+f*x,E[2]=o*m+c*p+l*x,E[4]=s*w+h*z+u*v,E[5]=r*w+a*z+f*v,E[6]=o*w+c*z+l*v,E[8]=s*g+h*b+u*M,E[9]=r*g+a*b+f*M,E[10]=o*g+c*b+l*M,E[12]=s*j+h*A+u*C+_,E[13]=r*j+a*A+f*C+y,E[14]=o*j+c*A+l*C+d,this},fromRotationAxisAngle:function(t,i){var n=Math.cos(i),e=Math.sin(i),s=1/t.length,r=t.x*s,o=t.y*s,h=t.z*s,a=1-n,c=this._m;return c[0]=a*r*r+n,c[1]=a*r*o+e*h,c[2]=a*r*h-e*o,c[3]=0,c[4]=a*r*o-e*h,c[5]=a*o*o+n,c[6]=a*o*h+e*r,c[7]=0,c[8]=a*r*h+e*o,c[9]=a*o*h-e*r,c[10]=a*h*h+n,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,this},fromEuler:function(t,i,n){var e=Math.cos(t),s=Math.sin(t),r=Math.cos(i),o=Math.sin(i),h=Math.cos(n),a=Math.sin(n),c=this._m;return c[0]=r*h,c[1]=e*a+s*o*h,c[2]=s*a-e*o*h,c[3]=0,c[4]=-r*a,c[5]=e*h-s*o*a,c[6]=s*h+e*o*a,c[7]=0,c[8]=o,c[9]=-s*r,c[10]=e*r,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,this},fromRotationPitchYawRoll:function(t,i,n){var e=Math.cos(-t),s=Math.cos(-i),r=Math.cos(n),o=Math.sin(-t),h=Math.sin(-i),a=Math.sin(n),c=-h*e,u=s*e,f=-o,l=-s*a-h*o*r,_=-h*a+o*r*s,y=e*r,d=u*y-f*_,m=f*l-c*y,p=c*_-u*l,x=this._m;return x[0]=d,x[1]=m,x[2]=p,x[3]=0,x[4]=c,x[5]=u,x[6]=f,x[7]=0,x[8]=l,x[9]=_,x[10]=y,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,this},fromTranslation:function(t,i,n){void 0===i&&(t=t.x,i=t.y,n=t.z);var e=this._m;return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t,e[13]=i,e[14]=n,e[15]=1,this},fromScale:function(t,i,n){t instanceof a?(i=t.y,n=t.z,t=t.x):void 0===i&&(i=n=t);var e=this._m;return e[0]=t,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},fromPerspectiveProjection:function(t,i,n,e){var s=1/Math.tan(.5*t),r=s/i,o=1/(n-e),h=this._m;return h[0]=r,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=0,h[6]=-(e+n)*o,h[7]=1,h[8]=0,h[9]=s,h[10]=0,h[11]=0,h[12]=0,h[13]=0,h[14]=2*n*e*o,h[15]=0,this},fromOrthographicOffCenterProjection:function(t,i,n,e,s,r){var o=1/(i-t),h=1/(n-e),a=1/(s-r),c=this._m;return c[0]=2*o,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=0,c[6]=-2*a,c[7]=0,c[8]=0,c[9]=2*h,c[10]=0,c[11]=0,c[12]=-(t+i)*o,c[13]=-(n+e)*h,c[14]=(r+s)*a,c[15]=1,this},fromOrthographicProjection:function(t,i,n,e){var s=1/t,r=1/i,o=1/(n-e),h=this._m;return h[0]=2*s,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=0,h[6]=2*o,h[7]=0,h[8]=0,h[9]=2*r,h[10]=0,h[11]=0,h[12]=0,h[13]=0,h[14]=(e+n)*o,h[15]=1,this},clone:function(){return new l(this._m)},transpose:function(){var t=this._m,i=t[1],n=t[2],e=t[3],s=t[6],r=t[7],o=t[11];return t[1]=t[4],t[2]=t[8],t[3]=t[12],t[4]=i,t[6]=t[9],t[7]=t[13],t[8]=n,t[9]=s,t[11]=t[14],t[12]=e,t[13]=r,t[14]=o,this},determinant3x3:function(t,i){var n=0===i?4:0,e=i<2?8:4,s=3===i?8:12,r=0===t?1:0,o=t<2?2:1,h=3===t?2:3,a=this._m,c=a[n|o],u=a[o|e],f=a[s|o],l=a[n|h],_=a[e|h],y=a[h|s];return a[n|r]*(u*y-f*_)-a[e|r]*(c*y-f*l)+a[s|r]*(c*_-u*l)},cofactor:function(t,i){var n=1-((t+i&1)<<1);return n*this.determinant3x3(t,i)},getCofactorMatrix:function(t,i,n){n=n||new l;for(var e=n._m,s=0;s<16;++s)e[s]=this.cofactor(3&s,s>>2);return n},getAdjugate:function(t,i,n){n=n||new l;for(var e=n._m,s=0;s<16;++s)e[s]=this.cofactor(s>>2,3&s);return n},determinant:function(){var t=this._m;return t[0]*this.determinant3x3(0,0)-t[4]*this.determinant3x3(0,1)+t[8]*this.determinant3x3(0,2)-t[12]*this.determinant3x3(0,3)},inverseOf:function(t){var i=1/t.determinant(),n=i*t.cofactor(0,0),e=i*t.cofactor(0,1),s=i*t.cofactor(0,2),r=i*t.cofactor(0,3),o=i*t.cofactor(1,0),h=i*t.cofactor(1,1),a=i*t.cofactor(1,2),c=i*t.cofactor(1,3),u=i*t.cofactor(2,0),f=i*t.cofactor(2,1),l=i*t.cofactor(2,2),_=i*t.cofactor(2,3),y=i*t.cofactor(3,0),d=i*t.cofactor(3,1),m=i*t.cofactor(3,2),p=i*t.cofactor(3,3),x=this._m;return x[0]=n,x[1]=e,x[2]=s,x[3]=r,x[4]=o,x[5]=h,x[6]=a,x[7]=c,x[8]=u,x[9]=f,x[10]=l,x[11]=_,x[12]=y,x[13]=d,x[14]=m,x[15]=p,this},inverseAffineOf:function(t){var i=t._m,n=i[0],e=i[1],s=i[2],r=i[4],o=i[5],h=i[6],a=i[8],c=i[9],u=i[10],f=i[12],l=i[13],_=i[14],y=n*(o*u-c*h)-r*(e*u-c*s)+a*(e*h-o*s),d=1/y,m=(o*u-c*h)*d,p=(c*s-e*u)*d,x=(e*h-o*s)*d,w=(a*h-r*u)*d,z=(n*u-a*s)*d,v=(r*s-n*h)*d,g=(r*c-a*o)*d,b=(a*e-n*c)*d,M=(n*o-r*e)*d,j=this._m;return j[0]=m,j[1]=p,j[2]=x,j[3]=0,j[4]=w,j[5]=z,j[6]=v,j[7]=0,j[8]=g,j[9]=b,j[10]=M,j[11]=0,j[12]=-m*f-w*l-g*_,j[13]=-p*f-z*l-b*_,j[14]=-x*f-v*l-M*_,j[15]=1,this},writeNormalMatrix:function(t,i){i=i||0;var n=this._m,e=n[0],s=n[1],r=n[2],o=n[4],h=n[5],a=n[6],c=n[8],u=n[9],f=n[10],l=e*(h*f-u*a)-o*(s*f-u*r)+c*(s*a-h*r),_=1/l;t[i]=(h*f-u*a)*_,t[i+1]=(c*a-o*f)*_,t[i+2]=(o*u-c*h)*_,t[i+3]=(u*r-s*f)*_,t[i+4]=(e*f-c*r)*_,t[i+5]=(c*s-e*u)*_,t[i+6]=(s*a-h*r)*_,t[i+7]=(o*r-e*a)*_,t[i+8]=(e*h-o*s)*_},writeData:function(t,i){i=i||0;for(var n=this._m,e=0;e<16;++e)t[i+e]=n[e]},writeData4x3:function(t,i){var n=this._m;i=i||0,t[i]=n[0],t[i+1]=n[4],t[i+2]=n[8],t[i+3]=n[12],t[i+4]=n[1],t[i+5]=n[5],t[i+6]=n[9],t[i+7]=n[13],t[i+8]=n[2],t[i+9]=n[6],t[i+10]=n[10],t[i+11]=n[14]},invert:function(){return this.inverseOf(this)},invertAffine:function(){return this.inverseAffineOf(this)},append:function(t){return this.multiply(t,this)},prepend:function(t){return this.multiply(this,t)},appendAffine:function(t){return this.multiplyAffine(t,this)},prependAffine:function(t){return this.multiplyAffine(this,t)},add:function(t){var i=this._m,n=t._m;return i[0]+=n[0],i[1]+=n[1],i[2]+=n[2],i[3]+=n[3],i[4]+=n[4],i[5]+=n[5],i[6]+=n[6],i[7]+=n[7],i[8]+=n[8],i[9]+=n[9],i[10]+=n[10],i[11]+=n[11],i[12]+=n[12],i[13]+=n[13],i[14]+=n[14],i[15]+=n[15],this},addAffine:function(t){var i=this._m,n=t._m;return i[0]+=n[0],i[1]+=n[1],i[2]+=n[2],i[4]+=n[4],i[5]+=n[5],i[6]+=n[6],i[8]+=n[8],i[9]+=n[9],i[10]+=n[10],this},subtract:function(t){var i=this._m,n=t._m;return i[0]-=n[0],i[1]-=n[1],i[2]-=n[2],i[3]-=n[3],i[4]-=n[4],i[5]-=n[5],i[6]-=n[6],i[7]-=n[7],i[8]-=n[8],i[9]-=n[9],i[10]-=n[10],i[11]-=n[11],i[12]-=n[12],i[13]-=n[13],i[14]-=n[14],i[15]-=n[15],this},subtractAffine:function(t){var i=this._m,n=t._m;return i[0]-=n[0],i[1]-=n[1],i[2]-=n[2],i[4]-=n[4],i[5]-=n[5],i[6]-=n[6],i[8]-=n[8],i[9]-=n[9],i[10]-=n[10],this},appendScale:function(t,i,n){t instanceof a?(i=t.y,n=t.z,t=t.x):void 0===i&&(i=n=t);var e=this._m;return e[0]*=t,e[1]*=i,e[2]*=n,e[4]*=t,e[5]*=i,e[6]*=n,e[8]*=t,e[9]*=i,e[10]*=n,e[12]*=t,e[13]*=i,e[14]*=n,this},prependScale:function(t,i,n){t instanceof a?(i=t.y,n=t.z,t=t.x):void 0===i&&(i=n=t);var e=this._m;return e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=t,e[4]*=i,e[5]*=i,e[6]*=i,e[7]*=i,e[8]*=n,e[9]*=n,e[10]*=n,e[11]*=n,this},appendTranslation:function(t,i,n){t instanceof a&&(i=t.y,n=t.z,t=t.x);var e=this._m;return e[12]+=t,e[13]+=i,e[14]+=n,this},prependTranslation:function(t,i,n){t instanceof a&&(i=t.y,n=t.z,t=t.x);var e=this._m;return e[12]+=e[0]*t+e[4]*i+e[8]*n,e[13]+=e[1]*t+e[5]*i+e[9]*n,e[14]+=e[2]*t+e[6]*i+e[10]*n,e[15]+=e[3]*t+e[7]*i+e[11]*n,this},appendQuaternion:function(t){var i=this._m,n=t.x,e=t.y,s=t.z,r=t.w,o=1-2*(e*e+s*s),h=2*(n*e+r*s),a=2*(n*s-r*e),c=2*(n*e-r*s),u=1-2*(n*n+s*s),f=2*(e*s+r*n),l=2*(n*s+r*e),_=2*(e*s-r*n),y=1-2*(n*n+e*e),d=i[0],m=i[1],p=i[2],x=i[4],w=i[5],z=i[6],v=i[8],g=i[9],b=i[10],M=i[12],j=i[13],A=i[14];return i[0]=o*d+c*m+l*p,i[1]=h*d+u*m+_*p,i[2]=a*d+f*m+y*p,i[4]=o*x+c*w+l*z,i[5]=h*x+u*w+_*z,i[6]=a*x+f*w+y*z,i[8]=o*v+c*g+l*b,i[9]=h*v+u*g+_*b,i[10]=a*v+f*g+y*b,i[12]=o*M+c*j+l*A,i[13]=h*M+u*j+_*A,i[14]=a*M+f*j+y*A,this},prependQuaternion:function(t){var i=this._m,n=t.x,e=t.y,s=t.z,r=t.w,o=i[0],h=i[1],a=i[2],c=i[4],u=i[5],f=i[6],l=i[8],_=i[9],y=i[10],d=1-2*(e*e+s*s),m=2*(n*e+r*s),p=2*(n*s-r*e),x=2*(n*e-r*s),w=1-2*(n*n+s*s),z=2*(e*s+r*n),v=2*(n*s+r*e),g=2*(e*s-r*n),b=1-2*(n*n+e*e);return i[0]=o*d+c*m+l*p,i[1]=h*d+u*m+_*p,i[2]=a*d+f*m+y*p,i[4]=o*x+c*w+l*z,i[5]=h*x+u*w+_*z,i[6]=a*x+f*w+y*z,i[8]=o*v+c*g+l*b,i[9]=h*v+u*g+_*b,i[10]=a*v+f*g+y*b,this},appendRotationAxisAngle:function(t,i){var n=this._m,e=Math.cos(i),s=Math.sin(i),r=1/t.length,o=t.x*r,h=t.y*r,a=t.z*r,c=1-e,u=c*o*o+e,f=c*o*h+s*a,l=c*o*a-s*h,_=c*o*h-s*a,y=c*h*h+e,d=c*h*a+s*o,m=c*o*a+s*h,p=c*h*a-s*o,x=c*a*a+e,w=n[0],z=n[1],v=n[2],g=n[4],b=n[5],M=n[6],j=n[8],A=n[9],C=n[10],E=n[12],O=n[13],S=n[14];return n[0]=u*w+_*z+m*v,n[1]=f*w+y*z+p*v,n[2]=l*w+d*z+x*v,n[4]=u*g+_*b+m*M,n[5]=f*g+y*b+p*M,n[6]=l*g+d*b+x*M,n[8]=u*j+_*A+m*C,n[9]=f*j+y*A+p*C,n[10]=l*j+d*A+x*C,n[12]=u*E+_*O+m*S,n[13]=f*E+y*O+p*S,n[14]=l*E+d*O+x*S,this},prependRotationAxisAngle:function(t,i){var n=this._m,e=Math.cos(i),s=Math.sin(i),r=1/t.length,o=t.x*r,h=t.y*r,a=t.z*r,c=1-e,u=n[0],f=n[1],l=n[2],_=n[4],y=n[5],d=n[6],m=n[8],p=n[9],x=n[10],w=c*o*o+e,z=c*o*h+s*a,v=c*o*a-s*h,g=c*o*h-s*a,b=c*h*h+e,M=c*h*a+s*o,j=c*o*a+s*h,A=c*h*a-s*o,C=c*a*a+e;return n[0]=u*w+_*z+m*v,n[1]=f*w+y*z+p*v,n[2]=l*w+d*z+x*v,n[4]=u*g+_*b+m*M,n[5]=f*g+y*b+p*M,n[6]=l*g+d*b+x*M,n[8]=u*j+_*A+m*C,n[9]=f*j+y*A+p*C,n[10]=l*j+d*A+x*C,this},getRow:function(t,i){var n=this._m;return i=i||new a,i.x=n[t],i.y=n[4|t],i.z=n[8|t],i.w=n[12|t],i},setRow:function(t,i){var n=this._m;return n[t]=i.x,n[4|t]=i.y,n[8|t]=i.z,n[12|t]=i.w,this},getElement:function(t,i){return this._m[t|i<<2]},setElement:function(t,i,n){return this._m[t|i<<2]=n,this},getColumn:function(t,i){var n=this._m;return i=i||new a,t<<=2,i.x=n[t],i.y=n[1|t],i.z=n[2|t],i.w=n[3|t],i},setColumn:function(t,i){var n=this._m;return t<<=2,n[t]=i.x,n[1|t]=i.y,n[2|t]=i.z,n[3|t]=i.w,this},copyColumn:function(t,i){var n=this._m,e=i._m;return t<<=2,n[t]=e[t],n[1|t]=e[1|t],n[2|t]=e[2|t],n[3|t]=e[3|t],this},lookAt:function(t,i,n){var e=new a,s=new a,r=new a;return function(t,i,n){if(n=n||a.Z_AXIS,a.subtract(t,i,s),s.normalize(),a.cross(s,n,e),Math.abs(e.lengthSqr)<1e-4){var o=new a(n.x,n.z,n.y,0);a.cross(s,o,e),Math.abs(e.lengthSqr)<=1e-4&&(o.set(n.z,n.y,n.z,0),a.cross(s,o,e))}e.normalize(),a.cross(e,s,r);var h=this._m;return h[0]=e.x,h[1]=e.y,h[2]=e.z,h[3]=0,h[4]=s.x,h[5]=s.y,h[6]=s.z,h[7]=0,h[8]=r.x,h[9]=r.y,h[10]=r.z,h[11]=0,h[12]=i.x,h[13]=i.y,h[14]=i.z,h[15]=1,this}}(),compose:function(t){return this.fromScale(t.scale),this.appendQuaternion(t.rotation),this.appendTranslation(t.position),this},decompose:function(t,i,n){t=t||new f;var e;void 0===i?(i=t.rotation,n=t.scale,e=t.position):e=t;var s=this._m,r=s[0],o=s[1],h=s[2],a=s[4],c=s[5],u=s[6],l=s[8],_=s[9],y=s[10],d=o*u-h*c,p=h*a-r*u,x=r*c-o*a,w=m.sign(d*l+p*_+x*y);n.x=w*Math.sqrt(r*r+o*o+h*h),n.y=w*Math.sqrt(a*a+c*c+u*u),n.z=w*Math.sqrt(l*l+_*_+y*y),n.x>.999&&n.x<1.001&&(n.x=1),n.y>.999&&n.y<1.001&&(n.y=1),n.z>.999&&n.z<1.001&&(n.z=1);var z=this.clone(),v=1/n.x,g=1/n.y,b=1/n.z,M=z._m;return M[0]*=v,M[1]*=v,M[2]*=v,M[4]*=g,M[5]*=g,M[6]*=g,M[8]*=b,M[9]*=b,M[10]*=b,i.fromMatrix(z),this.getColumn(3,e),t},swapColums:function(t,i){var n=this._m;if(t!==i){t<<=2,i<<=2;var e=n[t],s=n[1|t],r=n[2|t],o=n[3|t];return n[t]=n[i],n[1|t]=n[1|i],n[2|t]=n[2|i],n[3|t]=n[3|i],n[i]=e,n[1|i]=s,n[2|i]=r,n[3|i]=o,this}},toString:function(){for(var t=this._m,i="",n=0;n<16;++n){var e=3&n;0===e&&(i+="["),i+=t[n],i+=3===e?"]\n":"\t , \t"}return i}},l.IDENTITY=new l,l.ZERO=new l(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),_.prototype={fromAxisAngle:function(t,i){var n=.5*i,e=Math.sin(n)/t.length;return this.x=t.x*e,this.y=t.y*e,this.z=t.z*e,this.w=Math.cos(n),this},fromPitchYawRoll:function(t,i,n){var e=new l;return e.fromRotationPitchYawRoll(t,i,n),this.fromMatrix(e),this},fromEuler:function(t,i,n){void 0===i&&(i=t.y,n=t.z,t=t.x);var e=Math.cos(.5*t),s=Math.cos(.5*i),r=Math.cos(.5*n),o=Math.sin(.5*t),h=Math.sin(.5*i),a=Math.sin(.5*n);return this.x=o*s*r+e*h*a,this.y=e*h*r-o*s*a,this.z=e*s*a+o*h*r,this.w=e*s*r-o*h*a,this},toEuler:function(t){t=t||new a;var i=this.x,n=this.y,e=this.z,s=this.w,r=i*i,o=n*n,h=e*e,c=s*s;return t.x=Math.atan2(-2*(n*e-s*i),c-r-o+h),t.y=Math.asin(2*(i*e+s*n)),t.z=Math.atan2(-2*(i*n-s*e),c+r-o-h),t},fromMatrix:function(t){var i,n=t._m[0],e=t._m[5],s=t._m[10],r=n+e+s;return r>0?(r+=1,i=1/Math.sqrt(r)*.5,this.x=i*(t._m[6]-t._m[9]),this.y=i*(t._m[8]-t._m[2]),this.z=i*(t._m[1]-t._m[4]),this.w=i*r):n>e&&n>s?(r=n-e-s+1,i=1/Math.sqrt(r)*.5,this.x=i*r,this.y=i*(t._m[1]+t._m[4]),this.z=i*(t._m[8]+t._m[2]),this.w=i*(t._m[6]-t._m[9])):e>s?(r=e-n-s+1,i=1/Math.sqrt(r)*.5,this.x=i*(t._m[1]+t._m[4]),this.y=i*r,this.z=i*(t._m[6]+t._m[9]),this.w=i*(t._m[8]-t._m[2])):(r=s-n-e+1,i=1/Math.sqrt(r)*.5,this.x=i*(t._m[8]+t._m[2]),this.y=i*(t._m[6]+t._m[9]),this.z=i*r,this.w=i*(t._m[1]-t._m[4])),this.normalize(),this},rotate:function(t,i){i=i||new a;var n=t.x,e=t.y,s=t.z,r=this.x,o=this.y,h=this.z,c=this.w,u=-r*n-o*e-h*s,f=c*n+o*s-h*e,l=c*e-r*s+h*n,_=c*s+r*e-o*n;return i.x=-u*r+f*c-l*h+_*o,i.y=-u*o+f*h+l*c-_*r,i.z=-u*h-f*o+l*r+_*c,i.w=t.w,i},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},set:function(t,i,n,e){return this.x=t,this.y=i,this.z=n,this.w=e,this},copyFrom:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},get normSquared(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},get norm(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var t=1/Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},conjugate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},invert:function(){var t=this.x,i=this.y,n=this.z,e=this.w,s=1/(t*t+i*i+n*n+e*e);return this.x=-t*s,this.y=-i*s,this.z=-n*s,this.w=e*s,this},multiply:function(t,i){var n=t.w,e=t.x,s=t.y,r=t.z,o=i.w,h=i.x,a=i.y,c=i.z;return this.x=n*h+e*o+s*c-r*a,this.y=n*a-e*c+s*o+r*h,this.z=n*c+e*a-s*h+r*o,this.w=n*o-e*h-s*a-r*c,this},append:function(t){return this.multiply(t,this)},prepend:function(t){return this.multiply(this,t)},lerp:function(t,i,n){var e=t.w,s=t.x,r=t.y,o=t.z,h=i.w,a=i.x,c=i.y,u=i.z;return e*h+s*a+r*c+o*u<0&&(h=-h,a=-a,c=-c,u=-u),this.x=s+n*(a-s),this.y=r+n*(c-r),this.z=o+n*(u-o),this.w=e+n*(h-e),this.normalize(),this},slerp:function(t,i,n){var e=t.w,s=t.x,r=t.y,o=t.z,h=i.w,a=i.x,c=i.y,u=i.z,f=e*h+s*a+r*c+o*u;if(f<0&&(f=-f,h=-h,a=-a,c=-c,u=-u),f<.95){var l=Math.acos(f),_=n*l,y=a-s*f,d=c-r*f,m=u-o*f,p=h-e*f,x=1/Math.sqrt(y*y+d*d+m*m+p*p);y*=x,d*=x,m*=x,p*=x;var w=Math.cos(_),z=Math.sin(_);this.x=s*w+y*z,this.y=r*w+d*z,this.z=o*w+m*z,this.w=e*w+p*z}else this.x=s+n*(a-s),this.y=r+n*(c-r),this.z=o+n*(u-o),this.w=e+n*(h-e),this.normalize();return this},toString:function(){return"Quaternion("+this.x+", "+this.y+", "+this.z+", "+this.w+")"}},y.prototype=Object.create(e.prototype),y.prototype.volume=function(){return 0},y.prototype.createShape=function(t){return new CANNON.Plane},t.PhysicsSystem=h,t.RigidBody=o,t.BoxCollider=s,t.SphereCollider=r,t.InfinitePlaneCollider=y,Object.defineProperty(t,"__esModule",{value:!0})});