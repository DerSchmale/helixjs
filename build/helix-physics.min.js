!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports,require("cannon"),require("helix")):"function"==typeof define&&define.amd?define("HX",["exports","cannon","helix"],i):i(t.HX=t.HX||{},t.CANNON,t.HX)}(this,function(t,i,n){"use strict";function s(){this._center=null,this._orientation=null}function e(t,i){s.call(this),t&&i&&(this._halfExtents=HX.Float.subtract(i,t).scale(.5),this._center=HX.Float.add(i,t).scale(.5))}function r(t,i){s.call(this),this._radius=t,this._center=i,void 0!==t&&void 0===i&&(this._center=new HX.Float4)}function o(t,i){n.Component.call(this),this._collider=t,this._body=null,this._mass=i,this._linearDamping=.01,this._angularDamping=.01}function h(){n.EntitySystem.call(this),this._world=new i.World,this._gravity=-9.81,this._world.gravity.set(0,0,this._gravity),this._world.solver.tolerance=.001,this._world.solver.iterations=10,this._fixedTimeStep=1e3/60,this._friction=0,this._world.broadphase=new i.SAPBroadphase(this._world),this._components=[]}function a(t,i,n,s){this.x=t||0,this.y=i||0,this.z=n||0,this.w=void 0===s?1:s}function c(){this._listeners=[],this._lookUp={}}function u(){this._enabled=!0,this.onChange=new c,this._targets=[]}function f(){this._position=new a(0,0,0,1),this._rotation=new _,this._scale=new a(1,1,1,1),this._matrix=new y,this._changeListener=new u,this._changeListener.add(this._position,"x"),this._changeListener.add(this._position,"y"),this._changeListener.add(this._position,"z"),this._changeListener.add(this._rotation,"x"),this._changeListener.add(this._rotation,"y"),this._changeListener.add(this._rotation,"z"),this._changeListener.add(this._rotation,"w"),this._changeListener.add(this._scale,"x"),this._changeListener.add(this._scale,"y"),this._changeListener.add(this._scale,"z"),this._changeListener.onChange.bind(this._invalidateMatrix,this)}function y(t,i,n,s,e,r,o,h,a,c,u,f,y,_,l,m){if(void 0!==t&&isNaN(t))this._m=new Float32Array(t);else{var d=this._m=new Float32Array(16);d[0]=void 0===t?1:0,d[1]=e||0,d[2]=a||0,d[3]=y||0,d[4]=i||0,d[5]=void 0===r?1:0,d[6]=c||0,d[7]=_||0,d[8]=n||0,d[9]=o||0,d[10]=void 0===u?1:0,d[11]=l||0,d[12]=s||0,d[13]=h||0,d[14]=f||0,d[15]=void 0===m?1:0}}function _(t,i,n,s){this.x=t||0,this.y=i||0,this.z=n||0,this.w=void 0===s?1:s}function l(t){s.call(this),t&&(this._center=new HX.Float4(0,t,0))}s.prototype={createRigidBody:function(t){var n=this.createShape(t),s=new i.Body({mass:50*this.volume()});return this._center||(this._center=t.center),s.addShape(n,this._center,this._orientation),s},createShape:function(t){throw new Error("Abstract method called!")},volume:function(){throw new Error("Abstract method called!")}},e.prototype=Object.create(s.prototype),e.prototype.volume=function(){return 8*(this._halfExtents.x*this._halfExtents.y*this._halfExtents.z)},e.prototype.createShape=function(t){this._halfExtents||(this._halfExtents=t.getHalfExtents());var n=new i.Vec3;return n.copy(this._halfExtents),new i.Box(n)},r.prototype=Object.create(s.prototype),r.prototype.volume=function(){var t=this._radius;return.75*Math.PI*t*t*t},r.prototype.createShape=function(t){return this._radius=this._radius||t.getRadius(),new i.Sphere(this._radius)},n.Component.create(o,{body:{get:function(){return this._body}},mass:{get:function(){return this._mass},set:function(t){this._mass=t,this._body&&(this._body.mass=t)}},linearDamping:{get:function(){return this._linearDamping},set:function(t){this._linearDamping=t,this._body&&(this._body.linearDamping=t)}},angularDamping:{get:function(){return this._angularDamping},set:function(t){this._angularDamping=t,this._body&&(this._body.angularDamping=t)}}}),o.prototype.onAdded=function(){this._createBody()},o.prototype.onRemoved=function(){},o.prototype.applyTransform=function(){if(0!==this._mass){var t=this._entity,i=this._body;t.position=i.position,t.rotation=i.quaternion}},o.prototype._createBody=function(){var t,i=this._entity;if(i instanceof n.ModelInstance)t=i.localBounds;else{var s=new n.Matrix4x4;s.inverseAffineOf(i.worldMatrix),t=new n.BoundingAABB,t.transformFrom(i.worldBounds,s)}this._collider||(this._collider=t instanceof n.BoundingAABB?new e:new r),this._body=this._collider.createRigidBody(t),void 0!==this._mass&&(this._body.mass=this._mass),this._body.linearDamping=this._linearDamping,this._body.angularDamping=this._angularDamping,this._body.position.copy(i.position),this._body.quaternion.copy(i.rotation)},h.prototype=Object.create(n.EntitySystem.prototype,{gravity:{get:function(){return this._gravity},set:function(t){this._gravity=t,t instanceof n.Float4?this._world.gravity.set(t.x,t.y,t.z):this._world.gravity.set(0,t,0)}},fixedTimeStep:{get:function(){return this._fixedTimeStep},set:function(t){this._fixedTimeStep=t}}}),h.prototype.onStarted=function(){this._colliders=this.getEntitySet([o]),this._colliders.onEntityAdded.bind(this._onEntityAdded,this),this._colliders.onEntityRemoved.bind(this._onEntityRemoved,this);for(var t=this._colliders.numEntities,i=0;i<t;++i){var n=this._colliders.getEntity(i);this._onEntityAdded(n)}},h.prototype.onStopped=function(){this._colliders.onEntityAdded.unbind(this._onEntityAdded),this._colliders.onEntityRemoved.unbind(this._onEntityRemoved)},h.prototype._onEntityAdded=function(t){var i=t.getFirstComponentByType(o);this._components.push(i),this._world.addBody(i.body)},h.prototype._onEntityRemoved=function(){var t=entity.getFirstComponentByType(o);this._world.removeBody(t.body);var i=this._components.indexOf(t);this._components.splice(i,1)},h.prototype.onUpdate=function(t){this._world.step(.001*this._fixedTimeStep);for(var i=this._components.length,n=0;n<i;++n)this._components[n].applyTransform()},a.add=function(t,i,n){return n=n||new a,n.x=t.x+i.x,n.y=t.y+i.y,n.z=t.z+i.z,n.w=t.w+i.w,n},a.subtract=function(t,i,n){return n=n||new a,n.x=t.x-i.x,n.y=t.y-i.y,n.z=t.z-i.z,n.w=t.w-i.w,n},a.scale=function(t,i,n){return n=n||new a,n.x=t.x*i,n.y=t.y*i,n.z=t.z*i,n},a.scale4=function(t,i,n){return n=n||new a,n.x=t.x*i,n.y=t.y*i,n.z=t.z*i,n.w=t.w*i,n},a.cross=function(t,i,n){n=n||new a;var s=t.x,e=t.y,r=t.z,o=i.x,h=i.y,c=i.z;return n.x=e*c-r*h,n.y=r*o-s*c,n.z=s*h-e*o,n.w=0,n},a.prototype={set:function(t,i,n,s){return this.x=t,this.y=i,this.z=n,this.w=void 0===s?this.w:s,this},get lengthSqr(){return this.x*this.x+this.y*this.y+this.z*this.z},get length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},normalize:function(){var t=1/this.length;return this.x*=t,this.y*=t,this.z*=t,this},normalizeAsPlane:function(){var t=1/this.length;return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},clone:function(){return new a(this.x,this.y,this.z,this.w)},add:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},addScaled:function(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this.w+=t.w*i,this},subtract:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this},scale:function(t){return this.x*=t,this.y*=t,this.z*=t,this},scale4:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},negativeOf:function(t){return this.x=-t.x,this.y=-t.y,this.z=-t.z,this.w=-t.w,this},homogeneousProject:function(){var t=1/this.w;return this.x*=t,this.y*=t,this.z*=t,this.w=1,this},abs:function(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this.z=Math.abs(this.z),this.w=Math.abs(this.w),this},fromSphericalCoordinates:function(t,i,n){return this.x=t*Math.sin(n)*Math.cos(i),this.y=t*Math.sin(n)*Math.sin(i),this.z=t*Math.cos(n),this.w=1,this},copyFrom:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},maximize:function(t){return t.x>this.x&&(this.x=t.x),t.y>this.y&&(this.y=t.y),t.z>this.z&&(this.z=t.z),t.w>this.w&&(this.w=t.w),this},maximize3:function(t){return t.x>this.x&&(this.x=t.x),t.y>this.y&&(this.y=t.y),t.z>this.z&&(this.z=t.z),this},minimize:function(t){return t.x<this.x&&(this.x=t.x),t.y<this.y&&(this.y=t.y),t.z<this.z&&(this.z=t.z),t.w<this.w&&(this.w=t.w),this},minimize3:function(t){return t.x<this.x&&(this.x=t.x),t.y<this.y&&(this.y=t.y),t.z<this.z&&(this.z=t.z),this},planeFromNormalAndPoint:function(t,i){var n=t.x,s=t.y,e=t.z;return this.x=n,this.y=s,this.z=e,this.w=-(i.x*n+i.y*s+i.z*e),this},angle:function(t){return Math.acos(this.dot3(t)/(this.length*t.length))},angleNormalized:function(t){return Math.acos(this.dot3(t))},distanceTo:function(t){var i=t.x-this.x,n=t.y-this.y,s=t.z-this.z;return Math.sqrt(i*i+n*n+s*s)},squareDistanceTo:function(t){var i=t.x-this.x,n=t.y-this.y,s=t.z-this.z;return i*i+n*n+s*s},dot3:function(t){return t.x*this.x+t.y*this.y+t.z*this.z},dot:function(t){return t.x*this.x+t.y*this.y+t.z*this.z},dot4:function(t){return t.x*this.x+t.y*this.y+t.z*this.z+t.w*this.w},lerp:function(t,i,n){var s=t.x,e=t.y,r=t.z,o=t.w;return this.x=s+(i.x-s)*n,this.y=e+(i.y-e)*n,this.z=r+(i.z-r)*n,this.w=o+(i.w-o)*n,this},cross:function(t,i){var n=t.x,s=t.y,e=t.z,r=i.x,o=i.y,h=i.z;return this.x=s*h-e*o,this.y=e*r-n*h,this.z=n*o-s*r,this.w=0,this},toString:function(){return"Float4("+this.x+", "+this.y+", "+this.z+", "+this.w+")"}},a.ORIGIN_POINT=new a(0,0,0,1),a.ZERO=new a(0,0,0,0),a.X_AXIS=new a(1,0,0,0),a.Y_AXIS=new a(0,1,0,0),a.Z_AXIS=new a(0,0,1,0);var m=1/Math.log(2),d={DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,sign:function(t){return 0===t?0:t>0?1:-1},isPowerOfTwo:function(t){return!!t&&(t&-t)===t},log2:function(t){return Math.log(t)*m},clamp:function(t,i,n){return t<i?i:t>n?n:t},saturate:function(t){return d.clamp(t,0,1)},lerp:function(t,i,n){return t+(i-t)*n},linearStep:function(t,i,n){return d.saturate((n-t)/(i-t))},estimateGaussianRadius:function(t,i){return Math.sqrt(-2*t*Math.log(i))},fract:function(t){return t-Math.floor(t)}};c.prototype={bind:function(t,i){this._lookUp[t]=this._listeners.length;var n=i?t.bind(i):t;this._listeners.push(n)},unbind:function(t){var i=this._lookUp[t];this._listeners.splice(i,1),delete this._lookUp[t]},unbindAll:function(){this._listeners=[],this._lookUp={}},dispatch:function(t){for(var i=this._listeners.length,n=0;n<i;++n)this._listeners[n].apply(null,arguments)},get hasListeners(){return this._listeners.length>0}},u.prototype={get enabled(){return this._enabled},set enabled(t){this._enabled=t},add:function(t,i){var n=this._targets.length;this._targets.push({object:t,propertyName:i,value:t[i]});var s=this,e=s._targets[n];Object.defineProperty(t,i,{get:function(){return e.value},set:function(t){t!==e.value&&(e.value=t,s._enabled&&s.onChange.dispatch())}})},remove:function(t,i){for(var n=0;n<this._targets.length;++n){var s=this._targets[n];s.object===t&&s.propertyName===i&&(delete s.object[s.propertyName],s.object[s.propertyName]=s.value,this._targets.splice(n--,1))}}},f.prototype={get position(){return this._position},set position(t){this._position.copyFrom(t)},get rotation(){return this._rotation},set rotation(t){this._rotation.copyFrom(t)},get scale(){return this._scale},set scale(t){this._scale.copyFrom(t)},lookAt:function(t){this._matrix.lookAt(t,this._position),this._matrix.appendScale(this._scale),this._applyMatrix()},copyTransform:function(t){this._changeListener.enabled=!1,this._position.copyFrom(t.position),this._rotation.copyFrom(t.rotation),this._scale.copyFrom(t.scale),this._changeListener.enabled=!0,this._invalidateMatrix()},get matrix(){return this._matrixInvalid&&this._updateMatrix(),this._matrix},set matrix(t){this._matrix.copyFrom(t),this._applyMatrix()},_invalidateMatrix:function(){this._matrixInvalid=!0},_updateMatrix:function(){this._matrix.compose(this),this._matrixInvalid=!1},_applyMatrix:function(){this._matrixInvalid=!1,this._changeListener.enabled=!1,this._matrix.decompose(this),this._changeListener.enabled=!0}},y.prototype={transform:function(t,i){i=i||new a;var n=t.x,s=t.y,e=t.z,r=t.w,o=this._m;return i.x=o[0]*n+o[4]*s+o[8]*e+o[12]*r,i.y=o[1]*n+o[5]*s+o[9]*e+o[13]*r,i.z=o[2]*n+o[6]*s+o[10]*e+o[14]*r,i.w=o[3]*n+o[7]*s+o[11]*e+o[15]*r,i},transformPoint:function(t,i){i=i||new a;var n=t.x,s=t.y,e=t.z,r=this._m;return i.x=r[0]*n+r[4]*s+r[8]*e+r[12],i.y=r[1]*n+r[5]*s+r[9]*e+r[13],i.z=r[2]*n+r[6]*s+r[10]*e+r[14],i.w=1,i},transformNormal:function(t,i){var n=this._m,s=n[0],e=n[1],r=n[2],o=n[4],h=n[5],c=n[6],u=n[8],f=n[9],y=n[10],_=s*(h*y-f*c)-o*(e*y-f*r)+u*(e*c-h*r),l=1/_,m=(h*y-f*c)*l,d=(f*r-e*y)*l,p=(e*c-h*r)*l,x=(u*c-o*y)*l,w=(s*y-u*r)*l,z=(o*r-s*c)*l,v=(o*f-u*h)*l,g=(u*e-s*f)*l,b=(s*h-o*e)*l;i=i||new a;var M=t.x,A=t.y,j=t.z;return i.x=m*M+d*A+p*j,i.y=x*M+w*A+z*j,i.z=v*M+g*A+b*j,i.w=0,i},transformVector:function(t,i){i=i||new a;var n=t.x,s=t.y,e=t.z,r=this._m;return i.x=r[0]*n+r[4]*s+r[8]*e,i.y=r[1]*n+r[5]*s+r[9]*e,i.z=r[2]*n+r[6]*s+r[10]*e,i.w=0,i},transformExtent:function(t,i){i=i||new a;var n=t.x,s=t.y,e=t.z,r=this._m,o=r[0],h=r[1],c=r[2],u=r[4],f=r[5],y=r[6],_=r[8],l=r[9],m=r[10];return o<0&&(o=-o),h<0&&(h=-h),c<0&&(c=-c),u<0&&(u=-u),f<0&&(f=-f),y<0&&(y=-y),_<0&&(_=-_),l<0&&(l=-l),m<0&&(m=-m),i.x=o*n+u*s+_*e,i.y=h*n+f*s+l*e,i.z=c*n+y*s+m*e,i.w=0,i},copyFrom:function(t){var i=this._m,n=t._m;return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],i[9]=n[9],i[10]=n[10],i[11]=n[11],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15],this},fromQuaternion:function(t){var i=t.x,n=t.y,s=t.z,e=t.w,r=this._m;return r[0]=1-2*(n*n+s*s),r[1]=2*(i*n+e*s),r[2]=2*(i*s-e*n),r[3]=0,r[4]=2*(i*n-e*s),r[5]=1-2*(i*i+s*s),r[6]=2*(n*s+e*i),r[7]=0,r[8]=2*(i*s+e*n),r[9]=2*(n*s-e*i),r[10]=1-2*(i*i+n*n),r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,this},multiply:function(t,i){var n=t._m,s=i._m,e=n[0],r=n[1],o=n[2],h=n[3],a=n[4],c=n[5],u=n[6],f=n[7],y=n[8],_=n[9],l=n[10],m=n[11],d=n[12],p=n[13],x=n[14],w=n[15],z=s[0],v=s[1],g=s[2],b=s[3],M=s[4],A=s[5],j=s[6],O=s[7],E=s[8],S=s[9],R=s[10],D=s[11],F=s[12],P=s[13],T=s[14],B=s[15],q=this._m;return q[0]=e*z+a*v+y*g+d*b,q[1]=r*z+c*v+_*g+p*b,q[2]=o*z+u*v+l*g+x*b,q[3]=h*z+f*v+m*g+w*b,q[4]=e*M+a*A+y*j+d*O,q[5]=r*M+c*A+_*j+p*O,q[6]=o*M+u*A+l*j+x*O,q[7]=h*M+f*A+m*j+w*O,q[8]=e*E+a*S+y*R+d*D,q[9]=r*E+c*S+_*R+p*D,q[10]=o*E+u*S+l*R+x*D,q[11]=h*E+f*S+m*R+w*D,q[12]=e*F+a*P+y*T+d*B,q[13]=r*F+c*P+_*T+p*B,q[14]=o*F+u*P+l*T+x*B,q[15]=h*F+f*P+m*T+w*B,this},multiplyAffine:function(t,i){var n=t._m,s=i._m,e=n[0],r=n[1],o=n[2],h=n[4],a=n[5],c=n[6],u=n[8],f=n[9],y=n[10],_=n[12],l=n[13],m=n[14],d=s[0],p=s[1],x=s[2],w=s[4],z=s[5],v=s[6],g=s[8],b=s[9],M=s[10],A=s[12],j=s[13],O=s[14],E=this._m;return E[0]=e*d+h*p+u*x,E[1]=r*d+a*p+f*x,E[2]=o*d+c*p+y*x,E[4]=e*w+h*z+u*v,E[5]=r*w+a*z+f*v,E[6]=o*w+c*z+y*v,E[8]=e*g+h*b+u*M,E[9]=r*g+a*b+f*M,E[10]=o*g+c*b+y*M,E[12]=e*A+h*j+u*O+_,E[13]=r*A+a*j+f*O+l,E[14]=o*A+c*j+y*O+m,this},fromRotationAxisAngle:function(t,i){var n=Math.cos(i),s=Math.sin(i),e=1/t.length,r=t.x*e,o=t.y*e,h=t.z*e,a=1-n,c=this._m;return c[0]=a*r*r+n,c[1]=a*r*o+s*h,c[2]=a*r*h-s*o,c[3]=0,c[4]=a*r*o-s*h,c[5]=a*o*o+n,c[6]=a*o*h+s*r,c[7]=0,c[8]=a*r*h+s*o,c[9]=a*o*h-s*r,c[10]=a*h*h+n,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,this},fromEuler:function(t,i,n){var s=Math.cos(t),e=Math.sin(t),r=Math.cos(i),o=Math.sin(i),h=Math.cos(n),a=Math.sin(n),c=this._m;return c[0]=r*h,c[1]=s*a+e*o*h,c[2]=e*a-s*o*h,c[3]=0,c[4]=-r*a,c[5]=s*h-e*o*a,c[6]=e*h+s*o*a,c[7]=0,c[8]=o,c[9]=-e*r,c[10]=s*r,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,this},fromRotationPitchYawRoll:function(t,i,n){var s=Math.cos(-t),e=Math.cos(-i),r=Math.cos(n),o=Math.sin(-t),h=Math.sin(-i),a=Math.sin(n),c=-h*s,u=e*s,f=-o,y=-e*a-h*o*r,_=-h*a+o*r*e,l=s*r,m=u*l-f*_,d=f*y-c*l,p=c*_-u*y,x=this._m;return x[0]=m,x[1]=d,x[2]=p,x[3]=0,x[4]=c,x[5]=u,x[6]=f,x[7]=0,x[8]=y,x[9]=_,x[10]=l,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,this},fromTranslation:function(t,i,n){void 0===i&&(t=t.x,i=t.y,n=t.z);var s=this._m;return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=t,s[13]=i,s[14]=n,s[15]=1,this},fromScale:function(t,i,n){t instanceof a?(i=t.y,n=t.z,t=t.x):void 0===i&&(i=n=t);var s=this._m;return s[0]=t,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=i,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=n,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,this},fromPerspectiveProjection:function(t,i,n,s){var e=1/Math.tan(.5*t),r=e/i,o=1/(n-s),h=this._m;return h[0]=r,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=0,h[6]=-(s+n)*o,h[7]=1,h[8]=0,h[9]=e,h[10]=0,h[11]=0,h[12]=0,h[13]=0,h[14]=2*n*s*o,h[15]=0,this},fromOrthographicOffCenterProjection:function(t,i,n,s,e,r){var o=1/(i-t),h=1/(n-s),a=1/(e-r),c=this._m;return c[0]=2*o,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=0,c[6]=-2*a,c[7]=0,c[8]=0,c[9]=2*h,c[10]=0,c[11]=0,c[12]=-(t+i)*o,c[13]=-(n+s)*h,c[14]=(r+e)*a,c[15]=1,this},fromOrthographicProjection:function(t,i,n,s){var e=1/t,r=1/i,o=1/(n-s),h=this._m;return h[0]=2*e,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=0,h[6]=2*o,h[7]=0,h[8]=0,h[9]=2*r,h[10]=0,h[11]=0,h[12]=0,h[13]=0,h[14]=(s+n)*o,h[15]=1,this},clone:function(){return new y(this._m)},transpose:function(){var t=this._m,i=t[1],n=t[2],s=t[3],e=t[6],r=t[7],o=t[11];return t[1]=t[4],t[2]=t[8],t[3]=t[12],t[4]=i,t[6]=t[9],t[7]=t[13],t[8]=n,t[9]=e,t[11]=t[14],t[12]=s,t[13]=r,t[14]=o,this},determinant3x3:function(t,i){var n=0===i?4:0,s=i<2?8:4,e=3===i?8:12,r=0===t?1:0,o=t<2?2:1,h=3===t?2:3,a=this._m,c=a[n|o],u=a[o|s],f=a[e|o],y=a[n|h],_=a[s|h],l=a[h|e];return a[n|r]*(u*l-f*_)-a[s|r]*(c*l-f*y)+a[e|r]*(c*_-u*y)},cofactor:function(t,i){var n=1-((t+i&1)<<1);return n*this.determinant3x3(t,i)},getCofactorMatrix:function(t,i,n){n=n||new y;for(var s=n._m,e=0;e<16;++e)s[e]=this.cofactor(3&e,e>>2);return n},getAdjugate:function(t,i,n){n=n||new y;for(var s=n._m,e=0;e<16;++e)s[e]=this.cofactor(e>>2,3&e);return n},determinant:function(){var t=this._m;return t[0]*this.determinant3x3(0,0)-t[4]*this.determinant3x3(0,1)+t[8]*this.determinant3x3(0,2)-t[12]*this.determinant3x3(0,3)},inverseOf:function(t){var i=1/t.determinant(),n=i*t.cofactor(0,0),s=i*t.cofactor(0,1),e=i*t.cofactor(0,2),r=i*t.cofactor(0,3),o=i*t.cofactor(1,0),h=i*t.cofactor(1,1),a=i*t.cofactor(1,2),c=i*t.cofactor(1,3),u=i*t.cofactor(2,0),f=i*t.cofactor(2,1),y=i*t.cofactor(2,2),_=i*t.cofactor(2,3),l=i*t.cofactor(3,0),m=i*t.cofactor(3,1),d=i*t.cofactor(3,2),p=i*t.cofactor(3,3),x=this._m;return x[0]=n,x[1]=s,x[2]=e,x[3]=r,x[4]=o,x[5]=h,x[6]=a,x[7]=c,x[8]=u,x[9]=f,x[10]=y,x[11]=_,x[12]=l,x[13]=m,x[14]=d,x[15]=p,this},inverseAffineOf:function(t){var i=t._m,n=i[0],s=i[1],e=i[2],r=i[4],o=i[5],h=i[6],a=i[8],c=i[9],u=i[10],f=i[12],y=i[13],_=i[14],l=n*(o*u-c*h)-r*(s*u-c*e)+a*(s*h-o*e),m=1/l,d=(o*u-c*h)*m,p=(c*e-s*u)*m,x=(s*h-o*e)*m,w=(a*h-r*u)*m,z=(n*u-a*e)*m,v=(r*e-n*h)*m,g=(r*c-a*o)*m,b=(a*s-n*c)*m,M=(n*o-r*s)*m,A=this._m;return A[0]=d,A[1]=p,A[2]=x,A[3]=0,A[4]=w,A[5]=z,A[6]=v,A[7]=0,A[8]=g,A[9]=b,A[10]=M,A[11]=0,A[12]=-d*f-w*y-g*_,A[13]=-p*f-z*y-b*_,A[14]=-x*f-v*y-M*_,A[15]=1,this},writeNormalMatrix:function(t,i){i=i||0;var n=this._m,s=n[0],e=n[1],r=n[2],o=n[4],h=n[5],a=n[6],c=n[8],u=n[9],f=n[10],y=s*(h*f-u*a)-o*(e*f-u*r)+c*(e*a-h*r),_=1/y;t[i]=(h*f-u*a)*_,t[i+1]=(c*a-o*f)*_,t[i+2]=(o*u-c*h)*_,t[i+3]=(u*r-e*f)*_,t[i+4]=(s*f-c*r)*_,t[i+5]=(c*e-s*u)*_,t[i+6]=(e*a-h*r)*_,t[i+7]=(o*r-s*a)*_,t[i+8]=(s*h-o*e)*_},writeData:function(t,i){i=i||0;for(var n=this._m,s=0;s<16;++s)t[i+s]=n[s]},writeData4x3:function(t,i){var n=this._m;i=i||0,t[i]=n[0],t[i+1]=n[4],t[i+2]=n[8],t[i+3]=n[12],t[i+4]=n[1],t[i+5]=n[5],t[i+6]=n[9],t[i+7]=n[13],t[i+8]=n[2],t[i+9]=n[6],t[i+10]=n[10],t[i+11]=n[14]},invert:function(){return this.inverseOf(this)},invertAffine:function(){return this.inverseAffineOf(this)},append:function(t){return this.multiply(t,this)},prepend:function(t){return this.multiply(this,t)},appendAffine:function(t){return this.multiplyAffine(t,this)},prependAffine:function(t){return this.multiplyAffine(this,t)},add:function(t){var i=this._m,n=t._m;return i[0]+=n[0],i[1]+=n[1],i[2]+=n[2],i[3]+=n[3],i[4]+=n[4],i[5]+=n[5],i[6]+=n[6],i[7]+=n[7],i[8]+=n[8],i[9]+=n[9],i[10]+=n[10],i[11]+=n[11],i[12]+=n[12],i[13]+=n[13],i[14]+=n[14],i[15]+=n[15],this},addAffine:function(t){var i=this._m,n=t._m;return i[0]+=n[0],i[1]+=n[1],i[2]+=n[2],i[4]+=n[4],i[5]+=n[5],i[6]+=n[6],i[8]+=n[8],i[9]+=n[9],i[10]+=n[10],this},subtract:function(t){var i=this._m,n=t._m;return i[0]-=n[0],i[1]-=n[1],i[2]-=n[2],i[3]-=n[3],i[4]-=n[4],i[5]-=n[5],i[6]-=n[6],i[7]-=n[7],i[8]-=n[8],i[9]-=n[9],i[10]-=n[10],i[11]-=n[11],i[12]-=n[12],i[13]-=n[13],i[14]-=n[14],i[15]-=n[15],this},subtractAffine:function(t){var i=this._m,n=t._m;return i[0]-=n[0],i[1]-=n[1],i[2]-=n[2],i[4]-=n[4],i[5]-=n[5],i[6]-=n[6],i[8]-=n[8],i[9]-=n[9],i[10]-=n[10],this},appendScale:function(t,i,n){t instanceof a?(i=t.y,n=t.z,t=t.x):void 0===i&&(i=n=t);var s=this._m;return s[0]*=t,s[1]*=i,s[2]*=n,s[4]*=t,s[5]*=i,s[6]*=n,s[8]*=t,s[9]*=i,s[10]*=n,s[12]*=t,s[13]*=i,s[14]*=n,this},prependScale:function(t,i,n){t instanceof a?(i=t.y,n=t.z,t=t.x):void 0===i&&(i=n=t);var s=this._m;return s[0]*=t,s[1]*=t,s[2]*=t,s[3]*=t,s[4]*=i,s[5]*=i,s[6]*=i,s[7]*=i,s[8]*=n,s[9]*=n,s[10]*=n,s[11]*=n,this},appendTranslation:function(t){var i=this._m;return i[12]+=t.x,i[13]+=t.y,i[14]+=t.z,this},prependTranslation:function(t){var i=this._m,n=t.x,s=t.y,e=t.z;return i[12]+=i[0]*n+i[4]*s+i[8]*e,i[13]+=i[1]*n+i[5]*s+i[9]*e,i[14]+=i[2]*n+i[6]*s+i[10]*e,i[15]+=i[3]*n+i[7]*s+i[11]*e,this},appendQuaternion:function(t){var i=this._m,n=t.x,s=t.y,e=t.z,r=t.w,o=1-2*(s*s+e*e),h=2*(n*s+r*e),a=2*(n*e-r*s),c=2*(n*s-r*e),u=1-2*(n*n+e*e),f=2*(s*e+r*n),y=2*(n*e+r*s),_=2*(s*e-r*n),l=1-2*(n*n+s*s),m=i[0],d=i[1],p=i[2],x=i[4],w=i[5],z=i[6],v=i[8],g=i[9],b=i[10],M=i[12],A=i[13],j=i[14];return i[0]=o*m+c*d+y*p,i[1]=h*m+u*d+_*p,i[2]=a*m+f*d+l*p,i[4]=o*x+c*w+y*z,i[5]=h*x+u*w+_*z,i[6]=a*x+f*w+l*z,i[8]=o*v+c*g+y*b,i[9]=h*v+u*g+_*b,i[10]=a*v+f*g+l*b,i[12]=o*M+c*A+y*j,i[13]=h*M+u*A+_*j,i[14]=a*M+f*A+l*j,this},prependQuaternion:function(t){var i=this._m,n=t.x,s=t.y,e=t.z,r=t.w,o=i[0],h=i[1],a=i[2],c=i[4],u=i[5],f=i[6],y=i[8],_=i[9],l=i[10],m=1-2*(s*s+e*e),d=2*(n*s+r*e),p=2*(n*e-r*s),x=2*(n*s-r*e),w=1-2*(n*n+e*e),z=2*(s*e+r*n),v=2*(n*e+r*s),g=2*(s*e-r*n),b=1-2*(n*n+s*s);return i[0]=o*m+c*d+y*p,i[1]=h*m+u*d+_*p,i[2]=a*m+f*d+l*p,i[4]=o*x+c*w+y*z,i[5]=h*x+u*w+_*z,i[6]=a*x+f*w+l*z,i[8]=o*v+c*g+y*b,i[9]=h*v+u*g+_*b,i[10]=a*v+f*g+l*b,this},appendRotationAxisAngle:function(t,i){var n=this._m,s=Math.cos(i),e=Math.sin(i),r=1/t.length,o=t.x*r,h=t.y*r,a=t.z*r,c=1-s,u=c*o*o+s,f=c*o*h+e*a,y=c*o*a-e*h,_=c*o*h-e*a,l=c*h*h+s,m=c*h*a+e*o,d=c*o*a+e*h,p=c*h*a-e*o,x=c*a*a+s,w=n[0],z=n[1],v=n[2],g=n[4],b=n[5],M=n[6],A=n[8],j=n[9],O=n[10],E=n[12],S=n[13],R=n[14];return n[0]=u*w+_*z+d*v,n[1]=f*w+l*z+p*v,n[2]=y*w+m*z+x*v,n[4]=u*g+_*b+d*M,n[5]=f*g+l*b+p*M,n[6]=y*g+m*b+x*M,n[8]=u*A+_*j+d*O,n[9]=f*A+l*j+p*O,n[10]=y*A+m*j+x*O,n[12]=u*E+_*S+d*R,n[13]=f*E+l*S+p*R,n[14]=y*E+m*S+x*R,this},prependRotationAxisAngle:function(t,i){var n=this._m,s=Math.cos(i),e=Math.sin(i),r=1/t.length,o=t.x*r,h=t.y*r,a=t.z*r,c=1-s,u=n[0],f=n[1],y=n[2],_=n[4],l=n[5],m=n[6],d=n[8],p=n[9],x=n[10],w=c*o*o+s,z=c*o*h+e*a,v=c*o*a-e*h,g=c*o*h-e*a,b=c*h*h+s,M=c*h*a+e*o,A=c*o*a+e*h,j=c*h*a-e*o,O=c*a*a+s;return n[0]=u*w+_*z+d*v,n[1]=f*w+l*z+p*v,n[2]=y*w+m*z+x*v,n[4]=u*g+_*b+d*M,n[5]=f*g+l*b+p*M,n[6]=y*g+m*b+x*M,n[8]=u*A+_*j+d*O,n[9]=f*A+l*j+p*O,n[10]=y*A+m*j+x*O,this},getRow:function(t,i){var n=this._m;return i=i||new a,i.x=n[t],i.y=n[4|t],i.z=n[8|t],i.w=n[12|t],i},setRow:function(t,i){var n=this._m;return n[t]=i.x,n[4|t]=i.y,n[8|t]=i.z,n[12|t]=i.w,this},getElement:function(t,i){return this._m[t|i<<2]},setElement:function(t,i,n){return this._m[t|i<<2]=n,this},getColumn:function(t,i){var n=this._m;return i=i||new a,t<<=2,i.x=n[t],i.y=n[1|t],i.z=n[2|t],i.w=n[3|t],i},setColumn:function(t,i){var n=this._m;return t<<=2,n[t]=i.x,n[1|t]=i.y,n[2|t]=i.z,n[3|t]=i.w,this},copyColumn:function(t,i){var n=this._m,s=i._m;return t<<=2,n[t]=s[t],n[1|t]=s[1|t],n[2|t]=s[2|t],n[3|t]=s[3|t],this},lookAt:function(t,i,n){var s=new a,e=new a,r=new a;return function(t,i,n){if(n=n||a.Z_AXIS,a.subtract(t,i,e),e.normalize(),a.cross(e,n,s),Math.abs(s.lengthSqr)<1e-4){var o=new a(n.x,n.z,n.y,0);a.cross(e,o,s),Math.abs(s.lengthSqr)<=1e-4&&(o.set(n.z,n.y,n.z,0),a.cross(e,o,s))}s.normalize(),a.cross(s,e,r);var h=this._m;return h[0]=s.x,h[1]=s.y,h[2]=s.z,h[3]=0,h[4]=e.x,h[5]=e.y,h[6]=e.z,h[7]=0,h[8]=r.x,h[9]=r.y,h[10]=r.z,h[11]=0,h[12]=i.x,h[13]=i.y,h[14]=i.z,h[15]=1,this}}(),compose:function(t){return this.fromScale(t.scale),this.appendQuaternion(t.rotation),this.appendTranslation(t.position),this},decompose:function(t,i,n){t=t||new f;var s;void 0===i?(i=t.rotation,n=t.scale,s=t.position):s=t;var e=this._m,r=e[0],o=e[1],h=e[2],a=e[4],c=e[5],u=e[6],y=e[8],_=e[9],l=e[10],m=o*u-h*c,p=h*a-r*u,x=r*c-o*a,w=d.sign(m*y+p*_+x*l);n.x=w*Math.sqrt(r*r+o*o+h*h),n.y=w*Math.sqrt(a*a+c*c+u*u),n.z=w*Math.sqrt(y*y+_*_+l*l);var z=this.clone(),v=1/n.x,g=1/n.y,b=1/n.z,M=z._m;return M[0]*=v,M[1]*=v,M[2]*=v,M[4]*=g,M[5]*=g,M[6]*=g,M[8]*=b,M[9]*=b,M[10]*=b,i.fromMatrix(z),this.getColumn(3,s),t},swapColums:function(t,i){var n=this._m;if(t!==i){t<<=2,i<<=2;var s=n[t],e=n[1|t],r=n[2|t],o=n[3|t];return n[t]=n[i],n[1|t]=n[1|i],n[2|t]=n[2|i],n[3|t]=n[3|i],n[i]=s,n[1|i]=e,n[2|i]=r,n[3|i]=o,this}},toString:function(){for(var t=this._m,i="",n=0;n<16;++n){var s=3&n;0===s&&(i+="["),i+=t[n],i+=3===s?"]\n":"\t , \t"}return i}},y.IDENTITY=new y,y.ZERO=new y(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),_.prototype={fromAxisAngle:function(t,i){var n=.5*i,s=Math.sin(n)/t.length;return this.x=t.x*s,this.y=t.y*s,this.z=t.z*s,this.w=Math.cos(n),this},fromPitchYawRoll:function(t,i,n){var s=new y;return s.fromRotationPitchYawRoll(t,i,n),this.fromMatrix(s),this},fromEuler:function(t,i,n){var s=Math.cos(.5*t),e=Math.cos(.5*i),r=Math.cos(.5*n),o=Math.sin(.5*t),h=Math.sin(.5*i),a=Math.sin(.5*n);return this.x=o*e*r+s*h*a,this.y=s*h*r-o*e*a,this.z=s*e*a+o*h*r,this.w=s*e*r-o*h*a,this},toEuler:function(t){t=t||new a;var i=this.x,n=this.y,s=this.z,e=this.w,r=i*i,o=n*n,h=s*s,c=e*e;return t.x=Math.atan2(-2*(n*s-e*i),c-r-o+h),t.y=Math.asin(2*(i*s+e*n)),t.z=Math.atan2(-2*(i*n-e*s),c+r-o-h),t},fromMatrix:function(t){var i,n=t._m[0],s=t._m[5],e=t._m[10],r=n+s+e;return r>0?(r+=1,i=1/Math.sqrt(r)*.5,this.x=i*(t._m[6]-t._m[9]),this.y=i*(t._m[8]-t._m[2]),this.z=i*(t._m[1]-t._m[4]),this.w=i*r):n>s&&n>e?(r=n-s-e+1,i=1/Math.sqrt(r)*.5,this.x=i*r,this.y=i*(t._m[1]+t._m[4]),this.z=i*(t._m[8]+t._m[2]),this.w=i*(t._m[6]-t._m[9])):s>e?(r=s-n-e+1,i=1/Math.sqrt(r)*.5,this.x=i*(t._m[1]+t._m[4]),this.y=i*r,this.z=i*(t._m[6]+t._m[9]),this.w=i*(t._m[8]-t._m[2])):(r=e-n-s+1,i=1/Math.sqrt(r)*.5,this.x=i*(t._m[8]+t._m[2]),this.y=i*(t._m[6]+t._m[9]),this.z=i*r,this.w=i*(t._m[1]-t._m[4])),this.normalize(),this},rotate:function(t,i){i=i||new a;var n=t.x,s=t.y,e=t.z,r=this.x,o=this.y,h=this.z,c=this.w,u=-r*n-o*s-h*e,f=c*n+o*e-h*s,y=c*s-r*e+h*n,_=c*e+r*s-o*n;return i.x=-u*r+f*c-y*h+_*o,i.y=-u*o+f*h+y*c-_*r,i.z=-u*h-f*o+y*r+_*c,i.w=t.w,i},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},set:function(t,i,n,s){return this.x=t,this.y=i,this.z=n,this.w=s,this},copyFrom:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},get normSquared(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},get norm(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var t=1/Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},conjugate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},invert:function(){var t=this.x,i=this.y,n=this.z,s=this.w,e=1/(t*t+i*i+n*n+s*s);return this.x=-t*e,this.y=-i*e,this.z=-n*e,this.w=s*e,this},multiply:function(t,i){var n=t.w,s=t.x,e=t.y,r=t.z,o=i.w,h=i.x,a=i.y,c=i.z;return this.x=n*h+s*o+e*c-r*a,this.y=n*a-s*c+e*o+r*h,this.z=n*c+s*a-e*h+r*o,this.w=n*o-s*h-e*a-r*c,this},append:function(t){return this.multiply(t,this)},prepend:function(t){return this.multiply(this,t)},lerp:function(t,i,n){var s=t.w,e=t.x,r=t.y,o=t.z,h=i.w,a=i.x,c=i.y,u=i.z;return s*h+e*a+r*c+o*u<0&&(h=-h,a=-a,c=-c,u=-u),this.x=e+n*(a-e),this.y=r+n*(c-r),this.z=o+n*(u-o),this.w=s+n*(h-s),this.normalize(),this},slerp:function(t,i,n){var s=t.w,e=t.x,r=t.y,o=t.z,h=i.w,a=i.x,c=i.y,u=i.z,f=s*h+e*a+r*c+o*u;if(f<0&&(f=-f,h=-h,a=-a,c=-c,u=-u),f<.95){var y=Math.acos(f),_=n*y,l=a-e*f,m=c-r*f,d=u-o*f,p=h-s*f,x=1/Math.sqrt(l*l+m*m+d*d+p*p);l*=x,m*=x,d*=x,p*=x;var w=Math.cos(_),z=Math.sin(_);this.x=e*w+l*z,this.y=r*w+m*z,this.z=o*w+d*z,this.w=s*w+p*z}else this.x=e+n*(a-e),this.y=r+n*(c-r),this.z=o+n*(u-o),this.w=s+n*(h-s),this.normalize();return this},toString:function(){return"Quaternion("+this.x+", "+this.y+", "+this.z+", "+this.w+")"}},l.prototype=Object.create(s.prototype),l.prototype.volume=function(){return 0},l.prototype.createShape=function(t){return new CANNON.Plane},t.PhysicsSystem=h,t.RigidBody=o,t.BoxCollider=e,t.SphereCollider=r,t.InfinitePlaneCollider=l,Object.defineProperty(t,"__esModule",{value:!0})});