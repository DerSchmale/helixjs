!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define("HX",["exports"],e):e(t.HX={})}(this,function(t){"use strict";var c="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var e,i,n=(function(t,e){t.exports=function(){var t,e,i="undefined"!=typeof window?window:void 0!==c?c:"undefined"!=typeof self?self:{},n=function(){return/Android/i.test(navigator.userAgent)||/iPhone|iPad|iPod/i.test(navigator.userAgent)},s=function(t,e){for(var i=0,n=t.length;i<n;i++)e[i]=t[i]},r=function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t},o=(function(t,e){t.exports=function(){var i,t,e,n,s,r,o,a=function(){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}(),h=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var i=[],n=!0,s=!1,r=void 0;try{for(var o,a=t[Symbol.iterator]();!(n=(o=a.next()).done)&&(i.push(o.value),!e||i.length!==e);n=!0);}catch(t){s=!0,r=t}finally{try{!n&&a.return&&a.return()}finally{if(s)throw r}}return i}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")},y=function(t,e,i){return t+(e-t)*i},c=(o=/iPad|iPhone|iPod/.test(navigator.platform),function(){return o}),_=(r=-1!==navigator.userAgent.indexOf("Version")&&-1!==navigator.userAgent.indexOf("Android")&&-1!==navigator.userAgent.indexOf("Chrome"),function(){return r}),u=(/^((?!chrome|android).)*safari/i.test(navigator.userAgent),s=-1!==navigator.userAgent.indexOf("Firefox")&&-1!==navigator.userAgent.indexOf("Android"),function(){return s}),l=(e=navigator.userAgent.match(/.*Chrome\/([0-9]+)/),n=e?parseInt(e[1],10):null,function(){return n}),d=function(){var t=!1;if(65===l()){var e=navigator.userAgent.match(/.*Chrome\/([0-9\.]*)/);if(e){var i=e[1].split("."),n=h(i,4),s=(n[0],n[1],n[2]),r=n[3];t=3325===parseInt(s,10)&&parseInt(r,10)<148}}return function(){return t}}(),f=(t=-1!==navigator.userAgent.indexOf("R7 Build"),function(){return t}),p=function(){var t=90==window.orientation||-90==window.orientation;return f()?!t:t},g=function(){return Math.max(window.screen.width,window.screen.height)*window.devicePixelRatio},M=function(){return Math.min(window.screen.width,window.screen.height)*window.devicePixelRatio},A=function(){if(document.exitFullscreen)document.exitFullscreen();else if(document.webkitExitFullscreen)document.webkitExitFullscreen();else if(document.mozCancelFullScreen)document.mozCancelFullScreen();else{if(!document.msExitFullscreen)return!1;document.msExitFullscreen()}return!0},m=function(t,e,i,n){var s=t.createShader(t.VERTEX_SHADER);t.shaderSource(s,e),t.compileShader(s);var r=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(r,i),t.compileShader(r);var o=t.createProgram();for(var a in t.attachShader(o,s),t.attachShader(o,r),n)t.bindAttribLocation(o,n[a],a);return t.linkProgram(o),t.deleteShader(s),t.deleteShader(r),o},x=function(t,e){for(var i={},n=t.getProgramParameter(e,t.ACTIVE_UNIFORMS),s="",r=0;r<n;r++){var o=t.getActiveUniform(e,r);s=o.name.replace("[0]",""),i[s]=t.getUniformLocation(e,s)}return i},T=function(){var t,e=!1;return t=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0),e},N=function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t},D=function(t){if(c()){var e=t.style.width,i=t.style.height;t.style.width=parseInt(e)+1+"px",t.style.height=parseInt(i)+"px",setTimeout(function(){t.style.width=e,t.style.height=i},100)}window.canvas=t},E=function(){var Ct=Math.PI/180,jt=.25*Math.PI,bt=new Float32Array([0,0,0,1]),Pt=new Float32Array([0,0,0]);function n(t,e,i,n,s,r){var o,a,h,u,l,c,_,d,f,p;o=t,a=n||null,h=r.depthNear,u=r.depthFar,l=Math.tan(a?a.upDegrees*Ct:jt),c=Math.tan(a?a.downDegrees*Ct:jt),_=Math.tan(a?a.leftDegrees*Ct:jt),d=Math.tan(a?a.rightDegrees*Ct:jt),f=2/(_+d),p=2/(l+c),o[0]=f,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=p,o[6]=0,o[7]=0,o[8]=-(_-d)*f*.5,o[9]=(l-c)*p*.5,o[10]=u/(h-u),o[11]=-1,o[12]=0,o[13]=0,o[14]=u*h/(h-u),o[15]=0;var g,M,A,m,x,T,y,N,D,E,w,L,I,v,S,O,C,j,b,P,z,R,U,B,F,k,Y,Q,G,X,V,H,W,Z,K,q,J,$,tt,et,it,nt,st,rt,ot,at,ht,ut,lt,ct,_t,dt,ft,pt,gt,Mt,At,mt,xt,Tt,yt,Nt,Dt,Et,wt,Lt,It,vt,St=i.orientation||bt,Ot=i.position||Pt;g=e,A=Ot,m=(M=St)[0],x=M[1],T=M[2],y=M[3],w=m*(N=m+m),L=m*(D=x+x),I=m*(E=T+T),v=x*D,S=x*E,O=T*E,C=y*N,j=y*D,b=y*E,g[0]=1-(v+O),g[1]=L+b,g[2]=I-j,g[3]=0,g[4]=L-b,g[5]=1-(w+O),g[6]=S+C,g[7]=0,g[8]=I+j,g[9]=S-C,g[10]=1-(w+v),g[11]=0,g[12]=A[0],g[13]=A[1],g[14]=A[2],g[15]=1,s&&(z=P=e,K=(R=s)[0],q=R[1],J=R[2],z===P?(P[12]=z[0]*K+z[4]*q+z[8]*J+z[12],P[13]=z[1]*K+z[5]*q+z[9]*J+z[13],P[14]=z[2]*K+z[6]*q+z[10]*J+z[14],P[15]=z[3]*K+z[7]*q+z[11]*J+z[15]):(U=z[0],B=z[1],F=z[2],k=z[3],Y=z[4],Q=z[5],G=z[6],X=z[7],V=z[8],H=z[9],W=z[10],Z=z[11],P[0]=U,P[1]=B,P[2]=F,P[3]=k,P[4]=Y,P[5]=Q,P[6]=G,P[7]=X,P[8]=V,P[9]=H,P[10]=W,P[11]=Z,P[12]=U*K+Y*q+V*J+z[12],P[13]=B*K+Q*q+H*J+z[13],P[14]=F*K+G*q+W*J+z[14],P[15]=k*K+X*q+Z*J+z[15])),et=(tt=$=e)[0],it=tt[1],nt=tt[2],st=tt[3],rt=tt[4],ot=tt[5],at=tt[6],ht=tt[7],ut=tt[8],lt=tt[9],ct=tt[10],_t=tt[11],dt=tt[12],ft=tt[13],pt=tt[14],gt=tt[15],(vt=(Mt=et*ot-it*rt)*(It=ct*gt-_t*pt)-(At=et*at-nt*rt)*(Lt=lt*gt-_t*ft)+(mt=et*ht-st*rt)*(wt=lt*pt-ct*ft)+(xt=it*at-nt*ot)*(Et=ut*gt-_t*dt)-(Tt=it*ht-st*ot)*(Dt=ut*pt-ct*dt)+(yt=nt*ht-st*at)*(Nt=ut*ft-lt*dt))&&(vt=1/vt,$[0]=(ot*It-at*Lt+ht*wt)*vt,$[1]=(nt*Lt-it*It-st*wt)*vt,$[2]=(ft*yt-pt*Tt+gt*xt)*vt,$[3]=(ct*Tt-lt*yt-_t*xt)*vt,$[4]=(at*Et-rt*It-ht*Dt)*vt,$[5]=(et*It-nt*Et+st*Dt)*vt,$[6]=(pt*mt-dt*yt-gt*At)*vt,$[7]=(ut*yt-ct*mt+_t*At)*vt,$[8]=(rt*Lt-ot*Et+ht*Nt)*vt,$[9]=(it*Et-et*Lt-st*Nt)*vt,$[10]=(dt*Tt-ft*mt+gt*Mt)*vt,$[11]=(lt*mt-ut*Tt-_t*Mt)*vt,$[12]=(ot*Dt-rt*wt-at*Nt)*vt,$[13]=(et*wt-it*Dt+nt*Nt)*vt,$[14]=(ft*At-dt*xt-pt*Mt)*vt,$[15]=(ut*xt-lt*At+ct*Mt)*vt)}return function(t,e,i){return!(!t||!e||(t.pose=e,t.timestamp=e.timestamp,n(t.leftProjectionMatrix,t.leftViewMatrix,e,i._getFieldOfView("left"),i._getEyeOffset("left"),i),n(t.rightProjectionMatrix,t.rightViewMatrix,e,i._getFieldOfView("right"),i._getEyeOffset("right"),i),0))}}(),w=function(t){var e,i=t.indexOf("://");e=-1!==i?i+3:0;var n=t.indexOf("/",e);return-1===n&&(n=t.length),t.substring(0,n)},L=(i={},function(t,e){void 0===i[t]&&(console.warn("webvr-polyfill: "+e),i[t]=!0)}),I=function(t,e){var i=e?"Please use "+e+" instead.":"";L(t,t+" has been deprecated. This may not work on native WebVR displays. "+i)},v=function(t,e,i){if(e){for(var n=[],s=null,r=0;r<e.length;++r){var o=e[r];switch(o){case t.TEXTURE_BINDING_2D:case t.TEXTURE_BINDING_CUBE_MAP:var a=e[++r];if(a<t.TEXTURE0||a>t.TEXTURE31){console.error("TEXTURE_BINDING_2D or TEXTURE_BINDING_CUBE_MAP must be followed by a valid texture unit"),n.push(null,null);break}s||(s=t.getParameter(t.ACTIVE_TEXTURE)),t.activeTexture(a),n.push(t.getParameter(o),null);break;case t.ACTIVE_TEXTURE:s=t.getParameter(t.ACTIVE_TEXTURE),n.push(null);break;default:n.push(t.getParameter(o))}}i(t);for(var r=0;r<e.length;++r){var o=e[r],h=n[r];switch(o){case t.ACTIVE_TEXTURE:break;case t.ARRAY_BUFFER_BINDING:t.bindBuffer(t.ARRAY_BUFFER,h);break;case t.COLOR_CLEAR_VALUE:t.clearColor(h[0],h[1],h[2],h[3]);break;case t.COLOR_WRITEMASK:t.colorMask(h[0],h[1],h[2],h[3]);break;case t.CURRENT_PROGRAM:t.useProgram(h);break;case t.ELEMENT_ARRAY_BUFFER_BINDING:t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,h);break;case t.FRAMEBUFFER_BINDING:t.bindFramebuffer(t.FRAMEBUFFER,h);break;case t.RENDERBUFFER_BINDING:t.bindRenderbuffer(t.RENDERBUFFER,h);break;case t.TEXTURE_BINDING_2D:var a=e[++r];if(a<t.TEXTURE0||a>t.TEXTURE31)break;t.activeTexture(a),t.bindTexture(t.TEXTURE_2D,h);break;case t.TEXTURE_BINDING_CUBE_MAP:var a=e[++r];if(a<t.TEXTURE0||a>t.TEXTURE31)break;t.activeTexture(a),t.bindTexture(t.TEXTURE_CUBE_MAP,h);break;case t.VIEWPORT:t.viewport(h[0],h[1],h[2],h[3]);break;case t.BLEND:case t.CULL_FACE:case t.DEPTH_TEST:case t.SCISSOR_TEST:case t.STENCIL_TEST:h?t.enable(o):t.disable(o);break;default:console.log("No GL restore behavior for 0x"+o.toString(16))}s&&t.activeTexture(s)}}else i(t)},S=["attribute vec2 position;","attribute vec3 texCoord;","varying vec2 vTexCoord;","uniform vec4 viewportOffsetScale[2];","void main() {","  vec4 viewport = viewportOffsetScale[int(texCoord.z)];","  vTexCoord = (texCoord.xy * viewport.zw) + viewport.xy;","  gl_Position = vec4( position, 1.0, 1.0 );","}"].join("\n"),O=["precision mediump float;","uniform sampler2D diffuse;","varying vec2 vTexCoord;","void main() {","  gl_FragColor = texture2D(diffuse, vTexCoord);","}"].join("\n");function C(t,e,i,n){this.gl=t,this.cardboardUI=e,this.bufferScale=i,this.dirtySubmitFrameBindings=n,this.ctxAttribs=t.getContextAttributes(),this.meshWidth=20,this.meshHeight=20,this.bufferWidth=t.drawingBufferWidth,this.bufferHeight=t.drawingBufferHeight,this.realBindFramebuffer=t.bindFramebuffer,this.realEnable=t.enable,this.realDisable=t.disable,this.realColorMask=t.colorMask,this.realClearColor=t.clearColor,this.realViewport=t.viewport,c()||(this.realCanvasWidth=Object.getOwnPropertyDescriptor(t.canvas.__proto__,"width"),this.realCanvasHeight=Object.getOwnPropertyDescriptor(t.canvas.__proto__,"height")),this.isPatched=!1,this.lastBoundFramebuffer=null,this.cullFace=!1,this.depthTest=!1,this.blend=!1,this.scissorTest=!1,this.stencilTest=!1,this.viewport=[0,0,0,0],this.colorMask=[!0,!0,!0,!0],this.clearColor=[0,0,0,0],this.attribs={position:0,texCoord:1},this.program=m(t,S,O,this.attribs),this.uniforms=x(t,this.program),this.viewportOffsetScale=new Float32Array(8),this.setTextureBounds(),this.vertexBuffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),this.indexCount=0,this.renderTarget=t.createTexture(),this.framebuffer=t.createFramebuffer(),this.depthStencilBuffer=null,this.depthBuffer=null,this.stencilBuffer=null,this.ctxAttribs.depth&&this.ctxAttribs.stencil?this.depthStencilBuffer=t.createRenderbuffer():this.ctxAttribs.depth?this.depthBuffer=t.createRenderbuffer():this.ctxAttribs.stencil&&(this.stencilBuffer=t.createRenderbuffer()),this.patch(),this.onResize()}C.prototype.destroy=function(){var t=this.gl;this.unpatch(),t.deleteProgram(this.program),t.deleteBuffer(this.vertexBuffer),t.deleteBuffer(this.indexBuffer),t.deleteTexture(this.renderTarget),t.deleteFramebuffer(this.framebuffer),this.depthStencilBuffer&&t.deleteRenderbuffer(this.depthStencilBuffer),this.depthBuffer&&t.deleteRenderbuffer(this.depthBuffer),this.stencilBuffer&&t.deleteRenderbuffer(this.stencilBuffer),this.cardboardUI&&this.cardboardUI.destroy()},C.prototype.onResize=function(){var t=this.gl,e=this,i=[t.RENDERBUFFER_BINDING,t.TEXTURE_BINDING_2D,t.TEXTURE0];v(t,i,function(t){e.realBindFramebuffer.call(t,t.FRAMEBUFFER,null),e.scissorTest&&e.realDisable.call(t,t.SCISSOR_TEST),e.realColorMask.call(t,!0,!0,!0,!0),e.realViewport.call(t,0,0,t.drawingBufferWidth,t.drawingBufferHeight),e.realClearColor.call(t,0,0,0,1),t.clear(t.COLOR_BUFFER_BIT),e.realBindFramebuffer.call(t,t.FRAMEBUFFER,e.framebuffer),t.bindTexture(t.TEXTURE_2D,e.renderTarget),t.texImage2D(t.TEXTURE_2D,0,e.ctxAttribs.alpha?t.RGBA:t.RGB,e.bufferWidth,e.bufferHeight,0,e.ctxAttribs.alpha?t.RGBA:t.RGB,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e.renderTarget,0),e.ctxAttribs.depth&&e.ctxAttribs.stencil?(t.bindRenderbuffer(t.RENDERBUFFER,e.depthStencilBuffer),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,e.bufferWidth,e.bufferHeight),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,e.depthStencilBuffer)):e.ctxAttribs.depth?(t.bindRenderbuffer(t.RENDERBUFFER,e.depthBuffer),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,e.bufferWidth,e.bufferHeight),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,e.depthBuffer)):e.ctxAttribs.stencil&&(t.bindRenderbuffer(t.RENDERBUFFER,e.stencilBuffer),t.renderbufferStorage(t.RENDERBUFFER,t.STENCIL_INDEX8,e.bufferWidth,e.bufferHeight),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.STENCIL_ATTACHMENT,t.RENDERBUFFER,e.stencilBuffer)),!t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer incomplete!"),e.realBindFramebuffer.call(t,t.FRAMEBUFFER,e.lastBoundFramebuffer),e.scissorTest&&e.realEnable.call(t,t.SCISSOR_TEST),e.realColorMask.apply(t,e.colorMask),e.realViewport.apply(t,e.viewport),e.realClearColor.apply(t,e.clearColor)}),this.cardboardUI&&this.cardboardUI.onResize()},C.prototype.patch=function(){if(!this.isPatched){var s=this,e=this.gl.canvas,r=this.gl;c()||(e.width=g()*this.bufferScale,e.height=M()*this.bufferScale,Object.defineProperty(e,"width",{configurable:!0,enumerable:!0,get:function(){return s.bufferWidth},set:function(t){s.bufferWidth=t,s.realCanvasWidth.set.call(e,t),s.onResize()}}),Object.defineProperty(e,"height",{configurable:!0,enumerable:!0,get:function(){return s.bufferHeight},set:function(t){s.bufferHeight=t,s.realCanvasHeight.set.call(e,t),s.onResize()}})),this.lastBoundFramebuffer=r.getParameter(r.FRAMEBUFFER_BINDING),null==this.lastBoundFramebuffer&&(this.lastBoundFramebuffer=this.framebuffer,this.gl.bindFramebuffer(r.FRAMEBUFFER,this.framebuffer)),this.gl.bindFramebuffer=function(t,e){s.lastBoundFramebuffer=e||s.framebuffer,s.realBindFramebuffer.call(r,t,s.lastBoundFramebuffer)},this.cullFace=r.getParameter(r.CULL_FACE),this.depthTest=r.getParameter(r.DEPTH_TEST),this.blend=r.getParameter(r.BLEND),this.scissorTest=r.getParameter(r.SCISSOR_TEST),this.stencilTest=r.getParameter(r.STENCIL_TEST),r.enable=function(t){switch(t){case r.CULL_FACE:s.cullFace=!0;break;case r.DEPTH_TEST:s.depthTest=!0;break;case r.BLEND:s.blend=!0;break;case r.SCISSOR_TEST:s.scissorTest=!0;break;case r.STENCIL_TEST:s.stencilTest=!0}s.realEnable.call(r,t)},r.disable=function(t){switch(t){case r.CULL_FACE:s.cullFace=!1;break;case r.DEPTH_TEST:s.depthTest=!1;break;case r.BLEND:s.blend=!1;break;case r.SCISSOR_TEST:s.scissorTest=!1;break;case r.STENCIL_TEST:s.stencilTest=!1}s.realDisable.call(r,t)},this.colorMask=r.getParameter(r.COLOR_WRITEMASK),r.colorMask=function(t,e,i,n){s.colorMask[0]=t,s.colorMask[1]=e,s.colorMask[2]=i,s.colorMask[3]=n,s.realColorMask.call(r,t,e,i,n)},this.clearColor=r.getParameter(r.COLOR_CLEAR_VALUE),r.clearColor=function(t,e,i,n){s.clearColor[0]=t,s.clearColor[1]=e,s.clearColor[2]=i,s.clearColor[3]=n,s.realClearColor.call(r,t,e,i,n)},this.viewport=r.getParameter(r.VIEWPORT),r.viewport=function(t,e,i,n){s.viewport[0]=t,s.viewport[1]=e,s.viewport[2]=i,s.viewport[3]=n,s.realViewport.call(r,t,e,i,n)},this.isPatched=!0,D(e)}},C.prototype.unpatch=function(){if(this.isPatched){var t=this.gl,e=this.gl.canvas;c()||(Object.defineProperty(e,"width",this.realCanvasWidth),Object.defineProperty(e,"height",this.realCanvasHeight)),e.width=this.bufferWidth,e.height=this.bufferHeight,t.bindFramebuffer=this.realBindFramebuffer,t.enable=this.realEnable,t.disable=this.realDisable,t.colorMask=this.realColorMask,t.clearColor=this.realClearColor,t.viewport=this.realViewport,this.lastBoundFramebuffer==this.framebuffer&&t.bindFramebuffer(t.FRAMEBUFFER,null),this.isPatched=!1,setTimeout(function(){D(e)},1)}},C.prototype.setTextureBounds=function(t,e){t||(t=[0,0,.5,1]),e||(e=[.5,0,.5,1]),this.viewportOffsetScale[0]=t[0],this.viewportOffsetScale[1]=t[1],this.viewportOffsetScale[2]=t[2],this.viewportOffsetScale[3]=t[3],this.viewportOffsetScale[4]=e[0],this.viewportOffsetScale[5]=e[1],this.viewportOffsetScale[6]=e[2],this.viewportOffsetScale[7]=e[3]},C.prototype.submitFrame=function(){var t=this.gl,e=this,i=[];if(this.dirtySubmitFrameBindings||i.push(t.CURRENT_PROGRAM,t.ARRAY_BUFFER_BINDING,t.ELEMENT_ARRAY_BUFFER_BINDING,t.TEXTURE_BINDING_2D,t.TEXTURE0),v(t,i,function(t){e.realBindFramebuffer.call(t,t.FRAMEBUFFER,null),e.cullFace&&e.realDisable.call(t,t.CULL_FACE),e.depthTest&&e.realDisable.call(t,t.DEPTH_TEST),e.blend&&e.realDisable.call(t,t.BLEND),e.scissorTest&&e.realDisable.call(t,t.SCISSOR_TEST),e.stencilTest&&e.realDisable.call(t,t.STENCIL_TEST),e.realColorMask.call(t,!0,!0,!0,!0),e.realViewport.call(t,0,0,t.drawingBufferWidth,t.drawingBufferHeight),(e.ctxAttribs.alpha||c())&&(e.realClearColor.call(t,0,0,0,1),t.clear(t.COLOR_BUFFER_BIT)),t.useProgram(e.program),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e.indexBuffer),t.bindBuffer(t.ARRAY_BUFFER,e.vertexBuffer),t.enableVertexAttribArray(e.attribs.position),t.enableVertexAttribArray(e.attribs.texCoord),t.vertexAttribPointer(e.attribs.position,2,t.FLOAT,!1,20,0),t.vertexAttribPointer(e.attribs.texCoord,3,t.FLOAT,!1,20,8),t.activeTexture(t.TEXTURE0),t.uniform1i(e.uniforms.diffuse,0),t.bindTexture(t.TEXTURE_2D,e.renderTarget),t.uniform4fv(e.uniforms.viewportOffsetScale,e.viewportOffsetScale),t.drawElements(t.TRIANGLES,e.indexCount,t.UNSIGNED_SHORT,0),e.cardboardUI&&e.cardboardUI.renderNoState(),e.realBindFramebuffer.call(e.gl,t.FRAMEBUFFER,e.framebuffer),e.ctxAttribs.preserveDrawingBuffer||(e.realClearColor.call(t,0,0,0,0),t.clear(t.COLOR_BUFFER_BIT)),e.dirtySubmitFrameBindings||e.realBindFramebuffer.call(t,t.FRAMEBUFFER,e.lastBoundFramebuffer),e.cullFace&&e.realEnable.call(t,t.CULL_FACE),e.depthTest&&e.realEnable.call(t,t.DEPTH_TEST),e.blend&&e.realEnable.call(t,t.BLEND),e.scissorTest&&e.realEnable.call(t,t.SCISSOR_TEST),e.stencilTest&&e.realEnable.call(t,t.STENCIL_TEST),e.realColorMask.apply(t,e.colorMask),e.realViewport.apply(t,e.viewport),!e.ctxAttribs.alpha&&e.ctxAttribs.preserveDrawingBuffer||e.realClearColor.apply(t,e.clearColor)}),c()){var n=t.canvas;n.width==e.bufferWidth&&n.height==e.bufferHeight||(e.bufferWidth=n.width,e.bufferHeight=n.height,e.onResize())}},C.prototype.updateDeviceInfo=function(n){var t=this.gl,s=this,e=[t.ARRAY_BUFFER_BINDING,t.ELEMENT_ARRAY_BUFFER_BINDING];v(t,e,function(t){var e=s.computeMeshVertices_(s.meshWidth,s.meshHeight,n);if(t.bindBuffer(t.ARRAY_BUFFER,s.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW),!s.indexCount){var i=s.computeMeshIndices_(s.meshWidth,s.meshHeight);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,s.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,i,t.STATIC_DRAW),s.indexCount=i.length}})},C.prototype.computeMeshVertices_=function(t,e,i){for(var n=new Float32Array(2*t*e*5),s=i.getLeftEyeVisibleTanAngles(),r=i.getLeftEyeNoLensTanAngles(),o=i.getLeftEyeVisibleScreenRect(r),a=0,h=0;h<2;h++){for(var u=0;u<e;u++)for(var l=0;l<t;l++,a++){var c=l/(t-1),_=u/(e-1),d=c,f=_,p=y(s[0],s[2],c),g=y(s[3],s[1],_),M=Math.sqrt(p*p+g*g),A=i.distortion.distortInverse(M),m=p*A/M,x=g*A/M;c=(m-r[0])/(r[2]-r[0]),_=(x-r[3])/(r[1]-r[3]),c=2*(o.x+c*o.width-.5),_=2*(o.y+_*o.height-.5),n[5*a+0]=c,n[5*a+1]=_,n[5*a+2]=d,n[5*a+3]=f,n[5*a+4]=h}var T=s[2]-s[0];s[0]=-(T+s[0]),s[2]=T-s[2],T=r[2]-r[0],r[0]=-(T+r[0]),r[2]=T-r[2],o.x=1-(o.x+o.width)}return n},C.prototype.computeMeshIndices_=function(t,e){for(var i=new Uint16Array(2*(t-1)*(e-1)*6),n=t/2,s=e/2,r=0,o=0,a=0;a<2;a++)for(var h=0;h<e;h++)for(var u=0;u<t;u++,r++)0!=u&&0!=h&&(u<=n==h<=s?(i[o++]=r,i[o++]=r-t-1,i[o++]=r-t,i[o++]=r-t-1,i[o++]=r,i[o++]=r-1):(i[o++]=r-1,i[o++]=r-t,i[o++]=r,i[o++]=r-t,i[o++]=r-1,i[o++]=r-t-1));return i},C.prototype.getOwnPropertyDescriptor_=function(t,e){var i=Object.getOwnPropertyDescriptor(t,e);return void 0!==i.get&&void 0!==i.set||(i.configurable=!0,i.enumerable=!0,i.get=function(){return this.getAttribute(e)},i.set=function(t){this.setAttribute(e,t)}),i};var j=["attribute vec2 position;","uniform mat4 projectionMat;","void main() {","  gl_Position = projectionMat * vec4( position, -1.0, 1.0 );","}"].join("\n"),b=["precision mediump float;","uniform vec4 color;","void main() {","  gl_FragColor = color;","}"].join("\n"),P=Math.PI/180;function z(t){this.gl=t,this.attribs={position:0},this.program=m(t,j,b,this.attribs),this.uniforms=x(t,this.program),this.vertexBuffer=t.createBuffer(),this.gearOffset=0,this.gearVertexCount=0,this.arrowOffset=0,this.arrowVertexCount=0,this.projMat=new Float32Array(16),this.listener=null,this.onResize()}function R(t){this.coefficients=t}z.prototype.destroy=function(){var t=this.gl;this.listener&&t.canvas.removeEventListener("click",this.listener,!1),t.deleteProgram(this.program),t.deleteBuffer(this.vertexBuffer)},z.prototype.listen=function(i,n){var s=this.gl.canvas;this.listener=function(t){var e=s.clientWidth/2;t.clientX>e-42&&t.clientX<e+42&&t.clientY>s.clientHeight-42?i(t):t.clientX<42&&t.clientY<42&&n(t)},s.addEventListener("click",this.listener,!1)},z.prototype.onResize=function(){var t=this.gl,p=this,e=[t.ARRAY_BUFFER_BINDING];v(t,e,function(i){var r=[],o=i.drawingBufferWidth/2,t=Math.max(screen.width,screen.height)*window.devicePixelRatio,e=i.drawingBufferWidth/t,n=e*window.devicePixelRatio,s=4*n/2,a=42*n,h=28*n/2,u=14*n;function l(t,e){var i=(90-t)*P,n=Math.cos(i),s=Math.sin(i);r.push(.3125*n*h+o,.3125*s*h+h),r.push(e*n*h+o,e*s*h+h)}r.push(o-s,a),r.push(o-s,i.drawingBufferHeight),r.push(o+s,a),r.push(o+s,i.drawingBufferHeight),p.gearOffset=r.length/2;for(var c=0;c<=6;c++){var _=60*c;l(_,1),l(_+12,1),l(_+20,.75),l(_+40,.75),l(_+48,1)}function d(t,e){r.push(u+t,i.drawingBufferHeight-u-e)}p.gearVertexCount=r.length/2-p.gearOffset,p.arrowOffset=r.length/2;var f=s/Math.sin(45*P);d(0,h),d(h,0),d(h+f,f),d(f,h+f),d(f,h-f),d(0,h),d(h,2*h),d(h+f,2*h-f),d(f,h-f),d(0,h),d(f,h-s),d(28*n,h-s),d(f,h+s),d(28*n,h+s),p.arrowVertexCount=r.length/2-p.arrowOffset,i.bindBuffer(i.ARRAY_BUFFER,p.vertexBuffer),i.bufferData(i.ARRAY_BUFFER,new Float32Array(r),i.STATIC_DRAW)})},z.prototype.render=function(){var t=this.gl,e=this,i=[t.CULL_FACE,t.DEPTH_TEST,t.BLEND,t.SCISSOR_TEST,t.STENCIL_TEST,t.COLOR_WRITEMASK,t.VIEWPORT,t.CURRENT_PROGRAM,t.ARRAY_BUFFER_BINDING];v(t,i,function(t){t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.BLEND),t.disable(t.SCISSOR_TEST),t.disable(t.STENCIL_TEST),t.colorMask(!0,!0,!0,!0),t.viewport(0,0,t.drawingBufferWidth,t.drawingBufferHeight),e.renderNoState()})},z.prototype.renderNoState=function(){var t,e,i,n,s,r,o,a,h,u,l=this.gl;l.useProgram(this.program),l.bindBuffer(l.ARRAY_BUFFER,this.vertexBuffer),l.enableVertexAttribArray(this.attribs.position),l.vertexAttribPointer(this.attribs.position,2,l.FLOAT,!1,8,0),l.uniform4f(this.uniforms.color,1,1,1,1),t=this.projMat,e=0,i=l.drawingBufferWidth,n=0,s=l.drawingBufferHeight,a=1/(e-i),h=1/(n-s),u=1/((r=.1)-(o=1024)),t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(e+i)*a,t[13]=(s+n)*h,t[14]=(o+r)*u,t[15]=1,l.uniformMatrix4fv(this.uniforms.projectionMat,!1,this.projMat),l.drawArrays(l.TRIANGLE_STRIP,0,4),l.drawArrays(l.TRIANGLE_STRIP,this.gearOffset,this.gearVertexCount),l.drawArrays(l.TRIANGLE_STRIP,this.arrowOffset,this.arrowVertexCount)},R.prototype.distortInverse=function(t){for(var e=0,i=1,n=t-this.distort(e);1e-4<Math.abs(i-e);){var s=t-this.distort(i),r=i-s*((i-e)/(s-n));e=i,i=r,n=s}return i},R.prototype.distort=function(t){for(var e=t*t,i=0,n=0;n<this.coefficients.length;n++)i=e*(i+this.coefficients[n]);return(i+1)*t};var U=Math.PI/180,B=180/Math.PI,F=function(t,e,i){this.x=t||0,this.y=e||0,this.z=i||0};F.prototype={constructor:F,set:function(t,e,i){return this.x=t,this.y=e,this.z=i,this},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},normalize:function(){var t=this.length();if(0!==t){var e=1/t;this.multiplyScalar(e)}else this.x=0,this.y=0,this.z=0;return this},multiplyScalar:function(t){this.x*=t,this.y*=t,this.z*=t},applyQuaternion:function(t){var e=this.x,i=this.y,n=this.z,s=t.x,r=t.y,o=t.z,a=t.w,h=a*e+r*n-o*i,u=a*i+o*e-s*n,l=a*n+s*i-r*e,c=-s*e-r*i-o*n;return this.x=h*a+c*-s+u*-o-l*-r,this.y=u*a+c*-r+l*-s-h*-o,this.z=l*a+c*-o+h*-r-u*-s,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},crossVectors:function(t,e){var i=t.x,n=t.y,s=t.z,r=e.x,o=e.y,a=e.z;return this.x=n*a-s*o,this.y=s*r-i*a,this.z=i*o-n*r,this}};var k,Y,Q=function(t,e,i,n){this.x=t||0,this.y=e||0,this.z=i||0,this.w=void 0!==n?n:1};function G(t){this.width=t.width||g(),this.height=t.height||M(),this.widthMeters=t.widthMeters,this.heightMeters=t.heightMeters,this.bevelMeters=t.bevelMeters}Q.prototype={constructor:Q,set:function(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},setFromEulerXYZ:function(t,e,i){var n=Math.cos(t/2),s=Math.cos(e/2),r=Math.cos(i/2),o=Math.sin(t/2),a=Math.sin(e/2),h=Math.sin(i/2);return this.x=o*s*r+n*a*h,this.y=n*a*r-o*s*h,this.z=n*s*h+o*a*r,this.w=n*s*r-o*a*h,this},setFromEulerYXZ:function(t,e,i){var n=Math.cos(t/2),s=Math.cos(e/2),r=Math.cos(i/2),o=Math.sin(t/2),a=Math.sin(e/2),h=Math.sin(i/2);return this.x=o*s*r+n*a*h,this.y=n*a*r-o*s*h,this.z=n*s*h-o*a*r,this.w=n*s*r+o*a*h,this},setFromAxisAngle:function(t,e){var i=e/2,n=Math.sin(i);return this.x=t.x*n,this.y=t.y*n,this.z=t.z*n,this.w=Math.cos(i),this},multiply:function(t){return this.multiplyQuaternions(this,t)},multiplyQuaternions:function(t,e){var i=t.x,n=t.y,s=t.z,r=t.w,o=e.x,a=e.y,h=e.z,u=e.w;return this.x=i*u+r*o+n*h-s*a,this.y=n*u+r*a+s*o-i*h,this.z=s*u+r*h+i*a-n*o,this.w=r*u-i*o-n*a-s*h,this},inverse:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.normalize(),this},normalize:function(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return 0===t?(this.x=0,this.y=0,this.z=0,this.w=1):(t=1/t,this.x=this.x*t,this.y=this.y*t,this.z=this.z*t,this.w=this.w*t),this},slerp:function(t,e){if(0===e)return this;if(1===e)return this.copy(t);var i=this.x,n=this.y,s=this.z,r=this.w,o=r*t.w+i*t.x+n*t.y+s*t.z;if(o<0?(this.w=-t.w,this.x=-t.x,this.y=-t.y,this.z=-t.z,o=-o):this.copy(t),1<=o)return this.w=r,this.x=i,this.y=n,this.z=s,this;var a=Math.acos(o),h=Math.sqrt(1-o*o);if(Math.abs(h)<.001)return this.w=.5*(r+this.w),this.x=.5*(i+this.x),this.y=.5*(n+this.y),this.z=.5*(s+this.z),this;var u=Math.sin((1-e)*a)/h,l=Math.sin(e*a)/h;return this.w=r*u+this.w*l,this.x=i*u+this.x*l,this.y=n*u+this.y*l,this.z=s*u+this.z*l,this},setFromUnitVectors:function(t,e){return void 0===k&&(k=new F),(Y=t.dot(e)+1)<1e-6?(Y=0,Math.abs(t.x)>Math.abs(t.z)?k.set(-t.y,t.x,0):k.set(0,-t.z,t.y)):k.crossVectors(t,e),this.x=k.x,this.y=k.y,this.z=k.z,this.w=Y,this.normalize(),this}};var X=new G({widthMeters:.11,heightMeters:.062,bevelMeters:.004}),V=new G({widthMeters:.1038,heightMeters:.0584,bevelMeters:.004}),H={CardboardV1:new Z({id:"CardboardV1",label:"Cardboard I/O 2014",fov:40,interLensDistance:.06,baselineLensDistance:.035,screenLensDistance:.042,distortionCoefficients:[.441,.156],inverseCoefficients:[-.4410035,.42756155,-.4804439,.5460139,-.58821183,.5733938,-.48303202,.33299083,-.17573841,.0651772,-.01488963,.001559834]}),CardboardV2:new Z({id:"CardboardV2",label:"Cardboard I/O 2015",fov:60,interLensDistance:.064,baselineLensDistance:.035,screenLensDistance:.039,distortionCoefficients:[.34,.55],inverseCoefficients:[-.33836704,-.18162185,.862655,-1.2462051,1.0560602,-.58208317,.21609078,-.05444823,.009177956,-.0009904169,6183535e-11,-16981803e-13]})};function W(t,e){this.viewer=H.CardboardV2,this.updateDeviceParams(t),this.distortion=new R(this.viewer.distortionCoefficients);for(var i=0;i<e.length;i++){var n=e[i];H[n.id]=new Z(n)}}function Z(t){this.id=t.id,this.label=t.label,this.fov=t.fov,this.interLensDistance=t.interLensDistance,this.baselineLensDistance=t.baselineLensDistance,this.screenLensDistance=t.screenLensDistance,this.distortionCoefficients=t.distortionCoefficients,this.inverseCoefficients=t.inverseCoefficients}W.prototype.updateDeviceParams=function(t){this.device=this.determineDevice_(t)||this.device},W.prototype.getDevice=function(){return this.device},W.prototype.setViewer=function(t){this.viewer=t,this.distortion=new R(this.viewer.distortionCoefficients)},W.prototype.determineDevice_=function(t){if(!t)return c()?(console.warn("Using fallback iOS device measurements."),V):(console.warn("Using fallback Android device measurements."),X);var e=.0254/t.xdpi,i=.0254/t.ydpi,n=g(),s=M();return new G({widthMeters:e*n,heightMeters:i*s,bevelMeters:.001*t.bevelMm})},W.prototype.getDistortedFieldOfViewLeftEye=function(){var t=this.viewer,e=this.device,i=this.distortion,n=t.screenLensDistance,s=(e.widthMeters-t.interLensDistance)/2,r=t.interLensDistance/2,o=t.baselineLensDistance-e.bevelMeters,a=e.heightMeters-o,h=B*Math.atan(i.distort(s/n)),u=B*Math.atan(i.distort(r/n)),l=B*Math.atan(i.distort(o/n)),c=B*Math.atan(i.distort(a/n));return{leftDegrees:Math.min(h,t.fov),rightDegrees:Math.min(u,t.fov),downDegrees:Math.min(l,t.fov),upDegrees:Math.min(c,t.fov)}},W.prototype.getLeftEyeVisibleTanAngles=function(){var t=this.viewer,e=this.device,i=this.distortion,n=Math.tan(-U*t.fov),s=Math.tan(U*t.fov),r=Math.tan(U*t.fov),o=Math.tan(-U*t.fov),a=e.widthMeters/4,h=e.heightMeters/2,u=t.baselineLensDistance-e.bevelMeters-h,l=t.interLensDistance/2-a,c=-u,_=t.screenLensDistance,d=i.distort((l-a)/_),f=i.distort((c+h)/_),p=i.distort((l+a)/_),g=i.distort((c-h)/_),M=new Float32Array(4);return M[0]=Math.max(n,d),M[1]=Math.min(s,f),M[2]=Math.min(r,p),M[3]=Math.max(o,g),M},W.prototype.getLeftEyeNoLensTanAngles=function(){var t=this.viewer,e=this.device,i=this.distortion,n=new Float32Array(4),s=i.distortInverse(Math.tan(-U*t.fov)),r=i.distortInverse(Math.tan(U*t.fov)),o=i.distortInverse(Math.tan(U*t.fov)),a=i.distortInverse(Math.tan(-U*t.fov)),h=e.widthMeters/4,u=e.heightMeters/2,l=t.baselineLensDistance-e.bevelMeters-u,c=t.interLensDistance/2-h,_=-l,d=t.screenLensDistance,f=(c-h)/d,p=(_+u)/d,g=(c+h)/d,M=(_-u)/d;return n[0]=Math.max(s,f),n[1]=Math.min(r,p),n[2]=Math.min(o,g),n[3]=Math.max(a,M),n},W.prototype.getLeftEyeVisibleScreenRect=function(t){var e=this.viewer,i=this.device,n=e.screenLensDistance,s=(i.widthMeters-e.interLensDistance)/2,r=e.baselineLensDistance-i.bevelMeters,o=(t[0]*n+s)/i.widthMeters,a=(t[1]*n+r)/i.heightMeters,h=(t[2]*n+s)/i.widthMeters,u=(t[3]*n+r)/i.heightMeters;return{x:o,y:u,width:h-o,height:a-u}},W.prototype.getFieldOfViewLeftEye=function(t){return t?this.getUndistortedFieldOfViewLeftEye():this.getDistortedFieldOfViewLeftEye()},W.prototype.getFieldOfViewRightEye=function(t){var e=this.getFieldOfViewLeftEye(t);return{leftDegrees:e.rightDegrees,rightDegrees:e.leftDegrees,upDegrees:e.upDegrees,downDegrees:e.downDegrees}},W.prototype.getUndistortedFieldOfViewLeftEye=function(){var t=this.getUndistortedParams_();return{leftDegrees:B*Math.atan(t.outerDist),rightDegrees:B*Math.atan(t.innerDist),downDegrees:B*Math.atan(t.bottomDist),upDegrees:B*Math.atan(t.topDist)}},W.prototype.getUndistortedViewportLeftEye=function(){var t=this.getUndistortedParams_(),e=this.viewer,i=this.device,n=e.screenLensDistance,s=i.widthMeters/n,r=i.heightMeters/n,o=i.width/s,a=i.height/r,h=Math.round((t.eyePosX-t.outerDist)*o),u=Math.round((t.eyePosY-t.bottomDist)*a);return{x:h,y:u,width:Math.round((t.eyePosX+t.innerDist)*o)-h,height:Math.round((t.eyePosY+t.topDist)*a)-u}},W.prototype.getUndistortedParams_=function(){var t=this.viewer,e=this.device,i=this.distortion,n=t.screenLensDistance,s=t.interLensDistance/2/n,r=e.widthMeters/n,o=e.heightMeters/n,a=r/2-s,h=(t.baselineLensDistance-e.bevelMeters)/n,u=t.fov,l=i.distortInverse(Math.tan(U*u)),c=Math.min(a,l),_=Math.min(s,l),d=Math.min(h,l),f=Math.min(o-h,l);return{outerDist:c,innerDist:_,topDist:f,bottomDist:d,eyePosX:a,eyePosY:h}},W.Viewers=H;var K={format:1,last_updated:"2018-02-20T22:55:10Z",devices:[{type:"android",rules:[{mdmh:"asus/*/Nexus 7/*"},{ua:"Nexus 7"}],dpi:[320.8,323],bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_Z00AD/*"},{ua:"ASUS_Z00AD"}],dpi:[403,404.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel XL/*"},{ua:"Pixel XL"}],dpi:[537.9,533],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel/*"},{ua:"Pixel"}],dpi:[432.6,436.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC6435LVW/*"},{ua:"HTC6435LVW"}],dpi:[449.7,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC One XL/*"},{ua:"HTC One XL"}],dpi:[315.3,314.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"htc/*/Nexus 9/*"},{ua:"Nexus 9"}],dpi:289,bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One M9/*"},{ua:"HTC One M9"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One_M8/*"},{ua:"HTC One_M8"}],dpi:[449.7,447.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One/*"},{ua:"HTC One"}],dpi:472.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/Nexus 6P/*"},{ua:"Nexus 6P"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LENOVO/*/Lenovo PB2-690Y/*"},{ua:"Lenovo PB2-690Y"}],dpi:[457.2,454.713],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5X/*"},{ua:"Nexus 5X"}],dpi:[422,419.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS345/*"},{ua:"LGMS345"}],dpi:[221.7,219.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D800/*"},{ua:"LG-D800"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D850/*"},{ua:"LG-D850"}],dpi:[537.9,541.9],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/VS985 4G/*"},{ua:"VS985 4G"}],dpi:[537.9,535.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5/*"},{ua:"Nexus 5 B"}],dpi:[442.4,444.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 4/*"},{ua:"Nexus 4"}],dpi:[319.8,318.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LG-P769/*"},{ua:"LG-P769"}],dpi:[240.6,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS323/*"},{ua:"LGMS323"}],dpi:[206.6,204.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGLS996/*"},{ua:"LGLS996"}],dpi:[403.4,401.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/4560MMX/*"},{ua:"4560MMX"}],dpi:[240,219.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/A250/*"},{ua:"Micromax A250"}],dpi:[480,446.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/Micromax AQ4501/*"},{ua:"Micromax AQ4501"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/G5/*"},{ua:"Moto G (5) Plus"}],dpi:[403.4,403],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/DROID RAZR/*"},{ua:"DROID RAZR"}],dpi:[368.1,256.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT830C/*"},{ua:"XT830C"}],dpi:[254,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1021/*"},{ua:"XT1021"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1023/*"},{ua:"XT1023"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1028/*"},{ua:"XT1028"}],dpi:[326.6,327.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1034/*"},{ua:"XT1034"}],dpi:[326.6,328.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1053/*"},{ua:"XT1053"}],dpi:[315.3,316.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1562/*"},{ua:"XT1562"}],dpi:[403.4,402.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/Nexus 6/*"},{ua:"Nexus 6 B"}],dpi:[494.3,489.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1063/*"},{ua:"XT1063"}],dpi:[295,296.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1064/*"},{ua:"XT1064"}],dpi:[295,295.6],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1092/*"},{ua:"XT1092"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1095/*"},{ua:"XT1095"}],dpi:[422,423.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/G4/*"},{ua:"Moto G (4)"}],dpi:401,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/A0001/*"},{ua:"A0001"}],dpi:[403.4,401],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1005/*"},{ua:"ONE E1005"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2005/*"},{ua:"ONE A2005"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A5000/*"},{ua:"ONEPLUS A5000 "}],dpi:[403.411,399.737],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A5010/*"},{ua:"ONEPLUS A5010"}],dpi:[403,400],bw:2,ac:1e3},{type:"android",rules:[{mdmh:"OPPO/*/X909/*"},{ua:"X909"}],dpi:[442.4,444.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9082/*"},{ua:"GT-I9082"}],dpi:[184.7,185.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G360P/*"},{ua:"SM-G360P"}],dpi:[196.7,205.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Nexus S/*"},{ua:"Nexus S"}],dpi:[234.5,229.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[304.8,303.9],bw:5,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-T230NU/*"},{ua:"SM-T230NU"}],dpi:216,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SGH-T399/*"},{ua:"SGH-T399"}],dpi:[217.7,231.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SGH-M919/*"},{ua:"SGH-M919"}],dpi:[440.8,437.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N9005/*"},{ua:"SM-N9005"}],dpi:[386.4,387],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SM-N900A/*"},{ua:"SAMSUNG-SM-N900A"}],dpi:[386.4,387.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9500/*"},{ua:"GT-I9500"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/GT-I9505/*"},{ua:"GT-I9505"}],dpi:439.4,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900F/*"},{ua:"SM-G900F"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900M/*"},{ua:"SM-G900M"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G800F/*"},{ua:"SM-G800F"}],dpi:326.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G906S/*"},{ua:"SM-G906S"}],dpi:[562.7,572.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[306.7,304.8],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-T535/*"},{ua:"SM-T535"}],dpi:[142.6,136.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-N920C/*"},{ua:"SM-N920C"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920P/*"},{ua:"SM-N920P"}],dpi:[386.3655,390.144],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920W8/*"},{ua:"SM-N920W8"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300I/*"},{ua:"GT-I9300I"}],dpi:[304.8,305.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9195/*"},{ua:"GT-I9195"}],dpi:[249.4,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SPH-L520/*"},{ua:"SPH-L520"}],dpi:[249.4,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SGH-I717/*"},{ua:"SAMSUNG-SGH-I717"}],dpi:285.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SPH-D710/*"},{ua:"SPH-D710"}],dpi:[217.7,204.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-N7100/*"},{ua:"GT-N7100"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SCH-I605/*"},{ua:"SCH-I605"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Galaxy Nexus/*"},{ua:"Galaxy Nexus"}],dpi:[315.3,314.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910H/*"},{ua:"SM-N910H"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910C/*"},{ua:"SM-N910C"}],dpi:[515.2,520.2],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G130M/*"},{ua:"SM-G130M"}],dpi:[165.9,164.8],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G928I/*"},{ua:"SM-G928I"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G920F/*"},{ua:"SM-G920F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G920P/*"},{ua:"SM-G920P"}],dpi:[522.5,577],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G925F/*"},{ua:"SM-G925F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G925V/*"},{ua:"SM-G925V"}],dpi:[522.5,576.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G930F/*"},{ua:"SM-G930F"}],dpi:576.6,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G935F/*"},{ua:"SM-G935F"}],dpi:533,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G950F/*"},{ua:"SM-G950F"}],dpi:[562.707,565.293],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955U/*"},{ua:"SM-G955U"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"Sony/*/C6903/*"},{ua:"C6903"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"Sony/*/D6653/*"},{ua:"D6653"}],dpi:[428.6,427.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6653/*"},{ua:"E6653"}],dpi:[428.6,425.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6853/*"},{ua:"E6853"}],dpi:[403.4,401.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/SGP321/*"},{ua:"SGP321"}],dpi:[224.7,224.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"TCT/*/ALCATEL ONE TOUCH Fierce/*"},{ua:"ALCATEL ONE TOUCH Fierce"}],dpi:[240,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"THL/*/thl 5000/*"},{ua:"thl 5000"}],dpi:[480,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Fly/*/IQ4412/*"},{ua:"IQ4412"}],dpi:307.9,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"ZTE/*/ZTE Blade L2/*"},{ua:"ZTE Blade L2"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"BENEVE/*/VR518/*"},{ua:"VR518"}],dpi:480,bw:3,ac:500},{type:"ios",rules:[{res:[640,960]}],dpi:[325.1,328.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[640,1136]}],dpi:[317.1,320.2],bw:3,ac:1e3},{type:"ios",rules:[{res:[750,1334]}],dpi:326.4,bw:4,ac:1e3},{type:"ios",rules:[{res:[1242,2208]}],dpi:[453.6,458.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2001]}],dpi:[410.9,415.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2436]}],dpi:458,bw:4,ac:1e3}]};function q(t,e){if(this.dpdb=K,this.recalculateDeviceParams_(),t){this.onDeviceParamsUpdated=e;var i=new XMLHttpRequest,n=this;i.open("GET",t,!0),i.addEventListener("load",function(){n.loading=!1,200<=i.status&&i.status<=299?(n.dpdb=JSON.parse(i.response),n.recalculateDeviceParams_()):console.error("Error loading online DPDB!")}),i.send()}}function J(t){this.xdpi=t.xdpi,this.ydpi=t.ydpi,this.bevelMm=t.bevelMm}function $(t,e){this.set(t,e)}function tt(t,e){this.kFilter=t,this.isDebug=e,this.currentAccelMeasurement=new $,this.currentGyroMeasurement=new $,this.previousGyroMeasurement=new $,c()?this.filterQ=new Q(-1,0,0,1):this.filterQ=new Q(1,0,0,1),this.previousFilterQ=new Q,this.previousFilterQ.copy(this.filterQ),this.accelQ=new Q,this.isOrientationInitialized=!1,this.estimatedGravity=new F,this.measuredGravity=new F,this.gyroIntegralQ=new Q}function et(t,e){this.predictionTimeS=t,this.isDebug=e,this.previousQ=new Q,this.previousTimestampS=null,this.deltaQ=new Q,this.outQ=new Q}function it(t,e,i,n){this.yawOnly=i,this.accelerometer=new F,this.gyroscope=new F,this.filter=new tt(t,n),this.posePredictor=new et(e,n),this.isFirefoxAndroid=u(),this.isIOS=c();var s=l();this.isDeviceMotionInRadians=!this.isIOS&&s&&s<66,this.isWithoutDeviceMotion=d(),this.filterToWorldQ=new Q,c()?this.filterToWorldQ.setFromAxisAngle(new F(1,0,0),Math.PI/2):this.filterToWorldQ.setFromAxisAngle(new F(1,0,0),-Math.PI/2),this.inverseWorldToScreenQ=new Q,this.worldToScreenQ=new Q,this.originalPoseAdjustQ=new Q,this.originalPoseAdjustQ.setFromAxisAngle(new F(0,0,1),-window.orientation*Math.PI/180),this.setScreenTransform_(),p()&&this.filterToWorldQ.multiply(this.inverseWorldToScreenQ),this.resetQ=new Q,this.orientationOut_=new Float32Array(4),this.start()}q.prototype.getDeviceParams=function(){return this.deviceParams},q.prototype.recalculateDeviceParams_=function(){var t=this.calcDeviceParams_();t?(this.deviceParams=t,this.onDeviceParamsUpdated&&this.onDeviceParamsUpdated(this.deviceParams)):console.error("Failed to recalculate device parameters.")},q.prototype.calcDeviceParams_=function(){var t=this.dpdb;if(!t)return console.error("DPDB not available."),null;if(1!=t.format)return console.error("DPDB has unexpected format version."),null;if(!t.devices||!t.devices.length)return console.error("DPDB does not have a devices section."),null;var e=navigator.userAgent||navigator.vendor||window.opera,i=g(),n=M();if(!t.devices)return console.error("DPDB has no devices section."),null;for(var s=0;s<t.devices.length;s++){var r=t.devices[s];if(r.rules)if("ios"==r.type||"android"==r.type){if(c()==("ios"==r.type)){for(var o=!1,a=0;a<r.rules.length;a++){var h=r.rules[a];if(this.matchRule_(h,e,i,n)){o=!0;break}}if(o){var u=r.dpi[0]||r.dpi,l=r.dpi[1]||r.dpi;return new J({xdpi:u,ydpi:l,bevelMm:r.bw})}}}else console.warn("Device["+s+"] has invalid type.");else console.warn("Device["+s+"] has no rules section.")}return console.warn("No DPDB device match."),null},q.prototype.matchRule_=function(t,e,i,n){if(!t.ua&&!t.res)return!1;if(t.ua&&e.indexOf(t.ua)<0)return!1;if(t.res){if(!t.res[0]||!t.res[1])return!1;var s=t.res[0],r=t.res[1];if(Math.min(i,n)!=Math.min(s,r)||Math.max(i,n)!=Math.max(s,r))return!1}return!0},$.prototype.set=function(t,e){this.sample=t,this.timestampS=e},$.prototype.copy=function(t){this.set(t.sample,t.timestampS)},tt.prototype.addAccelMeasurement=function(t,e){this.currentAccelMeasurement.set(t,e)},tt.prototype.addGyroMeasurement=function(t,e){this.currentGyroMeasurement.set(t,e);var i,n=e-this.previousGyroMeasurement.timestampS;i=n,!(isNaN(i)||i<=.001||1<i)&&this.run_(),this.previousGyroMeasurement.copy(this.currentGyroMeasurement)},tt.prototype.run_=function(){if(!this.isOrientationInitialized)return this.accelQ=this.accelToQuaternion_(this.currentAccelMeasurement.sample),this.previousFilterQ.copy(this.accelQ),void(this.isOrientationInitialized=!0);var t=this.currentGyroMeasurement.timestampS-this.previousGyroMeasurement.timestampS,e=this.gyroToQuaternionDelta_(this.currentGyroMeasurement.sample,t);this.gyroIntegralQ.multiply(e),this.filterQ.copy(this.previousFilterQ),this.filterQ.multiply(e);var i=new Q;i.copy(this.filterQ),i.inverse(),this.estimatedGravity.set(0,0,-1),this.estimatedGravity.applyQuaternion(i),this.estimatedGravity.normalize(),this.measuredGravity.copy(this.currentAccelMeasurement.sample),this.measuredGravity.normalize();var n,s=new Q;s.setFromUnitVectors(this.estimatedGravity,this.measuredGravity),s.inverse(),this.isDebug&&console.log("Delta: %d deg, G_est: (%s, %s, %s), G_meas: (%s, %s, %s)",B*(1<(n=s).w?(console.warn("getQuaternionAngle: w > 1"),0):2*Math.acos(n.w)),this.estimatedGravity.x.toFixed(1),this.estimatedGravity.y.toFixed(1),this.estimatedGravity.z.toFixed(1),this.measuredGravity.x.toFixed(1),this.measuredGravity.y.toFixed(1),this.measuredGravity.z.toFixed(1));var r=new Q;r.copy(this.filterQ),r.multiply(s),this.filterQ.slerp(r,1-this.kFilter),this.previousFilterQ.copy(this.filterQ)},tt.prototype.getOrientation=function(){return this.filterQ},tt.prototype.accelToQuaternion_=function(t){var e=new F;e.copy(t),e.normalize();var i=new Q;return i.setFromUnitVectors(new F(0,0,-1),e),i.inverse(),i},tt.prototype.gyroToQuaternionDelta_=function(t,e){var i=new Q,n=new F;return n.copy(t),n.normalize(),i.setFromAxisAngle(n,t.length()*e),i},et.prototype.getPrediction=function(t,e,i){if(!this.previousTimestampS)return this.previousQ.copy(t),this.previousTimestampS=i,t;var n=new F;n.copy(e),n.normalize();var s=e.length();if(s<20*U)return this.isDebug&&console.log("Moving slowly, at %s deg/s: no prediction",(B*s).toFixed(1)),this.outQ.copy(t),this.previousQ.copy(t),this.outQ;var r=s*this.predictionTimeS;return this.deltaQ.setFromAxisAngle(n,r),this.outQ.copy(this.previousQ),this.outQ.multiply(this.deltaQ),this.previousQ.copy(t),this.previousTimestampS=i,this.outQ},it.prototype.getPosition=function(){return null},it.prototype.getOrientation=function(){var t=void 0;if(this.isWithoutDeviceMotion&&this._deviceOrientationQ){this.deviceOrientationFixQ=this.deviceOrientationFixQ||(n=(new Q).setFromAxisAngle(new F(0,0,-1),0),s=new Q,-90===window.orientation?s.setFromAxisAngle(new F(0,1,0),Math.PI/-2):s.setFromAxisAngle(new F(0,1,0),Math.PI/2),n.multiply(s)),this.deviceOrientationFilterToWorldQ=this.deviceOrientationFilterToWorldQ||((i=new Q).setFromAxisAngle(new F(1,0,0),-Math.PI/2),i),t=this._deviceOrientationQ;var e=new Q;return e.copy(t),e.multiply(this.deviceOrientationFilterToWorldQ),e.multiply(this.resetQ),e.multiply(this.worldToScreenQ),e.multiplyQuaternions(this.deviceOrientationFixQ,e),this.yawOnly&&(e.x=0,e.z=0,e.normalize()),this.orientationOut_[0]=e.x,this.orientationOut_[1]=e.y,this.orientationOut_[2]=e.z,this.orientationOut_[3]=e.w,this.orientationOut_}var i,n,s,r=this.filter.getOrientation();t=this.posePredictor.getPrediction(r,this.gyroscope,this.previousTimestampS);var e=new Q;return e.copy(this.filterToWorldQ),e.multiply(this.resetQ),e.multiply(t),e.multiply(this.worldToScreenQ),this.yawOnly&&(e.x=0,e.z=0,e.normalize()),this.orientationOut_[0]=e.x,this.orientationOut_[1]=e.y,this.orientationOut_[2]=e.z,this.orientationOut_[3]=e.w,this.orientationOut_},it.prototype.resetPose=function(){this.resetQ.copy(this.filter.getOrientation()),this.resetQ.x=0,this.resetQ.y=0,this.resetQ.z*=-1,this.resetQ.normalize(),p()&&this.resetQ.multiply(this.inverseWorldToScreenQ),this.resetQ.multiply(this.originalPoseAdjustQ)},it.prototype.onDeviceOrientation_=function(t){this._deviceOrientationQ=this._deviceOrientationQ||new Q;var e=t.alpha,i=t.beta,n=t.gamma;e=(e||0)*Math.PI/180,i=(i||0)*Math.PI/180,n=(n||0)*Math.PI/180,this._deviceOrientationQ.setFromEulerYXZ(i,e,-n)},it.prototype.onDeviceMotion_=function(t){this.updateDeviceMotion_(t)},it.prototype.updateDeviceMotion_=function(t){var e=t.accelerationIncludingGravity,i=t.rotationRate,n=t.timeStamp/1e3,s=n-this.previousTimestampS;return s<0?L("fusion-pose-sensor:invalid:non-monotonic","Invalid timestamps detected: non-monotonic timestamp from devicemotion"):s<=.001||1<s?L("fusion-pose-sensor:invalid:outside-threshold","Invalid timestamps detected: Timestamp from devicemotion outside expected range."):(this.accelerometer.set(-e.x,-e.y,-e.z),f()?this.gyroscope.set(-i.beta,i.alpha,i.gamma):this.gyroscope.set(i.alpha,i.beta,i.gamma),this.isDeviceMotionInRadians||this.gyroscope.multiplyScalar(Math.PI/180),this.filter.addAccelMeasurement(this.accelerometer,n),this.filter.addGyroMeasurement(this.gyroscope,n)),void(this.previousTimestampS=n)},it.prototype.onOrientationChange_=function(t){this.setScreenTransform_()},it.prototype.onMessage_=function(t){var e=t.data;if(e&&e.type){var i=e.type.toLowerCase();"devicemotion"===i&&this.updateDeviceMotion_(e.deviceMotionEvent)}},it.prototype.setScreenTransform_=function(){switch(this.worldToScreenQ.set(0,0,0,1),window.orientation){case 0:break;case 90:this.worldToScreenQ.setFromAxisAngle(new F(0,0,1),-Math.PI/2);break;case-90:this.worldToScreenQ.setFromAxisAngle(new F(0,0,1),Math.PI/2)}this.inverseWorldToScreenQ.copy(this.worldToScreenQ),this.inverseWorldToScreenQ.inverse()},it.prototype.start=function(){var t,e,i;this.onDeviceMotionCallback_=this.onDeviceMotion_.bind(this),this.onOrientationChangeCallback_=this.onOrientationChange_.bind(this),this.onMessageCallback_=this.onMessage_.bind(this),this.onDeviceOrientationCallback_=this.onDeviceOrientation_.bind(this),c()&&(t=window.self!==window.top,e=w(document.referrer),i=w(window.location.href),t&&e!==i)&&window.addEventListener("message",this.onMessageCallback_),window.addEventListener("orientationchange",this.onOrientationChangeCallback_),this.isWithoutDeviceMotion?window.addEventListener("deviceorientation",this.onDeviceOrientationCallback_):window.addEventListener("devicemotion",this.onDeviceMotionCallback_)},it.prototype.stop=function(){window.removeEventListener("devicemotion",this.onDeviceMotionCallback_),window.removeEventListener("deviceorientation",this.onDeviceOrientationCallback_),window.removeEventListener("orientationchange",this.onOrientationChangeCallback_),window.removeEventListener("message",this.onMessageCallback_)};var nt=new F(1,0,0),st=new F(0,0,1),rt={};screen.orientation?rt=screen.orientation:screen.msOrientation?rt=screen.msOrientation:Object.defineProperty(rt,"angle",{get:function(){return window.orientation||0}});var ot=new Q;ot.setFromAxisAngle(nt,-Math.PI/2),ot.multiply((new Q).setFromAxisAngle(st,Math.PI/2));var at=function(){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=t,this.sensor=null,this.fusionSensor=null,this._out=new Float32Array(4),this.api=null,this.errors=[],this._sensorQ=new Q,this._worldToScreenQ=new Q,this._outQ=new Q,this._onSensorRead=this._onSensorRead.bind(this),this._onSensorError=this._onSensorError.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onOrientationChange(),this.init()}return a(e,[{key:"init",value:function(){var t=null;try{(t=new RelativeOrientationSensor({frequency:60})).addEventListener("error",this._onSensorError)}catch(t){this.errors.push(t),"SecurityError"===t.name?(console.error("Cannot construct sensors due to the Feature Policy"),console.warn('Attempting to fall back using "devicemotion"; however this will fail in the future without correct permissions.'),this.useDeviceMotion()):"ReferenceError"===t.name?this.useDeviceMotion():console.error(t)}t&&(this.api="sensor",this.sensor=t,this.sensor.addEventListener("reading",this._onSensorRead),this.sensor.start()),window.addEventListener("orientationchange",this._onOrientationChange)}},{key:"useDeviceMotion",value:function(){this.api="devicemotion",this.fusionSensor=new it(this.config.K_FILTER,this.config.PREDICTION_TIME_S,this.config.YAW_ONLY,this.config.DEBUG),this.sensor&&(this.sensor.removeEventListener("reading",this._onSensorRead),this.sensor.removeEventListener("error",this._onSensorError),this.sensor=null)}},{key:"getOrientation",value:function(){if(this.fusionSensor)return this.fusionSensor.getOrientation();if(!this.sensor||!this.sensor.quaternion)return this._out[0]=this._out[1]=this._out[2]=0,this._out[3]=1,this._out;var t=this.sensor.quaternion;this._sensorQ.set(t[0],t[1],t[2],t[3]);var e=this._outQ;return e.copy(ot),e.multiply(this._sensorQ),e.multiply(this._worldToScreenQ),this.config.YAW_ONLY&&(e.x=e.z=0,e.normalize()),this._out[0]=e.x,this._out[1]=e.y,this._out[2]=e.z,this._out[3]=e.w,this._out}},{key:"_onSensorError",value:function(t){this.errors.push(t.error),"NotAllowedError"===t.error.name?console.error("Permission to access sensor was denied"):"NotReadableError"===t.error.name?console.error("Sensor could not be read"):console.error(t.error),this.useDeviceMotion()}},{key:"_onSensorRead",value:function(){}},{key:"_onOrientationChange",value:function(){var t=-rt.angle*Math.PI/180;this._worldToScreenQ.setFromAxisAngle(st,t)}}]),e}();function ht(){this.loadIcon_();var t=document.createElement("div"),e=t.style;e.position="fixed",e.top=0,e.right=0,e.bottom=0,e.left=0,e.backgroundColor="gray",e.fontFamily="sans-serif",e.zIndex=1e6;var i=document.createElement("img");i.src=this.icon;var e=i.style;e.marginLeft="25%",e.marginTop="25%",e.width="50%",t.appendChild(i);var n=document.createElement("div"),e=n.style;e.textAlign="center",e.fontSize="16px",e.lineHeight="24px",e.margin="24px 25%",e.width="50%",n.innerHTML="Place your phone into your Cardboard viewer.",t.appendChild(n);var s=document.createElement("div"),e=s.style;e.backgroundColor="#CFD8DC",e.position="fixed",e.bottom=0,e.width="100%",e.height="48px",e.padding="14px 24px",e.boxSizing="border-box",e.color="#656A6B",t.appendChild(s);var r=document.createElement("div");r.style.float="left",r.innerHTML="No Cardboard viewer?";var o=document.createElement("a");o.href="https://www.google.com/get/cardboard/get-cardboard/",o.innerHTML="get one",o.target="_blank";var e=o.style;e.float="right",e.fontWeight=600,e.textTransform="uppercase",e.borderLeft="1px solid gray",e.paddingLeft="24px",e.textDecoration="none",e.color="#656A6B",s.appendChild(r),s.appendChild(o),this.overlay=t,this.text=n,this.hide()}ht.prototype.show=function(t){t||this.overlay.parentElement?t&&(this.overlay.parentElement&&this.overlay.parentElement!=t&&this.overlay.parentElement.removeChild(this.overlay),t.appendChild(this.overlay)):document.body.appendChild(this.overlay),this.overlay.style.display="block";var e=this.overlay.querySelector("img"),i=e.style;p()?(i.width="20%",i.marginLeft="40%",i.marginTop="3%"):(i.width="50%",i.marginLeft="25%",i.marginTop="25%")},ht.prototype.hide=function(){this.overlay.style.display="none"},ht.prototype.showTemporarily=function(t,e){this.show(e),this.timer=setTimeout(this.hide.bind(this),t)},ht.prototype.disableShowTemporarily=function(){clearTimeout(this.timer)},ht.prototype.update=function(){this.disableShowTemporarily(),!p()&&T()?this.show():this.hide()},ht.prototype.loadIcon_=function(){this.icon="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+Cjxzdmcgd2lkdGg9IjE5OHB4IiBoZWlnaHQ9IjI0MHB4IiB2aWV3Qm94PSIwIDAgMTk4IDI0MCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4bWxuczpza2V0Y2g9Imh0dHA6Ly93d3cuYm9oZW1pYW5jb2RpbmcuY29tL3NrZXRjaC9ucyI+CiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDMuMy4zICgxMjA4MSkgLSBodHRwOi8vd3d3LmJvaGVtaWFuY29kaW5nLmNvbS9za2V0Y2ggLS0+CiAgICA8dGl0bGU+dHJhbnNpdGlvbjwvdGl0bGU+CiAgICA8ZGVzYz5DcmVhdGVkIHdpdGggU2tldGNoLjwvZGVzYz4KICAgIDxkZWZzPjwvZGVmcz4KICAgIDxnIGlkPSJQYWdlLTEiIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiIHNrZXRjaDp0eXBlPSJNU1BhZ2UiPgogICAgICAgIDxnIGlkPSJ0cmFuc2l0aW9uIiBza2V0Y2g6dHlwZT0iTVNBcnRib2FyZEdyb3VwIj4KICAgICAgICAgICAgPGcgaWQ9IkltcG9ydGVkLUxheWVycy1Db3B5LTQtKy1JbXBvcnRlZC1MYXllcnMtQ29weS0rLUltcG9ydGVkLUxheWVycy1Db3B5LTItQ29weSIgc2tldGNoOnR5cGU9Ik1TTGF5ZXJHcm91cCI+CiAgICAgICAgICAgICAgICA8ZyBpZD0iSW1wb3J0ZWQtTGF5ZXJzLUNvcHktNCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMC4wMDAwMDAsIDEwNy4wMDAwMDApIiBza2V0Y2g6dHlwZT0iTVNTaGFwZUdyb3VwIj4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTQ5LjYyNSwyLjUyNyBDMTQ5LjYyNSwyLjUyNyAxNTUuODA1LDYuMDk2IDE1Ni4zNjIsNi40MTggTDE1Ni4zNjIsNy4zMDQgQzE1Ni4zNjIsNy40ODEgMTU2LjM3NSw3LjY2NCAxNTYuNCw3Ljg1MyBDMTU2LjQxLDcuOTM0IDE1Ni40Miw4LjAxNSAxNTYuNDI3LDguMDk1IEMxNTYuNTY3LDkuNTEgMTU3LjQwMSwxMS4wOTMgMTU4LjUzMiwxMi4wOTQgTDE2NC4yNTIsMTcuMTU2IEwxNjQuMzMzLDE3LjA2NiBDMTY0LjMzMywxNy4wNjYgMTY4LjcxNSwxNC41MzYgMTY5LjU2OCwxNC4wNDIgQzE3MS4wMjUsMTQuODgzIDE5NS41MzgsMjkuMDM1IDE5NS41MzgsMjkuMDM1IEwxOTUuNTM4LDgzLjAzNiBDMTk1LjUzOCw4My44MDcgMTk1LjE1Miw4NC4yNTMgMTk0LjU5LDg0LjI1MyBDMTk0LjM1Nyw4NC4yNTMgMTk0LjA5NSw4NC4xNzcgMTkzLjgxOCw4NC4wMTcgTDE2OS44NTEsNzAuMTc5IEwxNjkuODM3LDcwLjIwMyBMMTQyLjUxNSw4NS45NzggTDE0MS42NjUsODQuNjU1IEMxMzYuOTM0LDgzLjEyNiAxMzEuOTE3LDgxLjkxNSAxMjYuNzE0LDgxLjA0NSBDMTI2LjcwOSw4MS4wNiAxMjYuNzA3LDgxLjA2OSAxMjYuNzA3LDgxLjA2OSBMMTIxLjY0LDk4LjAzIEwxMTMuNzQ5LDEwMi41ODYgTDExMy43MTIsMTAyLjUyMyBMMTEzLjcxMiwxMzAuMTEzIEMxMTMuNzEyLDEzMC44ODUgMTEzLjMyNiwxMzEuMzMgMTEyLjc2NCwxMzEuMzMgQzExMi41MzIsMTMxLjMzIDExMi4yNjksMTMxLjI1NCAxMTEuOTkyLDEzMS4wOTQgTDY5LjUxOSwxMDYuNTcyIEM2OC41NjksMTA2LjAyMyA2Ny43OTksMTA0LjY5NSA2Ny43OTksMTAzLjYwNSBMNjcuNzk5LDEwMi41NyBMNjcuNzc4LDEwMi42MTcgQzY3LjI3LDEwMi4zOTMgNjYuNjQ4LDEwMi4yNDkgNjUuOTYyLDEwMi4yMTggQzY1Ljg3NSwxMDIuMjE0IDY1Ljc4OCwxMDIuMjEyIDY1LjcwMSwxMDIuMjEyIEM2NS42MDYsMTAyLjIxMiA2NS41MTEsMTAyLjIxNSA2NS40MTYsMTAyLjIxOSBDNjUuMTk1LDEwMi4yMjkgNjQuOTc0LDEwMi4yMzUgNjQuNzU0LDEwMi4yMzUgQzY0LjMzMSwxMDIuMjM1IDYzLjkxMSwxMDIuMjE2IDYzLjQ5OCwxMDIuMTc4IEM2MS44NDMsMTAyLjAyNSA2MC4yOTgsMTAxLjU3OCA1OS4wOTQsMTAwLjg4MiBMMTIuNTE4LDczLjk5MiBMMTIuNTIzLDc0LjAwNCBMMi4yNDUsNTUuMjU0IEMxLjI0NCw1My40MjcgMi4wMDQsNTEuMDM4IDMuOTQzLDQ5LjkxOCBMNTkuOTU0LDE3LjU3MyBDNjAuNjI2LDE3LjE4NSA2MS4zNSwxNy4wMDEgNjIuMDUzLDE3LjAwMSBDNjMuMzc5LDE3LjAwMSA2NC42MjUsMTcuNjYgNjUuMjgsMTguODU0IEw2NS4yODUsMTguODUxIEw2NS41MTIsMTkuMjY0IEw2NS41MDYsMTkuMjY4IEM2NS45MDksMjAuMDAzIDY2LjQwNSwyMC42OCA2Ni45ODMsMjEuMjg2IEw2Ny4yNiwyMS41NTYgQzY5LjE3NCwyMy40MDYgNzEuNzI4LDI0LjM1NyA3NC4zNzMsMjQuMzU3IEM3Ni4zMjIsMjQuMzU3IDc4LjMyMSwyMy44NCA4MC4xNDgsMjIuNzg1IEM4MC4xNjEsMjIuNzg1IDg3LjQ2NywxOC41NjYgODcuNDY3LDE4LjU2NiBDODguMTM5LDE4LjE3OCA4OC44NjMsMTcuOTk0IDg5LjU2NiwxNy45OTQgQzkwLjg5MiwxNy45OTQgOTIuMTM4LDE4LjY1MiA5Mi43OTIsMTkuODQ3IEw5Ni4wNDIsMjUuNzc1IEw5Ni4wNjQsMjUuNzU3IEwxMDIuODQ5LDI5LjY3NCBMMTAyLjc0NCwyOS40OTIgTDE0OS42MjUsMi41MjcgTTE0OS42MjUsMC44OTIgQzE0OS4zNDMsMC44OTIgMTQ5LjA2MiwwLjk2NSAxNDguODEsMS4xMSBMMTAyLjY0MSwyNy42NjYgTDk3LjIzMSwyNC41NDIgTDk0LjIyNiwxOS4wNjEgQzkzLjMxMywxNy4zOTQgOTEuNTI3LDE2LjM1OSA4OS41NjYsMTYuMzU4IEM4OC41NTUsMTYuMzU4IDg3LjU0NiwxNi42MzIgODYuNjQ5LDE3LjE1IEM4My44NzgsMTguNzUgNzkuNjg3LDIxLjE2OSA3OS4zNzQsMjEuMzQ1IEM3OS4zNTksMjEuMzUzIDc5LjM0NSwyMS4zNjEgNzkuMzMsMjEuMzY5IEM3Ny43OTgsMjIuMjU0IDc2LjA4NCwyMi43MjIgNzQuMzczLDIyLjcyMiBDNzIuMDgxLDIyLjcyMiA2OS45NTksMjEuODkgNjguMzk3LDIwLjM4IEw2OC4xNDUsMjAuMTM1IEM2Ny43MDYsMTkuNjcyIDY3LjMyMywxOS4xNTYgNjcuMDA2LDE4LjYwMSBDNjYuOTg4LDE4LjU1OSA2Ni45NjgsMTguNTE5IDY2Ljk0NiwxOC40NzkgTDY2LjcxOSwxOC4wNjUgQzY2LjY5LDE4LjAxMiA2Ni42NTgsMTcuOTYgNjYuNjI0LDE3LjkxMSBDNjUuNjg2LDE2LjMzNyA2My45NTEsMTUuMzY2IDYyLjA1MywxNS4zNjYgQzYxLjA0MiwxNS4zNjYgNjAuMDMzLDE1LjY0IDU5LjEzNiwxNi4xNTggTDMuMTI1LDQ4LjUwMiBDMC40MjYsNTAuMDYxIC0wLjYxMyw1My40NDIgMC44MTEsNTYuMDQgTDExLjA4OSw3NC43OSBDMTEuMjY2LDc1LjExMyAxMS41MzcsNzUuMzUzIDExLjg1LDc1LjQ5NCBMNTguMjc2LDEwMi4yOTggQzU5LjY3OSwxMDMuMTA4IDYxLjQzMywxMDMuNjMgNjMuMzQ4LDEwMy44MDYgQzYzLjgxMiwxMDMuODQ4IDY0LjI4NSwxMDMuODcgNjQuNzU0LDEwMy44NyBDNjUsMTAzLjg3IDY1LjI0OSwxMDMuODY0IDY1LjQ5NCwxMDMuODUyIEM2NS41NjMsMTAzLjg0OSA2NS42MzIsMTAzLjg0NyA2NS43MDEsMTAzLjg0NyBDNjUuNzY0LDEwMy44NDcgNjUuODI4LDEwMy44NDkgNjUuODksMTAzLjg1MiBDNjUuOTg2LDEwMy44NTYgNjYuMDgsMTAzLjg2MyA2Ni4xNzMsMTAzLjg3NCBDNjYuMjgyLDEwNS40NjcgNjcuMzMyLDEwNy4xOTcgNjguNzAyLDEwNy45ODggTDExMS4xNzQsMTMyLjUxIEMxMTEuNjk4LDEzMi44MTIgMTEyLjIzMiwxMzIuOTY1IDExMi43NjQsMTMyLjk2NSBDMTE0LjI2MSwxMzIuOTY1IDExNS4zNDcsMTMxLjc2NSAxMTUuMzQ3LDEzMC4xMTMgTDExNS4zNDcsMTAzLjU1MSBMMTIyLjQ1OCw5OS40NDYgQzEyMi44MTksOTkuMjM3IDEyMy4wODcsOTguODk4IDEyMy4yMDcsOTguNDk4IEwxMjcuODY1LDgyLjkwNSBDMTMyLjI3OSw4My43MDIgMTM2LjU1Nyw4NC43NTMgMTQwLjYwNyw4Ni4wMzMgTDE0MS4xNCw4Ni44NjIgQzE0MS40NTEsODcuMzQ2IDE0MS45NzcsODcuNjEzIDE0Mi41MTYsODcuNjEzIEMxNDIuNzk0LDg3LjYxMyAxNDMuMDc2LDg3LjU0MiAxNDMuMzMzLDg3LjM5MyBMMTY5Ljg2NSw3Mi4wNzYgTDE5Myw4NS40MzMgQzE5My41MjMsODUuNzM1IDE5NC4wNTgsODUuODg4IDE5NC41OSw4NS44ODggQzE5Ni4wODcsODUuODg4IDE5Ny4xNzMsODQuNjg5IDE5Ny4xNzMsODMuMDM2IEwxOTcuMTczLDI5LjAzNSBDMTk3LjE3MywyOC40NTEgMTk2Ljg2MSwyNy45MTEgMTk2LjM1NSwyNy42MTkgQzE5Ni4zNTUsMjcuNjE5IDE3MS44NDMsMTMuNDY3IDE3MC4zODUsMTIuNjI2IEMxNzAuMTMyLDEyLjQ4IDE2OS44NSwxMi40MDcgMTY5LjU2OCwxMi40MDcgQzE2OS4yODUsMTIuNDA3IDE2OS4wMDIsMTIuNDgxIDE2OC43NDksMTIuNjI3IEMxNjguMTQzLDEyLjk3OCAxNjUuNzU2LDE0LjM1NyAxNjQuNDI0LDE1LjEyNSBMMTU5LjYxNSwxMC44NyBDMTU4Ljc5NiwxMC4xNDUgMTU4LjE1NCw4LjkzNyAxNTguMDU0LDcuOTM0IEMxNTguMDQ1LDcuODM3IDE1OC4wMzQsNy43MzkgMTU4LjAyMSw3LjY0IEMxNTguMDA1LDcuNTIzIDE1Ny45OTgsNy40MSAxNTcuOTk4LDcuMzA0IEwxNTcuOTk4LDYuNDE4IEMxNTcuOTk4LDUuODM0IDE1Ny42ODYsNS4yOTUgMTU3LjE4MSw1LjAwMiBDMTU2LjYyNCw0LjY4IDE1MC40NDIsMS4xMTEgMTUwLjQ0MiwxLjExMSBDMTUwLjE4OSwwLjk2NSAxNDkuOTA3LDAuODkyIDE0OS42MjUsMC44OTIiIGlkPSJGaWxsLTEiIGZpbGw9IiM0NTVBNjQiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNOTYuMDI3LDI1LjYzNiBMMTQyLjYwMyw1Mi41MjcgQzE0My44MDcsNTMuMjIyIDE0NC41ODIsNTQuMTE0IDE0NC44NDUsNTUuMDY4IEwxNDQuODM1LDU1LjA3NSBMNjMuNDYxLDEwMi4wNTcgTDYzLjQ2LDEwMi4wNTcgQzYxLjgwNiwxMDEuOTA1IDYwLjI2MSwxMDEuNDU3IDU5LjA1NywxMDAuNzYyIEwxMi40ODEsNzMuODcxIEw5Ni4wMjcsMjUuNjM2IiBpZD0iRmlsbC0yIiBmaWxsPSIjRkFGQUZBIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTYzLjQ2MSwxMDIuMTc0IEM2My40NTMsMTAyLjE3NCA2My40NDYsMTAyLjE3NCA2My40MzksMTAyLjE3MiBDNjEuNzQ2LDEwMi4wMTYgNjAuMjExLDEwMS41NjMgNTguOTk4LDEwMC44NjMgTDEyLjQyMiw3My45NzMgQzEyLjM4Niw3My45NTIgMTIuMzY0LDczLjkxNCAxMi4zNjQsNzMuODcxIEMxMi4zNjQsNzMuODMgMTIuMzg2LDczLjc5MSAxMi40MjIsNzMuNzcgTDk1Ljk2OCwyNS41MzUgQzk2LjAwNCwyNS41MTQgOTYuMDQ5LDI1LjUxNCA5Ni4wODUsMjUuNTM1IEwxNDIuNjYxLDUyLjQyNiBDMTQzLjg4OCw1My4xMzQgMTQ0LjY4Miw1NC4wMzggMTQ0Ljk1Nyw1NS4wMzcgQzE0NC45Nyw1NS4wODMgMTQ0Ljk1Myw1NS4xMzMgMTQ0LjkxNSw1NS4xNjEgQzE0NC45MTEsNTUuMTY1IDE0NC44OTgsNTUuMTc0IDE0NC44OTQsNTUuMTc3IEw2My41MTksMTAyLjE1OCBDNjMuNTAxLDEwMi4xNjkgNjMuNDgxLDEwMi4xNzQgNjMuNDYxLDEwMi4xNzQgTDYzLjQ2MSwxMDIuMTc0IFogTTEyLjcxNCw3My44NzEgTDU5LjExNSwxMDAuNjYxIEM2MC4yOTMsMTAxLjM0MSA2MS43ODYsMTAxLjc4MiA2My40MzUsMTAxLjkzNyBMMTQ0LjcwNyw1NS4wMTUgQzE0NC40MjgsNTQuMTA4IDE0My42ODIsNTMuMjg1IDE0Mi41NDQsNTIuNjI4IEw5Ni4wMjcsMjUuNzcxIEwxMi43MTQsNzMuODcxIEwxMi43MTQsNzMuODcxIFoiIGlkPSJGaWxsLTMiIGZpbGw9IiM2MDdEOEIiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTQ4LjMyNyw1OC40NzEgQzE0OC4xNDUsNTguNDggMTQ3Ljk2Miw1OC40OCAxNDcuNzgxLDU4LjQ3MiBDMTQ1Ljg4Nyw1OC4zODkgMTQ0LjQ3OSw1Ny40MzQgMTQ0LjYzNiw1Ni4zNCBDMTQ0LjY4OSw1NS45NjcgMTQ0LjY2NCw1NS41OTcgMTQ0LjU2NCw1NS4yMzUgTDYzLjQ2MSwxMDIuMDU3IEM2NC4wODksMTAyLjExNSA2NC43MzMsMTAyLjEzIDY1LjM3OSwxMDIuMDk5IEM2NS41NjEsMTAyLjA5IDY1Ljc0MywxMDIuMDkgNjUuOTI1LDEwMi4wOTggQzY3LjgxOSwxMDIuMTgxIDY5LjIyNywxMDMuMTM2IDY5LjA3LDEwNC4yMyBMMTQ4LjMyNyw1OC40NzEiIGlkPSJGaWxsLTQiIGZpbGw9IiNGRkZGRkYiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNNjkuMDcsMTA0LjM0NyBDNjkuMDQ4LDEwNC4zNDcgNjkuMDI1LDEwNC4zNCA2OS4wMDUsMTA0LjMyNyBDNjguOTY4LDEwNC4zMDEgNjguOTQ4LDEwNC4yNTcgNjguOTU1LDEwNC4yMTMgQzY5LDEwMy44OTYgNjguODk4LDEwMy41NzYgNjguNjU4LDEwMy4yODggQzY4LjE1MywxMDIuNjc4IDY3LjEwMywxMDIuMjY2IDY1LjkyLDEwMi4yMTQgQzY1Ljc0MiwxMDIuMjA2IDY1LjU2MywxMDIuMjA3IDY1LjM4NSwxMDIuMjE1IEM2NC43NDIsMTAyLjI0NiA2NC4wODcsMTAyLjIzMiA2My40NSwxMDIuMTc0IEM2My4zOTksMTAyLjE2OSA2My4zNTgsMTAyLjEzMiA2My4zNDcsMTAyLjA4MiBDNjMuMzM2LDEwMi4wMzMgNjMuMzU4LDEwMS45ODEgNjMuNDAyLDEwMS45NTYgTDE0NC41MDYsNTUuMTM0IEMxNDQuNTM3LDU1LjExNiAxNDQuNTc1LDU1LjExMyAxNDQuNjA5LDU1LjEyNyBDMTQ0LjY0Miw1NS4xNDEgMTQ0LjY2OCw1NS4xNyAxNDQuNjc3LDU1LjIwNCBDMTQ0Ljc4MSw1NS41ODUgMTQ0LjgwNiw1NS45NzIgMTQ0Ljc1MSw1Ni4zNTcgQzE0NC43MDYsNTYuNjczIDE0NC44MDgsNTYuOTk0IDE0NS4wNDcsNTcuMjgyIEMxNDUuNTUzLDU3Ljg5MiAxNDYuNjAyLDU4LjMwMyAxNDcuNzg2LDU4LjM1NSBDMTQ3Ljk2NCw1OC4zNjMgMTQ4LjE0Myw1OC4zNjMgMTQ4LjMyMSw1OC4zNTQgQzE0OC4zNzcsNTguMzUyIDE0OC40MjQsNTguMzg3IDE0OC40MzksNTguNDM4IEMxNDguNDU0LDU4LjQ5IDE0OC40MzIsNTguNTQ1IDE0OC4zODUsNTguNTcyIEw2OS4xMjksMTA0LjMzMSBDNjkuMTExLDEwNC4zNDIgNjkuMDksMTA0LjM0NyA2OS4wNywxMDQuMzQ3IEw2OS4wNywxMDQuMzQ3IFogTTY1LjY2NSwxMDEuOTc1IEM2NS43NTQsMTAxLjk3NSA2NS44NDIsMTAxLjk3NyA2NS45MywxMDEuOTgxIEM2Ny4xOTYsMTAyLjAzNyA2OC4yODMsMTAyLjQ2OSA2OC44MzgsMTAzLjEzOSBDNjkuMDY1LDEwMy40MTMgNjkuMTg4LDEwMy43MTQgNjkuMTk4LDEwNC4wMjEgTDE0Ny44ODMsNTguNTkyIEMxNDcuODQ3LDU4LjU5MiAxNDcuODExLDU4LjU5MSAxNDcuNzc2LDU4LjU4OSBDMTQ2LjUwOSw1OC41MzMgMTQ1LjQyMiw1OC4xIDE0NC44NjcsNTcuNDMxIEMxNDQuNTg1LDU3LjA5MSAxNDQuNDY1LDU2LjcwNyAxNDQuNTIsNTYuMzI0IEMxNDQuNTYzLDU2LjAyMSAxNDQuNTUyLDU1LjcxNiAxNDQuNDg4LDU1LjQxNCBMNjMuODQ2LDEwMS45NyBDNjQuMzUzLDEwMi4wMDIgNjQuODY3LDEwMi4wMDYgNjUuMzc0LDEwMS45ODIgQzY1LjQ3MSwxMDEuOTc3IDY1LjU2OCwxMDEuOTc1IDY1LjY2NSwxMDEuOTc1IEw2NS42NjUsMTAxLjk3NSBaIiBpZD0iRmlsbC01IiBmaWxsPSIjNjA3RDhCIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTIuMjA4LDU1LjEzNCBDMS4yMDcsNTMuMzA3IDEuOTY3LDUwLjkxNyAzLjkwNiw0OS43OTcgTDU5LjkxNywxNy40NTMgQzYxLjg1NiwxNi4zMzMgNjQuMjQxLDE2LjkwNyA2NS4yNDMsMTguNzM0IEw2NS40NzUsMTkuMTQ0IEM2NS44NzIsMTkuODgyIDY2LjM2OCwyMC41NiA2Ni45NDUsMjEuMTY1IEw2Ny4yMjMsMjEuNDM1IEM3MC41NDgsMjQuNjQ5IDc1LjgwNiwyNS4xNTEgODAuMTExLDIyLjY2NSBMODcuNDMsMTguNDQ1IEM4OS4zNywxNy4zMjYgOTEuNzU0LDE3Ljg5OSA5Mi43NTUsMTkuNzI3IEw5Ni4wMDUsMjUuNjU1IEwxMi40ODYsNzMuODg0IEwyLjIwOCw1NS4xMzQgWiIgaWQ9IkZpbGwtNiIgZmlsbD0iI0ZBRkFGQSI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0xMi40ODYsNzQuMDAxIEMxMi40NzYsNzQuMDAxIDEyLjQ2NSw3My45OTkgMTIuNDU1LDczLjk5NiBDMTIuNDI0LDczLjk4OCAxMi4zOTksNzMuOTY3IDEyLjM4NCw3My45NCBMMi4xMDYsNTUuMTkgQzEuMDc1LDUzLjMxIDEuODU3LDUwLjg0NSAzLjg0OCw0OS42OTYgTDU5Ljg1OCwxNy4zNTIgQzYwLjUyNSwxNi45NjcgNjEuMjcxLDE2Ljc2NCA2Mi4wMTYsMTYuNzY0IEM2My40MzEsMTYuNzY0IDY0LjY2NiwxNy40NjYgNjUuMzI3LDE4LjY0NiBDNjUuMzM3LDE4LjY1NCA2NS4zNDUsMTguNjYzIDY1LjM1MSwxOC42NzQgTDY1LjU3OCwxOS4wODggQzY1LjU4NCwxOS4xIDY1LjU4OSwxOS4xMTIgNjUuNTkxLDE5LjEyNiBDNjUuOTg1LDE5LjgzOCA2Ni40NjksMjAuNDk3IDY3LjAzLDIxLjA4NSBMNjcuMzA1LDIxLjM1MSBDNjkuMTUxLDIzLjEzNyA3MS42NDksMjQuMTIgNzQuMzM2LDI0LjEyIEM3Ni4zMTMsMjQuMTIgNzguMjksMjMuNTgyIDgwLjA1MywyMi41NjMgQzgwLjA2NCwyMi41NTcgODAuMDc2LDIyLjU1MyA4MC4wODgsMjIuNTUgTDg3LjM3MiwxOC4zNDQgQzg4LjAzOCwxNy45NTkgODguNzg0LDE3Ljc1NiA4OS41MjksMTcuNzU2IEM5MC45NTYsMTcuNzU2IDkyLjIwMSwxOC40NzIgOTIuODU4LDE5LjY3IEw5Ni4xMDcsMjUuNTk5IEM5Ni4xMzgsMjUuNjU0IDk2LjExOCwyNS43MjQgOTYuMDYzLDI1Ljc1NiBMMTIuNTQ1LDczLjk4NSBDMTIuNTI2LDczLjk5NiAxMi41MDYsNzQuMDAxIDEyLjQ4Niw3NC4wMDEgTDEyLjQ4Niw3NC4wMDEgWiBNNjIuMDE2LDE2Ljk5NyBDNjEuMzEyLDE2Ljk5NyA2MC42MDYsMTcuMTkgNTkuOTc1LDE3LjU1NCBMMy45NjUsNDkuODk5IEMyLjA4Myw1MC45ODUgMS4zNDEsNTMuMzA4IDIuMzEsNTUuMDc4IEwxMi41MzEsNzMuNzIzIEw5NS44NDgsMjUuNjExIEw5Mi42NTMsMTkuNzgyIEM5Mi4wMzgsMTguNjYgOTAuODcsMTcuOTkgODkuNTI5LDE3Ljk5IEM4OC44MjUsMTcuOTkgODguMTE5LDE4LjE4MiA4Ny40ODksMTguNTQ3IEw4MC4xNzIsMjIuNzcyIEM4MC4xNjEsMjIuNzc4IDgwLjE0OSwyMi43ODIgODAuMTM3LDIyLjc4NSBDNzguMzQ2LDIzLjgxMSA3Ni4zNDEsMjQuMzU0IDc0LjMzNiwyNC4zNTQgQzcxLjU4OCwyNC4zNTQgNjkuMDMzLDIzLjM0NyA2Ny4xNDIsMjEuNTE5IEw2Ni44NjQsMjEuMjQ5IEM2Ni4yNzcsMjAuNjM0IDY1Ljc3NCwxOS45NDcgNjUuMzY3LDE5LjIwMyBDNjUuMzYsMTkuMTkyIDY1LjM1NiwxOS4xNzkgNjUuMzU0LDE5LjE2NiBMNjUuMTYzLDE4LjgxOSBDNjUuMTU0LDE4LjgxMSA2NS4xNDYsMTguODAxIDY1LjE0LDE4Ljc5IEM2NC41MjUsMTcuNjY3IDYzLjM1NywxNi45OTcgNjIuMDE2LDE2Ljk5NyBMNjIuMDE2LDE2Ljk5NyBaIiBpZD0iRmlsbC03IiBmaWxsPSIjNjA3RDhCIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTQyLjQzNCw0OC44MDggTDQyLjQzNCw0OC44MDggQzM5LjkyNCw0OC44MDcgMzcuNzM3LDQ3LjU1IDM2LjU4Miw0NS40NDMgQzM0Ljc3MSw0Mi4xMzkgMzYuMTQ0LDM3LjgwOSAzOS42NDEsMzUuNzg5IEw1MS45MzIsMjguNjkxIEM1My4xMDMsMjguMDE1IDU0LjQxMywyNy42NTggNTUuNzIxLDI3LjY1OCBDNTguMjMxLDI3LjY1OCA2MC40MTgsMjguOTE2IDYxLjU3MywzMS4wMjMgQzYzLjM4NCwzNC4zMjcgNjIuMDEyLDM4LjY1NyA1OC41MTQsNDAuNjc3IEw0Ni4yMjMsNDcuNzc1IEM0NS4wNTMsNDguNDUgNDMuNzQyLDQ4LjgwOCA0Mi40MzQsNDguODA4IEw0Mi40MzQsNDguODA4IFogTTU1LjcyMSwyOC4xMjUgQzU0LjQ5NSwyOC4xMjUgNTMuMjY1LDI4LjQ2MSA1Mi4xNjYsMjkuMDk2IEwzOS44NzUsMzYuMTk0IEMzNi41OTYsMzguMDg3IDM1LjMwMiw0Mi4xMzYgMzYuOTkyLDQ1LjIxOCBDMzguMDYzLDQ3LjE3MyA0MC4wOTgsNDguMzQgNDIuNDM0LDQ4LjM0IEM0My42NjEsNDguMzQgNDQuODksNDguMDA1IDQ1Ljk5LDQ3LjM3IEw1OC4yODEsNDAuMjcyIEM2MS41NiwzOC4zNzkgNjIuODUzLDM0LjMzIDYxLjE2NCwzMS4yNDggQzYwLjA5MiwyOS4yOTMgNTguMDU4LDI4LjEyNSA1NS43MjEsMjguMTI1IEw1NS43MjEsMjguMTI1IFoiIGlkPSJGaWxsLTgiIGZpbGw9IiM2MDdEOEIiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTQ5LjU4OCwyLjQwNyBDMTQ5LjU4OCwyLjQwNyAxNTUuNzY4LDUuOTc1IDE1Ni4zMjUsNi4yOTcgTDE1Ni4zMjUsNy4xODQgQzE1Ni4zMjUsNy4zNiAxNTYuMzM4LDcuNTQ0IDE1Ni4zNjIsNy43MzMgQzE1Ni4zNzMsNy44MTQgMTU2LjM4Miw3Ljg5NCAxNTYuMzksNy45NzUgQzE1Ni41Myw5LjM5IDE1Ny4zNjMsMTAuOTczIDE1OC40OTUsMTEuOTc0IEwxNjUuODkxLDE4LjUxOSBDMTY2LjA2OCwxOC42NzUgMTY2LjI0OSwxOC44MTQgMTY2LjQzMiwxOC45MzQgQzE2OC4wMTEsMTkuOTc0IDE2OS4zODIsMTkuNCAxNjkuNDk0LDE3LjY1MiBDMTY5LjU0MywxNi44NjggMTY5LjU1MSwxNi4wNTcgMTY5LjUxNywxNS4yMjMgTDE2OS41MTQsMTUuMDYzIEwxNjkuNTE0LDEzLjkxMiBDMTcwLjc4LDE0LjY0MiAxOTUuNTAxLDI4LjkxNSAxOTUuNTAxLDI4LjkxNSBMMTk1LjUwMSw4Mi45MTUgQzE5NS41MDEsODQuMDA1IDE5NC43MzEsODQuNDQ1IDE5My43ODEsODMuODk3IEwxNTEuMzA4LDU5LjM3NCBDMTUwLjM1OCw1OC44MjYgMTQ5LjU4OCw1Ny40OTcgMTQ5LjU4OCw1Ni40MDggTDE0OS41ODgsMjIuMzc1IiBpZD0iRmlsbC05IiBmaWxsPSIjRkFGQUZBIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTE5NC41NTMsODQuMjUgQzE5NC4yOTYsODQuMjUgMTk0LjAxMyw4NC4xNjUgMTkzLjcyMiw4My45OTcgTDE1MS4yNSw1OS40NzYgQzE1MC4yNjksNTguOTA5IDE0OS40NzEsNTcuNTMzIDE0OS40NzEsNTYuNDA4IEwxNDkuNDcxLDIyLjM3NSBMMTQ5LjcwNSwyMi4zNzUgTDE0OS43MDUsNTYuNDA4IEMxNDkuNzA1LDU3LjQ1OSAxNTAuNDUsNTguNzQ0IDE1MS4zNjYsNTkuMjc0IEwxOTMuODM5LDgzLjc5NSBDMTk0LjI2Myw4NC4wNCAxOTQuNjU1LDg0LjA4MyAxOTQuOTQyLDgzLjkxNyBDMTk1LjIyNyw4My43NTMgMTk1LjM4NCw4My4zOTcgMTk1LjM4NCw4Mi45MTUgTDE5NS4zODQsMjguOTgyIEMxOTQuMTAyLDI4LjI0MiAxNzIuMTA0LDE1LjU0MiAxNjkuNjMxLDE0LjExNCBMMTY5LjYzNCwxNS4yMiBDMTY5LjY2OCwxNi4wNTIgMTY5LjY2LDE2Ljg3NCAxNjkuNjEsMTcuNjU5IEMxNjkuNTU2LDE4LjUwMyAxNjkuMjE0LDE5LjEyMyAxNjguNjQ3LDE5LjQwNSBDMTY4LjAyOCwxOS43MTQgMTY3LjE5NywxOS41NzggMTY2LjM2NywxOS4wMzIgQzE2Ni4xODEsMTguOTA5IDE2NS45OTUsMTguNzY2IDE2NS44MTQsMTguNjA2IEwxNTguNDE3LDEyLjA2MiBDMTU3LjI1OSwxMS4wMzYgMTU2LjQxOCw5LjQzNyAxNTYuMjc0LDcuOTg2IEMxNTYuMjY2LDcuOTA3IDE1Ni4yNTcsNy44MjcgMTU2LjI0Nyw3Ljc0OCBDMTU2LjIyMSw3LjU1NSAxNTYuMjA5LDcuMzY1IDE1Ni4yMDksNy4xODQgTDE1Ni4yMDksNi4zNjQgQzE1NS4zNzUsNS44ODMgMTQ5LjUyOSwyLjUwOCAxNDkuNTI5LDIuNTA4IEwxNDkuNjQ2LDIuMzA2IEMxNDkuNjQ2LDIuMzA2IDE1NS44MjcsNS44NzQgMTU2LjM4NCw2LjE5NiBMMTU2LjQ0Miw2LjIzIEwxNTYuNDQyLDcuMTg0IEMxNTYuNDQyLDcuMzU1IDE1Ni40NTQsNy41MzUgMTU2LjQ3OCw3LjcxNyBDMTU2LjQ4OSw3LjggMTU2LjQ5OSw3Ljg4MiAxNTYuNTA3LDcuOTYzIEMxNTYuNjQ1LDkuMzU4IDE1Ny40NTUsMTAuODk4IDE1OC41NzIsMTEuODg2IEwxNjUuOTY5LDE4LjQzMSBDMTY2LjE0MiwxOC41ODQgMTY2LjMxOSwxOC43MiAxNjYuNDk2LDE4LjgzNyBDMTY3LjI1NCwxOS4zMzYgMTY4LDE5LjQ2NyAxNjguNTQzLDE5LjE5NiBDMTY5LjAzMywxOC45NTMgMTY5LjMyOSwxOC40MDEgMTY5LjM3NywxNy42NDUgQzE2OS40MjcsMTYuODY3IDE2OS40MzQsMTYuMDU0IDE2OS40MDEsMTUuMjI4IEwxNjkuMzk3LDE1LjA2NSBMMTY5LjM5NywxMy43MSBMMTY5LjU3MiwxMy44MSBDMTcwLjgzOSwxNC41NDEgMTk1LjU1OSwyOC44MTQgMTk1LjU1OSwyOC44MTQgTDE5NS42MTgsMjguODQ3IEwxOTUuNjE4LDgyLjkxNSBDMTk1LjYxOCw4My40ODQgMTk1LjQyLDgzLjkxMSAxOTUuMDU5LDg0LjExOSBDMTk0LjkwOCw4NC4yMDYgMTk0LjczNyw4NC4yNSAxOTQuNTUzLDg0LjI1IiBpZD0iRmlsbC0xMCIgZmlsbD0iIzYwN0Q4QiI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0xNDUuNjg1LDU2LjE2MSBMMTY5LjgsNzAuMDgzIEwxNDMuODIyLDg1LjA4MSBMMTQyLjM2LDg0Ljc3NCBDMTM1LjgyNiw4Mi42MDQgMTI4LjczMiw4MS4wNDYgMTIxLjM0MSw4MC4xNTggQzExNi45NzYsNzkuNjM0IDExMi42NzgsODEuMjU0IDExMS43NDMsODMuNzc4IEMxMTEuNTA2LDg0LjQxNCAxMTEuNTAzLDg1LjA3MSAxMTEuNzMyLDg1LjcwNiBDMTEzLjI3LDg5Ljk3MyAxMTUuOTY4LDk0LjA2OSAxMTkuNzI3LDk3Ljg0MSBMMTIwLjI1OSw5OC42ODYgQzEyMC4yNiw5OC42ODUgOTQuMjgyLDExMy42ODMgOTQuMjgyLDExMy42ODMgTDcwLjE2Nyw5OS43NjEgTDE0NS42ODUsNTYuMTYxIiBpZD0iRmlsbC0xMSIgZmlsbD0iI0ZGRkZGRiI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik05NC4yODIsMTEzLjgxOCBMOTQuMjIzLDExMy43ODUgTDY5LjkzMyw5OS43NjEgTDcwLjEwOCw5OS42NiBMMTQ1LjY4NSw1Ni4wMjYgTDE0NS43NDMsNTYuMDU5IEwxNzAuMDMzLDcwLjA4MyBMMTQzLjg0Miw4NS4yMDUgTDE0My43OTcsODUuMTk1IEMxNDMuNzcyLDg1LjE5IDE0Mi4zMzYsODQuODg4IDE0Mi4zMzYsODQuODg4IEMxMzUuNzg3LDgyLjcxNCAxMjguNzIzLDgxLjE2MyAxMjEuMzI3LDgwLjI3NCBDMTIwLjc4OCw4MC4yMDkgMTIwLjIzNiw4MC4xNzcgMTE5LjY4OSw4MC4xNzcgQzExNS45MzEsODAuMTc3IDExMi42MzUsODEuNzA4IDExMS44NTIsODMuODE5IEMxMTEuNjI0LDg0LjQzMiAxMTEuNjIxLDg1LjA1MyAxMTEuODQyLDg1LjY2NyBDMTEzLjM3Nyw4OS45MjUgMTE2LjA1OCw5My45OTMgMTE5LjgxLDk3Ljc1OCBMMTE5LjgyNiw5Ny43NzkgTDEyMC4zNTIsOTguNjE0IEMxMjAuMzU0LDk4LjYxNyAxMjAuMzU2LDk4LjYyIDEyMC4zNTgsOTguNjI0IEwxMjAuNDIyLDk4LjcyNiBMMTIwLjMxNyw5OC43ODcgQzEyMC4yNjQsOTguODE4IDk0LjU5OSwxMTMuNjM1IDk0LjM0LDExMy43ODUgTDk0LjI4MiwxMTMuODE4IEw5NC4yODIsMTEzLjgxOCBaIE03MC40MDEsOTkuNzYxIEw5NC4yODIsMTEzLjU0OSBMMTE5LjA4NCw5OS4yMjkgQzExOS42Myw5OC45MTQgMTE5LjkzLDk4Ljc0IDEyMC4xMDEsOTguNjU0IEwxMTkuNjM1LDk3LjkxNCBDMTE1Ljg2NCw5NC4xMjcgMTEzLjE2OCw5MC4wMzMgMTExLjYyMiw4NS43NDYgQzExMS4zODIsODUuMDc5IDExMS4zODYsODQuNDA0IDExMS42MzMsODMuNzM4IEMxMTIuNDQ4LDgxLjUzOSAxMTUuODM2LDc5Ljk0MyAxMTkuNjg5LDc5Ljk0MyBDMTIwLjI0Niw3OS45NDMgMTIwLjgwNiw3OS45NzYgMTIxLjM1NSw4MC4wNDIgQzEyOC43NjcsODAuOTMzIDEzNS44NDYsODIuNDg3IDE0Mi4zOTYsODQuNjYzIEMxNDMuMjMyLDg0LjgzOCAxNDMuNjExLDg0LjkxNyAxNDMuNzg2LDg0Ljk2NyBMMTY5LjU2Niw3MC4wODMgTDE0NS42ODUsNTYuMjk1IEw3MC40MDEsOTkuNzYxIEw3MC40MDEsOTkuNzYxIFoiIGlkPSJGaWxsLTEyIiBmaWxsPSIjNjA3RDhCIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTE2Ny4yMywxOC45NzkgTDE2Ny4yMyw2OS44NSBMMTM5LjkwOSw4NS42MjMgTDEzMy40NDgsNzEuNDU2IEMxMzIuNTM4LDY5LjQ2IDEzMC4wMiw2OS43MTggMTI3LjgyNCw3Mi4wMyBDMTI2Ljc2OSw3My4xNCAxMjUuOTMxLDc0LjU4NSAxMjUuNDk0LDc2LjA0OCBMMTE5LjAzNCw5Ny42NzYgTDkxLjcxMiwxMTMuNDUgTDkxLjcxMiw2Mi41NzkgTDE2Ny4yMywxOC45NzkiIGlkPSJGaWxsLTEzIiBmaWxsPSIjRkZGRkZGIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTkxLjcxMiwxMTMuNTY3IEM5MS42OTIsMTEzLjU2NyA5MS42NzIsMTEzLjU2MSA5MS42NTMsMTEzLjU1MSBDOTEuNjE4LDExMy41MyA5MS41OTUsMTEzLjQ5MiA5MS41OTUsMTEzLjQ1IEw5MS41OTUsNjIuNTc5IEM5MS41OTUsNjIuNTM3IDkxLjYxOCw2Mi40OTkgOTEuNjUzLDYyLjQ3OCBMMTY3LjE3MiwxOC44NzggQzE2Ny4yMDgsMTguODU3IDE2Ny4yNTIsMTguODU3IDE2Ny4yODgsMTguODc4IEMxNjcuMzI0LDE4Ljg5OSAxNjcuMzQ3LDE4LjkzNyAxNjcuMzQ3LDE4Ljk3OSBMMTY3LjM0Nyw2OS44NSBDMTY3LjM0Nyw2OS44OTEgMTY3LjMyNCw2OS45MyAxNjcuMjg4LDY5Ljk1IEwxMzkuOTY3LDg1LjcyNSBDMTM5LjkzOSw4NS43NDEgMTM5LjkwNSw4NS43NDUgMTM5Ljg3Myw4NS43MzUgQzEzOS44NDIsODUuNzI1IDEzOS44MTYsODUuNzAyIDEzOS44MDIsODUuNjcyIEwxMzMuMzQyLDcxLjUwNCBDMTMyLjk2Nyw3MC42ODIgMTMyLjI4LDcwLjIyOSAxMzEuNDA4LDcwLjIyOSBDMTMwLjMxOSw3MC4yMjkgMTI5LjA0NCw3MC45MTUgMTI3LjkwOCw3Mi4xMSBDMTI2Ljg3NCw3My4yIDEyNi4wMzQsNzQuNjQ3IDEyNS42MDYsNzYuMDgyIEwxMTkuMTQ2LDk3LjcwOSBDMTE5LjEzNyw5Ny43MzggMTE5LjExOCw5Ny43NjIgMTE5LjA5Miw5Ny43NzcgTDkxLjc3LDExMy41NTEgQzkxLjc1MiwxMTMuNTYxIDkxLjczMiwxMTMuNTY3IDkxLjcxMiwxMTMuNTY3IEw5MS43MTIsMTEzLjU2NyBaIE05MS44MjksNjIuNjQ3IEw5MS44MjksMTEzLjI0OCBMMTE4LjkzNSw5Ny41OTggTDEyNS4zODIsNzYuMDE1IEMxMjUuODI3LDc0LjUyNSAxMjYuNjY0LDczLjA4MSAxMjcuNzM5LDcxLjk1IEMxMjguOTE5LDcwLjcwOCAxMzAuMjU2LDY5Ljk5NiAxMzEuNDA4LDY5Ljk5NiBDMTMyLjM3Nyw2OS45OTYgMTMzLjEzOSw3MC40OTcgMTMzLjU1NCw3MS40MDcgTDEzOS45NjEsODUuNDU4IEwxNjcuMTEzLDY5Ljc4MiBMMTY3LjExMywxOS4xODEgTDkxLjgyOSw2Mi42NDcgTDkxLjgyOSw2Mi42NDcgWiIgaWQ9IkZpbGwtMTQiIGZpbGw9IiM2MDdEOEIiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTY4LjU0MywxOS4yMTMgTDE2OC41NDMsNzAuMDgzIEwxNDEuMjIxLDg1Ljg1NyBMMTM0Ljc2MSw3MS42ODkgQzEzMy44NTEsNjkuNjk0IDEzMS4zMzMsNjkuOTUxIDEyOS4xMzcsNzIuMjYzIEMxMjguMDgyLDczLjM3NCAxMjcuMjQ0LDc0LjgxOSAxMjYuODA3LDc2LjI4MiBMMTIwLjM0Niw5Ny45MDkgTDkzLjAyNSwxMTMuNjgzIEw5My4wMjUsNjIuODEzIEwxNjguNTQzLDE5LjIxMyIgaWQ9IkZpbGwtMTUiIGZpbGw9IiNGRkZGRkYiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNOTMuMDI1LDExMy44IEM5My4wMDUsMTEzLjggOTIuOTg0LDExMy43OTUgOTIuOTY2LDExMy43ODUgQzkyLjkzMSwxMTMuNzY0IDkyLjkwOCwxMTMuNzI1IDkyLjkwOCwxMTMuNjg0IEw5Mi45MDgsNjIuODEzIEM5Mi45MDgsNjIuNzcxIDkyLjkzMSw2Mi43MzMgOTIuOTY2LDYyLjcxMiBMMTY4LjQ4NCwxOS4xMTIgQzE2OC41MiwxOS4wOSAxNjguNTY1LDE5LjA5IDE2OC42MDEsMTkuMTEyIEMxNjguNjM3LDE5LjEzMiAxNjguNjYsMTkuMTcxIDE2OC42NiwxOS4yMTIgTDE2OC42Niw3MC4wODMgQzE2OC42Niw3MC4xMjUgMTY4LjYzNyw3MC4xNjQgMTY4LjYwMSw3MC4xODQgTDE0MS4yOCw4NS45NTggQzE0MS4yNTEsODUuOTc1IDE0MS4yMTcsODUuOTc5IDE0MS4xODYsODUuOTY4IEMxNDEuMTU0LDg1Ljk1OCAxNDEuMTI5LDg1LjkzNiAxNDEuMTE1LDg1LjkwNiBMMTM0LjY1NSw3MS43MzggQzEzNC4yOCw3MC45MTUgMTMzLjU5Myw3MC40NjMgMTMyLjcyLDcwLjQ2MyBDMTMxLjYzMiw3MC40NjMgMTMwLjM1Nyw3MS4xNDggMTI5LjIyMSw3Mi4zNDQgQzEyOC4xODYsNzMuNDMzIDEyNy4zNDcsNzQuODgxIDEyNi45MTksNzYuMzE1IEwxMjAuNDU4LDk3Ljk0MyBDMTIwLjQ1LDk3Ljk3MiAxMjAuNDMxLDk3Ljk5NiAxMjAuNDA1LDk4LjAxIEw5My4wODMsMTEzLjc4NSBDOTMuMDY1LDExMy43OTUgOTMuMDQ1LDExMy44IDkzLjAyNSwxMTMuOCBMOTMuMDI1LDExMy44IFogTTkzLjE0Miw2Mi44ODEgTDkzLjE0MiwxMTMuNDgxIEwxMjAuMjQ4LDk3LjgzMiBMMTI2LjY5NSw3Ni4yNDggQzEyNy4xNCw3NC43NTggMTI3Ljk3Nyw3My4zMTUgMTI5LjA1Miw3Mi4xODMgQzEzMC4yMzEsNzAuOTQyIDEzMS41NjgsNzAuMjI5IDEzMi43Miw3MC4yMjkgQzEzMy42ODksNzAuMjI5IDEzNC40NTIsNzAuNzMxIDEzNC44NjcsNzEuNjQxIEwxNDEuMjc0LDg1LjY5MiBMMTY4LjQyNiw3MC4wMTYgTDE2OC40MjYsMTkuNDE1IEw5My4xNDIsNjIuODgxIEw5My4xNDIsNjIuODgxIFoiIGlkPSJGaWxsLTE2IiBmaWxsPSIjNjA3RDhCIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTE2OS44LDcwLjA4MyBMMTQyLjQ3OCw4NS44NTcgTDEzNi4wMTgsNzEuNjg5IEMxMzUuMTA4LDY5LjY5NCAxMzIuNTksNjkuOTUxIDEzMC4zOTMsNzIuMjYzIEMxMjkuMzM5LDczLjM3NCAxMjguNSw3NC44MTkgMTI4LjA2NCw3Ni4yODIgTDEyMS42MDMsOTcuOTA5IEw5NC4yODIsMTEzLjY4MyBMOTQuMjgyLDYyLjgxMyBMMTY5LjgsMTkuMjEzIEwxNjkuOCw3MC4wODMgWiIgaWQ9IkZpbGwtMTciIGZpbGw9IiNGQUZBRkEiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNOTQuMjgyLDExMy45MTcgQzk0LjI0MSwxMTMuOTE3IDk0LjIwMSwxMTMuOTA3IDk0LjE2NSwxMTMuODg2IEM5NC4wOTMsMTEzLjg0NSA5NC4wNDgsMTEzLjc2NyA5NC4wNDgsMTEzLjY4NCBMOTQuMDQ4LDYyLjgxMyBDOTQuMDQ4LDYyLjczIDk0LjA5Myw2Mi42NTIgOTQuMTY1LDYyLjYxMSBMMTY5LjY4MywxOS4wMSBDMTY5Ljc1NSwxOC45NjkgMTY5Ljg0NCwxOC45NjkgMTY5LjkxNywxOS4wMSBDMTY5Ljk4OSwxOS4wNTIgMTcwLjAzMywxOS4xMjkgMTcwLjAzMywxOS4yMTIgTDE3MC4wMzMsNzAuMDgzIEMxNzAuMDMzLDcwLjE2NiAxNjkuOTg5LDcwLjI0NCAxNjkuOTE3LDcwLjI4NSBMMTQyLjU5NSw4Ni4wNiBDMTQyLjUzOCw4Ni4wOTIgMTQyLjQ2OSw4Ni4xIDE0Mi40MDcsODYuMDggQzE0Mi4zNDQsODYuMDYgMTQyLjI5Myw4Ni4wMTQgMTQyLjI2Niw4NS45NTQgTDEzNS44MDUsNzEuNzg2IEMxMzUuNDQ1LDcwLjk5NyAxMzQuODEzLDcwLjU4IDEzMy45NzcsNzAuNTggQzEzMi45MjEsNzAuNTggMTMxLjY3Niw3MS4yNTIgMTMwLjU2Miw3Mi40MjQgQzEyOS41NCw3My41MDEgMTI4LjcxMSw3NC45MzEgMTI4LjI4Nyw3Ni4zNDggTDEyMS44MjcsOTcuOTc2IEMxMjEuODEsOTguMDM0IDEyMS43NzEsOTguMDgyIDEyMS43Miw5OC4xMTIgTDk0LjM5OCwxMTMuODg2IEM5NC4zNjIsMTEzLjkwNyA5NC4zMjIsMTEzLjkxNyA5NC4yODIsMTEzLjkxNyBMOTQuMjgyLDExMy45MTcgWiBNOTQuNTE1LDYyLjk0OCBMOTQuNTE1LDExMy4yNzkgTDEyMS40MDYsOTcuNzU0IEwxMjcuODQsNzYuMjE1IEMxMjguMjksNzQuNzA4IDEyOS4xMzcsNzMuMjQ3IDEzMC4yMjQsNzIuMTAzIEMxMzEuNDI1LDcwLjgzOCAxMzIuNzkzLDcwLjExMiAxMzMuOTc3LDcwLjExMiBDMTM0Ljk5NSw3MC4xMTIgMTM1Ljc5NSw3MC42MzggMTM2LjIzLDcxLjU5MiBMMTQyLjU4NCw4NS41MjYgTDE2OS41NjYsNjkuOTQ4IEwxNjkuNTY2LDE5LjYxNyBMOTQuNTE1LDYyLjk0OCBMOTQuNTE1LDYyLjk0OCBaIiBpZD0iRmlsbC0xOCIgZmlsbD0iIzYwN0Q4QiI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0xMDkuODk0LDkyLjk0MyBMMTA5Ljg5NCw5Mi45NDMgQzEwOC4xMiw5Mi45NDMgMTA2LjY1Myw5Mi4yMTggMTA1LjY1LDkwLjgyMyBDMTA1LjU4Myw5MC43MzEgMTA1LjU5Myw5MC42MSAxMDUuNjczLDkwLjUyOSBDMTA1Ljc1Myw5MC40NDggMTA1Ljg4LDkwLjQ0IDEwNS45NzQsOTAuNTA2IEMxMDYuNzU0LDkxLjA1MyAxMDcuNjc5LDkxLjMzMyAxMDguNzI0LDkxLjMzMyBDMTEwLjA0Nyw5MS4zMzMgMTExLjQ3OCw5MC44OTQgMTEyLjk4LDkwLjAyNyBDMTE4LjI5MSw4Ni45NiAxMjIuNjExLDc5LjUwOSAxMjIuNjExLDczLjQxNiBDMTIyLjYxMSw3MS40ODkgMTIyLjE2OSw2OS44NTYgMTIxLjMzMyw2OC42OTIgQzEyMS4yNjYsNjguNiAxMjEuMjc2LDY4LjQ3MyAxMjEuMzU2LDY4LjM5MiBDMTIxLjQzNiw2OC4zMTEgMTIxLjU2Myw2OC4yOTkgMTIxLjY1Niw2OC4zNjUgQzEyMy4zMjcsNjkuNTM3IDEyNC4yNDcsNzEuNzQ2IDEyNC4yNDcsNzQuNTg0IEMxMjQuMjQ3LDgwLjgyNiAxMTkuODIxLDg4LjQ0NyAxMTQuMzgyLDkxLjU4NyBDMTEyLjgwOCw5Mi40OTUgMTExLjI5OCw5Mi45NDMgMTA5Ljg5NCw5Mi45NDMgTDEwOS44OTQsOTIuOTQzIFogTTEwNi45MjUsOTEuNDAxIEMxMDcuNzM4LDkyLjA1MiAxMDguNzQ1LDkyLjI3OCAxMDkuODkzLDkyLjI3OCBMMTA5Ljg5NCw5Mi4yNzggQzExMS4yMTUsOTIuMjc4IDExMi42NDcsOTEuOTUxIDExNC4xNDgsOTEuMDg0IEMxMTkuNDU5LDg4LjAxNyAxMjMuNzgsODAuNjIxIDEyMy43OCw3NC41MjggQzEyMy43OCw3Mi41NDkgMTIzLjMxNyw3MC45MjkgMTIyLjQ1NCw2OS43NjcgQzEyMi44NjUsNzAuODAyIDEyMy4wNzksNzIuMDQyIDEyMy4wNzksNzMuNDAyIEMxMjMuMDc5LDc5LjY0NSAxMTguNjUzLDg3LjI4NSAxMTMuMjE0LDkwLjQyNSBDMTExLjY0LDkxLjMzNCAxMTAuMTMsOTEuNzQyIDEwOC43MjQsOTEuNzQyIEMxMDguMDgzLDkxLjc0MiAxMDcuNDgxLDkxLjU5MyAxMDYuOTI1LDkxLjQwMSBMMTA2LjkyNSw5MS40MDEgWiIgaWQ9IkZpbGwtMTkiIGZpbGw9IiM2MDdEOEIiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTEzLjA5Nyw5MC4yMyBDMTE4LjQ4MSw4Ny4xMjIgMTIyLjg0NSw3OS41OTQgMTIyLjg0NSw3My40MTYgQzEyMi44NDUsNzEuMzY1IDEyMi4zNjIsNjkuNzI0IDEyMS41MjIsNjguNTU2IEMxMTkuNzM4LDY3LjMwNCAxMTcuMTQ4LDY3LjM2MiAxMTQuMjY1LDY5LjAyNiBDMTA4Ljg4MSw3Mi4xMzQgMTA0LjUxNyw3OS42NjIgMTA0LjUxNyw4NS44NCBDMTA0LjUxNyw4Ny44OTEgMTA1LDg5LjUzMiAxMDUuODQsOTAuNyBDMTA3LjYyNCw5MS45NTIgMTEwLjIxNCw5MS44OTQgMTEzLjA5Nyw5MC4yMyIgaWQ9IkZpbGwtMjAiIGZpbGw9IiNGQUZBRkEiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTA4LjcyNCw5MS42MTQgTDEwOC43MjQsOTEuNjE0IEMxMDcuNTgyLDkxLjYxNCAxMDYuNTY2LDkxLjQwMSAxMDUuNzA1LDkwLjc5NyBDMTA1LjY4NCw5MC43ODMgMTA1LjY2NSw5MC44MTEgMTA1LjY1LDkwLjc5IEMxMDQuNzU2LDg5LjU0NiAxMDQuMjgzLDg3Ljg0MiAxMDQuMjgzLDg1LjgxNyBDMTA0LjI4Myw3OS41NzUgMTA4LjcwOSw3MS45NTMgMTE0LjE0OCw2OC44MTIgQzExNS43MjIsNjcuOTA0IDExNy4yMzIsNjcuNDQ5IDExOC42MzgsNjcuNDQ5IEMxMTkuNzgsNjcuNDQ5IDEyMC43OTYsNjcuNzU4IDEyMS42NTYsNjguMzYyIEMxMjEuNjc4LDY4LjM3NyAxMjEuNjk3LDY4LjM5NyAxMjEuNzEyLDY4LjQxOCBDMTIyLjYwNiw2OS42NjIgMTIzLjA3OSw3MS4zOSAxMjMuMDc5LDczLjQxNSBDMTIzLjA3OSw3OS42NTggMTE4LjY1Myw4Ny4xOTggMTEzLjIxNCw5MC4zMzggQzExMS42NCw5MS4yNDcgMTEwLjEzLDkxLjYxNCAxMDguNzI0LDkxLjYxNCBMMTA4LjcyNCw5MS42MTQgWiBNMTA2LjAwNiw5MC41MDUgQzEwNi43OCw5MS4wMzcgMTA3LjY5NCw5MS4yODEgMTA4LjcyNCw5MS4yODEgQzExMC4wNDcsOTEuMjgxIDExMS40NzgsOTAuODY4IDExMi45OCw5MC4wMDEgQzExOC4yOTEsODYuOTM1IDEyMi42MTEsNzkuNDk2IDEyMi42MTEsNzMuNDAzIEMxMjIuNjExLDcxLjQ5NCAxMjIuMTc3LDY5Ljg4IDEyMS4zNTYsNjguNzE4IEMxMjAuNTgyLDY4LjE4NSAxMTkuNjY4LDY3LjkxOSAxMTguNjM4LDY3LjkxOSBDMTE3LjMxNSw2Ny45MTkgMTE1Ljg4Myw2OC4zNiAxMTQuMzgyLDY5LjIyNyBDMTA5LjA3MSw3Mi4yOTMgMTA0Ljc1MSw3OS43MzMgMTA0Ljc1MSw4NS44MjYgQzEwNC43NTEsODcuNzM1IDEwNS4xODUsODkuMzQzIDEwNi4wMDYsOTAuNTA1IEwxMDYuMDA2LDkwLjUwNSBaIiBpZD0iRmlsbC0yMSIgZmlsbD0iIzYwN0Q4QiI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0xNDkuMzE4LDcuMjYyIEwxMzkuMzM0LDE2LjE0IEwxNTUuMjI3LDI3LjE3MSBMMTYwLjgxNiwyMS4wNTkgTDE0OS4zMTgsNy4yNjIiIGlkPSJGaWxsLTIyIiBmaWxsPSIjRkFGQUZBIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTE2OS42NzYsMTMuODQgTDE1OS45MjgsMTkuNDY3IEMxNTYuMjg2LDIxLjU3IDE1MC40LDIxLjU4IDE0Ni43ODEsMTkuNDkxIEMxNDMuMTYxLDE3LjQwMiAxNDMuMTgsMTQuMDAzIDE0Ni44MjIsMTEuOSBMMTU2LjMxNyw2LjI5MiBMMTQ5LjU4OCwyLjQwNyBMNjcuNzUyLDQ5LjQ3OCBMMTEzLjY3NSw3NS45OTIgTDExNi43NTYsNzQuMjEzIEMxMTcuMzg3LDczLjg0OCAxMTcuNjI1LDczLjMxNSAxMTcuMzc0LDcyLjgyMyBDMTE1LjAxNyw2OC4xOTEgMTE0Ljc4MSw2My4yNzcgMTE2LjY5MSw1OC41NjEgQzEyMi4zMjksNDQuNjQxIDE0MS4yLDMzLjc0NiAxNjUuMzA5LDMwLjQ5MSBDMTczLjQ3OCwyOS4zODggMTgxLjk4OSwyOS41MjQgMTkwLjAxMywzMC44ODUgQzE5MC44NjUsMzEuMDMgMTkxLjc4OSwzMC44OTMgMTkyLjQyLDMwLjUyOCBMMTk1LjUwMSwyOC43NSBMMTY5LjY3NiwxMy44NCIgaWQ9IkZpbGwtMjMiIGZpbGw9IiNGQUZBRkEiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTEzLjY3NSw3Ni40NTkgQzExMy41OTQsNzYuNDU5IDExMy41MTQsNzYuNDM4IDExMy40NDIsNzYuMzk3IEw2Ny41MTgsNDkuODgyIEM2Ny4zNzQsNDkuNzk5IDY3LjI4NCw0OS42NDUgNjcuMjg1LDQ5LjQ3OCBDNjcuMjg1LDQ5LjMxMSA2Ny4zNzQsNDkuMTU3IDY3LjUxOSw0OS4wNzMgTDE0OS4zNTUsMi4wMDIgQzE0OS40OTksMS45MTkgMTQ5LjY3NywxLjkxOSAxNDkuODIxLDIuMDAyIEwxNTYuNTUsNS44ODcgQzE1Ni43NzQsNi4wMTcgMTU2Ljg1LDYuMzAyIDE1Ni43MjIsNi41MjYgQzE1Ni41OTIsNi43NDkgMTU2LjMwNyw2LjgyNiAxNTYuMDgzLDYuNjk2IEwxNDkuNTg3LDIuOTQ2IEw2OC42ODcsNDkuNDc5IEwxMTMuNjc1LDc1LjQ1MiBMMTE2LjUyMyw3My44MDggQzExNi43MTUsNzMuNjk3IDExNy4xNDMsNzMuMzk5IDExNi45NTgsNzMuMDM1IEMxMTQuNTQyLDY4LjI4NyAxMTQuMyw2My4yMjEgMTE2LjI1OCw1OC4zODUgQzExOS4wNjQsNTEuNDU4IDEyNS4xNDMsNDUuMTQzIDEzMy44NCw0MC4xMjIgQzE0Mi40OTcsMzUuMTI0IDE1My4zNTgsMzEuNjMzIDE2NS4yNDcsMzAuMDI4IEMxNzMuNDQ1LDI4LjkyMSAxODIuMDM3LDI5LjA1OCAxOTAuMDkxLDMwLjQyNSBDMTkwLjgzLDMwLjU1IDE5MS42NTIsMzAuNDMyIDE5Mi4xODYsMzAuMTI0IEwxOTQuNTY3LDI4Ljc1IEwxNjkuNDQyLDE0LjI0NCBDMTY5LjIxOSwxNC4xMTUgMTY5LjE0MiwxMy44MjkgMTY5LjI3MSwxMy42MDYgQzE2OS40LDEzLjM4MiAxNjkuNjg1LDEzLjMwNiAxNjkuOTA5LDEzLjQzNSBMMTk1LjczNCwyOC4zNDUgQzE5NS44NzksMjguNDI4IDE5NS45NjgsMjguNTgzIDE5NS45NjgsMjguNzUgQzE5NS45NjgsMjguOTE2IDE5NS44NzksMjkuMDcxIDE5NS43MzQsMjkuMTU0IEwxOTIuNjUzLDMwLjkzMyBDMTkxLjkzMiwzMS4zNSAxOTAuODksMzEuNTA4IDE4OS45MzUsMzEuMzQ2IEMxODEuOTcyLDI5Ljk5NSAxNzMuNDc4LDI5Ljg2IDE2NS4zNzIsMzAuOTU0IEMxNTMuNjAyLDMyLjU0MyAxNDIuODYsMzUuOTkzIDEzNC4zMDcsNDAuOTMxIEMxMjUuNzkzLDQ1Ljg0NyAxMTkuODUxLDUyLjAwNCAxMTcuMTI0LDU4LjczNiBDMTE1LjI3LDYzLjMxNCAxMTUuNTAxLDY4LjExMiAxMTcuNzksNzIuNjExIEMxMTguMTYsNzMuMzM2IDExNy44NDUsNzQuMTI0IDExNi45OSw3NC42MTcgTDExMy45MDksNzYuMzk3IEMxMTMuODM2LDc2LjQzOCAxMTMuNzU2LDc2LjQ1OSAxMTMuNjc1LDc2LjQ1OSIgaWQ9IkZpbGwtMjQiIGZpbGw9IiM0NTVBNjQiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTUzLjMxNiwyMS4yNzkgQzE1MC45MDMsMjEuMjc5IDE0OC40OTUsMjAuNzUxIDE0Ni42NjQsMTkuNjkzIEMxNDQuODQ2LDE4LjY0NCAxNDMuODQ0LDE3LjIzMiAxNDMuODQ0LDE1LjcxOCBDMTQzLjg0NCwxNC4xOTEgMTQ0Ljg2LDEyLjc2MyAxNDYuNzA1LDExLjY5OCBMMTU2LjE5OCw2LjA5MSBDMTU2LjMwOSw2LjAyNSAxNTYuNDUyLDYuMDYyIDE1Ni41MTgsNi4xNzMgQzE1Ni41ODMsNi4yODQgMTU2LjU0Nyw2LjQyNyAxNTYuNDM2LDYuNDkzIEwxNDYuOTQsMTIuMTAyIEMxNDUuMjQ0LDEzLjA4MSAxNDQuMzEyLDE0LjM2NSAxNDQuMzEyLDE1LjcxOCBDMTQ0LjMxMiwxNy4wNTggMTQ1LjIzLDE4LjMyNiAxNDYuODk3LDE5LjI4OSBDMTUwLjQ0NiwyMS4zMzggMTU2LjI0LDIxLjMyNyAxNTkuODExLDE5LjI2NSBMMTY5LjU1OSwxMy42MzcgQzE2OS42NywxMy41NzMgMTY5LjgxMywxMy42MTEgMTY5Ljg3OCwxMy43MjMgQzE2OS45NDMsMTMuODM0IDE2OS45MDQsMTMuOTc3IDE2OS43OTMsMTQuMDQyIEwxNjAuMDQ1LDE5LjY3IEMxNTguMTg3LDIwLjc0MiAxNTUuNzQ5LDIxLjI3OSAxNTMuMzE2LDIxLjI3OSIgaWQ9IkZpbGwtMjUiIGZpbGw9IiM2MDdEOEIiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTEzLjY3NSw3NS45OTIgTDY3Ljc2Miw0OS40ODQiIGlkPSJGaWxsLTI2IiBmaWxsPSIjNDU1QTY0Ij48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTExMy42NzUsNzYuMzQyIEMxMTMuNjE1LDc2LjM0MiAxMTMuNTU1LDc2LjMyNyAxMTMuNSw3Ni4yOTUgTDY3LjU4Nyw0OS43ODcgQzY3LjQxOSw0OS42OSA2Ny4zNjIsNDkuNDc2IDY3LjQ1OSw0OS4zMDkgQzY3LjU1Niw0OS4xNDEgNjcuNzcsNDkuMDgzIDY3LjkzNyw0OS4xOCBMMTEzLjg1LDc1LjY4OCBDMTE0LjAxOCw3NS43ODUgMTE0LjA3NSw3NiAxMTMuOTc4LDc2LjE2NyBDMTEzLjkxNCw3Ni4yNzkgMTEzLjc5Niw3Ni4zNDIgMTEzLjY3NSw3Ni4zNDIiIGlkPSJGaWxsLTI3IiBmaWxsPSIjNDU1QTY0Ij48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTY3Ljc2Miw0OS40ODQgTDY3Ljc2MiwxMDMuNDg1IEM2Ny43NjIsMTA0LjU3NSA2OC41MzIsMTA1LjkwMyA2OS40ODIsMTA2LjQ1MiBMMTExLjk1NSwxMzAuOTczIEMxMTIuOTA1LDEzMS41MjIgMTEzLjY3NSwxMzEuMDgzIDExMy42NzUsMTI5Ljk5MyBMMTEzLjY3NSw3NS45OTIiIGlkPSJGaWxsLTI4IiBmaWxsPSIjRkFGQUZBIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTExMi43MjcsMTMxLjU2MSBDMTEyLjQzLDEzMS41NjEgMTEyLjEwNywxMzEuNDY2IDExMS43OCwxMzEuMjc2IEw2OS4zMDcsMTA2Ljc1NSBDNjguMjQ0LDEwNi4xNDIgNjcuNDEyLDEwNC43MDUgNjcuNDEyLDEwMy40ODUgTDY3LjQxMiw0OS40ODQgQzY3LjQxMiw0OS4yOSA2Ny41NjksNDkuMTM0IDY3Ljc2Miw0OS4xMzQgQzY3Ljk1Niw0OS4xMzQgNjguMTEzLDQ5LjI5IDY4LjExMyw0OS40ODQgTDY4LjExMywxMDMuNDg1IEM2OC4xMTMsMTA0LjQ0NSA2OC44MiwxMDUuNjY1IDY5LjY1NywxMDYuMTQ4IEwxMTIuMTMsMTMwLjY3IEMxMTIuNDc0LDEzMC44NjggMTEyLjc5MSwxMzAuOTEzIDExMywxMzAuNzkyIEMxMTMuMjA2LDEzMC42NzMgMTEzLjMyNSwxMzAuMzgxIDExMy4zMjUsMTI5Ljk5MyBMMTEzLjMyNSw3NS45OTIgQzExMy4zMjUsNzUuNzk4IDExMy40ODIsNzUuNjQxIDExMy42NzUsNzUuNjQxIEMxMTMuODY5LDc1LjY0MSAxMTQuMDI1LDc1Ljc5OCAxMTQuMDI1LDc1Ljk5MiBMMTE0LjAyNSwxMjkuOTkzIEMxMTQuMDI1LDEzMC42NDggMTEzLjc4NiwxMzEuMTQ3IDExMy4zNSwxMzEuMzk5IEMxMTMuMTYyLDEzMS41MDcgMTEyLjk1MiwxMzEuNTYxIDExMi43MjcsMTMxLjU2MSIgaWQ9IkZpbGwtMjkiIGZpbGw9IiM0NTVBNjQiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTEyLjg2LDQwLjUxMiBDMTEyLjg2LDQwLjUxMiAxMTIuODYsNDAuNTEyIDExMi44NTksNDAuNTEyIEMxMTAuNTQxLDQwLjUxMiAxMDguMzYsMzkuOTkgMTA2LjcxNywzOS4wNDEgQzEwNS4wMTIsMzguMDU3IDEwNC4wNzQsMzYuNzI2IDEwNC4wNzQsMzUuMjkyIEMxMDQuMDc0LDMzLjg0NyAxMDUuMDI2LDMyLjUwMSAxMDYuNzU0LDMxLjUwNCBMMTE4Ljc5NSwyNC41NTEgQzEyMC40NjMsMjMuNTg5IDEyMi42NjksMjMuMDU4IDEyNS4wMDcsMjMuMDU4IEMxMjcuMzI1LDIzLjA1OCAxMjkuNTA2LDIzLjU4MSAxMzEuMTUsMjQuNTMgQzEzMi44NTQsMjUuNTE0IDEzMy43OTMsMjYuODQ1IDEzMy43OTMsMjguMjc4IEMxMzMuNzkzLDI5LjcyNCAxMzIuODQxLDMxLjA2OSAxMzEuMTEzLDMyLjA2NyBMMTE5LjA3MSwzOS4wMTkgQzExNy40MDMsMzkuOTgyIDExNS4xOTcsNDAuNTEyIDExMi44Niw0MC41MTIgTDExMi44Niw0MC41MTIgWiBNMTI1LjAwNywyMy43NTkgQzEyMi43OSwyMy43NTkgMTIwLjcwOSwyNC4yNTYgMTE5LjE0NiwyNS4xNTggTDEwNy4xMDQsMzIuMTEgQzEwNS42MDIsMzIuOTc4IDEwNC43NzQsMzQuMTA4IDEwNC43NzQsMzUuMjkyIEMxMDQuNzc0LDM2LjQ2NSAxMDUuNTg5LDM3LjU4MSAxMDcuMDY3LDM4LjQzNCBDMTA4LjYwNSwzOS4zMjMgMTEwLjY2MywzOS44MTIgMTEyLjg1OSwzOS44MTIgTDExMi44NiwzOS44MTIgQzExNS4wNzYsMzkuODEyIDExNy4xNTgsMzkuMzE1IDExOC43MjEsMzguNDEzIEwxMzAuNzYyLDMxLjQ2IEMxMzIuMjY0LDMwLjU5MyAxMzMuMDkyLDI5LjQ2MyAxMzMuMDkyLDI4LjI3OCBDMTMzLjA5MiwyNy4xMDYgMTMyLjI3OCwyNS45OSAxMzAuOCwyNS4xMzYgQzEyOS4yNjEsMjQuMjQ4IDEyNy4yMDQsMjMuNzU5IDEyNS4wMDcsMjMuNzU5IEwxMjUuMDA3LDIzLjc1OSBaIiBpZD0iRmlsbC0zMCIgZmlsbD0iIzYwN0Q4QiI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0xNjUuNjMsMTYuMjE5IEwxNTkuODk2LDE5LjUzIEMxNTYuNzI5LDIxLjM1OCAxNTEuNjEsMjEuMzY3IDE0OC40NjMsMTkuNTUgQzE0NS4zMTYsMTcuNzMzIDE0NS4zMzIsMTQuNzc4IDE0OC40OTksMTIuOTQ5IEwxNTQuMjMzLDkuNjM5IEwxNjUuNjMsMTYuMjE5IiBpZD0iRmlsbC0zMSIgZmlsbD0iI0ZBRkFGQSI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0xNTQuMjMzLDEwLjQ0OCBMMTY0LjIyOCwxNi4yMTkgTDE1OS41NDYsMTguOTIzIEMxNTguMTEyLDE5Ljc1IDE1Ni4xOTQsMjAuMjA2IDE1NC4xNDcsMjAuMjA2IEMxNTIuMTE4LDIwLjIwNiAxNTAuMjI0LDE5Ljc1NyAxNDguODE0LDE4Ljk0MyBDMTQ3LjUyNCwxOC4xOTkgMTQ2LjgxNCwxNy4yNDkgMTQ2LjgxNCwxNi4yNjkgQzE0Ni44MTQsMTUuMjc4IDE0Ny41MzcsMTQuMzE0IDE0OC44NSwxMy41NTYgTDE1NC4yMzMsMTAuNDQ4IE0xNTQuMjMzLDkuNjM5IEwxNDguNDk5LDEyLjk0OSBDMTQ1LjMzMiwxNC43NzggMTQ1LjMxNiwxNy43MzMgMTQ4LjQ2MywxOS41NSBDMTUwLjAzMSwyMC40NTUgMTUyLjA4NiwyMC45MDcgMTU0LjE0NywyMC45MDcgQzE1Ni4yMjQsMjAuOTA3IDE1OC4zMDYsMjAuNDQ3IDE1OS44OTYsMTkuNTMgTDE2NS42MywxNi4yMTkgTDE1NC4yMzMsOS42MzkiIGlkPSJGaWxsLTMyIiBmaWxsPSIjNjA3RDhCIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTE0NS40NDUsNzIuNjY3IEwxNDUuNDQ1LDcyLjY2NyBDMTQzLjY3Miw3Mi42NjcgMTQyLjIwNCw3MS44MTcgMTQxLjIwMiw3MC40MjIgQzE0MS4xMzUsNzAuMzMgMTQxLjE0NSw3MC4xNDcgMTQxLjIyNSw3MC4wNjYgQzE0MS4zMDUsNjkuOTg1IDE0MS40MzIsNjkuOTQ2IDE0MS41MjUsNzAuMDExIEMxNDIuMzA2LDcwLjU1OSAxNDMuMjMxLDcwLjgyMyAxNDQuMjc2LDcwLjgyMiBDMTQ1LjU5OCw3MC44MjIgMTQ3LjAzLDcwLjM3NiAxNDguNTMyLDY5LjUwOSBDMTUzLjg0Miw2Ni40NDMgMTU4LjE2Myw1OC45ODcgMTU4LjE2Myw1Mi44OTQgQzE1OC4xNjMsNTAuOTY3IDE1Ny43MjEsNDkuMzMyIDE1Ni44ODQsNDguMTY4IEMxNTYuODE4LDQ4LjA3NiAxNTYuODI4LDQ3Ljk0OCAxNTYuOTA4LDQ3Ljg2NyBDMTU2Ljk4OCw0Ny43ODYgMTU3LjExNCw0Ny43NzQgMTU3LjIwOCw0Ny44NCBDMTU4Ljg3OCw0OS4wMTIgMTU5Ljc5OCw1MS4yMiAxNTkuNzk4LDU0LjA1OSBDMTU5Ljc5OCw2MC4zMDEgMTU1LjM3Myw2OC4wNDYgMTQ5LjkzMyw3MS4xODYgQzE0OC4zNiw3Mi4wOTQgMTQ2Ljg1LDcyLjY2NyAxNDUuNDQ1LDcyLjY2NyBMMTQ1LjQ0NSw3Mi42NjcgWiBNMTQyLjQ3Niw3MSBDMTQzLjI5LDcxLjY1MSAxNDQuMjk2LDcyLjAwMiAxNDUuNDQ1LDcyLjAwMiBDMTQ2Ljc2Nyw3Mi4wMDIgMTQ4LjE5OCw3MS41NSAxNDkuNyw3MC42ODIgQzE1NS4wMSw2Ny42MTcgMTU5LjMzMSw2MC4xNTkgMTU5LjMzMSw1NC4wNjUgQzE1OS4zMzEsNTIuMDg1IDE1OC44NjgsNTAuNDM1IDE1OC4wMDYsNDkuMjcyIEMxNTguNDE3LDUwLjMwNyAxNTguNjMsNTEuNTMyIDE1OC42Myw1Mi44OTIgQzE1OC42Myw1OS4xMzQgMTU0LjIwNSw2Ni43NjcgMTQ4Ljc2NSw2OS45MDcgQzE0Ny4xOTIsNzAuODE2IDE0NS42ODEsNzEuMjgzIDE0NC4yNzYsNzEuMjgzIEMxNDMuNjM0LDcxLjI4MyAxNDMuMDMzLDcxLjE5MiAxNDIuNDc2LDcxIEwxNDIuNDc2LDcxIFoiIGlkPSJGaWxsLTMzIiBmaWxsPSIjNjA3RDhCIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTE0OC42NDgsNjkuNzA0IEMxNTQuMDMyLDY2LjU5NiAxNTguMzk2LDU5LjA2OCAxNTguMzk2LDUyLjg5MSBDMTU4LjM5Niw1MC44MzkgMTU3LjkxMyw0OS4xOTggMTU3LjA3NCw0OC4wMyBDMTU1LjI4OSw0Ni43NzggMTUyLjY5OSw0Ni44MzYgMTQ5LjgxNiw0OC41MDEgQzE0NC40MzMsNTEuNjA5IDE0MC4wNjgsNTkuMTM3IDE0MC4wNjgsNjUuMzE0IEMxNDAuMDY4LDY3LjM2NSAxNDAuNTUyLDY5LjAwNiAxNDEuMzkxLDcwLjE3NCBDMTQzLjE3Niw3MS40MjcgMTQ1Ljc2NSw3MS4zNjkgMTQ4LjY0OCw2OS43MDQiIGlkPSJGaWxsLTM0IiBmaWxsPSIjRkFGQUZBIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTE0NC4yNzYsNzEuMjc2IEwxNDQuMjc2LDcxLjI3NiBDMTQzLjEzMyw3MS4yNzYgMTQyLjExOCw3MC45NjkgMTQxLjI1Nyw3MC4zNjUgQzE0MS4yMzYsNzAuMzUxIDE0MS4yMTcsNzAuMzMyIDE0MS4yMDIsNzAuMzExIEMxNDAuMzA3LDY5LjA2NyAxMzkuODM1LDY3LjMzOSAxMzkuODM1LDY1LjMxNCBDMTM5LjgzNSw1OS4wNzMgMTQ0LjI2LDUxLjQzOSAxNDkuNyw0OC4yOTggQzE1MS4yNzMsNDcuMzkgMTUyLjc4NCw0Ni45MjkgMTU0LjE4OSw0Ni45MjkgQzE1NS4zMzIsNDYuOTI5IDE1Ni4zNDcsNDcuMjM2IDE1Ny4yMDgsNDcuODM5IEMxNTcuMjI5LDQ3Ljg1NCAxNTcuMjQ4LDQ3Ljg3MyAxNTcuMjYzLDQ3Ljg5NCBDMTU4LjE1Nyw0OS4xMzggMTU4LjYzLDUwLjg2NSAxNTguNjMsNTIuODkxIEMxNTguNjMsNTkuMTMyIDE1NC4yMDUsNjYuNzY2IDE0OC43NjUsNjkuOTA3IEMxNDcuMTkyLDcwLjgxNSAxNDUuNjgxLDcxLjI3NiAxNDQuMjc2LDcxLjI3NiBMMTQ0LjI3Niw3MS4yNzYgWiBNMTQxLjU1OCw3MC4xMDQgQzE0Mi4zMzEsNzAuNjM3IDE0My4yNDUsNzEuMDA1IDE0NC4yNzYsNzEuMDA1IEMxNDUuNTk4LDcxLjAwNSAxNDcuMDMsNzAuNDY3IDE0OC41MzIsNjkuNiBDMTUzLjg0Miw2Ni41MzQgMTU4LjE2Myw1OS4wMzMgMTU4LjE2Myw1Mi45MzkgQzE1OC4xNjMsNTEuMDMxIDE1Ny43MjksNDkuMzg1IDE1Ni45MDcsNDguMjIzIEMxNTYuMTMzLDQ3LjY5MSAxNTUuMjE5LDQ3LjQwOSAxNTQuMTg5LDQ3LjQwOSBDMTUyLjg2Nyw0Ny40MDkgMTUxLjQzNSw0Ny44NDIgMTQ5LjkzMyw0OC43MDkgQzE0NC42MjMsNTEuNzc1IDE0MC4zMDIsNTkuMjczIDE0MC4zMDIsNjUuMzY2IEMxNDAuMzAyLDY3LjI3NiAxNDAuNzM2LDY4Ljk0MiAxNDEuNTU4LDcwLjEwNCBMMTQxLjU1OCw3MC4xMDQgWiIgaWQ9IkZpbGwtMzUiIGZpbGw9IiM2MDdEOEIiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTUwLjcyLDY1LjM2MSBMMTUwLjM1Nyw2NS4wNjYgQzE1MS4xNDcsNjQuMDkyIDE1MS44NjksNjMuMDQgMTUyLjUwNSw2MS45MzggQzE1My4zMTMsNjAuNTM5IDE1My45NzgsNTkuMDY3IDE1NC40ODIsNTcuNTYzIEwxNTQuOTI1LDU3LjcxMiBDMTU0LjQxMiw1OS4yNDUgMTUzLjczMyw2MC43NDUgMTUyLjkxLDYyLjE3MiBDMTUyLjI2Miw2My4yOTUgMTUxLjUyNSw2NC4zNjggMTUwLjcyLDY1LjM2MSIgaWQ9IkZpbGwtMzYiIGZpbGw9IiM2MDdEOEIiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTE1LjkxNyw4NC41MTQgTDExNS41NTQsODQuMjIgQzExNi4zNDQsODMuMjQ1IDExNy4wNjYsODIuMTk0IDExNy43MDIsODEuMDkyIEMxMTguNTEsNzkuNjkyIDExOS4xNzUsNzguMjIgMTE5LjY3OCw3Ni43MTcgTDEyMC4xMjEsNzYuODY1IEMxMTkuNjA4LDc4LjM5OCAxMTguOTMsNzkuODk5IDExOC4xMDYsODEuMzI2IEMxMTcuNDU4LDgyLjQ0OCAxMTYuNzIyLDgzLjUyMSAxMTUuOTE3LDg0LjUxNCIgaWQ9IkZpbGwtMzciIGZpbGw9IiM2MDdEOEIiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTE0LDEzMC40NzYgTDExNCwxMzAuMDA4IEwxMTQsNzYuMDUyIEwxMTQsNzUuNTg0IEwxMTQsNzYuMDUyIEwxMTQsMTMwLjAwOCBMMTE0LDEzMC40NzYiIGlkPSJGaWxsLTM4IiBmaWxsPSIjNjA3RDhCIj48L3BhdGg+CiAgICAgICAgICAgICAgICA8L2c+CiAgICAgICAgICAgICAgICA8ZyBpZD0iSW1wb3J0ZWQtTGF5ZXJzLUNvcHkiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDYyLjAwMDAwMCwgMC4wMDAwMDApIiBza2V0Y2g6dHlwZT0iTVNTaGFwZUdyb3VwIj4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTkuODIyLDM3LjQ3NCBDMTkuODM5LDM3LjMzOSAxOS43NDcsMzcuMTk0IDE5LjU1NSwzNy4wODIgQzE5LjIyOCwzNi44OTQgMTguNzI5LDM2Ljg3MiAxOC40NDYsMzcuMDM3IEwxMi40MzQsNDAuNTA4IEMxMi4zMDMsNDAuNTg0IDEyLjI0LDQwLjY4NiAxMi4yNDMsNDAuNzkzIEMxMi4yNDUsNDAuOTI1IDEyLjI0NSw0MS4yNTQgMTIuMjQ1LDQxLjM3MSBMMTIuMjQ1LDQxLjQxNCBMMTIuMjM4LDQxLjU0MiBDOC4xNDgsNDMuODg3IDUuNjQ3LDQ1LjMyMSA1LjY0Nyw0NS4zMjEgQzUuNjQ2LDQ1LjMyMSAzLjU3LDQ2LjM2NyAyLjg2LDUwLjUxMyBDMi44Niw1MC41MTMgMS45NDgsNTcuNDc0IDEuOTYyLDcwLjI1OCBDMS45NzcsODIuODI4IDIuNTY4LDg3LjMyOCAzLjEyOSw5MS42MDkgQzMuMzQ5LDkzLjI5MyA2LjEzLDkzLjczNCA2LjEzLDkzLjczNCBDNi40NjEsOTMuNzc0IDYuODI4LDkzLjcwNyA3LjIxLDkzLjQ4NiBMODIuNDgzLDQ5LjkzNSBDODQuMjkxLDQ4Ljg2NiA4NS4xNSw0Ni4yMTYgODUuNTM5LDQzLjY1MSBDODYuNzUyLDM1LjY2MSA4Ny4yMTQsMTAuNjczIDg1LjI2NCwzLjc3MyBDODUuMDY4LDMuMDggODQuNzU0LDIuNjkgODQuMzk2LDIuNDkxIEw4Mi4zMSwxLjcwMSBDODEuNTgzLDEuNzI5IDgwLjg5NCwyLjE2OCA4MC43NzYsMi4yMzYgQzgwLjYzNiwyLjMxNyA0MS44MDcsMjQuNTg1IDIwLjAzMiwzNy4wNzIgTDE5LjgyMiwzNy40NzQiIGlkPSJGaWxsLTEiIGZpbGw9IiNGRkZGRkYiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNODIuMzExLDEuNzAxIEw4NC4zOTYsMi40OTEgQzg0Ljc1NCwyLjY5IDg1LjA2OCwzLjA4IDg1LjI2NCwzLjc3MyBDODcuMjEzLDEwLjY3MyA4Ni43NTEsMzUuNjYgODUuNTM5LDQzLjY1MSBDODUuMTQ5LDQ2LjIxNiA4NC4yOSw0OC44NjYgODIuNDgzLDQ5LjkzNSBMNy4yMSw5My40ODYgQzYuODk3LDkzLjY2NyA2LjU5NSw5My43NDQgNi4zMTQsOTMuNzQ0IEw2LjEzMSw5My43MzMgQzYuMTMxLDkzLjczNCAzLjM0OSw5My4yOTMgMy4xMjgsOTEuNjA5IEMyLjU2OCw4Ny4zMjcgMS45NzcsODIuODI4IDEuOTYzLDcwLjI1OCBDMS45NDgsNTcuNDc0IDIuODYsNTAuNTEzIDIuODYsNTAuNTEzIEMzLjU3LDQ2LjM2NyA1LjY0Nyw0NS4zMjEgNS42NDcsNDUuMzIxIEM1LjY0Nyw0NS4zMjEgOC4xNDgsNDMuODg3IDEyLjIzOCw0MS41NDIgTDEyLjI0NSw0MS40MTQgTDEyLjI0NSw0MS4zNzEgQzEyLjI0NSw0MS4yNTQgMTIuMjQ1LDQwLjkyNSAxMi4yNDMsNDAuNzkzIEMxMi4yNCw0MC42ODYgMTIuMzAyLDQwLjU4MyAxMi40MzQsNDAuNTA4IEwxOC40NDYsMzcuMDM2IEMxOC41NzQsMzYuOTYyIDE4Ljc0NiwzNi45MjYgMTguOTI3LDM2LjkyNiBDMTkuMTQ1LDM2LjkyNiAxOS4zNzYsMzYuOTc5IDE5LjU1NCwzNy4wODIgQzE5Ljc0NywzNy4xOTQgMTkuODM5LDM3LjM0IDE5LjgyMiwzNy40NzQgTDIwLjAzMywzNy4wNzIgQzQxLjgwNiwyNC41ODUgODAuNjM2LDIuMzE4IDgwLjc3NywyLjIzNiBDODAuODk0LDIuMTY4IDgxLjU4MywxLjcyOSA4Mi4zMTEsMS43MDEgTTgyLjMxMSwwLjcwNCBMODIuMjcyLDAuNzA1IEM4MS42NTQsMC43MjggODAuOTg5LDAuOTQ5IDgwLjI5OCwxLjM2MSBMODAuMjc3LDEuMzczIEM4MC4xMjksMS40NTggNTkuNzY4LDEzLjEzNSAxOS43NTgsMzYuMDc5IEMxOS41LDM1Ljk4MSAxOS4yMTQsMzUuOTI5IDE4LjkyNywzNS45MjkgQzE4LjU2MiwzNS45MjkgMTguMjIzLDM2LjAxMyAxNy45NDcsMzYuMTczIEwxMS45MzUsMzkuNjQ0IEMxMS40OTMsMzkuODk5IDExLjIzNiw0MC4zMzQgMTEuMjQ2LDQwLjgxIEwxMS4yNDcsNDAuOTYgTDUuMTY3LDQ0LjQ0NyBDNC43OTQsNDQuNjQ2IDIuNjI1LDQ1Ljk3OCAxLjg3Nyw1MC4zNDUgTDEuODcxLDUwLjM4NCBDMS44NjIsNTAuNDU0IDAuOTUxLDU3LjU1NyAwLjk2NSw3MC4yNTkgQzAuOTc5LDgyLjg3OSAxLjU2OCw4Ny4zNzUgMi4xMzcsOTEuNzI0IEwyLjEzOSw5MS43MzkgQzIuNDQ3LDk0LjA5NCA1LjYxNCw5NC42NjIgNS45NzUsOTQuNzE5IEw2LjAwOSw5NC43MjMgQzYuMTEsOTQuNzM2IDYuMjEzLDk0Ljc0MiA2LjMxNCw5NC43NDIgQzYuNzksOTQuNzQyIDcuMjYsOTQuNjEgNy43MSw5NC4zNSBMODIuOTgzLDUwLjc5OCBDODQuNzk0LDQ5LjcyNyA4NS45ODIsNDcuMzc1IDg2LjUyNSw0My44MDEgQzg3LjcxMSwzNS45ODcgODguMjU5LDEwLjcwNSA4Ni4yMjQsMy41MDIgQzg1Ljk3MSwyLjYwOSA4NS41MiwxLjk3NSA4NC44ODEsMS42MiBMODQuNzQ5LDEuNTU4IEw4Mi42NjQsMC43NjkgQzgyLjU1MSwwLjcyNSA4Mi40MzEsMC43MDQgODIuMzExLDAuNzA0IiBpZD0iRmlsbC0yIiBmaWxsPSIjNDU1QTY0Ij48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTY2LjI2NywxMS41NjUgTDY3Ljc2MiwxMS45OTkgTDExLjQyMyw0NC4zMjUiIGlkPSJGaWxsLTMiIGZpbGw9IiNGRkZGRkYiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTIuMjAyLDkwLjU0NSBDMTIuMDI5LDkwLjU0NSAxMS44NjIsOTAuNDU1IDExLjc2OSw5MC4yOTUgQzExLjYzMiw5MC4wNTcgMTEuNzEzLDg5Ljc1MiAxMS45NTIsODkuNjE0IEwzMC4zODksNzguOTY5IEMzMC42MjgsNzguODMxIDMwLjkzMyw3OC45MTMgMzEuMDcxLDc5LjE1MiBDMzEuMjA4LDc5LjM5IDMxLjEyNyw3OS42OTYgMzAuODg4LDc5LjgzMyBMMTIuNDUxLDkwLjQ3OCBMMTIuMjAyLDkwLjU0NSIgaWQ9IkZpbGwtNCIgZmlsbD0iIzYwN0Q4QiI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0xMy43NjQsNDIuNjU0IEwxMy42NTYsNDIuNTkyIEwxMy43MDIsNDIuNDIxIEwxOC44MzcsMzkuNDU3IEwxOS4wMDcsMzkuNTAyIEwxOC45NjIsMzkuNjczIEwxMy44MjcsNDIuNjM3IEwxMy43NjQsNDIuNjU0IiBpZD0iRmlsbC01IiBmaWxsPSIjNjA3RDhCIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTguNTIsOTAuMzc1IEw4LjUyLDQ2LjQyMSBMOC41ODMsNDYuMzg1IEw3NS44NCw3LjU1NCBMNzUuODQsNTEuNTA4IEw3NS43NzgsNTEuNTQ0IEw4LjUyLDkwLjM3NSBMOC41Miw5MC4zNzUgWiBNOC43Nyw0Ni41NjQgTDguNzcsODkuOTQ0IEw3NS41OTEsNTEuMzY1IEw3NS41OTEsNy45ODUgTDguNzcsNDYuNTY0IEw4Ljc3LDQ2LjU2NCBaIiBpZD0iRmlsbC02IiBmaWxsPSIjNjA3RDhCIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTI0Ljk4Niw4My4xODIgQzI0Ljc1Niw4My4zMzEgMjQuMzc0LDgzLjU2NiAyNC4xMzcsODMuNzA1IEwxMi42MzIsOTAuNDA2IEMxMi4zOTUsOTAuNTQ1IDEyLjQyNiw5MC42NTggMTIuNyw5MC42NTggTDEzLjI2NSw5MC42NTggQzEzLjU0LDkwLjY1OCAxMy45NTgsOTAuNTQ1IDE0LjE5NSw5MC40MDYgTDI1LjcsODMuNzA1IEMyNS45MzcsODMuNTY2IDI2LjEyOCw4My40NTIgMjYuMTI1LDgzLjQ0OSBDMjYuMTIyLDgzLjQ0NyAyNi4xMTksODMuMjIgMjYuMTE5LDgyLjk0NiBDMjYuMTE5LDgyLjY3MiAyNS45MzEsODIuNTY5IDI1LjcwMSw4Mi43MTkgTDI0Ljk4Niw4My4xODIiIGlkPSJGaWxsLTciIGZpbGw9IiM2MDdEOEIiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTMuMjY2LDkwLjc4MiBMMTIuNyw5MC43ODIgQzEyLjUsOTAuNzgyIDEyLjM4NCw5MC43MjYgMTIuMzU0LDkwLjYxNiBDMTIuMzI0LDkwLjUwNiAxMi4zOTcsOTAuMzk5IDEyLjU2OSw5MC4yOTkgTDI0LjA3NCw4My41OTcgQzI0LjMxLDgzLjQ1OSAyNC42ODksODMuMjI2IDI0LjkxOCw4My4wNzggTDI1LjYzMyw4Mi42MTQgQzI1LjcyMyw4Mi41NTUgMjUuODEzLDgyLjUyNSAyNS44OTksODIuNTI1IEMyNi4wNzEsODIuNTI1IDI2LjI0NCw4Mi42NTUgMjYuMjQ0LDgyLjk0NiBDMjYuMjQ0LDgzLjE2IDI2LjI0NSw4My4zMDkgMjYuMjQ3LDgzLjM4MyBMMjYuMjUzLDgzLjM4NyBMMjYuMjQ5LDgzLjQ1NiBDMjYuMjQ2LDgzLjUzMSAyNi4yNDYsODMuNTMxIDI1Ljc2Myw4My44MTIgTDE0LjI1OCw5MC41MTQgQzE0LDkwLjY2NSAxMy41NjQsOTAuNzgyIDEzLjI2Niw5MC43ODIgTDEzLjI2Niw5MC43ODIgWiBNMTIuNjY2LDkwLjUzMiBMMTIuNyw5MC41MzMgTDEzLjI2Niw5MC41MzMgQzEzLjUxOCw5MC41MzMgMTMuOTE1LDkwLjQyNSAxNC4xMzIsOTAuMjk5IEwyNS42MzcsODMuNTk3IEMyNS44MDUsODMuNDk5IDI1LjkzMSw4My40MjQgMjUuOTk4LDgzLjM4MyBDMjUuOTk0LDgzLjI5OSAyNS45OTQsODMuMTY1IDI1Ljk5NCw4Mi45NDYgTDI1Ljg5OSw4Mi43NzUgTDI1Ljc2OCw4Mi44MjQgTDI1LjA1NCw4My4yODcgQzI0LjgyMiw4My40MzcgMjQuNDM4LDgzLjY3MyAyNC4yLDgzLjgxMiBMMTIuNjk1LDkwLjUxNCBMMTIuNjY2LDkwLjUzMiBMMTIuNjY2LDkwLjUzMiBaIiBpZD0iRmlsbC04IiBmaWxsPSIjNjA3RDhCIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTEzLjI2Niw4OS44NzEgTDEyLjcsODkuODcxIEMxMi41LDg5Ljg3MSAxMi4zODQsODkuODE1IDEyLjM1NCw4OS43MDUgQzEyLjMyNCw4OS41OTUgMTIuMzk3LDg5LjQ4OCAxMi41NjksODkuMzg4IEwyNC4wNzQsODIuNjg2IEMyNC4zMzIsODIuNTM1IDI0Ljc2OCw4Mi40MTggMjUuMDY3LDgyLjQxOCBMMjUuNjMyLDgyLjQxOCBDMjUuODMyLDgyLjQxOCAyNS45NDgsODIuNDc0IDI1Ljk3OCw4Mi41ODQgQzI2LjAwOCw4Mi42OTQgMjUuOTM1LDgyLjgwMSAyNS43NjMsODIuOTAxIEwxNC4yNTgsODkuNjAzIEMxNCw4OS43NTQgMTMuNTY0LDg5Ljg3MSAxMy4yNjYsODkuODcxIEwxMy4yNjYsODkuODcxIFogTTEyLjY2Niw4OS42MjEgTDEyLjcsODkuNjIyIEwxMy4yNjYsODkuNjIyIEMxMy41MTgsODkuNjIyIDEzLjkxNSw4OS41MTUgMTQuMTMyLDg5LjM4OCBMMjUuNjM3LDgyLjY4NiBMMjUuNjY3LDgyLjY2OCBMMjUuNjMyLDgyLjY2NyBMMjUuMDY3LDgyLjY2NyBDMjQuODE1LDgyLjY2NyAyNC40MTgsODIuNzc1IDI0LjIsODIuOTAxIEwxMi42OTUsODkuNjAzIEwxMi42NjYsODkuNjIxIEwxMi42NjYsODkuNjIxIFoiIGlkPSJGaWxsLTkiIGZpbGw9IiM2MDdEOEIiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTIuMzcsOTAuODAxIEwxMi4zNyw4OS41NTQgTDEyLjM3LDkwLjgwMSIgaWQ9IkZpbGwtMTAiIGZpbGw9IiM2MDdEOEIiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNNi4xMyw5My45MDEgQzUuMzc5LDkzLjgwOCA0LjgxNiw5My4xNjQgNC42OTEsOTIuNTI1IEMzLjg2LDg4LjI4NyAzLjU0LDgzLjc0MyAzLjUyNiw3MS4xNzMgQzMuNTExLDU4LjM4OSA0LjQyMyw1MS40MjggNC40MjMsNTEuNDI4IEM1LjEzNCw0Ny4yODIgNy4yMSw0Ni4yMzYgNy4yMSw0Ni4yMzYgQzcuMjEsNDYuMjM2IDgxLjY2NywzLjI1IDgyLjA2OSwzLjAxNyBDODIuMjkyLDIuODg4IDg0LjU1NiwxLjQzMyA4NS4yNjQsMy45NCBDODcuMjE0LDEwLjg0IDg2Ljc1MiwzNS44MjcgODUuNTM5LDQzLjgxOCBDODUuMTUsNDYuMzgzIDg0LjI5MSw0OS4wMzMgODIuNDgzLDUwLjEwMSBMNy4yMSw5My42NTMgQzYuODI4LDkzLjg3NCA2LjQ2MSw5My45NDEgNi4xMyw5My45MDEgQzYuMTMsOTMuOTAxIDMuMzQ5LDkzLjQ2IDMuMTI5LDkxLjc3NiBDMi41NjgsODcuNDk1IDEuOTc3LDgyLjk5NSAxLjk2Miw3MC40MjUgQzEuOTQ4LDU3LjY0MSAyLjg2LDUwLjY4IDIuODYsNTAuNjggQzMuNTcsNDYuNTM0IDUuNjQ3LDQ1LjQ4OSA1LjY0Nyw0NS40ODkgQzUuNjQ2LDQ1LjQ4OSA4LjA2NSw0NC4wOTIgMTIuMjQ1LDQxLjY3OSBMMTMuMTE2LDQxLjU2IEwxOS43MTUsMzcuNzMgTDE5Ljc2MSwzNy4yNjkgTDYuMTMsOTMuOTAxIiBpZD0iRmlsbC0xMSIgZmlsbD0iI0ZBRkFGQSI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik02LjMxNyw5NC4xNjEgTDYuMTAyLDk0LjE0OCBMNi4xMDEsOTQuMTQ4IEw1Ljg1Nyw5NC4xMDEgQzUuMTM4LDkzLjk0NSAzLjA4NSw5My4zNjUgMi44ODEsOTEuODA5IEMyLjMxMyw4Ny40NjkgMS43MjcsODIuOTk2IDEuNzEzLDcwLjQyNSBDMS42OTksNTcuNzcxIDIuNjA0LDUwLjcxOCAyLjYxMyw1MC42NDggQzMuMzM4LDQ2LjQxNyA1LjQ0NSw0NS4zMSA1LjUzNSw0NS4yNjYgTDEyLjE2Myw0MS40MzkgTDEzLjAzMyw0MS4zMiBMMTkuNDc5LDM3LjU3OCBMMTkuNTEzLDM3LjI0NCBDMTkuNTI2LDM3LjEwNyAxOS42NDcsMzcuMDA4IDE5Ljc4NiwzNy4wMjEgQzE5LjkyMiwzNy4wMzQgMjAuMDIzLDM3LjE1NiAyMC4wMDksMzcuMjkzIEwxOS45NSwzNy44ODIgTDEzLjE5OCw0MS44MDEgTDEyLjMyOCw0MS45MTkgTDUuNzcyLDQ1LjcwNCBDNS43NDEsNDUuNzIgMy43ODIsNDYuNzcyIDMuMTA2LDUwLjcyMiBDMy4wOTksNTAuNzgyIDIuMTk4LDU3LjgwOCAyLjIxMiw3MC40MjQgQzIuMjI2LDgyLjk2MyAyLjgwOSw4Ny40MiAzLjM3Myw5MS43MjkgQzMuNDY0LDkyLjQyIDQuMDYyLDkyLjg4MyA0LjY4Miw5My4xODEgQzQuNTY2LDkyLjk4NCA0LjQ4Niw5Mi43NzYgNC40NDYsOTIuNTcyIEMzLjY2NSw4OC41ODggMy4yOTEsODQuMzcgMy4yNzYsNzEuMTczIEMzLjI2Miw1OC41MiA0LjE2Nyw1MS40NjYgNC4xNzYsNTEuMzk2IEM0LjkwMSw0Ny4xNjUgNy4wMDgsNDYuMDU5IDcuMDk4LDQ2LjAxNCBDNy4wOTQsNDYuMDE1IDgxLjU0MiwzLjAzNCA4MS45NDQsMi44MDIgTDgxLjk3MiwyLjc4NSBDODIuODc2LDIuMjQ3IDgzLjY5MiwyLjA5NyA4NC4zMzIsMi4zNTIgQzg0Ljg4NywyLjU3MyA4NS4yODEsMy4wODUgODUuNTA0LDMuODcyIEM4Ny41MTgsMTEgODYuOTY0LDM2LjA5MSA4NS43ODUsNDMuODU1IEM4NS4yNzgsNDcuMTk2IDg0LjIxLDQ5LjM3IDgyLjYxLDUwLjMxNyBMNy4zMzUsOTMuODY5IEM2Ljk5OSw5NC4wNjMgNi42NTgsOTQuMTYxIDYuMzE3LDk0LjE2MSBMNi4zMTcsOTQuMTYxIFogTTYuMTcsOTMuNjU0IEM2LjQ2Myw5My42OSA2Ljc3NCw5My42MTcgNy4wODUsOTMuNDM3IEw4Mi4zNTgsNDkuODg2IEM4NC4xODEsNDguODA4IDg0Ljk2LDQ1Ljk3MSA4NS4yOTIsNDMuNzggQzg2LjQ2NiwzNi4wNDkgODcuMDIzLDExLjA4NSA4NS4wMjQsNC4wMDggQzg0Ljg0NiwzLjM3NyA4NC41NTEsMi45NzYgODQuMTQ4LDIuODE2IEM4My42NjQsMi42MjMgODIuOTgyLDIuNzY0IDgyLjIyNywzLjIxMyBMODIuMTkzLDMuMjM0IEM4MS43OTEsMy40NjYgNy4zMzUsNDYuNDUyIDcuMzM1LDQ2LjQ1MiBDNy4zMDQsNDYuNDY5IDUuMzQ2LDQ3LjUyMSA0LjY2OSw1MS40NzEgQzQuNjYyLDUxLjUzIDMuNzYxLDU4LjU1NiAzLjc3NSw3MS4xNzMgQzMuNzksODQuMzI4IDQuMTYxLDg4LjUyNCA0LjkzNiw5Mi40NzYgQzUuMDI2LDkyLjkzNyA1LjQxMiw5My40NTkgNS45NzMsOTMuNjE1IEM2LjA4Nyw5My42NCA2LjE1OCw5My42NTIgNi4xNjksOTMuNjU0IEw2LjE3LDkzLjY1NCBMNi4xNyw5My42NTQgWiIgaWQ9IkZpbGwtMTIiIGZpbGw9IiM0NTVBNjQiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNNy4zMTcsNjguOTgyIEM3LjgwNiw2OC43MDEgOC4yMDIsNjguOTI2IDguMjAyLDY5LjQ4NyBDOC4yMDIsNzAuMDQ3IDcuODA2LDcwLjczIDcuMzE3LDcxLjAxMiBDNi44MjksNzEuMjk0IDYuNDMzLDcxLjA2OSA2LjQzMyw3MC41MDggQzYuNDMzLDY5Ljk0OCA2LjgyOSw2OS4yNjUgNy4zMTcsNjguOTgyIiBpZD0iRmlsbC0xMyIgZmlsbD0iI0ZGRkZGRiI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik02LjkyLDcxLjEzMyBDNi42MzEsNzEuMTMzIDYuNDMzLDcwLjkwNSA2LjQzMyw3MC41MDggQzYuNDMzLDY5Ljk0OCA2LjgyOSw2OS4yNjUgNy4zMTcsNjguOTgyIEM3LjQ2LDY4LjkgNy41OTUsNjguODYxIDcuNzE0LDY4Ljg2MSBDOC4wMDMsNjguODYxIDguMjAyLDY5LjA5IDguMjAyLDY5LjQ4NyBDOC4yMDIsNzAuMDQ3IDcuODA2LDcwLjczIDcuMzE3LDcxLjAxMiBDNy4xNzQsNzEuMDk0IDcuMDM5LDcxLjEzMyA2LjkyLDcxLjEzMyBNNy43MTQsNjguNjc0IEM3LjU1Nyw2OC42NzQgNy4zOTIsNjguNzIzIDcuMjI0LDY4LjgyMSBDNi42NzYsNjkuMTM4IDYuMjQ2LDY5Ljg3OSA2LjI0Niw3MC41MDggQzYuMjQ2LDcwLjk5NCA2LjUxNyw3MS4zMiA2LjkyLDcxLjMyIEM3LjA3OCw3MS4zMiA3LjI0Myw3MS4yNzEgNy40MTEsNzEuMTc0IEM3Ljk1OSw3MC44NTcgOC4zODksNzAuMTE3IDguMzg5LDY5LjQ4NyBDOC4zODksNjkuMDAxIDguMTE3LDY4LjY3NCA3LjcxNCw2OC42NzQiIGlkPSJGaWxsLTE0IiBmaWxsPSIjODA5N0EyIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTYuOTIsNzAuOTQ3IEM2LjY0OSw3MC45NDcgNi42MjEsNzAuNjQgNi42MjEsNzAuNTA4IEM2LjYyMSw3MC4wMTcgNi45ODIsNjkuMzkyIDcuNDExLDY5LjE0NSBDNy41MjEsNjkuMDgyIDcuNjI1LDY5LjA0OSA3LjcxNCw2OS4wNDkgQzcuOTg2LDY5LjA0OSA4LjAxNSw2OS4zNTUgOC4wMTUsNjkuNDg3IEM4LjAxNSw2OS45NzggNy42NTIsNzAuNjAzIDcuMjI0LDcwLjg1MSBDNy4xMTUsNzAuOTE0IDcuMDEsNzAuOTQ3IDYuOTIsNzAuOTQ3IE03LjcxNCw2OC44NjEgQzcuNTk1LDY4Ljg2MSA3LjQ2LDY4LjkgNy4zMTcsNjguOTgyIEM2LjgyOSw2OS4yNjUgNi40MzMsNjkuOTQ4IDYuNDMzLDcwLjUwOCBDNi40MzMsNzAuOTA1IDYuNjMxLDcxLjEzMyA2LjkyLDcxLjEzMyBDNy4wMzksNzEuMTMzIDcuMTc0LDcxLjA5NCA3LjMxNyw3MS4wMTIgQzcuODA2LDcwLjczIDguMjAyLDcwLjA0NyA4LjIwMiw2OS40ODcgQzguMjAyLDY5LjA5IDguMDAzLDY4Ljg2MSA3LjcxNCw2OC44NjEiIGlkPSJGaWxsLTE1IiBmaWxsPSIjODA5N0EyIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTcuNDQ0LDg1LjM1IEM3LjcwOCw4NS4xOTggNy45MjEsODUuMzE5IDcuOTIxLDg1LjYyMiBDNy45MjEsODUuOTI1IDcuNzA4LDg2LjI5MiA3LjQ0NCw4Ni40NDQgQzcuMTgxLDg2LjU5NyA2Ljk2Nyw4Ni40NzUgNi45NjcsODYuMTczIEM2Ljk2Nyw4NS44NzEgNy4xODEsODUuNTAyIDcuNDQ0LDg1LjM1IiBpZD0iRmlsbC0xNiIgZmlsbD0iI0ZGRkZGRiI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik03LjIzLDg2LjUxIEM3LjA3NCw4Ni41MSA2Ljk2Nyw4Ni4zODcgNi45NjcsODYuMTczIEM2Ljk2Nyw4NS44NzEgNy4xODEsODUuNTAyIDcuNDQ0LDg1LjM1IEM3LjUyMSw4NS4zMDUgNy41OTQsODUuMjg0IDcuNjU4LDg1LjI4NCBDNy44MTQsODUuMjg0IDcuOTIxLDg1LjQwOCA3LjkyMSw4NS42MjIgQzcuOTIxLDg1LjkyNSA3LjcwOCw4Ni4yOTIgNy40NDQsODYuNDQ0IEM3LjM2Nyw4Ni40ODkgNy4yOTQsODYuNTEgNy4yMyw4Ni41MSBNNy42NTgsODUuMDk4IEM3LjU1OCw4NS4wOTggNy40NTUsODUuMTI3IDcuMzUxLDg1LjE4OCBDNy4wMzEsODUuMzczIDYuNzgxLDg1LjgwNiA2Ljc4MSw4Ni4xNzMgQzYuNzgxLDg2LjQ4MiA2Ljk2Niw4Ni42OTcgNy4yMyw4Ni42OTcgQzcuMzMsODYuNjk3IDcuNDMzLDg2LjY2NiA3LjUzOCw4Ni42MDcgQzcuODU4LDg2LjQyMiA4LjEwOCw4NS45ODkgOC4xMDgsODUuNjIyIEM4LjEwOCw4NS4zMTMgNy45MjMsODUuMDk4IDcuNjU4LDg1LjA5OCIgaWQ9IkZpbGwtMTciIGZpbGw9IiM4MDk3QTIiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNNy4yMyw4Ni4zMjIgTDcuMTU0LDg2LjE3MyBDNy4xNTQsODUuOTM4IDcuMzMzLDg1LjYyOSA3LjUzOCw4NS41MTIgTDcuNjU4LDg1LjQ3MSBMNy43MzQsODUuNjIyIEM3LjczNCw4NS44NTYgNy41NTUsODYuMTY0IDcuMzUxLDg2LjI4MiBMNy4yMyw4Ni4zMjIgTTcuNjU4LDg1LjI4NCBDNy41OTQsODUuMjg0IDcuNTIxLDg1LjMwNSA3LjQ0NCw4NS4zNSBDNy4xODEsODUuNTAyIDYuOTY3LDg1Ljg3MSA2Ljk2Nyw4Ni4xNzMgQzYuOTY3LDg2LjM4NyA3LjA3NCw4Ni41MSA3LjIzLDg2LjUxIEM3LjI5NCw4Ni41MSA3LjM2Nyw4Ni40ODkgNy40NDQsODYuNDQ0IEM3LjcwOCw4Ni4yOTIgNy45MjEsODUuOTI1IDcuOTIxLDg1LjYyMiBDNy45MjEsODUuNDA4IDcuODE0LDg1LjI4NCA3LjY1OCw4NS4yODQiIGlkPSJGaWxsLTE4IiBmaWxsPSIjODA5N0EyIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTc3LjI3OCw3Ljc2OSBMNzcuMjc4LDUxLjQzNiBMMTAuMjA4LDkwLjE2IEwxMC4yMDgsNDYuNDkzIEw3Ny4yNzgsNy43NjkiIGlkPSJGaWxsLTE5IiBmaWxsPSIjNDU1QTY0Ij48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTEwLjA4Myw5MC4zNzUgTDEwLjA4Myw0Ni40MjEgTDEwLjE0Niw0Ni4zODUgTDc3LjQwMyw3LjU1NCBMNzcuNDAzLDUxLjUwOCBMNzcuMzQxLDUxLjU0NCBMMTAuMDgzLDkwLjM3NSBMMTAuMDgzLDkwLjM3NSBaIE0xMC4zMzMsNDYuNTY0IEwxMC4zMzMsODkuOTQ0IEw3Ny4xNTQsNTEuMzY1IEw3Ny4xNTQsNy45ODUgTDEwLjMzMyw0Ni41NjQgTDEwLjMzMyw0Ni41NjQgWiIgaWQ9IkZpbGwtMjAiIGZpbGw9IiM2MDdEOEIiPjwvcGF0aD4KICAgICAgICAgICAgICAgIDwvZz4KICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0xMjUuNzM3LDg4LjY0NyBMMTE4LjA5OCw5MS45ODEgTDExOC4wOTgsODQgTDEwNi42MzksODguNzEzIEwxMDYuNjM5LDk2Ljk4MiBMOTksMTAwLjMxNSBMMTEyLjM2OSwxMDMuOTYxIEwxMjUuNzM3LDg4LjY0NyIgaWQ9IkltcG9ydGVkLUxheWVycy1Db3B5LTIiIGZpbGw9IiM0NTVBNjQiIHNrZXRjaDp0eXBlPSJNU1NoYXBlR3JvdXAiPjwvcGF0aD4KICAgICAgICAgICAgPC9nPgogICAgICAgIDwvZz4KICAgIDwvZz4KPC9zdmc+"};var ut="CardboardV1",lt="WEBVR_CARDBOARD_VIEWER";function ct(t){try{this.selectedKey=localStorage.getItem(lt)}catch(t){console.error("Failed to load viewer profile: %s",t)}this.selectedKey||(this.selectedKey=t||ut),this.dialog=this.createDialog_(W.Viewers),this.root=null,this.onChangeCallbacks_=[]}ct.prototype.show=function(t){(this.root=t).appendChild(this.dialog);var e=this.dialog.querySelector("#"+this.selectedKey);e.checked=!0,this.dialog.style.display="block"},ct.prototype.hide=function(){this.root&&this.root.contains(this.dialog)&&this.root.removeChild(this.dialog),this.dialog.style.display="none"},ct.prototype.getCurrentViewer=function(){return W.Viewers[this.selectedKey]},ct.prototype.getSelectedKey_=function(){var t=this.dialog.querySelector("input[name=field]:checked");return t?t.id:null},ct.prototype.onChange=function(t){this.onChangeCallbacks_.push(t)},ct.prototype.fireOnChange_=function(t){for(var e=0;e<this.onChangeCallbacks_.length;e++)this.onChangeCallbacks_[e](t)},ct.prototype.onSave_=function(){if(this.selectedKey=this.getSelectedKey_(),this.selectedKey&&W.Viewers[this.selectedKey]){this.fireOnChange_(W.Viewers[this.selectedKey]);try{localStorage.setItem(lt,this.selectedKey)}catch(t){console.error("Failed to save viewer profile: %s",t)}this.hide()}else console.error("ViewerSelector.onSave_: this should never happen!")},ct.prototype.createDialog_=function(t){var e=document.createElement("div");e.classList.add("webvr-polyfill-viewer-selector"),e.style.display="none";var i=document.createElement("div"),n=i.style;n.position="fixed",n.left=0,n.top=0,n.width="100%",n.height="100%",n.background="rgba(0, 0, 0, 0.3)",i.addEventListener("click",this.hide.bind(this));var s=document.createElement("div"),n=s.style;for(var r in n.boxSizing="border-box",n.position="fixed",n.top="24px",n.left="50%",n.marginLeft="-140px",n.width="280px",n.padding="24px",n.overflow="hidden",n.background="#fafafa",n.fontFamily="'Roboto', sans-serif",n.boxShadow="0px 5px 20px #666",s.appendChild(this.createH1_("Select your viewer")),t)s.appendChild(this.createChoice_(r,t[r].label));return s.appendChild(this.createButton_("Save",this.onSave_.bind(this))),e.appendChild(i),e.appendChild(s),e},ct.prototype.createH1_=function(t){var e=document.createElement("h1"),i=e.style;return i.color="black",i.fontSize="20px",i.fontWeight="bold",i.marginTop=0,i.marginBottom="24px",e.innerHTML=t,e},ct.prototype.createChoice_=function(t,e){var i=document.createElement("div");i.style.marginTop="8px",i.style.color="black";var n=document.createElement("input");n.style.fontSize="30px",n.setAttribute("id",t),n.setAttribute("type","radio"),n.setAttribute("value",t),n.setAttribute("name","field");var s=document.createElement("label");return s.style.marginLeft="4px",s.setAttribute("for",t),s.innerHTML=e,i.appendChild(n),i.appendChild(s),i},ct.prototype.createButton_=function(t,e){var i=document.createElement("button");i.innerHTML=t;var n=i.style;return n.float="right",n.textTransform="uppercase",n.color="#1094f7",n.fontSize="14px",n.letterSpacing=0,n.border=0,n.background="none",n.marginTop="16px",i.addEventListener("click",e),i};var _t,dt,ft,pt,gt="undefined"!=typeof window?window:void 0!==gt?gt:"undefined"!=typeof self?self:{},Mt=(ft=dt={exports:{}},pt=function(){return function(i){var n={};function s(t){if(n[t])return n[t].exports;var e=n[t]={i:t,l:!1,exports:{}};return i[t].call(e.exports,e,e.exports,s),e.l=!0,e.exports}return s.m=i,s.c=n,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=0)}([function(t,e,i){var n=function(){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}(),s=i(1),r="undefined"!=typeof navigator&&parseFloat((""+(/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))<10&&!window.MSStream,o=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),r?this.noSleepTimer=null:(this.noSleepVideo=document.createElement("video"),this.noSleepVideo.setAttribute("playsinline",""),this.noSleepVideo.setAttribute("src",s),this.noSleepVideo.addEventListener("timeupdate",function(t){.5<this.noSleepVideo.currentTime&&(this.noSleepVideo.currentTime=Math.random())}.bind(this)))}return n(t,[{key:"enable",value:function(){r?(this.disable(),this.noSleepTimer=window.setInterval(function(){window.location.href="/",window.setTimeout(window.stop,0)},15e3)):this.noSleepVideo.play()}},{key:"disable",value:function(){r?this.noSleepTimer&&(window.clearInterval(this.noSleepTimer),this.noSleepTimer=null):this.noSleepVideo.pause()}}]),t}();t.exports=o},function(t,e,i){t.exports="data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAACKBtZGF0AAAC8wYF///v3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0MiByMjQ3OSBkZDc5YTYxIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTEgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MToweDExMSBtZT1oZXggc3VibWU9MiBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0wIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MCA4eDhkY3Q9MCBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0wIHRocmVhZHM9NiBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTMgYl9weXJhbWlkPTIgYl9hZGFwdD0xIGJfYmlhcz0wIGRpcmVjdD0xIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MSBrZXlpbnQ9MzAwIGtleWludF9taW49MzAgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD0xMCByYz1jcmYgbWJ0cmVlPTEgY3JmPTIwLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IHZidl9tYXhyYXRlPTIwMDAwIHZidl9idWZzaXplPTI1MDAwIGNyZl9tYXg9MC4wIG5hbF9ocmQ9bm9uZSBmaWxsZXI9MCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAAAOWWIhAA3//p+C7v8tDDSTjf97w55i3SbRPO4ZY+hkjD5hbkAkL3zpJ6h/LR1CAABzgB1kqqzUorlhQAAAAxBmiQYhn/+qZYADLgAAAAJQZ5CQhX/AAj5IQADQGgcIQADQGgcAAAACQGeYUQn/wALKCEAA0BoHAAAAAkBnmNEJ/8ACykhAANAaBwhAANAaBwAAAANQZpoNExDP/6plgAMuSEAA0BoHAAAAAtBnoZFESwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBnqVEJ/8ACykhAANAaBwAAAAJAZ6nRCf/AAsoIQADQGgcIQADQGgcAAAADUGarDRMQz/+qZYADLghAANAaBwAAAALQZ7KRRUsK/8ACPkhAANAaBwAAAAJAZ7pRCf/AAsoIQADQGgcIQADQGgcAAAACQGe60Qn/wALKCEAA0BoHAAAAA1BmvA0TEM//qmWAAy5IQADQGgcIQADQGgcAAAAC0GfDkUVLCv/AAj5IQADQGgcAAAACQGfLUQn/wALKSEAA0BoHCEAA0BoHAAAAAkBny9EJ/8ACyghAANAaBwAAAANQZs0NExDP/6plgAMuCEAA0BoHAAAAAtBn1JFFSwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBn3FEJ/8ACyghAANAaBwAAAAJAZ9zRCf/AAsoIQADQGgcIQADQGgcAAAADUGbeDRMQz/+qZYADLkhAANAaBwAAAALQZ+WRRUsK/8ACPghAANAaBwhAANAaBwAAAAJAZ+1RCf/AAspIQADQGgcAAAACQGft0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bm7w0TEM//qmWAAy4IQADQGgcAAAAC0Gf2kUVLCv/AAj5IQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHAAAAAkBn/tEJ/8ACykhAANAaBwAAAANQZvgNExDP/6plgAMuSEAA0BoHCEAA0BoHAAAAAtBnh5FFSwr/wAI+CEAA0BoHAAAAAkBnj1EJ/8ACyghAANAaBwhAANAaBwAAAAJAZ4/RCf/AAspIQADQGgcAAAADUGaJDRMQz/+qZYADLghAANAaBwAAAALQZ5CRRUsK/8ACPkhAANAaBwhAANAaBwAAAAJAZ5hRCf/AAsoIQADQGgcAAAACQGeY0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bmmg0TEM//qmWAAy5IQADQGgcAAAAC0GehkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGepUQn/wALKSEAA0BoHAAAAAkBnqdEJ/8ACyghAANAaBwAAAANQZqsNExDP/6plgAMuCEAA0BoHCEAA0BoHAAAAAtBnspFFSwr/wAI+SEAA0BoHAAAAAkBnulEJ/8ACyghAANAaBwhAANAaBwAAAAJAZ7rRCf/AAsoIQADQGgcAAAADUGa8DRMQz/+qZYADLkhAANAaBwhAANAaBwAAAALQZ8ORRUsK/8ACPkhAANAaBwAAAAJAZ8tRCf/AAspIQADQGgcIQADQGgcAAAACQGfL0Qn/wALKCEAA0BoHAAAAA1BmzQ0TEM//qmWAAy4IQADQGgcAAAAC0GfUkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGfcUQn/wALKCEAA0BoHAAAAAkBn3NEJ/8ACyghAANAaBwhAANAaBwAAAANQZt4NExC//6plgAMuSEAA0BoHAAAAAtBn5ZFFSwr/wAI+CEAA0BoHCEAA0BoHAAAAAkBn7VEJ/8ACykhAANAaBwAAAAJAZ+3RCf/AAspIQADQGgcAAAADUGbuzRMQn/+nhAAYsAhAANAaBwhAANAaBwAAAAJQZ/aQhP/AAspIQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHAAACiFtb292AAAAbG12aGQAAAAA1YCCX9WAgl8AAAPoAAAH/AABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAGGlvZHMAAAAAEICAgAcAT////v7/AAAF+XRyYWsAAABcdGtoZAAAAAPVgIJf1YCCXwAAAAEAAAAAAAAH0AAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAygAAAMoAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAB9AAABdwAAEAAAAABXFtZGlhAAAAIG1kaGQAAAAA1YCCX9WAgl8AAV+QAAK/IFXEAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAUcbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAE3HN0YmwAAACYc3RzZAAAAAAAAAABAAAAiGF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAygDKAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAAyYXZjQwFNQCj/4QAbZ01AKOyho3ySTUBAQFAAAAMAEAAr8gDxgxlgAQAEaO+G8gAAABhzdHRzAAAAAAAAAAEAAAA8AAALuAAAABRzdHNzAAAAAAAAAAEAAAABAAAB8GN0dHMAAAAAAAAAPAAAAAEAABdwAAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAAC7gAAAAAQAAF3AAAAABAAAAAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAEEc3RzegAAAAAAAAAAAAAAPAAAAzQAAAAQAAAADQAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAANAAAADQAAAQBzdGNvAAAAAAAAADwAAAAwAAADZAAAA3QAAAONAAADoAAAA7kAAAPQAAAD6wAAA/4AAAQXAAAELgAABEMAAARcAAAEbwAABIwAAAShAAAEugAABM0AAATkAAAE/wAABRIAAAUrAAAFQgAABV0AAAVwAAAFiQAABaAAAAW1AAAFzgAABeEAAAX+AAAGEwAABiwAAAY/AAAGVgAABnEAAAaEAAAGnQAABrQAAAbPAAAG4gAABvUAAAcSAAAHJwAAB0AAAAdTAAAHcAAAB4UAAAeeAAAHsQAAB8gAAAfjAAAH9gAACA8AAAgmAAAIQQAACFQAAAhnAAAIhAAACJcAAAMsdHJhawAAAFx0a2hkAAAAA9WAgl/VgIJfAAAAAgAAAAAAAAf8AAAAAAAAAAAAAAABAQAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAACsm1kaWEAAAAgbWRoZAAAAADVgIJf1YCCXwAArEQAAWAAVcQAAAAAACdoZGxyAAAAAAAAAABzb3VuAAAAAAAAAAAAAAAAU3RlcmVvAAAAAmNtaW5mAAAAEHNtaGQAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAidzdGJsAAAAZ3N0c2QAAAAAAAAAAQAAAFdtcDRhAAAAAAAAAAEAAAAAAAAAAAACABAAAAAArEQAAAAAADNlc2RzAAAAAAOAgIAiAAIABICAgBRAFQAAAAADDUAAAAAABYCAgAISEAaAgIABAgAAABhzdHRzAAAAAAAAAAEAAABYAAAEAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAAUc3RzegAAAAAAAAAGAAAAWAAAAXBzdGNvAAAAAAAAAFgAAAOBAAADhwAAA5oAAAOtAAADswAAA8oAAAPfAAAD5QAAA/gAAAQLAAAEEQAABCgAAAQ9AAAEUAAABFYAAARpAAAEgAAABIYAAASbAAAErgAABLQAAATHAAAE3gAABPMAAAT5AAAFDAAABR8AAAUlAAAFPAAABVEAAAVXAAAFagAABX0AAAWDAAAFmgAABa8AAAXCAAAFyAAABdsAAAXyAAAF+AAABg0AAAYgAAAGJgAABjkAAAZQAAAGZQAABmsAAAZ+AAAGkQAABpcAAAauAAAGwwAABskAAAbcAAAG7wAABwYAAAcMAAAHIQAABzQAAAc6AAAHTQAAB2QAAAdqAAAHfwAAB5IAAAeYAAAHqwAAB8IAAAfXAAAH3QAAB/AAAAgDAAAICQAACCAAAAg1AAAIOwAACE4AAAhhAAAIeAAACH4AAAiRAAAIpAAACKoAAAiwAAAItgAACLwAAAjCAAAAFnVkdGEAAAAObmFtZVN0ZXJlbwAAAHB1ZHRhAAAAaG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAO2lsc3QAAAAzqXRvbwAAACtkYXRhAAAAAQAAAABIYW5kQnJha2UgMC4xMC4yIDIwMTUwNjExMDA="}])},ft.exports=pt(),(_t=dt.exports)&&_t.__esModule?_t.default:_t),At=1e3,mt=[0,0,.5,1],xt=[.5,0,.5,1],Tt=window.requestAnimationFrame,yt=window.cancelAnimationFrame;function Nt(t){Object.defineProperties(this,{hasPosition:{writable:!1,enumerable:!0,value:t.hasPosition},hasExternalDisplay:{writable:!1,enumerable:!0,value:t.hasExternalDisplay},canPresent:{writable:!1,enumerable:!0,value:t.canPresent},maxLayers:{writable:!1,enumerable:!0,value:t.maxLayers},hasOrientation:{enumerable:!0,get:function(){return I("VRDisplayCapabilities.prototype.hasOrientation","VRDisplay.prototype.getFrameData"),t.hasOrientation}}})}function Dt(t){var e=!("wakelock"in(t=t||{}))||t.wakelock;this.isPolyfilled=!0,this.displayId=At++,this.displayName="",this.depthNear=.01,this.depthFar=1e4,this.isPresenting=!1,Object.defineProperty(this,"isConnected",{get:function(){return I("VRDisplay.prototype.isConnected","VRDisplayCapabilities.prototype.hasExternalDisplay"),!1}}),this.capabilities=new Nt({hasPosition:!1,hasOrientation:!1,hasExternalDisplay:!1,canPresent:!1,maxLayers:1}),this.stageParameters=null,this.waitingForPresent_=!1,this.layer_=null,this.originalParent_=null,this.fullscreenElement_=null,this.fullscreenWrapper_=null,this.fullscreenElementCachedStyle_=null,this.fullscreenEventTarget_=null,this.fullscreenChangeHandler_=null,this.fullscreenErrorHandler_=null,e&&T()&&(this.wakelock_=new Mt)}Dt.prototype.getFrameData=function(t){return E(t,this._getPose(),this)},Dt.prototype.getPose=function(){return I("VRDisplay.prototype.getPose","VRDisplay.prototype.getFrameData"),this._getPose()},Dt.prototype.resetPose=function(){return I("VRDisplay.prototype.resetPose"),this._resetPose()},Dt.prototype.getImmediatePose=function(){return I("VRDisplay.prototype.getImmediatePose","VRDisplay.prototype.getFrameData"),this._getPose()},Dt.prototype.requestAnimationFrame=function(t){return Tt(t)},Dt.prototype.cancelAnimationFrame=function(t){return yt(t)},Dt.prototype.wrapForFullscreen=function(t){if(c())return t;if(!this.fullscreenWrapper_){this.fullscreenWrapper_=document.createElement("div");var e=["height: "+Math.min(screen.height,screen.width)+"px !important","top: 0 !important","left: 0 !important","right: 0 !important","border: 0","margin: 0","padding: 0","z-index: 999999 !important","position: fixed"];this.fullscreenWrapper_.setAttribute("style",e.join("; ")+";"),this.fullscreenWrapper_.classList.add("webvr-polyfill-fullscreen-wrapper")}if(this.fullscreenElement_==t)return this.fullscreenWrapper_;if(this.fullscreenElement_&&(this.originalParent_?this.originalParent_.appendChild(this.fullscreenElement_):this.fullscreenElement_.parentElement.removeChild(this.fullscreenElement_)),this.fullscreenElement_=t,this.originalParent_=t.parentElement,this.originalParent_||document.body.appendChild(t),!this.fullscreenWrapper_.parentElement){var i=this.fullscreenElement_.parentElement;i.insertBefore(this.fullscreenWrapper_,this.fullscreenElement_),i.removeChild(this.fullscreenElement_)}this.fullscreenWrapper_.insertBefore(this.fullscreenElement_,this.fullscreenWrapper_.firstChild),this.fullscreenElementCachedStyle_=this.fullscreenElement_.getAttribute("style");var n=this;return function(){if(n.fullscreenElement_){var t=["position: absolute","top: 0","left: 0","width: "+Math.max(screen.width,screen.height)+"px","height: "+Math.min(screen.height,screen.width)+"px","border: 0","margin: 0","padding: 0"];n.fullscreenElement_.setAttribute("style",t.join("; ")+";")}}(),this.fullscreenWrapper_},Dt.prototype.removeFullscreenWrapper=function(){if(this.fullscreenElement_){var t=this.fullscreenElement_;this.fullscreenElementCachedStyle_?t.setAttribute("style",this.fullscreenElementCachedStyle_):t.removeAttribute("style"),this.fullscreenElement_=null,this.fullscreenElementCachedStyle_=null;var e=this.fullscreenWrapper_.parentElement;return this.fullscreenWrapper_.removeChild(t),this.originalParent_===e?e.insertBefore(t,this.fullscreenWrapper_):this.originalParent_&&this.originalParent_.appendChild(t),e.removeChild(this.fullscreenWrapper_),t}},Dt.prototype.requestPresent=function(h){var u=this.isPresenting,l=this;return h instanceof Array||(I("VRDisplay.prototype.requestPresent with non-array argument","an array of VRLayers as the first argument"),h=[h]),new Promise(function(e,t){if(l.capabilities.canPresent)if(0==h.length||h.length>l.capabilities.maxLayers)t(new Error("Invalid number of layers."));else{var i=h[0];if(i.source){var n=i.leftBounds||mt,s=i.rightBounds||xt;if(u){var r=l.layer_;r.source!==i.source&&(r.source=i.source);for(var o=0;o<4;o++)r.leftBounds[o]=n[o],r.rightBounds[o]=s[o];return l.wrapForFullscreen(l.layer_.source),l.updatePresent_(),void e()}if(l.layer_={predistorted:i.predistorted,source:i.source,leftBounds:n.slice(0),rightBounds:s.slice(0)},l.waitingForPresent_=!1,l.layer_&&l.layer_.source){var a=l.wrapForFullscreen(l.layer_.source);l.addFullscreenListeners_(a,function(){var t=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;l.isPresenting=a===t,l.isPresenting?(screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape-primary").catch(function(t){console.error("screen.orientation.lock() failed due to",t.message)}),l.waitingForPresent_=!1,l.beginPresent_(),e()):(screen.orientation&&screen.orientation.unlock&&screen.orientation.unlock(),l.removeFullscreenWrapper(),l.disableWakeLock(),l.endPresent_(),l.removeFullscreenListeners_()),l.fireVRDisplayPresentChange_()},function(){l.waitingForPresent_&&(l.removeFullscreenWrapper(),l.removeFullscreenListeners_(),l.disableWakeLock(),l.waitingForPresent_=!1,l.isPresenting=!1,t(new Error("Unable to present.")))}),function(t){if(_())return!1;if(t.requestFullscreen)t.requestFullscreen();else if(t.webkitRequestFullscreen)t.webkitRequestFullscreen();else if(t.mozRequestFullScreen)t.mozRequestFullScreen();else{if(!t.msRequestFullscreen)return!1;t.msRequestFullscreen()}return!0}(a)?(l.enableWakeLock(),l.waitingForPresent_=!0):(c()||_())&&(l.enableWakeLock(),l.isPresenting=!0,l.beginPresent_(),l.fireVRDisplayPresentChange_(),e())}l.waitingForPresent_||c()||(A(),t(new Error("Unable to present.")))}else e()}else t(new Error("VRDisplay is not capable of presenting."))})},Dt.prototype.exitPresent=function(){var i=this.isPresenting,n=this;return this.isPresenting=!1,this.layer_=null,this.disableWakeLock(),new Promise(function(t,e){i?(!A()&&c()&&(n.endPresent_(),n.fireVRDisplayPresentChange_()),_()&&(n.removeFullscreenWrapper(),n.removeFullscreenListeners_(),n.endPresent_(),n.fireVRDisplayPresentChange_()),t()):e(new Error("Was not presenting to VRDisplay."))})},Dt.prototype.getLayers=function(){return this.layer_?[this.layer_]:[]},Dt.prototype.fireVRDisplayPresentChange_=function(){var t=new CustomEvent("vrdisplaypresentchange",{detail:{display:this}});window.dispatchEvent(t)},Dt.prototype.fireVRDisplayConnect_=function(){var t=new CustomEvent("vrdisplayconnect",{detail:{display:this}});window.dispatchEvent(t)},Dt.prototype.addFullscreenListeners_=function(t,e,i){this.removeFullscreenListeners_(),this.fullscreenEventTarget_=t,this.fullscreenChangeHandler_=e,this.fullscreenErrorHandler_=i,e&&(document.fullscreenEnabled?t.addEventListener("fullscreenchange",e,!1):document.webkitFullscreenEnabled?t.addEventListener("webkitfullscreenchange",e,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenchange",e,!1):document.msFullscreenEnabled&&t.addEventListener("msfullscreenchange",e,!1)),i&&(document.fullscreenEnabled?t.addEventListener("fullscreenerror",i,!1):document.webkitFullscreenEnabled?t.addEventListener("webkitfullscreenerror",i,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenerror",i,!1):document.msFullscreenEnabled&&t.addEventListener("msfullscreenerror",i,!1))},Dt.prototype.removeFullscreenListeners_=function(){if(this.fullscreenEventTarget_){var t=this.fullscreenEventTarget_;if(this.fullscreenChangeHandler_){var e=this.fullscreenChangeHandler_;t.removeEventListener("fullscreenchange",e,!1),t.removeEventListener("webkitfullscreenchange",e,!1),document.removeEventListener("mozfullscreenchange",e,!1),t.removeEventListener("msfullscreenchange",e,!1)}if(this.fullscreenErrorHandler_){var i=this.fullscreenErrorHandler_;t.removeEventListener("fullscreenerror",i,!1),t.removeEventListener("webkitfullscreenerror",i,!1),document.removeEventListener("mozfullscreenerror",i,!1),t.removeEventListener("msfullscreenerror",i,!1)}this.fullscreenEventTarget_=null,this.fullscreenChangeHandler_=null,this.fullscreenErrorHandler_=null}},Dt.prototype.enableWakeLock=function(){this.wakelock_&&this.wakelock_.enable()},Dt.prototype.disableWakeLock=function(){this.wakelock_&&this.wakelock_.disable()},Dt.prototype.beginPresent_=function(){},Dt.prototype.endPresent_=function(){},Dt.prototype.submitFrame=function(t){};var Et={ADDITIONAL_VIEWERS:[],DEFAULT_VIEWER:"",MOBILE_WAKE_LOCK:!0,DEBUG:(Dt.prototype.getEyeParameters=function(t){return null},!1),DPDB_URL:"https://dpdb.webvr.rocks/dpdb.json",K_FILTER:.98,PREDICTION_TIME_S:.04,CARDBOARD_UI_DISABLED:!1,ROTATE_INSTRUCTIONS_DISABLED:!1,YAW_ONLY:!1,BUFFER_SCALE:.5,DIRTY_SUBMIT_FRAME_BINDINGS:!1},wt={LEFT:"left",RIGHT:"right"};function Lt(t){var e=N({},Et);t=N(e,t||{}),Dt.call(this,{wakelock:t.MOBILE_WAKE_LOCK}),this.config=t,this.displayName="Cardboard VRDisplay",this.capabilities=new Nt({hasPosition:!1,hasOrientation:!0,hasExternalDisplay:!1,canPresent:!0,maxLayers:1}),this.stageParameters=null,this.bufferScale_=this.config.BUFFER_SCALE,this.poseSensor_=new at(this.config),this.distorter_=null,this.cardboardUI_=null,this.dpdb_=new q(this.config.DPDB_URL,this.onDeviceParamsUpdated_.bind(this)),this.deviceInfo_=new W(this.dpdb_.getDeviceParams(),t.ADDITIONAL_VIEWERS),this.viewerSelector_=new ct(t.DEFAULT_VIEWER),this.viewerSelector_.onChange(this.onViewerChanged_.bind(this)),this.deviceInfo_.setViewer(this.viewerSelector_.getCurrentViewer()),this.config.ROTATE_INSTRUCTIONS_DISABLED||(this.rotateInstructions_=new ht),c()&&window.addEventListener("resize",this.onResize_.bind(this))}return(Lt.prototype=Object.create(Dt.prototype))._getPose=function(){return{position:null,orientation:this.poseSensor_.getOrientation(),linearVelocity:null,linearAcceleration:null,angularVelocity:null,angularAcceleration:null}},Lt.prototype._resetPose=function(){this.poseSensor_.resetPose&&this.poseSensor_.resetPose()},Lt.prototype._getFieldOfView=function(t){var e;if(t==wt.LEFT)e=this.deviceInfo_.getFieldOfViewLeftEye();else{if(t!=wt.RIGHT)return console.error("Invalid eye provided: %s",t),null;e=this.deviceInfo_.getFieldOfViewRightEye()}return e},Lt.prototype._getEyeOffset=function(t){var e;if(t==wt.LEFT)e=[.5*-this.deviceInfo_.viewer.interLensDistance,0,0];else{if(t!=wt.RIGHT)return console.error("Invalid eye provided: %s",t),null;e=[.5*this.deviceInfo_.viewer.interLensDistance,0,0]}return e},Lt.prototype.getEyeParameters=function(t){var e=this._getEyeOffset(t),i=this._getFieldOfView(t),n={offset:e,renderWidth:.5*this.deviceInfo_.device.width*this.bufferScale_,renderHeight:this.deviceInfo_.device.height*this.bufferScale_};return Object.defineProperty(n,"fieldOfView",{enumerable:!0,get:function(){return I("VRFieldOfView","VRFrameData's projection matrices"),i}}),n},Lt.prototype.onDeviceParamsUpdated_=function(t){this.config.DEBUG&&console.log("DPDB reported that device params were updated."),this.deviceInfo_.updateDeviceParams(t),this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_)},Lt.prototype.updateBounds_=function(){this.layer_&&this.distorter_&&(this.layer_.leftBounds||this.layer_.rightBounds)&&this.distorter_.setTextureBounds(this.layer_.leftBounds,this.layer_.rightBounds)},Lt.prototype.beginPresent_=function(){var t=this.layer_.source.getContext("webgl");t||(t=this.layer_.source.getContext("experimental-webgl")),t||(t=this.layer_.source.getContext("webgl2")),t&&(this.layer_.predistorted?this.config.CARDBOARD_UI_DISABLED||(t.canvas.width=g()*this.bufferScale_,t.canvas.height=M()*this.bufferScale_,this.cardboardUI_=new z(t)):(this.config.CARDBOARD_UI_DISABLED||(this.cardboardUI_=new z(t)),this.distorter_=new C(t,this.cardboardUI_,this.config.BUFFER_SCALE,this.config.DIRTY_SUBMIT_FRAME_BINDINGS),this.distorter_.updateDeviceInfo(this.deviceInfo_)),this.cardboardUI_&&this.cardboardUI_.listen(function(t){this.viewerSelector_.show(this.layer_.source.parentElement),t.stopPropagation(),t.preventDefault()}.bind(this),function(t){this.exitPresent(),t.stopPropagation(),t.preventDefault()}.bind(this)),this.rotateInstructions_&&(p()&&T()?this.rotateInstructions_.showTemporarily(3e3,this.layer_.source.parentElement):this.rotateInstructions_.update()),this.orientationHandler=this.onOrientationChange_.bind(this),window.addEventListener("orientationchange",this.orientationHandler),this.vrdisplaypresentchangeHandler=this.updateBounds_.bind(this),window.addEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler),this.fireVRDisplayDeviceParamsChange_())},Lt.prototype.endPresent_=function(){this.distorter_&&(this.distorter_.destroy(),this.distorter_=null),this.cardboardUI_&&(this.cardboardUI_.destroy(),this.cardboardUI_=null),this.rotateInstructions_&&this.rotateInstructions_.hide(),this.viewerSelector_.hide(),window.removeEventListener("orientationchange",this.orientationHandler),window.removeEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler)},Lt.prototype.updatePresent_=function(){this.endPresent_(),this.beginPresent_()},Lt.prototype.submitFrame=function(t){if(this.distorter_)this.updateBounds_(),this.distorter_.submitFrame();else if(this.cardboardUI_&&this.layer_){var e=this.layer_.source.getContext("webgl").canvas;e.width==this.lastWidth&&e.height==this.lastHeight||this.cardboardUI_.onResize(),this.lastWidth=e.width,this.lastHeight=e.height,this.cardboardUI_.render()}},Lt.prototype.onOrientationChange_=function(t){this.viewerSelector_.hide(),this.rotateInstructions_&&this.rotateInstructions_.update(),this.onResize_()},Lt.prototype.onResize_=function(t){if(this.layer_){var e=this.layer_.source.getContext("webgl");e.canvas.setAttribute("style",["position: absolute","top: 0","left: 0","width: 100vw","height: 100vh","border: 0","margin: 0","padding: 0px","box-sizing: content-box"].join("; ")+";"),D(e.canvas)}},Lt.prototype.onViewerChanged_=function(t){this.deviceInfo_.setViewer(t),this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_),this.fireVRDisplayDeviceParamsChange_()},Lt.prototype.fireVRDisplayDeviceParamsChange_=function(){var t=new CustomEvent("vrdisplaydeviceparamschange",{detail:{vrdisplay:this,deviceInfo:this.deviceInfo_}});window.dispatchEvent(t)},Lt.VRFrameData=function(){this.leftProjectionMatrix=new Float32Array(16),this.leftViewMatrix=new Float32Array(16),this.rightProjectionMatrix=new Float32Array(16),this.rightViewMatrix=new Float32Array(16),this.pose=null},Lt.VRDisplay=Dt,Lt}()}(e={exports:{}},e.exports),(t=e.exports)&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t),a={ADDITIONAL_VIEWERS:[],DEFAULT_VIEWER:"",PROVIDE_MOBILE_VRDISPLAY:!0,GET_VR_DISPLAYS_TIMEOUT:1e3,MOBILE_WAKE_LOCK:!0,DEBUG:!1,DPDB_URL:"https://dpdb.webvr.rocks/dpdb.json",K_FILTER:.98,PREDICTION_TIME_S:.04,TOUCH_PANNER_DISABLED:!0,CARDBOARD_UI_DISABLED:!1,ROTATE_INSTRUCTIONS_DISABLED:!1,YAW_ONLY:!1,BUFFER_SCALE:.5,DIRTY_SUBMIT_FRAME_BINDINGS:!1};function h(t){this.config=r(r({},a),t),this.polyfillDisplays=[],this.enabled=!1,this.hasNative="getVRDisplays"in navigator,this.native={},this.native.getVRDisplays=navigator.getVRDisplays,this.native.VRFrameData=window.VRFrameData,this.native.VRDisplay=window.VRDisplay,(!this.hasNative||this.config.PROVIDE_MOBILE_VRDISPLAY&&n())&&(this.enable(),this.getVRDisplays().then(function(t){t&&t[0]&&t[0].fireVRDisplayConnect_&&t[0].fireVRDisplayConnect_()}))}h.prototype.getPolyfillDisplays=function(){if(this._polyfillDisplaysPopulated)return this.polyfillDisplays;if(n()){var t=new o({ADDITIONAL_VIEWERS:this.config.ADDITIONAL_VIEWERS,DEFAULT_VIEWER:this.config.DEFAULT_VIEWER,MOBILE_WAKE_LOCK:this.config.MOBILE_WAKE_LOCK,DEBUG:this.config.DEBUG,DPDB_URL:this.config.DPDB_URL,CARDBOARD_UI_DISABLED:this.config.CARDBOARD_UI_DISABLED,K_FILTER:this.config.K_FILTER,PREDICTION_TIME_S:this.config.PREDICTION_TIME_S,TOUCH_PANNER_DISABLED:this.config.TOUCH_PANNER_DISABLED,ROTATE_INSTRUCTIONS_DISABLED:this.config.ROTATE_INSTRUCTIONS_DISABLED,YAW_ONLY:this.config.YAW_ONLY,BUFFER_SCALE:this.config.BUFFER_SCALE,DIRTY_SUBMIT_FRAME_BINDINGS:this.config.DIRTY_SUBMIT_FRAME_BINDINGS});this.polyfillDisplays.push(t)}return this._polyfillDisplaysPopulated=!0,this.polyfillDisplays},h.prototype.enable=function(){if(this.enabled=!0,this.hasNative&&this.native.VRFrameData){var e=this.native.VRFrameData,i=new this.native.VRFrameData,n=this.native.VRDisplay.prototype.getFrameData;window.VRDisplay.prototype.getFrameData=function(t){t instanceof e?n.call(this,t):(n.call(this,i),t.pose=i.pose,s(i.leftProjectionMatrix,t.leftProjectionMatrix),s(i.rightProjectionMatrix,t.rightProjectionMatrix),s(i.leftViewMatrix,t.leftViewMatrix),s(i.rightViewMatrix,t.rightViewMatrix))}}navigator.getVRDisplays=this.getVRDisplays.bind(this),window.VRDisplay=o.VRDisplay,window.VRFrameData=o.VRFrameData},h.prototype.getVRDisplays=function(){var e,i=this,n=this.config;if(!this.hasNative)return Promise.resolve(this.getPolyfillDisplays());var s,t=this.native.getVRDisplays.call(navigator),r=new Promise(function(t){e=setTimeout(function(){console.warn("Native WebVR implementation detected, but `getVRDisplays()` failed to resolve. Falling back to polyfill."),t([])},n.GET_VR_DISPLAYS_TIMEOUT)});return(s=[t,r],Promise.race?Promise.race(s):new Promise(function(t,e){for(var i=0;i<s.length;i++)s[i].then(t,e)})).then(function(t){return clearTimeout(e),0<t.length?t:i.getPolyfillDisplays()})},h.version="0.10.6",h.VRFrameData=o.VRFrameData,h.VRDisplay=o.VRDisplay;var u=Object.freeze({default:h}),l=u&&h||u;return void 0!==i&&i.window&&(i.document||(i.document=i.window.document),i.navigator||(i.navigator=i.window.navigator)),l}()}(e={exports:{}},e.exports),e.exports),s=(i=n)&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i;!function(){if(window.AudioContext=window.AudioContext||window.webkitAudioContext,window.AudioContext){window.hx_audioContext=new window.AudioContext;var n=function(t){if(window.hx_audioContext){var e=window.hx_audioContext.createBuffer(1,1,22050),i=window.hx_audioContext.createBufferSource();i.buffer=e,i.connect(window.hx_audioContext.destination),i.start?i.start(0):i.play?i.play(0):i.noteOn&&i.noteOn(0)}document.removeEventListener("touchstart",n),document.removeEventListener("touchend",n)};document.addEventListener("touchstart",n),document.addEventListener("touchend",n)}}();var d={_files:{},get:function(t,e){var i="";for(var n in e)e.hasOwnProperty(n)&&(i+="#define "+n+" "+e[n]+"\n");return i+d._files[t]}};d._files["debug_bounds_fragment.glsl"]="uniform vec4 color;\n\nvoid main()\n{\n    hx_FragColor = color;\n}",d._files["debug_bounds_vertex.glsl"]="vertex_attribute vec4 hx_position;\n\nuniform mat4 hx_wvpMatrix;\n\nvoid main()\n{\n    gl_Position = hx_wvpMatrix * hx_position;\n}",d._files["lighting_blinn_phong.glsl"]="/*// schlick-beckman\nfloat hx_lightVisibility(vec3 normal, vec3 viewDir, float roughness, float nDotL)\n{\n\tfloat nDotV = max(-dot(normal, viewDir), 0.0);\n\tfloat r = roughness * roughness * 0.797896;\n\tfloat g1 = nDotV * (1.0 - r) + r;\n\tfloat g2 = nDotL * (1.0 - r) + r;\n    return .25 / (g1 * g2);\n}*/\n\nfloat hx_blinnPhongDistribution(float roughness, vec3 normal, vec3 halfVector)\n{\n\tfloat roughnessSqr = clamp(roughness * roughness, 0.0001, .9999);\n//\troughnessSqr *= roughnessSqr;\n\tfloat halfDotNormal = max(-dot(halfVector, normal), 0.0);\n\treturn pow(halfDotNormal, 2.0/roughnessSqr - 2.0) / roughnessSqr;\n}\n\nvoid hx_brdf(in HX_GeometryData geometry, in vec3 lightDir, in vec3 viewDir, in vec3 viewPos, in vec3 lightColor, vec3 normalSpecularReflectance, out vec3 diffuseColor, out vec3 specularColor)\n{\n\tfloat nDotL = max(-dot(lightDir, geometry.normal), 0.0);\n\tvec3 irradiance = nDotL * lightColor;\t// in fact irradiance / PI\n\n\tvec3 halfVector = normalize(lightDir + viewDir);\n\n\tfloat distribution = hx_blinnPhongDistribution(geometry.roughness, geometry.normal, halfVector);\n\n\tfloat halfDotLight = max(dot(halfVector, lightDir), 0.0);\n\tfloat cosAngle = 1.0 - halfDotLight;\n\t// to the 5th power\n\tvec3 fresnel = normalSpecularReflectance + (1.0 - normalSpecularReflectance)*pow(cosAngle, 5.0);\n\n// / PI factor is encoded in light colour\n\tdiffuseColor = irradiance;\n\tspecularColor = irradiance * fresnel * distribution;\n\n//#ifdef HX_VISIBILITY\n//    specularColor *= hx_lightVisibility(normal, lightDir, geometry.roughness, nDotL);\n//#endif\n}",d._files["lighting_debug.glsl"]="void hx_brdf(in HX_GeometryData geometry, in vec3 lightDir, in vec3 viewDir, in vec3 viewPos, in vec3 lightColor, vec3 normalSpecularReflectance, out vec3 diffuseColor, out vec3 specularColor)\n{\n\tdiffuseColor = vec3(0.0);\n\tspecularColor = vec3(0.0);\n}",d._files["lighting_ggx.glsl"]="#ifdef HX_VISIBILITY_TERM\nfloat hx_geometryTerm(vec3 normal, vec3 dir, float k)\n{\n    float d = max(-dot(normal, dir), 0.0);\n    return d / (d * (1.0 - k) + k);\n}\n\n// schlick-beckman\nfloat hx_lightVisibility(vec3 normal, vec3 viewDir, vec3 lightDir, float roughness)\n{\n\tfloat k = roughness + 1.0;\n\tk = k * k * .125;\n\treturn hx_geometryTerm(normal, viewDir, k) * hx_geometryTerm(normal, lightDir, k);\n}\n#endif\n\nfloat hx_ggxDistribution(float roughness, vec3 normal, vec3 halfVector)\n{\n    float roughSqr = roughness*roughness;\n    float halfDotNormal = max(-dot(halfVector, normal), 0.0);\n    float denom = (halfDotNormal * halfDotNormal) * (roughSqr - 1.0) + 1.0;\n    return roughSqr / (denom * denom);\n}\n\n// light dir is to the lit surface\n// view dir is to the lit surface\nvoid hx_brdf(in HX_GeometryData geometry, in vec3 lightDir, in vec3 viewDir, in vec3 viewPos, in vec3 lightColor, vec3 normalSpecularReflectance, out vec3 diffuseColor, out vec3 specularColor)\n{\n\tfloat nDotL = max(-dot(lightDir, geometry.normal), 0.0);\n\tvec3 irradiance = nDotL * lightColor;\t// in fact irradiance / PI\n\n\tvec3 halfVector = normalize(lightDir + viewDir);\n\n    float mappedRoughness =  geometry.roughness * geometry.roughness;\n\n\tfloat distribution = hx_ggxDistribution(mappedRoughness, geometry.normal, halfVector);\n\n\tfloat halfDotLight = max(dot(halfVector, lightDir), 0.0);\n\tfloat cosAngle = 1.0 - halfDotLight;\n\tvec3 fresnel = normalSpecularReflectance + (1.0 - normalSpecularReflectance) * pow(cosAngle, 5.0);\n\n\tdiffuseColor = irradiance;\n\n\tspecularColor = irradiance * fresnel * distribution;\n\n#ifdef HX_VISIBILITY_TERM\n    specularColor *= hx_lightVisibility(geometry.normal, viewDir, lightDir, geometry.roughness);\n#endif\n}",d._files["directional_light.glsl"]="struct HX_DirectionalLight\n{\n    vec3 color;\n    vec3 direction; // in view space?\n\n    int castShadows;\n\n    mat4 shadowMapMatrices[4];\n    vec4 splitDistances;\n\n    float depthBias;\n    float maxShadowDistance;    // = light.splitDistances[light.numCascades - 1]\n};\n\nvoid hx_calculateLight(HX_DirectionalLight light, HX_GeometryData geometry, vec3 viewVector, vec3 viewPosition, vec3 normalSpecularReflectance, out vec3 diffuse, out vec3 specular)\n{\n\thx_brdf(geometry, light.direction, viewVector, viewPosition, light.color, normalSpecularReflectance, diffuse, specular);\n}\n\nmat4 hx_getShadowMatrix(HX_DirectionalLight light, vec3 viewPos)\n{\n    #if HX_NUM_SHADOW_CASCADES > 1\n        // not very efficient :(\n        for (int i = 0; i < HX_NUM_SHADOW_CASCADES - 1; ++i) {\n            if (viewPos.y < light.splitDistances[i])\n                return light.shadowMapMatrices[i];\n        }\n        return light.shadowMapMatrices[HX_NUM_SHADOW_CASCADES - 1];\n    #else\n        return light.shadowMapMatrices[0];\n    #endif\n}\n\n#ifdef HX_FRAGMENT_SHADER\nfloat hx_calculateShadows(HX_DirectionalLight light, sampler2D shadowMap, vec3 viewPos)\n{\n    mat4 shadowMatrix = hx_getShadowMatrix(light, viewPos);\n    vec4 shadowMapCoord = shadowMatrix * vec4(viewPos, 1.0);\n    float shadow = hx_readShadow(shadowMap, shadowMapCoord, light.depthBias);\n\n    // this can occur when meshInstance.castShadows = false, or using inherited bounds\n    bool isOutside = max(shadowMapCoord.x, shadowMapCoord.y) > 1.0 || min(shadowMapCoord.x, shadowMapCoord.y) < 0.0;\n    if (isOutside) shadow = 1.0;\n\n    // this makes sure that anything beyond the last cascade is unshadowed\n    return max(shadow, float(viewPos.y > light.maxShadowDistance));\n}\n#endif",d._files["light_probe.glsl"]="#define HX_PROBE_K0 .00098\n#define HX_PROBE_K1 .9921\n\n// really only used for clustered\nstruct HX_Probe\n{\n    int hasDiffuse;\n    int hasSpecular;\n    float numMipLevels;\n    float intensity;\n};\n\n/*\nvar minRoughness = 0.0014;\nvar maxPower = 2.0 / (minRoughness * minRoughness) - 2.0;\nvar maxMipFactor = (exp2(-10.0/Math.sqrt(maxPower)) - HX_PROBE_K0)/HX_PROBE_K1;\nvar HX_PROBE_SCALE = 1.0 / maxMipFactor\n*/\n\n#define HX_PROBE_SCALE\n\nvec3 hx_calculateDiffuseProbeLight(samplerCube texture, vec3 normal)\n{\n\treturn hx_gammaToLinear(textureCube(texture, normal.xzy).xyz);\n}\n\nvec3 hx_calculateSpecularProbeLight(samplerCube texture, float numMips, vec3 reflectedViewDir, vec3 fresnelColor, float roughness)\n{\n    #if defined(HX_TEXTURE_LOD) || defined (HX_GLSL_300_ES)\n    // knald method:\n        float power = 2.0/(roughness * roughness) - 2.0;\n        float factor = (exp2(-10.0/sqrt(power)) - HX_PROBE_K0)/HX_PROBE_K1;\n//        float mipLevel = numMips * (1.0 - clamp(factor * HX_PROBE_SCALE, 0.0, 1.0));\n        float mipLevel = numMips * (1.0 - clamp(factor, 0.0, 1.0));\n        #ifdef HX_GLSL_300_ES\n        vec4 specProbeSample = textureLod(texture, reflectedViewDir.xzy, mipLevel);\n        #else\n        vec4 specProbeSample = textureCubeLodEXT(texture, reflectedViewDir.xzy, mipLevel);\n        #endif\n    #else\n        vec4 specProbeSample = textureCube(texture, reflectedViewDir.xzy);\n    #endif\n\treturn hx_gammaToLinear(specProbeSample.xyz) * fresnelColor;\n}",d._files["point_light.glsl"]="struct HX_PointLight\n{\n    vec3 color;\n    vec3 position;\n    float radius;\n    float rcpRadius;\n\n    float depthBias;\n    mat4 shadowMapMatrix;\n    int castShadows;\n    vec4 shadowTiles[6];    // for each cube face\n};\n\nvoid hx_calculateLight(HX_PointLight light, HX_GeometryData geometry, vec3 viewVector, vec3 viewPosition, vec3 normalSpecularReflectance, out vec3 diffuse, out vec3 specular)\n{\n    vec3 direction = viewPosition - light.position;\n    float attenuation = dot(direction, direction);  // distance squared\n    float distance = sqrt(attenuation);\n    // normalize\n    direction /= distance;\n    attenuation = max((1.0 - distance * light.rcpRadius) / attenuation, 0.0);\n\thx_brdf(geometry, direction, viewVector, viewPosition, light.color * attenuation, normalSpecularReflectance, diffuse, specular);\n}\n\n#ifdef HX_FRAGMENT_SHADER\nfloat hx_calculateShadows(HX_PointLight light, sampler2D shadowMap, vec3 viewPos)\n{\n    vec3 dir = viewPos - light.position;\n    // go from view space back to world space, as a vector\n    float dist = length(dir);\n    dir = mat3(light.shadowMapMatrix) * dir;\n\n    // swizzle to opengl cube map space\n    dir = dir.xzy;\n\n    vec3 absDir = abs(dir);\n    float maxDir = max(max(absDir.x, absDir.y), absDir.z);\n    vec2 uv;\n    vec4 tile;\n    if (absDir.x == maxDir) {\n        tile = dir.x > 0.0? light.shadowTiles[0]: light.shadowTiles[1];\n        // signs are important (hence division by either dir or absDir\n        uv = vec2(-dir.z / dir.x, -dir.y / absDir.x);\n    }\n    else if (absDir.y == maxDir) {\n        tile = dir.y > 0.0? light.shadowTiles[4]: light.shadowTiles[5];\n        uv = vec2(dir.x / absDir.y, dir.z / dir.y);\n    }\n    else {\n        tile = dir.z > 0.0? light.shadowTiles[2]: light.shadowTiles[3];\n        uv = vec2(dir.x / dir.z, -dir.y / absDir.z);\n    }\n\n    // match the scaling applied in the shadow map pass (used to reduce bleeding from filtering)\n    uv *= .95;\n\n    vec4 shadowMapCoord;\n    shadowMapCoord.xy = uv * tile.xy + tile.zw;\n    shadowMapCoord.z = dist * light.rcpRadius;\n    shadowMapCoord.w = 1.0;\n    return  hx_readShadow(shadowMap, shadowMapCoord, light.depthBias);\n}\n#endif",d._files["spot_light.glsl"]="struct HX_SpotLight\n{\n    vec3 color;\n    vec3 position;\n    vec3 direction;\n    float radius;\n    float rcpRadius;\n\n    vec2 angleData;    // cos(inner), rcp(cos(outer) - cos(inner))\n\n    mat4 shadowMapMatrix;\n    float depthBias;\n    int castShadows;\n\n    vec4 shadowTile;    // xy = scale, zw = offset\n};\n\nvoid hx_calculateLight(HX_SpotLight light, HX_GeometryData geometry, vec3 viewVector, vec3 viewPosition, vec3 normalSpecularReflectance, out vec3 diffuse, out vec3 specular)\n{\n    vec3 direction = viewPosition - light.position;\n    float attenuation = dot(direction, direction);  // distance squared\n    float distance = sqrt(attenuation);\n    // normalize\n    direction /= distance;\n\n    float cosAngle = dot(light.direction, direction);\n\n    attenuation = max((1.0 - distance * light.rcpRadius) / attenuation, 0.0);\n    attenuation *=  saturate((cosAngle - light.angleData.x) * light.angleData.y);\n\n\thx_brdf(geometry, direction, viewVector, viewPosition, light.color * attenuation, normalSpecularReflectance, diffuse, specular);\n}\n\n#ifdef HX_FRAGMENT_SHADER\nfloat hx_calculateShadows(HX_SpotLight light, sampler2D shadowMap, vec3 viewPos)\n{\n    vec4 shadowMapCoord = light.shadowMapMatrix * vec4(viewPos, 1.0);\n    shadowMapCoord /= shadowMapCoord.w;\n    // *.9 --\x3e match the scaling applied in the shadow map pass (used to reduce bleeding from filtering)\n    shadowMapCoord.xy = shadowMapCoord.xy * .95 * light.shadowTile.xy + light.shadowTile.zw;\n    shadowMapCoord.z = length(viewPos - light.position) * light.rcpRadius;\n    return hx_readShadow(shadowMap, shadowMapCoord, light.depthBias);\n}\n#endif",d._files["default_geometry_fragment.glsl"]="uniform vec3 color;\nuniform vec3 emissiveColor;\nuniform float alpha;\n\n#if defined(COLOR_MAP) || defined(NORMAL_MAP)|| defined(SPECULAR_MAP)|| defined(ROUGHNESS_MAP) || defined(MASK_MAP) || defined(METALLIC_ROUGHNESS_MAP) || defined(OCCLUSION_MAP) || defined(EMISSION_MAP)\n    varying_in vec2 texCoords;\n#endif\n\n#ifdef COLOR_MAP\n    uniform sampler2D colorMap;\n\n    #ifdef COLOR_MAP_SCALE_OFFSET\n        uniform vec2 colorMapScale;\n        uniform vec2 colorMapOffset;\n    #endif\n#endif\n\n#ifdef OCCLUSION_MAP\n    uniform sampler2D occlusionMap;\n#endif\n\n#ifdef EMISSION_MAP\n    uniform sampler2D emissionMap;\n\n    #ifdef EMISSION_MAP_SCALE_OFFSET\n        uniform vec2 emissionMapScale;\n        uniform vec2 emissionMapOffset;\n    #endif\n#endif\n\n#ifdef MASK_MAP\n    uniform sampler2D maskMap;\n\n    #ifdef MASK_MAP_SCALE_OFFSET\n        uniform vec2 maskMapScale;\n        uniform vec2 maskMapOffset;\n    #endif\n#endif\n\n#ifndef HX_SKIP_NORMALS\n    varying_in vec3 normal;\n\n    #ifdef NORMAL_MAP\n        varying_in vec3 tangent;\n        varying_in vec3 bitangent;\n\n        uniform sampler2D normalMap;\n\n        #ifdef NORMAL_MAP_SCALE_OFFSET\n            uniform vec2 normalMapScale;\n            uniform vec2 normalMapOffset;\n        #endif\n\n    #endif\n#endif\n\n#ifndef HX_SKIP_SPECULAR\n    uniform float roughness;\n    uniform float roughnessRange;\n    uniform float normalSpecularReflectance;\n    uniform float metallicness;\n\n    #if defined(SPECULAR_MAP) || defined(ROUGHNESS_MAP) || defined(METALLIC_ROUGHNESS_MAP)\n        uniform sampler2D specularMap;\n\n        #ifdef SPECULAR_MAP_SCALE_OFFSET\n            uniform vec2 specularMapScale;\n            uniform vec2 specularMapOffset;\n        #endif\n    #endif\n#endif\n\n#if defined(ALPHA_THRESHOLD)\n    uniform float alphaThreshold;\n#endif\n\n#ifdef VERTEX_COLORS\n    varying_in vec3 vertexColor;\n#endif\n\nHX_GeometryData hx_geometry()\n{\n    HX_GeometryData data;\n\n    vec4 outputColor = vec4(color, alpha);\n\n    #ifdef VERTEX_COLORS\n        outputColor.xyz *= vertexColor;\n    #endif\n\n    vec2 uv;\n\n    #ifdef COLOR_MAP\n        uv = texCoords;\n        #ifdef COLOR_MAP_SCALE_OFFSET\n            uv = uv * colorMapScale + colorMapOffset;\n        #endif\n        #ifdef COLOR_MAP_ADD\n            outputColor += texture2D(colorMap, uv);\n        #else\n            outputColor *= texture2D(colorMap, uv);\n        #endif\n    #endif\n\n    #ifdef MASK_MAP\n        uv = texCoords;\n        #ifdef MASK_MAP_SCALE_OFFSET\n            uv = uv * maskMapScale + maskMapOffset;\n        #endif\n        outputColor.w *= texture2D(maskMap, uv).x;\n    #endif\n\n    #ifdef ALPHA_THRESHOLD\n        if (outputColor.w < alphaThreshold) discard;\n    #endif\n\n    data.color = hx_gammaToLinear(outputColor);\n\n#ifndef HX_SKIP_SPECULAR\n    float metallicnessOut = metallicness;\n    float specNormalReflOut = normalSpecularReflectance;\n    float roughnessOut = roughness;\n#endif\n\n#if defined(HX_SKIP_NORMALS) && defined(NORMAL_ROUGHNESS_MAP) && !defined(HX_SKIP_SPECULAR)\n    uv = texCoords;\n    #ifdef NORMAL_MAP_SCALE_OFFSET\n        uv = uv * normalMapScale + normalMapOffset;\n    #endif\n    vec4 normalSample = texture2D(normalMap, uv);\n    roughnessOut -= roughnessRange * (normalSample.w - .5);\n#endif\n\n#ifndef HX_SKIP_NORMALS\n    vec3 fragNormal = normal;\n\n    #ifdef NORMAL_MAP\n        uv = texCoords;\n        #ifdef NORMAL_MAP_SCALE_OFFSET\n            uv = uv * normalMapScale + normalMapOffset;\n        #endif\n        vec4 normalSample = texture2D(normalMap, uv);\n        mat3 TBN;\n        TBN[2] = normalize(normal);\n        TBN[0] = normalize(tangent);\n        TBN[1] = normalize(bitangent);\n\n        fragNormal = TBN * (normalSample.xyz - .5);\n\n        #ifdef NORMAL_ROUGHNESS_MAP\n            roughnessOut -= roughnessRange * (normalSample.w - .5);\n        #endif\n    #endif\n\n    #ifdef DOUBLE_SIDED\n        fragNormal *= gl_FrontFacing? 1.0 : -1.0;\n    #endif\n    data.normal = normalize(fragNormal);\n#endif\n\n#ifndef HX_SKIP_SPECULAR\n    #if defined(SPECULAR_MAP) || defined(ROUGHNESS_MAP) || defined(METALLIC_ROUGHNESS_MAP)\n        uv = texCoords;\n        #ifdef SPECULAR_MAP_SCALE_OFFSET\n            uv = uv * specularMapScale + specularMapOffset;\n        #endif\n        vec4 specSample = texture2D(specularMap, uv);\n\n        #ifdef METALLIC_ROUGHNESS_MAP\n            roughnessOut -= roughnessRange * (specSample.y - .5);\n            metallicnessOut *= specSample.z;\n\n        #else\n            roughnessOut -= roughnessRange * (specSample.x - .5);\n\n        #ifdef SPECULAR_MAP\n            specNormalReflOut *= specSample.y;\n            metallicnessOut *= specSample.z;\n        #endif\n    #endif\n#endif\n\n    data.metallicness = metallicnessOut;\n    data.normalSpecularReflectance = specNormalReflOut;\n    data.roughness = roughnessOut;\n#endif\n\n    data.occlusion = 1.0;\n\n#ifdef OCCLUSION_MAP\n    data.occlusion = texture2D(occlusionMap, texCoords).x;\n#endif\n\n    vec3 emission = emissiveColor;\n#ifdef EMISSION_MAP\n    uv = texCoords;\n    #ifdef EMISSION_MAP_SCALE_OFFSET\n        uv = uv * emissionMapScale + emissionMapOffset;\n    #endif\n    emission *= texture2D(emissionMap, uv).xyz;\n#endif\n\n    data.emission = hx_gammaToLinear(emission);\n    return data;\n}",d._files["default_geometry_vertex.glsl"]="vertex_attribute vec4 hx_position;\n\n// morph positions are offsets re the base position!\n#ifdef HX_USE_MORPHING\nvertex_attribute vec3 hx_morphPosition0;\nvertex_attribute vec3 hx_morphPosition1;\nvertex_attribute vec3 hx_morphPosition2;\nvertex_attribute vec3 hx_morphPosition3;\n\n#ifdef HX_USE_NORMAL_MORPHING\n    #ifndef HX_SKIP_NORMALS\n    vertex_attribute vec3 hx_morphNormal0;\n    vertex_attribute vec3 hx_morphNormal1;\n    vertex_attribute vec3 hx_morphNormal2;\n    vertex_attribute vec3 hx_morphNormal3;\n    #endif\n\nuniform float hx_morphWeights[4];\n#else\nvertex_attribute vec3 hx_morphPosition4;\nvertex_attribute vec3 hx_morphPosition5;\nvertex_attribute vec3 hx_morphPosition6;\nvertex_attribute vec3 hx_morphPosition7;\n\nuniform float hx_morphWeights[8];\n#endif\n\n#endif\n\n#ifdef HX_USE_SKINNING\nvertex_attribute vec4 hx_jointIndices;\nvertex_attribute vec4 hx_jointWeights;\n\nuniform mat4 hx_bindShapeMatrix;\nuniform mat4 hx_bindShapeMatrixInverse;\n\n// WebGL doesn't support mat4x3 and I don't want to split the uniform either\n#ifdef HX_USE_SKINNING_TEXTURE\nuniform sampler2D hx_skinningTexture;\n#else\nuniform vec4 hx_skinningMatrices[HX_MAX_SKELETON_JOINTS * 3];\n#endif\n#endif\n\nuniform mat4 hx_wvpMatrix;\nuniform mat4 hx_worldViewMatrix;\n\n#if defined(COLOR_MAP) || defined(NORMAL_MAP)|| defined(SPECULAR_MAP)|| defined(ROUGHNESS_MAP) || defined(MASK_MAP) || defined(OCCLUSION_MAP) || defined(EMISSION_MAP)\nvertex_attribute vec2 hx_texCoord;\nvarying_out vec2 texCoords;\n#endif\n\n#ifdef VERTEX_COLORS\nvertex_attribute vec3 hx_vertexColor;\nvarying_out vec3 vertexColor;\n#endif\n\n#ifndef HX_SKIP_NORMALS\nvertex_attribute vec3 hx_normal;\nvarying_out vec3 normal;\n\nuniform mat3 hx_normalWorldViewMatrix;\n#ifdef NORMAL_MAP\nvertex_attribute vec4 hx_tangent;\n\nvarying_out vec3 tangent;\nvarying_out vec3 bitangent;\n#endif\n#endif\n\nvoid hx_geometry()\n{\n    vec4 morphedPosition = hx_position;\n\n    #ifndef HX_SKIP_NORMALS\n    vec3 morphedNormal = hx_normal;\n    #endif\n\n// TODO: Abstract this in functions for easier reuse in other materials\n#ifdef HX_USE_MORPHING\n    morphedPosition.xyz += hx_morphPosition0 * hx_morphWeights[0];\n    morphedPosition.xyz += hx_morphPosition1 * hx_morphWeights[1];\n    morphedPosition.xyz += hx_morphPosition2 * hx_morphWeights[2];\n    morphedPosition.xyz += hx_morphPosition3 * hx_morphWeights[3];\n    #ifdef HX_USE_NORMAL_MORPHING\n        #ifndef HX_SKIP_NORMALS\n        morphedNormal += hx_morphNormal0 * hx_morphWeights[0];\n        morphedNormal += hx_morphNormal1 * hx_morphWeights[1];\n        morphedNormal += hx_morphNormal2 * hx_morphWeights[2];\n        morphedNormal += hx_morphNormal3 * hx_morphWeights[3];\n        #endif\n    #else\n        morphedPosition.xyz += hx_morphPosition4 * hx_morphWeights[4];\n        morphedPosition.xyz += hx_morphPosition5 * hx_morphWeights[5];\n        morphedPosition.xyz += hx_morphPosition6 * hx_morphWeights[6];\n        morphedPosition.xyz += hx_morphPosition7 * hx_morphWeights[7];\n    #endif\n#endif\n\n#ifdef HX_USE_SKINNING\n    mat4 skinningMatrix = hx_getSkinningMatrix(0);\n\n    // first transform to armature space\n    // then apply skinning in skeleton space\n    // then transform back to object space\n    vec4 animPosition = hx_bindShapeMatrixInverse * ((hx_bindShapeMatrix * morphedPosition) * skinningMatrix);\n\n    #ifndef HX_SKIP_NORMALS\n        vec3 animNormal = morphedNormal * mat3(skinningMatrix);\n\n        #ifdef NORMAL_MAP\n        vec3 animTangent = hx_tangent.xyz * mat3(skinningMatrix);\n        #endif\n    #endif\n#else\n    vec4 animPosition = morphedPosition;\n\n    #ifndef HX_SKIP_NORMALS\n        vec3 animNormal = morphedNormal;\n\n        #ifdef NORMAL_MAP\n        vec3 animTangent = hx_tangent.xyz;\n        #endif\n    #endif\n#endif\n\n    // TODO: Should gl_position be handled by the shaders if we only return local position?\n    gl_Position = hx_wvpMatrix * animPosition;\n\n#ifndef HX_SKIP_NORMALS\n    normal = normalize(hx_normalWorldViewMatrix * animNormal);\n\n    #ifdef NORMAL_MAP\n        tangent = mat3(hx_worldViewMatrix) * animTangent;\n        bitangent = cross(tangent, normal) * hx_tangent.w;\n    #endif\n#endif\n\n#if defined(COLOR_MAP) || defined(NORMAL_MAP)|| defined(SPECULAR_MAP)|| defined(ROUGHNESS_MAP) || defined(MASK_MAP) || defined(OCCLUSION_MAP) || defined(EMISSION_MAP)\n    texCoords = hx_texCoord;\n#endif\n\n#ifdef VERTEX_COLORS\n    vertexColor = hx_vertexColor;\n#endif\n}",d._files["default_skybox_fragment.glsl"]="varying_in vec3 viewWorldDir;\n\nuniform samplerCube hx_skybox;\n\nHX_GeometryData hx_geometry()\n{\n    HX_GeometryData data;\n    data.color = textureCube(hx_skybox, viewWorldDir.xzy);\n    data.emission = vec3(0.0);\n    data.color = hx_gammaToLinear(data.color);\n    return data;\n}",d._files["default_skybox_vertex.glsl"]="vertex_attribute vec4 hx_position;\n\nuniform vec3 hx_cameraWorldPosition;\nuniform float hx_cameraFarPlaneDistance;\nuniform mat4 hx_viewProjectionMatrix;\n\nvarying_out vec3 viewWorldDir;\n\n// using 2D quad for rendering skyboxes rather than 3D cube causes jittering of the skybox\nvoid hx_geometry()\n{\n    viewWorldDir = hx_position.xyz;\n    vec4 pos = hx_position;\n    // use a decent portion of the frustum to prevent FP issues\n    pos.xyz = pos.xyz * hx_cameraFarPlaneDistance + hx_cameraWorldPosition;\n    pos = hx_viewProjectionMatrix * pos;\n    // make sure it's drawn behind everything else, so z = 1.0\n    pos.z = pos.w;\n    gl_Position = pos;\n}",d._files["material_dir_shadow_fragment.glsl"]="void main()\n{\n    // geometry is really only used for kil instructions if necessary\n    // hopefully the compiler optimizes the rest out for us\n    HX_GeometryData data = hx_geometry();\n    hx_FragColor = hx_getShadowMapValue(gl_FragCoord.z);\n}",d._files["material_fwd_base_fragment.glsl"]="uniform vec3 hx_ambientColor;\n\n#ifdef HX_SSAO\nuniform sampler2D hx_ssao;\n#endif\n\nuniform vec2 hx_rcpRenderTargetResolution;\n\nvoid main()\n{\n    vec2 screenUV = gl_FragCoord.xy * hx_rcpRenderTargetResolution;\n\n    HX_GeometryData data = hx_geometry();\n    // simply override with emission\n    hx_FragColor = data.color;\n    #ifdef HX_SSAO\n    float ssao = texture2D(hx_ssao, screenUV).x;\n    #else\n    float ssao = 1.0;\n    #endif\n    hx_FragColor.xyz = hx_FragColor.xyz * hx_ambientColor * ssao + data.emission;\n}",d._files["material_fwd_base_vertex.glsl"]="void main()\n{\n    hx_geometry();\n}",d._files["material_fwd_clustered_fragment.glsl"]="struct HX_PointSpotLight\n{\n// the order here is ordered in function of packing\n    vec3 color;\n    float radius;\n\n    vec3 position;\n    float rcpRadius;\n\n    vec3 direction; // spot only\n    float depthBias;\n\n    mat4 shadowMapMatrix;\n\n    int isSpot;\n    int castShadows;\n    vec2 angleData;    // cos(inner), rcp(cos(outer) - cos(inner))\n\n    vec4 shadowTile;    // xy = scale, zw = offset\n\n    // points only\n    // the 5 missing tiles, share the first one with spots!\n    vec4 shadowTiles[5];    // for each cube face\n};\n\nHX_SpotLight hx_asSpotLight(HX_PointSpotLight light)\n{\n    HX_SpotLight spot;\n    spot.color = light.color;\n    spot.position = light.position;\n    spot.radius = light.radius;\n    spot.direction = light.direction;\n    spot.rcpRadius = light.rcpRadius;\n    spot.angleData = light.angleData;\n    spot.shadowMapMatrix = light.shadowMapMatrix;\n    spot.depthBias = light.depthBias;\n    spot.castShadows = light.castShadows;\n    spot.shadowTile = light.shadowTile;\n    return spot;\n}\n\nHX_PointLight hx_asPointLight(HX_PointSpotLight light)\n{\n    HX_PointLight point;\n    point.color = light.color;\n    point.position = light.position;\n    point.radius = light.radius;\n    point.rcpRadius = light.rcpRadius;\n    point.shadowMapMatrix = light.shadowMapMatrix;\n    point.depthBias = light.depthBias;\n    point.castShadows = light.castShadows;\n    point.shadowTiles[0] = light.shadowTile;\n    point.shadowTiles[1] = light.shadowTiles[0];\n    point.shadowTiles[2] = light.shadowTiles[1];\n    point.shadowTiles[3] = light.shadowTiles[2];\n    point.shadowTiles[4] = light.shadowTiles[3];\n    point.shadowTiles[5] = light.shadowTiles[4];\n    return point;\n}\n\nvarying_in vec3 hx_viewPosition;\n\nuniform vec3 hx_ambientColor;\nuniform vec2 hx_rcpRenderTargetResolution;\nuniform sampler2D hx_shadowMap;\n\n#ifdef HX_SSAO\nuniform sampler2D hx_ssao;\n#endif\n\nuniform hx_lightingCells\n{\n    // std140 layout specification dictates arrays of scalars have strides rounded up to the alignment of vec4\n    // meaning the array would be 4 times as big when using floats. Hence the use of vec4s.\n    ivec4 hx_cells[HX_CELL_ARRAY_LEN];\n};\n\nuniform hx_lights\n{\n    int hx_numDirLights;\n    int hx_numLightProbes;\n    int hx_numPointSpotLights;\n\n#if HX_NUM_DIR_LIGHTS > 0\n    HX_DirectionalLight hx_directionalLights[HX_NUM_DIR_LIGHTS];\n#endif\n\n#if HX_NUM_LIGHT_PROBES > 0\n    HX_Probe hx_probes[HX_NUM_LIGHT_PROBES];\n#endif\n\n#if HX_NUM_POINT_SPOT_LIGHTS > 0\n    HX_PointSpotLight hx_pointSpotLights[HX_NUM_POINT_SPOT_LIGHTS];\n#endif\n\n};\n\n#if HX_NUM_LIGHT_PROBES > 0\nuniform mat4 hx_cameraWorldMatrix;\n\nuniform samplerCube hx_diffuseProbes[HX_NUM_LIGHT_PROBES];\nuniform samplerCube hx_specularProbes[HX_NUM_LIGHT_PROBES];\n#endif\n\nivec2 getCurrentCell(vec2 screenUV)\n{\n    return ivec2(screenUV * vec2(float(HX_NUM_CELLS_X), float(HX_NUM_CELLS_Y)));\n}\n\nvoid main()\n{\n    HX_GeometryData data = hx_geometry();\n\n    // update the colours\n    vec3 specularColor = mix(vec3(data.normalSpecularReflectance), data.color.xyz, data.metallicness);\n    data.color.xyz *= 1.0 - data.metallicness;\n\n    vec3 diffuseAccum = vec3(0.0);\n    vec3 specularAccum = vec3(0.0);\n    vec3 viewVector = normalize(hx_viewPosition);\n\n    float ao = data.occlusion;\n    vec2 screenUV = gl_FragCoord.xy * hx_rcpRenderTargetResolution;\n\n    #ifdef HX_SSAO\n        ao = texture2D(hx_ssao, screenUV).x;\n    #endif\n\n    #if HX_NUM_DIR_LIGHTS > 0\n        for (int i = 0; i < hx_numDirLights; ++i) {\n            HX_DirectionalLight light = hx_directionalLights[i];\n            vec3 diffuse, specular;\n            hx_calculateLight(light, data, viewVector, hx_viewPosition, specularColor, diffuse, specular);\n\n            if (light.castShadows == 1) {\n                float shadow = hx_calculateShadows(light, hx_shadowMap, hx_viewPosition);\n                diffuse *= shadow;\n                specular *= shadow;\n            }\n\n            diffuseAccum += diffuse;\n            specularAccum += specular;\n        }\n    #endif\n\n    #if HX_NUM_LIGHT_PROBES > 0\n        vec3 worldNormal = mat3(hx_cameraWorldMatrix) * data.normal;\n        vec3 reflectedViewDir = reflect(viewVector, data.normal);\n        vec3 fresnel = hx_fresnelProbe(specularColor, reflectedViewDir, data.normal, data.roughness);\n\n        reflectedViewDir = mat3(hx_cameraWorldMatrix) * reflectedViewDir;\n\n        for (int i = 0; i < HX_NUM_LIGHT_PROBES; ++i) {\n            // this is a bit icky, but since the cube textures need to indexed using a literal, we can't loop over hx_numLightProbes\n            if (i < hx_numLightProbes) {\n                if (hx_probes[i].hasDiffuse == 1)\n                    diffuseAccum += hx_calculateDiffuseProbeLight(hx_diffuseProbes[i], worldNormal) * ao * hx_probes[i].intensity;\n\n                if (hx_probes[i].hasSpecular == 1)\n                    specularAccum += hx_calculateSpecularProbeLight(hx_specularProbes[i], hx_probes[i].numMipLevels, reflectedViewDir, fresnel, data.roughness) * ao * hx_probes[i].intensity;\n            }\n        }\n    #endif\n\n    #if HX_NUM_POINT_SPOT_LIGHTS > 0\n        ivec2 cell = getCurrentCell(screenUV);\n        int cellIndex = HX_CELL_STRIDE * (HX_NUM_CELLS_X * cell.y + cell.x);\n        int cellElm = cellIndex / 4;\n        int comp = cellIndex - cellElm * 4;\n\n        int numLights = hx_cells[cellElm][comp];\n\n//        specularAccum += float(numLights) / 5.0;\n\n        for (int i = 1; i <= numLights; ++i) {\n            vec3 diffuse, specular;\n            float shadow = 1.0;;\n            int lightIndex = cellIndex + i;\n            int cellElm = lightIndex / 4;\n            int comp = lightIndex - cellElm * 4;\n            lightIndex = hx_cells[cellElm][comp];\n\n            if (hx_pointSpotLights[lightIndex].isSpot == 1) {\n                HX_SpotLight spot = hx_asSpotLight(hx_pointSpotLights[lightIndex]);\n                hx_calculateLight(spot, data, viewVector, hx_viewPosition, specularColor, diffuse, specular);\n                if (spot.castShadows == 1)\n                    shadow = hx_calculateShadows(spot, hx_shadowMap, hx_viewPosition);\n            }\n            else {\n                HX_PointLight point = hx_asPointLight(hx_pointSpotLights[lightIndex]);\n                hx_calculateLight(point, data, viewVector, hx_viewPosition, specularColor, diffuse, specular);\n                if (point.castShadows == 1)\n                    shadow = hx_calculateShadows(point, hx_shadowMap, hx_viewPosition);\n            }\n\n            diffuseAccum += diffuse * shadow;\n            specularAccum += specular * shadow;\n        }\n    #endif\n\n    hx_FragColor = vec4((diffuseAccum + hx_ambientColor * ao) * data.color.xyz + specularAccum + data.emission, data.color.w);\n}",d._files["material_fwd_clustered_vertex.glsl"]="varying_out vec3 hx_viewPosition;\nuniform mat4 hx_inverseProjectionMatrix;\n\nvoid main()\n{\n    hx_geometry();\n    // we need to do an unprojection here to be sure to have skinning - or anything like that - support\n    hx_viewPosition = (hx_inverseProjectionMatrix * gl_Position).xyz;\n}",d._files["material_fwd_dir_fragment.glsl"]="varying_in vec3 hx_viewPosition;\n\nuniform HX_DirectionalLight hx_directionalLight;\n\nuniform sampler2D hx_shadowMap;\n\nvoid main()\n{\n    HX_GeometryData data = hx_geometry();\n\n    vec3 viewVector = normalize(hx_viewPosition);\n    vec3 diffuse, specular;\n\n    vec3 specularColor = mix(vec3(data.normalSpecularReflectance), data.color.xyz, data.metallicness);\n    data.color.xyz *= 1.0 - data.metallicness;\n\n    hx_calculateLight(hx_directionalLight, data, viewVector, hx_viewPosition, specularColor, diffuse, specular);\n\n    hx_FragColor = vec4(diffuse * data.color.xyz + specular, data.color.w);\n\n    if (hx_directionalLight.castShadows == 1)\n        hx_FragColor.xyz *= hx_calculateShadows(hx_directionalLight, hx_shadowMap, hx_viewPosition);\n}",d._files["material_fwd_dir_vertex.glsl"]="varying_out vec3 hx_viewPosition;\nuniform mat4 hx_inverseProjectionMatrix;\n\nvoid main()\n{\n    hx_geometry();\n    hx_viewPosition = (hx_inverseProjectionMatrix * gl_Position).xyz;\n}",d._files["material_fwd_fixed_fragment.glsl"]="varying_in vec3 hx_viewPosition;\n\nuniform vec3 hx_ambientColor;\n\nuniform sampler2D hx_shadowMap;\n\n#if HX_NUM_DIR_LIGHTS > 0\nuniform HX_DirectionalLight hx_directionalLights[HX_NUM_DIR_LIGHTS];\n#endif\n\n#if HX_NUM_POINT_LIGHTS > 0\nuniform HX_PointLight hx_pointLights[HX_NUM_POINT_LIGHTS];\n#endif\n\n#if HX_NUM_SPOT_LIGHTS > 0\nuniform HX_SpotLight hx_spotLights[HX_NUM_SPOT_LIGHTS];\n#endif\n\n#if HX_NUM_DIFFUSE_PROBES > 0 || HX_NUM_SPECULAR_PROBES > 0\nuniform mat4 hx_cameraWorldMatrix;\n#endif\n\n#if HX_NUM_DIFFUSE_PROBES > 0\nuniform samplerCube hx_diffuseProbeMaps[HX_NUM_DIFFUSE_PROBES];\nuniform float hx_diffuseProbeIntensities[HX_NUM_DIFFUSE_PROBES];\n#endif\n\n#if HX_NUM_SPECULAR_PROBES > 0\nuniform samplerCube hx_specularProbeMaps[HX_NUM_SPECULAR_PROBES];\nuniform float hx_specularProbeNumMips[HX_NUM_SPECULAR_PROBES];\nuniform float hx_specularProbeIntensities[HX_NUM_SPECULAR_PROBES];\n#endif\n\n#ifdef HX_SSAO\nuniform sampler2D hx_ssao;\n\nuniform vec2 hx_rcpRenderTargetResolution;\n#endif\n\n\nvoid main()\n{\n    HX_GeometryData data = hx_geometry();\n\n    // update the colours\n    vec3 specularColor = mix(vec3(data.normalSpecularReflectance), data.color.xyz, data.metallicness);\n    data.color.xyz *= 1.0 - data.metallicness;\n\n    vec3 diffuseAccum = vec3(0.0);\n    vec3 specularAccum = vec3(0.0);\n    vec3 viewVector = normalize(hx_viewPosition);\n\n    float ao = data.occlusion;\n\n    #ifdef HX_SSAO\n        vec2 screenUV = gl_FragCoord.xy * hx_rcpRenderTargetResolution;\n        ao = texture2D(hx_ssao, screenUV).x;\n    #endif\n\n    #if HX_NUM_DIR_LIGHTS > 0\n    for (int i = 0; i < HX_NUM_DIR_LIGHTS; ++i) {\n        vec3 diffuse, specular;\n        hx_calculateLight(hx_directionalLights[i], data, viewVector, hx_viewPosition, specularColor, diffuse, specular);\n\n        if (hx_directionalLights[i].castShadows == 1) {\n            float shadow = hx_calculateShadows(hx_directionalLights[i], hx_shadowMap, hx_viewPosition);\n            diffuse *= shadow;\n            specular *= shadow;\n        }\n\n        diffuseAccum += diffuse;\n        specularAccum += specular;\n    }\n    #endif\n\n    #if HX_NUM_POINT_LIGHTS > 0\n    for (int i = 0; i < HX_NUM_POINT_LIGHTS; ++i) {\n        vec3 diffuse, specular;\n        hx_calculateLight(hx_pointLights[i], data, viewVector, hx_viewPosition, specularColor, diffuse, specular);\n\n        if (hx_pointLights[i].castShadows == 1) {\n            float shadow = hx_calculateShadows(hx_pointLights[i], hx_shadowMap, hx_viewPosition);\n            diffuse *= shadow;\n            specular *= shadow;\n        }\n\n        diffuseAccum += diffuse;\n        specularAccum += specular;\n    }\n    #endif\n\n    #if HX_NUM_SPOT_LIGHTS > 0\n    for (int i = 0; i < HX_NUM_SPOT_LIGHTS; ++i) {\n        vec3 diffuse, specular;\n        hx_calculateLight(hx_spotLights[i], data, viewVector, hx_viewPosition, specularColor, diffuse, specular);\n\n        if (hx_spotLights[i].castShadows == 1) {\n            float shadow = hx_calculateShadows(hx_spotLights[i], hx_shadowMap, hx_viewPosition);\n            diffuse *= shadow;\n            specular *= shadow;\n        }\n\n        diffuseAccum += diffuse;\n        specularAccum += specular;\n    }\n    #endif\n\n// TODO: add support for local probes\n\n    #if HX_NUM_DIFFUSE_PROBES > 0\n    vec3 worldNormal = mat3(hx_cameraWorldMatrix) * data.normal;\n    for (int i = 0; i < HX_NUM_DIFFUSE_PROBES; ++i) {\n        diffuseAccum += hx_calculateDiffuseProbeLight(hx_diffuseProbeMaps[i], worldNormal) * ao * hx_diffuseProbeIntensities[i];\n    }\n    #endif\n\n    #if HX_NUM_SPECULAR_PROBES > 0\n    vec3 reflectedViewDir = reflect(viewVector, data.normal);\n    vec3 fresnel = hx_fresnelProbe(specularColor, reflectedViewDir, data.normal, data.roughness);\n\n    reflectedViewDir = mat3(hx_cameraWorldMatrix) * reflectedViewDir;\n\n   for (int i = 0; i < HX_NUM_SPECULAR_PROBES; ++i) {\n        specularAccum += hx_calculateSpecularProbeLight(hx_specularProbeMaps[i], hx_specularProbeNumMips[i], reflectedViewDir, fresnel, data.roughness) * ao * hx_specularProbeIntensities[i];\n    }\n    #endif\n\n    hx_FragColor = vec4((diffuseAccum + hx_ambientColor * ao) * data.color.xyz + specularAccum + data.emission, data.color.w);\n}",d._files["material_fwd_fixed_vertex.glsl"]="varying_out vec3 hx_viewPosition;\nuniform mat4 hx_inverseProjectionMatrix;\n\nvoid main()\n{\n    hx_geometry();\n    // we need to do an unprojection here to be sure to have skinning - or anything like that - support\n    hx_viewPosition = (hx_inverseProjectionMatrix * gl_Position).xyz;\n}",d._files["material_fwd_point_fragment.glsl"]="varying_in vec3 hx_viewPosition;\n\nuniform HX_PointLight hx_pointLight;\n\nuniform sampler2D hx_shadowMap;\n\nvoid main()\n{\n    HX_GeometryData data = hx_geometry();\n\n    vec3 viewVector = normalize(hx_viewPosition);\n    vec3 diffuse, specular;\n\n    vec3 specularColor = mix(vec3(data.normalSpecularReflectance), data.color.xyz, data.metallicness);\n    data.color.xyz *= 1.0 - data.metallicness;\n\n    hx_calculateLight(hx_pointLight, data, viewVector, hx_viewPosition, specularColor, diffuse, specular);\n\n    hx_FragColor = vec4(diffuse * data.color.xyz + specular, data.color.w);\n\n    if (hx_pointLight.castShadows == 1)\n        hx_FragColor.xyz *= hx_calculateShadows(hx_pointLight, hx_shadowMap, hx_viewPosition);\n}",d._files["material_fwd_point_vertex.glsl"]="varying_out vec3 hx_viewPosition;\nuniform mat4 hx_inverseProjectionMatrix;\n\nvoid main()\n{\n    hx_geometry();\n    hx_viewPosition = (hx_inverseProjectionMatrix * gl_Position).xyz;\n}",d._files["material_fwd_probe_fragment.glsl"]="varying_in vec3 hx_viewPosition;\nvarying_in vec3 hx_worldPosition;\n\nuniform samplerCube hx_diffuseProbeMap;\nuniform samplerCube hx_specularProbeMap;\nuniform float hx_specularProbeNumMips;\n\nuniform mat4 hx_cameraWorldMatrix;\n\n#ifdef HX_SSAO\nuniform vec2 hx_rcpRenderTargetResolution;\nuniform sampler2D hx_ssao;\n#endif\n\nuniform float hx_probeSize;\nuniform vec3 hx_probePosition;\nuniform float hx_probeLocal;\nuniform float hx_probeIntensity;\n\nvoid main()\n{\n    HX_GeometryData data = hx_geometry();\n\n    vec3 viewVector = normalize(hx_viewPosition);\n\n    vec3 specularColor = mix(vec3(data.normalSpecularReflectance), data.color.xyz, data.metallicness);\n    data.color.xyz *= 1.0 - data.metallicness;\n\n    // TODO: We should be able to change the base of TBN in vertex shader\n    vec3 worldNormal = mat3(hx_cameraWorldMatrix) * data.normal;\n    vec3 reflectedViewDir = reflect(viewVector, data.normal);\n    vec3 fresnel = hx_fresnelProbe(specularColor, reflectedViewDir, data.normal, data.roughness);\n    reflectedViewDir = mat3(hx_cameraWorldMatrix) * reflectedViewDir;\n    vec3 diffRay = hx_intersectCubeMap(hx_worldPosition, hx_probePosition, worldNormal, hx_probeSize);\n    vec3 specRay = hx_intersectCubeMap(hx_worldPosition, hx_probePosition, reflectedViewDir, hx_probeSize);\n    diffRay = mix(worldNormal, diffRay, hx_probeLocal);\n    specRay = mix(reflectedViewDir, specRay, hx_probeLocal);\n    vec3 diffuse = hx_calculateDiffuseProbeLight(hx_diffuseProbeMap, diffRay) * hx_probeIntensity;\n    vec3 specular = hx_calculateSpecularProbeLight(hx_specularProbeMap, hx_specularProbeNumMips, specRay, fresnel, data.roughness) * hx_probeIntensity;\n\n    hx_FragColor = vec4((diffuse * data.color.xyz + specular) * data.occlusion, data.color.w);\n\n    #ifdef HX_SSAO\n    vec2 screenUV = gl_FragCoord.xy * hx_rcpRenderTargetResolution;\n    hx_FragColor.xyz *= texture2D(hx_ssao, screenUV).x;\n    #endif\n}",d._files["material_fwd_probe_vertex.glsl"]="varying_out vec3 hx_viewPosition;\nvarying_out vec3 hx_worldPosition;\nuniform mat4 hx_inverseProjectionMatrix;\nuniform mat4 hx_worldMatrix;\n\nvoid main()\n{\n    hx_geometry();\n    hx_worldPosition = (hx_worldMatrix * gl_Position).xyz;\n    hx_viewPosition = (hx_inverseProjectionMatrix * gl_Position).xyz;\n}",d._files["material_fwd_spot_fragment.glsl"]="varying_in vec3 hx_viewPosition;\n\nuniform HX_SpotLight hx_spotLight;\n\nuniform sampler2D hx_shadowMap;\n\nvoid main()\n{\n    HX_GeometryData data = hx_geometry();\n\n    vec3 viewVector = normalize(hx_viewPosition);\n    vec3 diffuse, specular;\n\n    vec3 specularColor = mix(vec3(data.normalSpecularReflectance), data.color.xyz, data.metallicness);\n    data.color.xyz *= 1.0 - data.metallicness;\n\n    hx_calculateLight(hx_spotLight, data, viewVector, hx_viewPosition, specularColor, diffuse, specular);\n\n    hx_FragColor = vec4(diffuse * data.color.xyz + specular, data.color.w);\n\n    if (hx_spotLight.castShadows == 1)\n        hx_FragColor.xyz *= hx_calculateShadows(hx_spotLight, hx_shadowMap, hx_viewPosition);\n}",d._files["material_fwd_spot_vertex.glsl"]="varying_out vec3 hx_viewPosition;\nuniform mat4 hx_inverseProjectionMatrix;\n\nvoid main()\n{\n    hx_geometry();\n    hx_viewPosition = (hx_inverseProjectionMatrix * gl_Position).xyz;\n}",d._files["material_normal_depth_fragment.glsl"]="varying_in float hx_linearDepth;\n\nvoid main()\n{\n    HX_GeometryData data = hx_geometry();\n    hx_FragColor.xy = hx_encodeNormal(data.normal);\n    hx_FragColor.zw = hx_floatToRG8(hx_linearDepth);\n}",d._files["material_normal_depth_vertex.glsl"]="varying_out float hx_linearDepth;\n\nuniform float hx_rcpCameraFrustumRange;\nuniform float hx_cameraNearPlaneDistance;\n\nvoid main()\n{\n    hx_geometry();\n\n    hx_linearDepth = (gl_Position.w - hx_cameraNearPlaneDistance) * hx_rcpCameraFrustumRange;\n}",d._files["material_point_shadow_fragment.glsl"]="varying_in vec3 hx_viewPosition;\n\nuniform float hx_rcpRadius;\n\nvoid main()\n{\n    // geometry is really only used for kil instructions if necessary\n    // hopefully the compiler optimizes the rest out for us\n    HX_GeometryData data = hx_geometry();\n\n    hx_FragColor = hx_getShadowMapValue(length(hx_viewPosition) * hx_rcpRadius);\n}",d._files["material_point_shadow_vertex.glsl"]="varying_out vec3 hx_viewPosition;\n\nuniform mat4 hx_inverseProjectionMatrix;\n\nvoid main()\n{\n    hx_geometry();\n    hx_viewPosition = (hx_inverseProjectionMatrix * gl_Position).xyz;\n\n    // this shrinks it down to leave some room for filtering\n    gl_Position.xy *= .95;\n}",d._files["material_unlit_fragment.glsl"]="void main()\n{\n    HX_GeometryData data = hx_geometry();\n    hx_FragColor = data.color;\n    hx_FragColor.xyz += data.emission;\n}",d._files["material_unlit_vertex.glsl"]="void main()\n{\n    hx_geometry();\n}",d._files["bloom_composite_fragment.glsl"]="varying_in vec2 uv;\n\nuniform sampler2D bloomTexture;\nuniform sampler2D hx_backbuffer;\nuniform float strength;\n\nvoid main()\n{\n\thx_FragColor = texture2D(hx_backbuffer, uv) + texture2D(bloomTexture, uv) * strength;\n}",d._files["bloom_composite_vertex.glsl"]="vertex_attribute vec4 hx_position;\nvertex_attribute vec2 hx_texCoord;\n\nvarying_out vec2 uv;\n\nvoid main()\n{\n\t   uv = hx_texCoord;\n\t   gl_Position = hx_position;\n}",d._files["bloom_threshold_fragment.glsl"]="varying_in vec2 uv;\n\nuniform sampler2D hx_backbuffer;\n\nuniform float threshold;\n\nvoid main()\n{\n        vec4 color = texture2D(hx_backbuffer, uv);\n        float originalLuminance = .05 + hx_luminance(color);\n        float targetLuminance = max(originalLuminance - threshold, 0.0);\n        hx_FragColor = color * targetLuminance / originalLuminance;\n}\n",d._files["default_post_vertex.glsl"]="vertex_attribute vec4 hx_position;\nvertex_attribute vec2 hx_texCoord;\n\nvarying_out vec2 uv;\n\nvoid main()\n{\n\tuv = hx_texCoord;\n\tgl_Position = hx_position;\n}",d._files["fog_fragment.glsl"]="varying_in vec2 uv;\nvarying_in vec3 viewDir;\n\nuniform vec3 tint;\nuniform float density;\nuniform float startDistance;\nuniform float heightFallOff;\n\nuniform float hx_cameraFrustumRange;\nuniform float hx_cameraNearPlaneDistance;\nuniform vec3 hx_cameraWorldPosition;\n\nuniform sampler2D hx_normalDepthBuffer;\nuniform sampler2D hx_backbuffer;\n\nvoid main()\n{\n    vec4 normalDepth = texture2D(hx_normalDepthBuffer, uv);\n\tvec4 color = texture2D(hx_backbuffer, uv);\n\tfloat depth = hx_decodeLinearDepth(normalDepth);\n\t// do not fog up skybox\n\tif (normalDepth.z == 1.0 && normalDepth.w == 1.0) depth = 0.0;\n\tfloat absViewY = hx_cameraNearPlaneDistance + depth * hx_cameraFrustumRange;\n\tvec3 viewVec = viewDir * absViewY;\n\tfloat fogFactor = max(length(viewVec) - startDistance, 0.0);// * exp(-heightFallOff * hx_cameraWorldPosition.y);\n//    if( abs( viewVec.y ) > 0.1 )\n//\t{\n\t\tfloat t = heightFallOff * (viewVec.z + hx_cameraWorldPosition.z);\n\t\tfogFactor *= saturate(( 1.0 - exp( -t ) ) / t);\n//\t}\n\n\tfloat fog = clamp(exp(-fogFactor * density), 0.0, 1.0);\n\tcolor.xyz = mix(tint, color.xyz, fog);\n\thx_FragColor = color;\n}",d._files["fog_vertex.glsl"]="vertex_attribute vec4 hx_position;\nvertex_attribute vec2 hx_texCoord;\n\nvarying_out vec2 uv;\nvarying_out vec3 viewDir;\n\nuniform mat4 hx_inverseProjectionMatrix;\nuniform mat4 hx_cameraWorldMatrix;\n\nvoid main()\n{\n    uv = hx_texCoord;\n    viewDir = mat3(hx_cameraWorldMatrix) * hx_getLinearDepthViewVector(hx_position.xy, hx_inverseProjectionMatrix);\n    gl_Position = hx_position;\n}",d._files["fxaa_fragment.glsl"]="varying_in vec2 uv;\n\nuniform sampler2D hx_backbuffer;\nuniform vec2 hx_rcpRenderTargetResolution;\nuniform float edgeThreshold;\nuniform float edgeThresholdMin;\nuniform float edgeSharpness;\n\nfloat luminanceHint(vec4 color)\n{\n\treturn .30/.59 * color.r + color.g;\n}\n\nvoid main()\n{\n\tvec4 center = texture2D(hx_backbuffer, uv);\n\tvec2 halfRes = vec2(hx_rcpRenderTargetResolution.x, hx_rcpRenderTargetResolution.y) * .5;\n\tfloat topLeftLum = luminanceHint(texture2D(hx_backbuffer, uv + vec2(-halfRes.x, halfRes.y)));\n\tfloat bottomLeftLum = luminanceHint(texture2D(hx_backbuffer, uv + vec2(-halfRes.x, -halfRes.y)));\n\tfloat topRightLum = luminanceHint(texture2D(hx_backbuffer, uv + vec2(halfRes.x, halfRes.y)));\n\tfloat bottomRightLum = luminanceHint(texture2D(hx_backbuffer, uv + vec2(halfRes.x, -halfRes.y)));\n\n\tfloat centerLum = luminanceHint(center);\n\tfloat minLum = min(min(topLeftLum, bottomLeftLum), min(topRightLum, bottomRightLum));\n\tfloat maxLum = max(max(topLeftLum, bottomLeftLum), max(topRightLum, bottomRightLum));\n\tfloat range = max(centerLum, maxLum) - min(centerLum, minLum);\n\tfloat threshold = max(edgeThresholdMin, maxLum * edgeThreshold);\n\tfloat applyFXAA = range < threshold? 0.0 : 1.0;\n\n\tfloat diagDiff1 = bottomLeftLum - topRightLum;\n\tfloat diagDiff2 = bottomRightLum - topLeftLum;\n\tvec2 dir1 = normalize(vec2(diagDiff1 + diagDiff2, diagDiff1 - diagDiff2));\n\tvec4 sampleNeg1 = texture2D(hx_backbuffer, uv - halfRes * dir1);\n\tvec4 samplePos1 = texture2D(hx_backbuffer, uv + halfRes * dir1);\n\n\tfloat minComp = min(abs(dir1.x), abs(dir1.y)) * edgeSharpness;\n\tvec2 dir2 = clamp(dir1.xy / minComp, -2.0, 2.0) * 2.0;\n\tvec4 sampleNeg2 = texture2D(hx_backbuffer, uv - hx_rcpRenderTargetResolution * dir2);\n\tvec4 samplePos2 = texture2D(hx_backbuffer, uv + hx_rcpRenderTargetResolution * dir2);\n\tvec4 tap1 = sampleNeg1 + samplePos1;\n\tvec4 fxaa = (tap1 + sampleNeg2 + samplePos2) * .25;\n\tfloat fxaaLum = luminanceHint(fxaa);\n\tif ((fxaaLum < minLum) || (fxaaLum > maxLum))\n\t\tfxaa = tap1 * .5;\n\thx_FragColor = mix(center, fxaa, applyFXAA);\n}",d._files["gaussian_blur_fragment.glsl"]="varying_in vec2 uv;\n\nuniform sampler2D sourceTexture;\n\nuniform vec2 stepSize;\n\nuniform float gaussianWeights[NUM_WEIGHTS];\n\nvoid main()\n{\n\tvec4 total = texture2D(sourceTexture, uv) * gaussianWeights[0];\n    vec2 offset = vec2(0.0);\n\n\tfor (int i = 1; i <= RADIUS; ++i) {\n\t\toffset += stepSize;\n\t    vec4 s = texture2D(sourceTexture, uv + offset) + texture2D(sourceTexture, uv - offset);\n\t\ttotal += s * gaussianWeights[i];\n\t}\n\n\thx_FragColor = total;\n}",d._files["gaussian_blur_vertex.glsl"]="vertex_attribute vec4 hx_position;\nvertex_attribute vec2 hx_texCoord;\n\nvarying_out vec2 uv;\n\nvoid main()\n{\n\tuv = hx_texCoord;\n\tgl_Position = hx_position;\n}",d._files["post_viewpos_vertex.glsl"]="vertex_attribute vec4 hx_position;\nvertex_attribute vec2 hx_texCoord;\n\nvarying_out vec2 uv;\nvarying_out vec3 viewDir;\n\nuniform mat4 hx_inverseProjectionMatrix;\n\nvoid main()\n{\n    uv = hx_texCoord;\n    viewDir = hx_getLinearDepthViewVector(hx_position.xy, hx_inverseProjectionMatrix);\n    gl_Position = hx_position;\n}",d._files["ssr_fragment.glsl"]='#derivatives\n\n// TODO: This won\'t work anymore\nuniform sampler2D hx_gbufferColor;\nuniform sampler2D hx_gbufferNormals;\nuniform sampler2D hx_gbufferSpecular;\nuniform sampler2D hx_gbufferDepth;\nuniform sampler2D hx_dither2D;\nuniform vec2 hx_renderTargetResolution;\n\nuniform sampler2D hx_frontbuffer;\n\nvarying_in vec2 uv;\nvarying_in vec3 viewDir;\n\nuniform vec2 ditherTextureScale;\nuniform float hx_cameraNearPlaneDistance;\nuniform float hx_cameraFrustumRange;\nuniform float hx_rcpCameraFrustumRange;\nuniform mat4 hx_projectionMatrix;\n\nuniform float maxDistance;\nuniform float stepSize;\nuniform float maxRoughness;\n\n// all in viewspace\n// 0 is start, 1 is end\nfloat raytrace(in vec3 ray0, in vec3 rayDir, out float hitZ, out vec2 hitUV)\n{\n    vec4 dither = hx_sampleDefaultDither(hx_dither2D, uv * ditherTextureScale);\n    // Clip to the near plane\n\tfloat rayLength = ((ray0.z + rayDir.z * maxDistance) > -hx_cameraNearPlaneDistance) ?\n\t\t\t\t\t\t(-hx_cameraNearPlaneDistance - ray0.z) / rayDir.z : maxDistance;\n\n    vec3 ray1 = ray0 + rayDir * rayLength;\n\n    // only need the w component for perspective correct interpolation\n    // need to get adjusted ray end\'s uv value\n    vec4 hom0 = hx_projectionMatrix * vec4(ray0, 1.0);\n    vec4 hom1 = hx_projectionMatrix * vec4(ray1, 1.0);\n    float rcpW0 = 1.0 / hom0.w;\n    float rcpW1 = 1.0 / hom1.w;\n\n    hom0 *= rcpW0;\n    hom1 *= rcpW1;\n\n    // expressed in pixels, so we can snap to 1\n    // need to figure out the ratio between 1 pixel and the entire line "width" (if primarily vertical, it\'s actually height)\n\n    // line dimensions in pixels:\n\n    vec2 pixelSize = (hom1.xy - hom0.xy) * hx_renderTargetResolution * .5;\n\n    // line-"width" = max(abs(pixelSize.x), abs(pixelSize.y))\n    // ratio pixel/width = 1 / max(abs(pixelSize.x), abs(pixelSize.y))\n\n    float stepRatio = 1.0 / max(abs(pixelSize.x), abs(pixelSize.y)) * stepSize;\n\n    vec2 uvEnd = hom1.xy * .5 + .5;\n\n    vec2 dUV = (uvEnd - uv) * stepRatio;\n    hitUV = uv;\n\n    // linear depth\n    float rayDepth = (-ray0.z - hx_cameraNearPlaneDistance) * hx_rcpCameraFrustumRange;\n    float rayPerspDepth0 = rayDepth * rcpW0;\n    float rayPerspDepth1 = (-ray1.z - hx_cameraNearPlaneDistance) * hx_rcpCameraFrustumRange * rcpW1;\n    float rayPerspDepth = rayPerspDepth0;\n    // could probably optimize this:\n    float dRayD = (rayPerspDepth1 - rayPerspDepth0) * stepRatio;\n\n    float rcpW = rcpW0;\n    float dRcpW = (rcpW1 - rcpW0) * stepRatio;\n    float sceneDepth = rayDepth;\n\n    float amount = 0.0;\n\n    hitUV += dUV * dither.z;\n    rayPerspDepth += dRayD * dither.z;\n    rcpW += dRcpW * dither.z;\n\n    float sampleCount;\n    for (int i = 0; i < NUM_SAMPLES; ++i) {\n        rayDepth = rayPerspDepth / rcpW;\n\n        sceneDepth = hx_sampleLinearDepth(hx_gbufferDepth, hitUV);\n\n        if (rayDepth > sceneDepth + .001) {\n            amount = float(sceneDepth < 1.0);\n            sampleCount = float(i);\n            break;\n        }\n\n        hitUV += dUV;\n        rayPerspDepth += dRayD;\n        rcpW += dRcpW;\n    }\n\n    hitZ = -hx_cameraNearPlaneDistance - sceneDepth * hx_cameraFrustumRange;\n\n    amount *= clamp((1.0 - (sampleCount - float(NUM_SAMPLES)) / float(NUM_SAMPLES)) * 5.0, 0.0, 1.0);\n    return amount;\n}\n\nvoid main()\n{\n    vec4 colorSample = hx_gammaToLinear(texture2D(hx_gbufferColor, uv));\n    vec4 specularSample = texture2D(hx_gbufferSpecular, uv);\n    float depth = hx_sampleLinearDepth(hx_gbufferDepth, uv);\n    vec3 normalSpecularReflectance;\n    float roughness;\n    float metallicness;\n    hx_decodeReflectionData(colorSample, specularSample, normalSpecularReflectance, roughness, metallicness);\n    vec3 normal = hx_decodeNormal(texture2D(hx_gbufferNormals, uv));\n    vec3 reflDir = reflect(normalize(viewDir), normal);\n\n    vec3 fresnel = hx_fresnel(normalSpecularReflectance, reflDir, normal);\n    // not physically correct, but attenuation is required to look good\n\n    // step for every pixel\n\n    float absViewY = hx_cameraNearPlaneDistance + depth * hx_cameraFrustumRange;\n    vec3 viewSpacePos = absViewY * viewDir;\n\n    float hitY = 0.0;\n    vec2 hitUV;\n    float amount = raytrace(viewSpacePos, reflDir, hitY, hitUV);\n    float fadeFactor = 1.0 - clamp(reflDir.z * 2.0, 0.0, 1.0);\n\n    vec2 borderFactors = abs(hitUV * 2.0 - 1.0);\n    borderFactors = (1.0 - borderFactors) * 10.0;\n    fadeFactor *= clamp(borderFactors.x, 0.0, 1.0) * clamp(borderFactors.y, 0.0, 1.0);\n\n    float diff = viewSpacePos.y - hitY;\n    fadeFactor *= hx_linearStep(-1.0, 0.0, diff);\n    fadeFactor *= hx_linearStep(maxRoughness, 0.0, roughness);\n\n    vec4 reflColor = texture2D(hx_frontbuffer, hitUV);\n\n    float amountUsed = amount * fadeFactor;\n    hx_FragColor = vec4(fresnel * reflColor.xyz, amountUsed);\n}\n\n',d._files["ssr_stencil_fragment.glsl"]="uniform sampler2D hx_gbufferSpecular;\n\nvarying_in vec2 uv;\n\nuniform float maxRoughness;\n\nvoid main()\n{\n    vec4 specularSample = texture2D(hx_gbufferSpecular, uv);\n    if (specularSample.x > maxRoughness)\n        discard;\n}\n\n",d._files["tonemap_filmic_fragment.glsl"]="void main()\n{\n\tvec3 x = hx_getToneMapScaledColor().xyz * 16.0;\n\n    // Uncharted 2 tonemapping (http://filmicworlds.com/blog/filmic-tonemapping-operators/)\n\n\tfloat A = 0.15;\n    float B = 0.50;\n    float C = 0.10;\n    float D = 0.20;\n    float E = 0.02;\n    float F = 0.30;\n    float W = 11.2;\n\n    hx_FragColor.xyz = hx_gammaToLinear(((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F);\n    hx_FragColor.w = 1.0;\n}",d._files["tonemap_reference_fragment.glsl"]="varying_in vec2 uv;\n\nuniform sampler2D hx_backbuffer;\n\nvoid main()\n{\n\tvec4 color = texture2D(hx_backbuffer, uv);\n\tfloat lum = clamp(hx_luminance(color), 0.0, 1000.0);\n\tfloat l = log(1.0 + lum);\n\thx_FragColor = vec4(l, l, l, 1.0);\n}",d._files["tonemap_reinhard_fragment.glsl"]="void main()\n{\n\tvec4 color = hx_getToneMapScaledColor();\n\tfloat lum = hx_luminance(color);\n\thx_FragColor = color / (1.0 + lum);\n}",d._files["blend_color_copy_fragment.glsl"]="varying_in vec2 uv;\n\nuniform sampler2D sampler;\n\nuniform vec4 blendColor;\n\nvoid main()\n{\n    // extractChannel comes from a macro\n   hx_FragColor = texture2D(sampler, uv) * blendColor;\n}\n",d._files["copy_fragment.glsl"]="varying_in vec2 uv;\n\nuniform sampler2D sampler;\n\nvoid main()\n{\n    // extractChannel comes from a macro\n   hx_FragColor = vec4(extractChannels(texture2D(sampler, uv)));\n\n#ifndef COPY_ALPHA\n   hx_FragColor.a = 1.0;\n#endif\n}\n",d._files["copy_to_gamma_fragment.glsl"]="varying_in vec2 uv;\n\nuniform sampler2D sampler;\n\nvoid main()\n{\n   hx_FragColor = hx_linearToGamma(texture2D(sampler, uv));\n}",d._files["copy_vertex.glsl"]="vertex_attribute vec4 hx_position;\nvertex_attribute vec2 hx_texCoord;\n\nvarying_out vec2 uv;\n\nvoid main()\n{\n    uv = hx_texCoord;\n    gl_Position = hx_position;\n}",d._files["null_fragment.glsl"]="void main()\n{\n   hx_FragColor = vec4(1.0);\n}\n",d._files["null_vertex.glsl"]="vertex_attribute vec4 hx_position;\n\nvoid main()\n{\n    gl_Position = hx_position;\n}",d._files["esm_blur_fragment.glsl"]="varying_in vec2 uv;\n\nuniform sampler2D source;\nuniform vec2 direction; // this is 1/pixelSize\n\nfloat readValue(vec2 coord)\n{\n    float v = texture2D(source, coord).x;\n    return v;\n//    return exp(HX_ESM_CONSTANT * v);\n}\n\nvoid main()\n{\n    float total = readValue(uv);\n\n\tfor (int i = 1; i <= RADIUS; ++i) {\n\t    vec2 offset = direction * float(i);\n\t\ttotal += readValue(uv + offset) + readValue(uv - offset);\n\t}\n\n//\thx_FragColor = vec4(log(total * RCP_NUM_SAMPLES) / HX_ESM_CONSTANT);\n\thx_FragColor = vec4(total * RCP_NUM_SAMPLES);\n}",d._files["shadow_esm.glsl"]="vec4 hx_getShadowMapValue(float depth)\n{\n    // I wish we could write exp directly, but precision issues (can't encode real floats)\n    return vec4(exp(HX_ESM_CONSTANT * depth));\n// so when blurring, we'll need to do ln(sum(exp())\n//    return vec4(depth);\n}\n\nfloat hx_readShadow(sampler2D shadowMap, vec4 shadowMapCoord, float depthBias)\n{\n    float shadowSample = texture2D(shadowMap, shadowMapCoord.xy).x;\n    shadowMapCoord.z += depthBias;\n//    float diff = shadowSample - shadowMapCoord.z;\n//    return saturate(HX_ESM_DARKENING * exp(HX_ESM_CONSTANT * diff));\n    return saturate(HX_ESM_DARKENING * shadowSample * exp(-HX_ESM_CONSTANT * shadowMapCoord.z));\n}",d._files["shadow_hard.glsl"]="vec4 hx_getShadowMapValue(float depth)\n{\n    return hx_floatToRGBA8(depth);\n}\n\nfloat hx_readShadow(sampler2D shadowMap, vec4 shadowMapCoord, float depthBias)\n{\n    float shadowSample = hx_RGBA8ToFloat(texture2D(shadowMap, shadowMapCoord.xy));\n    float diff = shadowMapCoord.z - shadowSample - depthBias;\n    return float(diff < 0.0);\n}",d._files["shadow_pcf.glsl"]="#ifdef HX_PCF_DITHER_SHADOWS\n    uniform sampler2D hx_dither2D;\n    uniform vec2 hx_dither2DTextureScale;\n#endif\n\nuniform vec2 hx_poissonDisk[32];\n\nvec4 hx_getShadowMapValue(float depth)\n{\n    return hx_floatToRGBA8(depth);\n}\n\nfloat hx_readShadow(sampler2D shadowMap, vec4 shadowMapCoord, float depthBias)\n{\n    float shadowTest = 0.0;\n\n    #ifdef HX_PCF_DITHER_SHADOWS\n        vec4 dither = hx_sampleDefaultDither(hx_dither2D, gl_FragCoord.xy * hx_dither2DTextureScale);\n        dither = vec4(dither.x, -dither.y, dither.y, dither.x) * HX_PCF_SOFTNESS;  // add radius scale\n    #endif\n\n    for (int i = 0; i < HX_PCF_NUM_SHADOW_SAMPLES; ++i) {\n        vec2 offset;\n        #ifdef HX_PCF_DITHER_SHADOWS\n        offset.x = dot(dither.xy, hx_poissonDisk[i]);\n        offset.y = dot(dither.zw, hx_poissonDisk[i]);\n        #else\n        offset = hx_poissonDisk[i] * HX_PCF_SOFTNESS;\n        #endif\n        float shadowSample = hx_RGBA8ToFloat(texture2D(shadowMap, shadowMapCoord.xy + offset));\n        float diff = shadowMapCoord.z - shadowSample - depthBias;\n        shadowTest += float(diff < 0.0);\n    }\n\n    return shadowTest * HX_PCF_RCP_NUM_SHADOW_SAMPLES;\n}",d._files["shadow_vsm.glsl"]="#derivatives\n\nvec4 hx_getShadowMapValue(float depth)\n{\n    float dx = dFdx(depth);\n    float dy = dFdy(depth);\n    float moment2 = depth * depth + 0.25*(dx*dx + dy*dy);\n\n    #if defined(HX_HALF_FLOAT_TEXTURES_LINEAR) || defined(HX_FLOAT_TEXTURES_LINEAR)\n    return vec4(depth, moment2, 0.0, 1.0);\n    #else\n    return vec4(hx_floatToRG8(depth), hx_floatToRG8(moment2));\n    #endif\n}\n\nfloat hx_readShadow(sampler2D shadowMap, vec4 shadowMapCoord, float depthBias)\n{\n    vec4 s = texture2D(shadowMap, shadowMapCoord.xy);\n    #if defined(HX_HALF_FLOAT_TEXTURES_LINEAR) || defined(HX_FLOAT_TEXTURES_LINEAR)\n    vec2 moments = s.xy;\n    #else\n    vec2 moments = vec2(hx_RG8ToFloat(s.xy), hx_RG8ToFloat(s.zw));\n    #endif\n    shadowMapCoord.z += depthBias;\n\n    float variance = moments.y - moments.x * moments.x;\n    variance = max(variance, HX_VSM_MIN_VARIANCE);\n\n    float diff = shadowMapCoord.z - moments.x;\n    float upperBound = 1.0;\n\n    // transparents could be closer to the light than casters\n    if (diff > 0.0)\n        upperBound = variance / (variance + diff*diff);\n\n    return saturate((upperBound - HX_VSM_LIGHT_BLEED_REDUCTION) * HX_VSM_RCP_LIGHT_BLEED_REDUCTION_RANGE);\n}",d._files["vsm_blur_fragment.glsl"]="varying_in vec2 uv;\n\nuniform sampler2D source;\nuniform vec2 direction; // this is 1/pixelSize\n\nvec2 readValues(vec2 coord)\n{\n    vec4 s = texture2D(source, coord);\n    #if defined(HX_HALF_FLOAT_TEXTURES_LINEAR) || defined(HX_FLOAT_TEXTURES_LINEAR)\n    return s.xy;\n    #else\n    return vec2(hx_RG8ToFloat(s.xy), hx_RG8ToFloat(s.zw));\n    #endif\n}\n\nvoid main()\n{\n    vec2 total = readValues(uv);\n\n\tfor (int i = 1; i <= RADIUS; ++i) {\n\t    vec2 offset = direction * float(i);\n\t\ttotal += readValues(uv + offset) + readValues(uv - offset);\n\t}\n\n    total *= RCP_NUM_SAMPLES;\n\n#if defined(HX_HALF_FLOAT_TEXTURES_LINEAR) || defined(HX_FLOAT_TEXTURES_LINEAR)\n    hx_FragColor = vec4(total, 0.0, 1.0);\n#else\n\thx_FragColor.xy = hx_floatToRG8(total.x);\n\thx_FragColor.zw = hx_floatToRG8(total.y);\n#endif\n}",d._files["2d_to_cube_vertex.glsl"]="// position to write to\nvertex_attribute vec4 hx_position;\n\n// the corner of the cube map\nvertex_attribute vec3 corner;\n\nvarying_out vec3 direction;\n\nvoid main()\n{\n    direction = corner;\n    gl_Position = hx_position;\n}\n",d._files["equirectangular_to_cube_fragment.glsl"]="#define RECIPROCAL_PI2 0.15915494\n\nvarying_in vec3 direction;\n\nuniform sampler2D source;\n\nvoid main()\n{\n    vec3 dir = normalize(direction);\n    vec2 uv;\n    uv.x = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tuv.y = dir.y * 0.5 + 0.5;\n    hx_FragColor = texture2D(source, uv);\n}\n",d._files["greyscale_to_rgba8.glsl"]="varying_in vec2 uv;\n\nuniform sampler2D source;\n\nvoid main()\n{\n    hx_FragColor = hx_floatToRGBA8(texture2D(source, uv).x);\n}\n",d._files["smooth_heightmap_fragment.glsl"]="varying_in vec2 uv;\n\nuniform sampler2D reference;    // the source (8 bit) texture\nuniform sampler2D source;\n\nuniform vec2 stepSize;\n\nvoid main()\n{\n    float gauss[4];\n    gauss[0] = 0.201788613113303;\n    gauss[1] = 0.17755834971394;\n    gauss[2] = 0.120969095455128;\n    gauss[3] = 0.063811162332456;\n    float refHeight = texture2D(reference, uv).x;\n    float total = hx_RGBA8ToFloat(texture2D(source, uv)) * gauss[0];\n    float totalWeight = gauss[0];\n    float currentWeightL = 1.0;\n    float currentWeightR = 1.0;\n    vec2 offset = vec2(0.0);\n\n\n    for (int i = 0; i < 3; ++i) {\n        offset += stepSize;\n        float refLeft = texture2D(reference, uv - offset).x;\n        float refRight = texture2D(reference, uv + offset).x;\n        float heightLeft = hx_RGBA8ToFloat(texture2D(source, uv - offset));\n        float heightRight = hx_RGBA8ToFloat(texture2D(source, uv + offset));\n        // smooth out over N pixels that have the same reference height in the source image\n        currentWeightL = max(currentWeightL - abs(refLeft - refHeight) * 5.0, 0.0);\n        currentWeightR = max(currentWeightR - abs(refRight - refHeight) * 5.0, 0.0);\n        totalWeight += (currentWeightL + currentWeightR) * gauss[i + 1];\n        total += (heightLeft * currentWeightL + heightRight * currentWeightR) *  gauss[i + 1];\n    }\n\n    hx_FragColor = hx_floatToRGBA8(total / totalWeight);\n//    hx_FragColor = hx_floatToRGBA8(refHeight);\n}\n",d._files["snippets_general.glsl"]="#define HX_LOG_10 2.302585093\n\n#ifdef HX_GLSL_300_ES\n// replace some outdated function names\nvec4 texture2D(sampler2D s, vec2 uv) { return texture(s, uv); }\nvec4 textureCube(samplerCube s, vec3 uvw) { return texture(s, uvw); }\n\n#define vertex_attribute in\n#define varying_in in\n#define varying_out out\n\n#ifdef HX_FRAGMENT_SHADER\nout vec4 hx_FragColor;\n#endif\n\n#else\n\n#define vertex_attribute attribute\n#define varying_in varying\n#define varying_out varying\n#define hx_FragColor gl_FragColor\n\n#endif\n\nfloat saturate(float value)\n{\n    return clamp(value, 0.0, 1.0);\n}\n\nvec2 saturate(vec2 value)\n{\n    return clamp(value, 0.0, 1.0);\n}\n\nvec3 saturate(vec3 value)\n{\n    return clamp(value, 0.0, 1.0);\n}\n\nvec4 saturate(vec4 value)\n{\n    return clamp(value, 0.0, 1.0);\n}\n\n// Only for 0 - 1\nvec4 hx_floatToRGBA8(float value)\n{\n    vec4 enc = value * vec4(1.0, 255.0, 65025.0, 16581375.0);\n    // cannot fract first value or 1 would not be encodable\n    enc.yzw = fract(enc.yzw);\n    return enc - enc.yzww * vec4(1.0/255.0, 1.0/255.0, 1.0/255.0, 0.0);\n}\n\nfloat hx_RGBA8ToFloat(vec4 rgba)\n{\n    return dot(rgba, vec4(1.0, 1.0/255.0, 1.0/65025.0, 1.0/16581375.0));\n}\n\nvec2 hx_floatToRG8(float value)\n{\n    vec2 enc = vec2(1.0, 255.0) * value;\n    enc.y = fract(enc.y);\n    enc.x -= enc.y / 255.0;\n    return enc;\n}\n\nfloat hx_RG8ToFloat(vec2 rg)\n{\n    return dot(rg, vec2(1.0, 1.0/255.0));\n}\n\nvec2 hx_encodeNormal(vec3 normal)\n{\n    vec2 data;\n    float p = sqrt(-normal.y*8.0 + 8.0);\n    data = normal.xz / p + .5;\n    return data;\n}\n\nvec3 hx_decodeNormal(vec4 data)\n{\n    vec3 normal;\n    data.xy = data.xy*4.0 - 2.0;\n    float f = dot(data.xy, data.xy);\n    float g = sqrt(1.0 - f * .25);\n    normal.xz = data.xy * g;\n    normal.y = -(1.0 - f * .5);\n    return normal;\n}\n\nfloat hx_log10(float val)\n{\n    return log(val) / HX_LOG_10;\n}\n\nvec4 hx_gammaToLinear(vec4 color)\n{\n    #if defined(HX_GAMMA_CORRECTION_PRECISE)\n        color.x = pow(color.x, 2.2);\n        color.y = pow(color.y, 2.2);\n        color.z = pow(color.z, 2.2);\n    #elif defined(HX_GAMMA_CORRECTION_FAST)\n        color.xyz *= color.xyz;\n    #endif\n    return color;\n}\n\nvec3 hx_gammaToLinear(vec3 color)\n{\n    #if defined(HX_GAMMA_CORRECTION_PRECISE)\n        color.x = pow(color.x, 2.2);\n        color.y = pow(color.y, 2.2);\n        color.z = pow(color.z, 2.2);\n    #elif defined(HX_GAMMA_CORRECTION_FAST)\n        color.xyz *= color.xyz;\n    #endif\n    return color;\n}\n\nvec4 hx_linearToGamma(vec4 linear)\n{\n    #if defined(HX_GAMMA_CORRECTION_PRECISE)\n        linear.x = pow(linear.x, 0.454545);\n        linear.y = pow(linear.y, 0.454545);\n        linear.z = pow(linear.z, 0.454545);\n    #elif defined(HX_GAMMA_CORRECTION_FAST)\n        linear.xyz = sqrt(linear.xyz);\n    #endif\n    return linear;\n}\n\nvec3 hx_linearToGamma(vec3 linear)\n{\n    #if defined(HX_GAMMA_CORRECTION_PRECISE)\n        linear.x = pow(linear.x, 0.454545);\n        linear.y = pow(linear.y, 0.454545);\n        linear.z = pow(linear.z, 0.454545);\n    #elif defined(HX_GAMMA_CORRECTION_FAST)\n        linear.xyz = sqrt(linear.xyz);\n    #endif\n    return linear;\n}\n\n/*float hx_sampleLinearDepth(sampler2D tex, vec2 uv)\n{\n    return hx_RGBA8ToFloat(texture2D(tex, uv));\n}*/\n\nfloat hx_decodeLinearDepth(vec4 samp)\n{\n    return hx_RG8ToFloat(samp.zw);\n}\n\nvec3 hx_getFrustumVector(vec2 position, mat4 unprojectionMatrix)\n{\n    vec4 unprojNear = unprojectionMatrix * vec4(position, -1.0, 1.0);\n    vec4 unprojFar = unprojectionMatrix * vec4(position, 1.0, 1.0);\n    return unprojFar.xyz/unprojFar.w - unprojNear.xyz/unprojNear.w;\n}\n\n// view vector with z = 1, so we can use nearPlaneDist + linearDepth * (farPlaneDist - nearPlaneDist) as a scale factor to find view space position\nvec3 hx_getLinearDepthViewVector(vec2 position, mat4 unprojectionMatrix)\n{\n    vec4 unproj = unprojectionMatrix * vec4(position, 0.0, 1.0);\n    unproj /= unproj.w;\n    return unproj.xyz / unproj.y;\n}\n\n// THIS IS FOR NON_LINEAR DEPTH!\nfloat hx_depthToViewY(float depthSample, mat4 projectionMatrix)\n{\n    // View Y maps to NDC Z!!!\n    // y = projectionMatrix[3][2] / (d * 2.0 - 1.0 + projectionMatrix[1][2])\n    return projectionMatrix[3][2] / (depthSample * 2.0 - 1.0 + projectionMatrix[1][2]);\n}\n\nvec3 hx_getNormalSpecularReflectance(float metallicness, float insulatorNormalSpecularReflectance, vec3 color)\n{\n    return mix(vec3(insulatorNormalSpecularReflectance), color, metallicness);\n}\n\nvec3 hx_fresnel(vec3 normalSpecularReflectance, vec3 lightDir, vec3 halfVector)\n{\n    float cosAngle = 1.0 - max(dot(halfVector, lightDir), 0.0);\n    // to the 5th power\n    float power = pow(cosAngle, 5.0);\n    return normalSpecularReflectance + (1.0 - normalSpecularReflectance) * power;\n}\n\n// https://seblagarde.wordpress.com/2011/08/17/hello-world/\nvec3 hx_fresnelProbe(vec3 normalSpecularReflectance, vec3 lightDir, vec3 normal, float roughness)\n{\n    float cosAngle = 1.0 - max(dot(normal, lightDir), 0.0);\n    // to the 5th power\n    float power = pow(cosAngle, 5.0);\n    float gloss = (1.0 - roughness) * (1.0 - roughness);\n    vec3 bound = max(vec3(gloss), normalSpecularReflectance);\n    return normalSpecularReflectance + (bound - normalSpecularReflectance) * power;\n}\n\n\nfloat hx_luminance(vec4 color)\n{\n    return dot(color.xyz, vec3(.30, 0.59, .11));\n}\n\nfloat hx_luminance(vec3 color)\n{\n    return dot(color, vec3(.30, 0.59, .11));\n}\n\n// linear variant of smoothstep\nfloat hx_linearStep(float lower, float upper, float x)\n{\n    return clamp((x - lower) / (upper - lower), 0.0, 1.0);\n}\n\nvec4 hx_sampleDefaultDither(sampler2D ditherTexture, vec2 uv)\n{\n    vec4 s = texture2D(ditherTexture, uv);\n\n    #ifndef HX_FLOAT_TEXTURES\n    s = s * 2.0 - 1.0;\n    #endif\n\n    return s;\n}\n\nvec3 hx_intersectCubeMap(vec3 rayOrigin, vec3 cubeCenter, vec3 rayDir, float cubeSize)\n{\n    vec3 t = (cubeSize * sign(rayDir) - (rayOrigin - cubeCenter)) / rayDir;\n    float minT = min(min(t.x, t.y), t.z);\n    return rayOrigin + minT * rayDir;\n}\n\n// sadly, need a parameter due to a bug in Internet Explorer / Edge. Just pass in 0.\n#ifdef HX_USE_SKINNING_TEXTURE\n#define HX_RCP_MAX_SKELETON_JOINTS 1.0 / float(HX_MAX_SKELETON_JOINTS - 1)\nmat4 hx_getSkinningMatrixImpl(vec4 weights, vec4 indices, sampler2D tex)\n{\n    mat4 m = mat4(0.0);\n    for (int i = 0; i < 4; ++i) {\n        mat4 t;\n        float index = indices[i] * HX_RCP_MAX_SKELETON_JOINTS;\n        t[0] = texture2D(tex, vec2(index, 0.0));\n        t[1] = texture2D(tex, vec2(index, 0.5));\n        t[2] = texture2D(tex, vec2(index, 1.0));\n        t[3] = vec4(0.0, 0.0, 0.0, 1.0);\n        m += weights[i] * t;\n    }\n    return m;\n}\n#define hx_getSkinningMatrix(v) hx_getSkinningMatrixImpl(hx_jointWeights, hx_jointIndices, hx_skinningTexture)\n#else\n#define hx_getSkinningMatrix(v) ( hx_jointWeights.x * mat4(hx_skinningMatrices[int(hx_jointIndices.x) * 3], hx_skinningMatrices[int(hx_jointIndices.x) * 3 + 1], hx_skinningMatrices[int(hx_jointIndices.x) * 3 + 2], vec4(0.0, 0.0, 0.0, 1.0)) + hx_jointWeights.y * mat4(hx_skinningMatrices[int(hx_jointIndices.y) * 3], hx_skinningMatrices[int(hx_jointIndices.y) * 3 + 1], hx_skinningMatrices[int(hx_jointIndices.y) * 3 + 2], vec4(0.0, 0.0, 0.0, 1.0)) + hx_jointWeights.z * mat4(hx_skinningMatrices[int(hx_jointIndices.z) * 3], hx_skinningMatrices[int(hx_jointIndices.z) * 3 + 1], hx_skinningMatrices[int(hx_jointIndices.z) * 3 + 2], vec4(0.0, 0.0, 0.0, 1.0)) + hx_jointWeights.w * mat4(hx_skinningMatrices[int(hx_jointIndices.w) * 3], hx_skinningMatrices[int(hx_jointIndices.w) * 3 + 1], hx_skinningMatrices[int(hx_jointIndices.w) * 3 + 2], vec4(0.0, 0.0, 0.0, 1.0)) )\n#endif",d._files["snippets_geometry.glsl"]="struct HX_GeometryData\n{\n    vec4 color;\n    vec3 normal;\n    float metallicness;\n    float normalSpecularReflectance;\n    float roughness;\n    float occlusion;\n    vec3 emission;\n    vec4 data;  // this can be anything the lighting model requires (only works with forward rendering)\n};",d._files["snippets_tonemap.glsl"]="varying_in vec2 uv;\n\n#ifdef HX_ADAPTIVE\nuniform sampler2D hx_luminanceMap;\nuniform float hx_luminanceMipLevel;\n#endif\n\nuniform float hx_exposure;\nuniform float hx_key;\n\nuniform sampler2D hx_backbuffer;\n\n\nvec4 hx_getToneMapScaledColor()\n{\n    #ifdef HX_ADAPTIVE\n    #ifdef HX_GLSL_300_ES\n    float referenceLuminance = textureLod(hx_luminanceMap, uv, hx_luminanceMipLevel).x;\n    #else\n    float referenceLuminance = texture2DLodEXT(hx_luminanceMap, uv, hx_luminanceMipLevel).x;\n    #endif\n    referenceLuminance = exp(referenceLuminance) - 1.0;\n    referenceLuminance = clamp(referenceLuminance, .08, 1000.0);\n\tfloat exposure = hx_key / referenceLuminance * hx_exposure;\n\t#else\n\tfloat exposure = hx_exposure;\n\t#endif\n    return texture2D(hx_backbuffer, uv) * exposure;\n}",d._files["ao_blur_fragment.glsl"]="varying_in vec2 uv1;\nvarying_in vec2 uv2;\nvarying_in vec2 uv3;\nvarying_in vec2 uv4;\n\nuniform sampler2D source;\n\nvoid main()\n{\n    vec4 total = texture2D(source, uv1) + texture2D(source, uv2) + texture2D(source, uv3) + texture2D(source, uv4);\n\thx_FragColor = total * .25;\n}",d._files["ao_blur_vertex.glsl"]="vertex_attribute vec4 hx_position;\nvertex_attribute vec2 hx_texCoord;\n\nvarying_out vec2 uv1;\nvarying_out vec2 uv2;\nvarying_out vec2 uv3;\nvarying_out vec2 uv4;\n\nuniform vec2 pixelSize;\n\nvoid main()\n{\n\tuv1 = hx_texCoord + vec2(-1.5, .5) * pixelSize;\n\tuv2 = hx_texCoord + vec2(.5, .5) * pixelSize;\n\tuv3 = hx_texCoord + vec2(.5, -1.5) * pixelSize;\n\tuv4 = hx_texCoord + vec2(-1.5, -1.5) * pixelSize;\n\tgl_Position = hx_position;\n}",d._files["hbao_fragment.glsl"]="uniform float hx_cameraFrustumRange;\nuniform float hx_cameraNearPlaneDistance;\nuniform vec2 hx_rcpRenderTargetResolution;\nuniform mat4 hx_projectionMatrix;\n\nuniform float strengthPerRay;\nuniform float halfSampleRadius;\nuniform float bias;\nuniform float rcpFallOffDistance;\nuniform vec2 ditherScale;\n\nuniform sampler2D hx_normalDepthBuffer;\nuniform sampler2D sampleDirTexture;\nuniform sampler2D ditherTexture;\n\nvarying_in vec2 uv;\nvarying_in vec3 viewDir;\nvarying_in vec3 frustumCorner;\n\nvec3 getViewPos(vec2 sampleUV)\n{\n    vec4 smp = texture2D(hx_normalDepthBuffer, sampleUV);\n    float depth = hx_decodeLinearDepth(smp);\n    float viewY = hx_cameraNearPlaneDistance + depth * hx_cameraFrustumRange;\n    vec3 viewPos = frustumCorner * vec3(sampleUV.x * 2.0 - 1.0, 1.0, sampleUV.y * 2.0 - 1.0);\n    return viewPos * viewY;\n}\n\n// Retrieves the occlusion factor for a particular sample\nfloat getSampleOcclusion(vec2 sampleUV, vec3 centerViewPos, vec3 centerNormal, vec3 tangent, inout float topOcclusion)\n{\n    vec3 sampleViewPos = getViewPos(sampleUV);\n\n    // get occlusion factor based on candidate horizon elevation\n    vec3 horizonVector = sampleViewPos - centerViewPos;\n    float horizonVectorLength = length(horizonVector);\n\n    float occlusion;\n\n    // If the horizon vector points away from the tangent, make an estimate\n    if (dot(tangent, horizonVector) < 0.0)\n        occlusion = .5;\n    else\n        occlusion = dot(centerNormal, horizonVector) / horizonVectorLength;\n\n    // this adds occlusion only if angle of the horizon vector is higher than the previous highest one without branching\n    float diff = max(occlusion - topOcclusion, 0.0);\n    topOcclusion = max(occlusion, topOcclusion);\n\n    // attenuate occlusion contribution using distance function 1 - (d/f)^2\n    float distanceFactor = 1.0 - saturate(horizonVectorLength * rcpFallOffDistance);\n    return diff * distanceFactor;\n}\n\n// Retrieves the occlusion for a given ray\nfloat getRayOcclusion(vec2 direction, float jitter, vec2 projectedRadii, vec3 centerViewPos, vec3 centerNormal)\n{\n    // calculate the nearest neighbour sample along the direction vector\n    vec2 texelSizedStep = direction * hx_rcpRenderTargetResolution;\n    direction *= projectedRadii;\n\n    // gets the tangent for the current ray, this will be used to handle opposing horizon vectors\n    // Tangent is corrected with respect to face normal by projecting it onto the tangent plane defined by the normal\n    vec3 tangent = getViewPos(uv + texelSizedStep) - centerViewPos;\n    tangent -= dot(centerNormal, tangent) * centerNormal;\n\n    vec2 stepUV = direction.xy / float(NUM_SAMPLES_PER_RAY - 1);\n\n    // jitter the starting position for ray marching between the nearest neighbour and the sample step size\n    vec2 jitteredOffset = mix(texelSizedStep, stepUV, jitter);\n    //stepUV *= 1.0 + jitter * .1;\n    vec2 sampleUV = uv + jitteredOffset;\n\n    // top occlusion keeps track of the occlusion contribution of the last found occluder.\n    // set to bias value to avoid near-occluders\n    float topOcclusion = bias;\n    float occlusion = 0.0;\n\n    // march!\n    for (int step = 0; step < NUM_SAMPLES_PER_RAY; ++step) {\n        occlusion += getSampleOcclusion(sampleUV, centerViewPos, centerNormal, tangent, topOcclusion);\n        sampleUV += stepUV;\n    }\n\n    return occlusion;\n}\n\nvoid main()\n{\n    vec4 normalDepth = texture2D(hx_normalDepthBuffer, uv);\n    vec3 centerNormal = hx_decodeNormal(normalDepth);\n    float centerDepth = hx_decodeLinearDepth(normalDepth);\n    float viewY = hx_cameraNearPlaneDistance + centerDepth * hx_cameraFrustumRange;\n    vec3 centerViewPos = viewY * viewDir;\n\n    // clamp z to a minimum, so the radius does not get excessively large in screen-space\n    float projRadius = halfSampleRadius / max(centerViewPos.y, 7.0);\n    vec2 projectedRadii = projRadius * vec2(hx_projectionMatrix[0][0], hx_projectionMatrix[1][2]);\n\n    // do not take more steps than there are pixels\n    float totalOcclusion = 0.0;\n\n    vec2 randomFactors = texture2D(ditherTexture, uv * ditherScale).xy;\n\n    vec2 rayUV = vec2(0.0);\n    for (int i = 0; i < NUM_RAYS; ++i) {\n        rayUV.x = (float(i) + randomFactors.x) / float(NUM_RAYS);\n        vec2 sampleDir = texture2D(sampleDirTexture, rayUV).xy * 2.0 - 1.0;\n        totalOcclusion += getRayOcclusion(sampleDir, randomFactors.y, projectedRadii, centerViewPos, centerNormal);\n    }\n\n    totalOcclusion = 1.0 - clamp(strengthPerRay * totalOcclusion, 0.0, 1.0);\n    hx_FragColor = vec4(vec3(totalOcclusion), 1.0);\n}",d._files["hbao_vertex.glsl"]="vertex_attribute vec4 hx_position;\nvertex_attribute vec2 hx_texCoord;\n\nuniform mat4 hx_inverseProjectionMatrix;\n\nvarying_out vec2 uv;\nvarying_out vec3 viewDir;\nvarying_out vec3 frustumCorner;\n\nvoid main()\n{\n    uv = hx_texCoord;\n    viewDir = hx_getLinearDepthViewVector(hx_position.xy, hx_inverseProjectionMatrix);\n    frustumCorner = hx_getLinearDepthViewVector(vec2(1.0, 1.0), hx_inverseProjectionMatrix);\n    gl_Position = hx_position;\n}",d._files["ssao_fragment.glsl"]='uniform mat4 hx_projectionMatrix;\nuniform mat4 hx_cameraWorldMatrix;\nuniform float hx_cameraFrustumRange;\nuniform float hx_cameraNearPlaneDistance;\n\nuniform vec2 ditherScale;\nuniform float strengthPerSample;\nuniform float rcpFallOffDistance;\nuniform float sampleRadius;\nuniform vec3 samples[NUM_SAMPLES]; // w contains bias\n\nuniform sampler2D ditherTexture;\nuniform sampler2D hx_normalDepthBuffer;\n\nvarying_in vec2 uv;\n\nvoid main()\n{\n    vec4 normalDepth = texture2D(hx_normalDepthBuffer, uv);\n    vec3 centerNormal = hx_decodeNormal(normalDepth);\n    float centerDepth = hx_decodeLinearDepth(normalDepth);\n    float totalOcclusion = 0.0;\n    vec3 dither = texture2D(ditherTexture, uv * ditherScale).xyz;\n    vec3 randomPlaneNormal = normalize(dither - .5);\n    float w = hx_cameraNearPlaneDistance + centerDepth * hx_cameraFrustumRange;\n    float centerY = centerDepth * hx_cameraFrustumRange;    // can ignore nearDist\n    vec3 sampleRadii;\n    sampleRadii.xz = sampleRadius * .5 / w * vec2(hx_projectionMatrix[0][0], hx_projectionMatrix[1][2]);\n    sampleRadii.y = sampleRadius;\n\n    for (int i = 0; i < NUM_SAMPLES; ++i) {\n        vec3 sampleOffset = reflect(samples[i], randomPlaneNormal);\n        vec3 normOffset = normalize(sampleOffset);\n\n        // mirror sample position to the positive side of the plane\n        float cosFactor = dot(normOffset, centerNormal);\n        float sign = sign(cosFactor);\n        sampleOffset *= sign;\n        cosFactor *= sign;\n\n        vec3 scaledOffset = sampleOffset * sampleRadii;\n\n        vec2 samplePos = uv + scaledOffset.xz;\n        normalDepth = texture2D(hx_normalDepthBuffer, samplePos);\n        float occluderDepth = hx_decodeLinearDepth(normalDepth);\n\n        // can ignore nearDist\n        float occluderY = hx_cameraFrustumRange * occluderDepth;\n        float sampleY = centerY + scaledOffset.y;\n\n        float distanceFactor = max(1.0 - (sampleY - occluderY) * rcpFallOffDistance, 0.0);\n\n        // at this point, occlusion really means occlusion, and not the output "colour" (ie 1 = completely occluded)\n        float sampleOcclusion = float(occluderY < sampleY);\n\n        // if cosFactor = 0, the sample is coplanar, and occludes less\n        totalOcclusion += sampleOcclusion * distanceFactor * cosFactor;\n    }\n    hx_FragColor = vec4(vec3(1.0 - totalOcclusion * strengthPerSample), 1.0);\n}';var _={shuffle:function(t){for(var e,i,n=t.length;0!==n;)i=Math.floor(Math.random()*n),e=t[n-=1],t[n]=t[i],t[i]=e;return t},forEach:function(t,e){for(var i in t)t.hasOwnProperty(i)&&e(t[i],i)}};function r(){this._listeners=[],this._lookUp={}}function o(){this._isRunning=!1,this._dt=0,this._currentTime=0,this._tickFunc=this._tick.bind(this),this._animationFrame=void 0,this.onTick=new r}function h(t,e,i,n){this.r=0,this.g=0,this.b=0,this.a=1,this.set(t,e,i,n)}r.prototype={bind:function(t,e){this._lookUp[t]=this._listeners.length;var i=e?t.bind(e):t;this._listeners.push(i)},unbind:function(t){var e=this._lookUp[t];void 0!==e&&(this._listeners.splice(e,1),delete this._lookUp[t])},unbindAll:function(){this._listeners=[],this._lookUp={}},dispatch:function(t){for(var e=this._listeners.length,i=0;i<e;++i)this._listeners[i].apply(null,arguments)},get hasListeners(){return 0<this._listeners.length}},o.prototype={start:function(){this._isRunning||(this._currentTime=0,this._isRunning=!0,this._requestAnimationFrame())},stop:function(){this._isRunning=!1,ve.VR_DISPLAY?ve.VR_DISPLAY.cancelAnimationFrame(this._animationFrame):cancelAnimationFrame(this._animationFrame)},get dt(){return this._dt},get time(){return this._currentTime},_tick:function(t){this._isRunning&&(this._requestAnimationFrame(),0===this._currentTime?this._dt=16:this._dt=t-this._currentTime,this._currentTime=t,this._dt<0&&(this._dt=0),this.onTick.dispatch(this._dt))},_requestAnimationFrame:function(){Be.VR_CAN_PRESENT?this._animationFrame=ve.VR_DISPLAY.requestAnimationFrame(this._tickFunc):this._animationFrame=requestAnimationFrame(this._tickFunc)}},h.lerp=function(t,e,i,n){n=n||new h;var s=t.r,r=t.g,o=t.b,a=t.a;return n.r=s+(e.r-s)*i,n.g=r+(e.g-r)*i,n.b=o+(e.b-o)*i,n.a=a+(e.a-a)*i,n},h.prototype={set:function(t,e,i,n){void 0===t?(this.a=1,this.r=1,this.g=1,this.b=1):void 0===e?(this.a=1,this.r=((16711680&t)>>>16)/255,this.g=((65280&t)>>>8)/255,this.b=(255&t)/255):(this.r=t,this.g=e,this.b=i,this.a=void 0===n?1:n)},scale:function(t){this.r*=t,this.g*=t,this.b*=t},hex:function(){return 255*Math.min(this.r,1)<<16|255*Math.min(this.g,1)<<8|255*Math.min(this.b,1)},luminance:function(){return.3*this.r+.59*this.g+.11*this.b},gammaToLinear:function(t){return t=t||new h,ve.OPTIONS.usePreciseGammaCorrection?(t.r=Math.pow(this.r,2.2),t.g=Math.pow(this.g,2.2),t.b=Math.pow(this.b,2.2)):(t.r=this.r*this.r,t.g=this.g*this.g,t.b=this.b*this.b),t.a=this.a,t},linearToGamma:function(t){return t=t||new h,ve.OPTIONS.usePreciseGammaCorrection?(t.r=Math.pow(this.r,.454545),t.g=Math.pow(this.g,.454545),t.b=Math.pow(this.b,.454545)):(t.r=Math.sqrt(this.r),t.g=Math.sqrt(this.g),t.b=Math.sqrt(this.b)),t.a=this.a,t},copyFrom:function(t){this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a},toString:function(){return"Color("+this.r+", "+this.g+", "+this.b+", "+this.a+")"},clone:function(){var t=new h;return t.r=this.r,t.g=this.g,t.b=this.b,t.a=this.a,t}},h.BLACK=new h(0,0,0,1),h.ZERO=new h(0,0,0,0),h.RED=new h(1,0,0,1),h.GREEN=new h(0,1,0,1),h.BLUE=new h(0,0,1,1),h.YELLOW=new h(1,1,0,1),h.MAGENTA=new h(1,0,1,1),h.CYAN=new h(0,1,1,1),h.WHITE=new h(1,1,1,1);var u={GENERAL:"precision highp float;\n\n"+d.get("snippets_general.glsl")+"\n\n",VERSION:""},l={printShaderCode:function(t){for(var e=t.split("\n"),i="",n=0;n<e.length;++n)i+=n+1+":\t"+e[n]+"\n";console.log(i)},printSkeletonHierarchy:function(t){for(var e="Skeleton: \n",i=t.joints,n=0,s=i.length;n<s;++n){for(var r=i[n],o=r.name;-1!==r.parentIndex;)r=i[r.parentIndex],e+="\t";e+="\t"+o+"\n"}console.log(e)},assert:function(t,e){if(!t)throw new Error(e)}};function f(){this.program=null,this.frameMark=0,this.key=null,this.isCached=!0,this.renderOrderHint=0}var p={},g=[],a=0,M=0,A=function(t){var e=g[a];2e3<t-e.frameMark?(delete p[e.key],g.splice(a,1),e.isCached=!1):++a,a===g.length&&(a=0)},m=function(t){var e=p[t.key];return e||(p[t.key]=t,g.push(t),t)},x=function(t,e){var i=t+"///"+e,n=p[i];if(n)return n.frameMark=ve.CURRENT_FRAME_MARK,n;var s=U.gl;t="#define HX_VERTEX_SHADER\n"+u.GENERAL+t,e="#define HX_FRAGMENT_SHADER\n"+u.GENERAL+e;var r=N(t,s.VERTEX_SHADER),o=N(e,s.FRAGMENT_SHADER);if(r&&o){var a=s.createProgram();if(s.attachShader(a,r),s.attachShader(a,o),s.linkProgram(a),!ve.OPTIONS.debug||s.getProgramParameter(a,s.LINK_STATUS))return(n=new f).program=a,n.frameMark=ve.CURRENT_FRAME_MARK,n.key=i,n.isCached=!0,n.renderOrderHint=M++,p[i]=n,g.push(n),n;var h=s.getProgramInfoLog(a);if(console.log("**********"),l.printShaderCode(t),console.log("**********"),l.printShaderCode(e),ve.OPTIONS.throwOnShaderError)throw new Error("Error in program linking:"+h);console.warn("Error in program linking:"+h)}};function T(t,e,i){return t.search(e)<0?t:t="#extension "+i+" : enable\n"+t.replace(e,"")}function y(t,e){for(var i=t.match(e)||[],n={},s=0;s<i.length;++s){var r=i[s];10===(r=r.replace(/(\r|\n)/g,"")).charCodeAt(0)&&(r=r.substring(1));var o=r.indexOf("hx_"),a=r.indexOf(";"),h=r.indexOf("[");0<=h&&h<a&&(a=h);var u=r.substring(o,a);if(!n[u=u.trim()]){n[u]=!0;var l="HX_GUARD_"+u.toUpperCase(),c="\n#ifndef "+l+"\n#define "+l+"\n"+r+"\n#endif\n";r=r.replace(/\[/g,"\\[");var _=new RegExp(r,"g");t=t.replace(_,c)}}return t}function N(t,e){var i;i=y(i=y(i=T(i=T(i=T(i=t,/^\s*#derivatives\s*$/gm,"GL_OES_standard_derivatives"),/^\s*#texturelod\s*$/gm,"GL_EXT_shader_texture_lod"),/^\s*#drawbuffers\s*$/gm,"GL_EXT_draw_buffers"),/^\s*uniform\s+\w+\s+hx_\w+(\[\w+])?\s*;/gm),/^\s*attribute\s+\w+\s+hx_\w+\s*;/gm),t=i=u.VERSION+i;var n,s,r,o=U.gl.createShader(e);if(n=o,s=t,(r=U.gl).shaderSource(n,s),r.compileShader(n),ve.OPTIONS.debug&&!r.getShaderParameter(n,r.COMPILE_STATUS)&&(console.warn(r.getShaderInfoLog(n)),l.printShaderCode(s),1)){if(ve.OPTIONS.throwOnShaderError)throw new Error("Failed generating shader: \n"+t);return console.warn("Failed generating shader"),null}return o}var D=0,E=!0,w=!0,L=!1,I=null,v=!1,S=null,O=null,C=null,j=null,b={numDrawCalls:0,numTriangles:0,numClears:0},P=null,U={gl:null,_setGL:function(t){U.gl=P=t},clear:function(t){void 0===t&&(t=We.COMPLETE),P.clear(t),++b.numClears},drawElements:function(t,e,i,n){n=n||P.UNSIGNED_SHORT,++b.numDrawCalls,b.numTriangles+=e/3,P.drawElements(t,e,n,2*i)},setShader:function(t){null!==t&&(U.gl.useProgram(t.program),t._cachedProgram.isCached||(t._cachedProgram=m(t._cachedProgram)),t._cachedProgram.frameMark=ve.CURRENT_FRAME_MARK)},setViewport:function(t){t?P.viewport(t.x||0,t.y||0,t.width,t.height):P.viewport(0,0,ve.TARGET_CANVAS.width,ve.TARGET_CANVAS.height)},getCurrentRenderTarget:function(){return C},setColorMask:function(t){L||t===w||(w=t,P.colorMask(t,t,t,t))},lockColorMask:function(t){void 0!==t&&U.setColorMask(t),L=!0},unlockColorMask:function(t){void 0!==t&&U.setColorMask(t),L=!1},setRenderTarget:function(t){var e=C=t;e?(P.bindFramebuffer(P.FRAMEBUFFER,e._fbo),1<e._numColorTextures&&(Be.WEBGL_2?P.drawBuffers(e._drawBuffers):Be.EXT_DRAW_BUFFERS.drawBuffersWEBGL(e._drawBuffers))):P.bindFramebuffer(P.FRAMEBUFFER,null),U.setViewport(t)},enableAttributes:function(t){var e,i=D;if(i<t)for(e=i;e<t;++e)P.enableVertexAttribArray(e);else if(t<i)for(e=t+=1;e<i;++e)P.disableVertexAttribArray(e);D=t},setClearColor:function(t){t=t instanceof h?t:new h(t),P.clearColor(t.r,t.g,t.b,t.a)},setCullMode:function(t){if(I!==t){if(t===Ye.NONE)P.disable(P.CULL_FACE);else{I===Ye.NONE&&P.enable(P.CULL_FACE);var e=t;v&&(e===Ye.BACK?e=Ye.FRONT:e===Ye.FRONT&&(e=Ye.BACK)),P.cullFace(e)}I=t}},setInvertCulling:function(t){v!==t&&(v=t,I=Ye.NONE)},setDepthMask:function(t){E!==t&&(E=t,P.depthMask(E))},setDepthTest:function(t){S!==t&&((S=t)===Ge.DISABLED?P.disable(P.DEPTH_TEST):(P.enable(P.DEPTH_TEST),P.depthFunc(S)))},setBlendState:function(t){if(O!==t){var e=O=t;if(e&&!1!==e.enabled){P.enable(P.BLEND),null===e.alphaSrcFactor||void 0===e.alphaSrcFactor?P.blendFunc(e.srcFactor,e.dstFactor):P.blendFuncSeparate(e.srcFactor,e.dstFactor,e.alphaSrcFactor,e.alphaDstFactor),null===e.alphaOperator||void 0===e.alphaOperator?P.blendEquation(e.operator):P.blendEquationSeparate(e.operator,e.alphaOperator);var i=e.color;i&&P.blendColor(i.r,i.g,i.b,i.a)}else P.disable(P.BLEND)}},updateStencilReferenceValue:function(t){var e=j;e&&e.reference!==t&&(e.reference=t,P.stencilFunc(e.comparison,t,e.readMask))},setStencilState:function(t){var e=j=t;e&&!1!==e.enabled?(P.enable(P.STENCIL_TEST),P.stencilFunc(e.comparison,e.reference,e.readMask),P.stencilOp(e.onStencilFail,e.onDepthFail,e.onPass),P.stencilMask(e.writeMask)):(P.disable(P.STENCIL_TEST),P.stencilFunc(Ge.ALWAYS,0,255),P.stencilOp(Qe.KEEP,Qe.KEEP,Qe.KEEP))},setMaterialPassState:function(t,e,i,n,s){if(I!==t){if(t===Ye.NONE)P.disable(P.CULL_FACE);else{I===Ye.NONE&&P.enable(P.CULL_FACE);var r=t;v&&(r===Ye.BACK?r=Ye.FRONT:r===Ye.FRONT&&(r=Ye.BACK)),P.cullFace(r)}I=t}if(S!==e&&((S=e)===Ge.DISABLED?P.disable(P.DEPTH_TEST):(P.enable(P.DEPTH_TEST),P.depthFunc(S))),E!==i&&(E=i,P.depthMask(E)),L||n===w||(w=n,P.colorMask(n,n,n,n)),O!==s)if((O=s)&&!1!==s.enabled){P.enable(P.BLEND),null===s.alphaSrcFactor||void 0===s.alphaSrcFactor?P.blendFunc(s.srcFactor,s.dstFactor):P.blendFuncSeparate(s.srcFactor,s.dstFactor,s.alphaSrcFactor,s.alphaDstFactor),null===s.alphaOperator||void 0===s.alphaOperator?P.blendEquation(s.operator):P.blendEquationSeparate(s.operator,s.alphaOperator);var o=s.color;o&&P.blendColor(o.r,o.g,o.b,o.a)}else P.disable(P.BLEND)}};function z(){this._blurShader=null,this.numBlurPasses=1}function R(){z.call(this)}z.prototype={getCullMode:function(){return Ye.FRONT},getShadowMapFilter:function(){return Fe.NEAREST_NOMIP},getShadowMapFormat:function(){return Ze.RGBA},getShadowMapDataType:function(){return Ke.UNSIGNED_BYTE},getGLSL:function(){throw new Error("Abstract method called")},get blurShader(){return this._blurShader||(this._blurShader=this._createBlurShader()),this._blurShader},init:function(){},_createBlurShader:function(){},_invalidateBlurShader:function(){this._blurShader&&(this._blurShader=null)}},(R.prototype=Object.create(z.prototype)).getGLSL=function(){return d.get("shadow_hard.glsl")};var B,F,k={Unlit:null,BlinnPhong:d.get("lighting_blinn_phong.glsl"),GGX:d.get("lighting_ggx.glsl"),GGX_FULL:"#define HX_VISIBILITY_TERM\n"+d.get("lighting_ggx.glsl"),DEBUG:d.get("lighting_debug.glsl")};function Y(t){this._buffer=U.gl.createBuffer(),this._uniforms=[],this._size=t}function Q(t,e){this.program=null,this.renderOrderHint=-1,this._uniforms=null,this._textureUniforms=null,this._uniformBlocks=null,this._ready=!1,t&&e&&this.init(t,e)}function G(t){Q.call(this),this.init(d.get("copy_vertex.glsl"),t);var e=U.gl,i=e.getUniformLocation(this.program,"sampler");this._positionAttributeLocation=e.getAttribLocation(this.program,"hx_position"),this._texCoordAttributeLocation=e.getAttribLocation(this.program,"hx_texCoord"),e.useProgram(this.program),e.uniform1i(i,0)}function X(t,e){var i="#define extractChannels(src) ((src)."+(t=t||"xyzw")+")\n";(e=void 0===e||e)&&(i+="#define COPY_ALPHA\n"),G.call(this,i+d.get("copy_fragment.glsl"))}function V(){G.call(this,d.get("copy_to_gamma_fragment.glsl"))}function H(){this._buffer=U.gl.createBuffer()}function W(){this._buffer=U.gl.createBuffer()}function Z(t,e,i,n){this.x=t||0,this.y=e||0,this.z=i||0,this.w=void 0===n?1:n}function K(t){this.type=t,this._expanse=K.EXPANSE_EMPTY,this._minimumX=0,this._minimumY=0,this._minimumZ=0,this._maximumX=0,this._maximumY=0,this._maximumZ=0,this._halfExtentX=0,this._halfExtentY=0,this._halfExtentZ=0,this._center=new Z}Y.prototype={get size(){return this._size},uploadData:function(t,e){var i=U.gl;void 0===e&&(e=i.DYNAMIC_DRAW),this.bind(),i.bufferData(i.UNIFORM_BUFFER,t,e)},registerUniform:function(t,e,i,n){this._uniforms[t]={offset:e,size:i,type:n}},getUniformOffset:function(t){var e=this._uniforms[t];return e?e.offset:-1},setUniform:function(t,e){var i=U.gl,n=this._uniforms[t];switch(this.bind(),n.type){case i.FLOAT:var s=new Float32Array(1);s[0]=e,e=s;break;case i.FLOAT_VEC2:(s=new Float32Array(2))[0]=value.x||value[0]||0,s[1]=value.y||value[1]||0,e=s;break;case i.FLOAT_VEC3:(s=new Float32Array(3))[0]=value.x||value[0]||0,s[1]=value.y||value[1]||0,s[2]=value.z||value[2]||0,e=s;break;case i.FLOAT_VEC4:(s=new Float32Array(4))[0]=value.x||value[0]||0,s[1]=value.y||value[1]||0,s[2]=value.z||value[2]||0,s[3]=value.w||value[3]||0,e=s;break;case i.INT:case i.BOOL:(s=new Int32Array(1))[0]=value,e=s;break;case i.INT_VEC2:case i.BOOL_VEC2:(s=new Int32Array(2))[0]=value.x||value[0]||0,s[1]=value.y||value[1]||0,e=s;break;case i.INT_VEC3:case i.BOOL_VEC3:(s=new Int32Array(3))[0]=value.x||value[0]||0,s[1]=value.y||value[1]||0,s[2]=value.z||value[2]||0,e=s;break;case i.INT_VEC4:case i.BOOL_VEC4:(s=new Int32Array(4))[0]=value.x||value[0]||0,s[1]=value.y||value[1]||0,s[2]=value.z||value[2]||0,s[3]=value.w||value[3]||0,e=s;break;case i.FLOAT_MAT4:e=value}i.bufferSubData(i.UNIFORM_BUFFER,n.offset,n.size,e)},bind:function(t){var e=U.gl;void 0===t?e.bindBuffer(e.UNIFORM_BUFFER,this._buffer):e.bindBufferBase(e.UNIFORM_BUFFER,t,this._buffer)}},Q.prototype={constructor:Q,isReady:function(){return this._ready},init:function(t,e){this._cachedProgram=x(t,e),this._cachedProgram&&(this.program=this._cachedProgram.program,this.renderOrderHint=this._cachedProgram.renderOrderHint,this._storeUniforms(),this._ready=!0)},hasUniform:function(t){return this._uniforms.hasOwnProperty(t)},getUniform:function(t){return this._uniforms[t]},getUniformLocation:function(t){return this.hasUniform(t)?this._uniforms[t].location:null},getAttributeLocation:function(t){return U.gl.getAttribLocation(this.program,t)},_storeUniforms:function(){this._uniforms={},this._textureUniforms=[],this._uniformBlocks=[];var t=0,e=U.gl;e.useProgram(this.program);for(var i=e.getProgramParameter(this.program,e.ACTIVE_UNIFORMS),n=0;n<i;++n){var s=e.getActiveUniform(this.program,n),r=s.name,o=e.getUniformLocation(this.program,r);this._uniforms[r]={type:s.type,location:o,size:s.size},s.type!==e.SAMPLER_2D&&s.type!==e.SAMPLER_CUBE||(this._textureUniforms.push(s),e.uniform1i(o,t++))}if(Be.WEBGL_2)for(i=e.getProgramParameter(this.program,e.ACTIVE_UNIFORM_BLOCKS),n=0;n<i;++n){r=e.getActiveUniformBlockName(this.program,n);e.uniformBlockBinding(this.program,n,n),this._uniformBlocks.push(r)}},createUniformBuffer:function(t){for(var e=U.gl,i=this.program,n=null,s=0,r=this._uniformBlocks.length;s<r;++s)if(this._uniformBlocks[s]===t){n=s;break}if(!n)return null;var o=e.getActiveUniformBlockParameter(i,n,e.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES),a=e.getActiveUniformBlockParameter(i,n,e.UNIFORM_BLOCK_DATA_SIZE),h=new Y(a),u=e.getActiveUniforms(i,o,e.UNIFORM_OFFSET);for(s=0;s<o.length;++s){var l=e.getActiveUniform(i,o[s]);h.registerUniform(l.name,u[s],l.size,l.type)}return h.uploadData(new Float32Array(a/4)),h},get numTextures(){return this._textureUniforms.length},getTextureIndex:function(t){for(var e=0,i=this._textureUniforms.length;e<i;++e){if(this._textureUniforms[e].name===t)return e}return-1},getUniformBufferIndex:function(t){for(var e=0,i=this._uniformBlocks.length;e<i;++e)if(this._uniformBlocks[e]===t)return e;return-1},get numUniformBuffers(){return this._uniformBlocks.length}},(G.prototype=Object.create(Q.prototype)).execute=function(t,e){var i=U.gl;U.setDepthTest(Ge.DISABLED),U.setCullMode(Ye.NONE),t._vertexBuffers[0].bind(),t._indexBuffer.bind(),U.setShader(this),e.bind(0),i.vertexAttribPointer(this._positionAttributeLocation,2,i.FLOAT,!1,16,0),i.vertexAttribPointer(this._texCoordAttributeLocation,2,i.FLOAT,!1,16,8),U.enableAttributes(2),U.drawElements(Xe.TRIANGLES,6,0)},X.prototype=Object.create(G.prototype),Object.create(G.prototype).setBlendColor=function(t,e,i,n){var s=U.gl;s.useProgram(this.program),s.uniform4f(this._colorLocation,t,e,i,n)},V.prototype=Object.create(G.prototype),H.prototype={uploadData:function(t,e){void 0===e&&(e=qe.STATIC_DRAW),this.bind(),U.gl.bufferData(U.gl.ELEMENT_ARRAY_BUFFER,t,e)},bind:function(){U.gl.bindBuffer(U.gl.ELEMENT_ARRAY_BUFFER,this._buffer)}},W.prototype={uploadData:function(t,e){void 0===e&&(e=U.gl.STATIC_DRAW),this.bind(),U.gl.bufferData(U.gl.ARRAY_BUFFER,t,e)},bind:function(){U.gl.bindBuffer(U.gl.ARRAY_BUFFER,this._buffer)}},Z.add=function(t,e,i){return(i=i||new Z).x=t.x+e.x,i.y=t.y+e.y,i.z=t.z+e.z,i.w=t.w+e.w,i},Z.subtract=function(t,e,i){return(i=i||new Z).x=t.x-e.x,i.y=t.y-e.y,i.z=t.z-e.z,i.w=t.w-e.w,i},Z.scale=function(t,e,i){return(i=i||new Z).x=t.x*e,i.y=t.y*e,i.z=t.z*e,i},Z.scale4=function(t,e,i){return(i=i||new Z).x=t.x*e,i.y=t.y*e,i.z=t.z*e,i.w=t.w*e,i},Z.cross=function(t,e,i){i=i||new Z;var n=t.x,s=t.y,r=t.z,o=e.x,a=e.y,h=e.z;return i.x=s*h-r*a,i.y=r*o-n*h,i.z=n*a-s*o,i.w=0,i},Z.prototype={set:function(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=void 0===n?this.w:n,this},get lengthSqr(){return this.x*this.x+this.y*this.y+this.z*this.z},get length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},normalize:function(){var t=1/this.length;return this.x*=t,this.y*=t,this.z*=t,this},normalizeAsPlane:function(){var t=1/this.length;return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},clone:function(){return new Z(this.x,this.y,this.z,this.w)},add:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},addScaled:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this},subtract:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this},subtractScaled:function(t,e){return this.x-=t.x*e,this.y-=t.y*e,this.z-=t.z*e,this.w-=t.w*e,this},scale:function(t){return this.x*=t,this.y*=t,this.z*=t,this},scale4:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},negativeOf:function(t){return this.x=-t.x,this.y=-t.y,this.z=-t.z,this.w=-t.w,this},homogeneousProject:function(){var t=1/this.w;return this.x*=t,this.y*=t,this.z*=t,this.w=1,this},abs:function(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this.z=Math.abs(this.z),this.w=Math.abs(this.w),this},fromSphericalCoordinates:function(t,e,i){return this.x=t*Math.sin(i)*Math.cos(e),this.y=t*Math.sin(i)*Math.sin(e),this.z=t*Math.cos(i),this.w=1,this},copyFrom:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},maximize:function(t){return t.x>this.x&&(this.x=t.x),t.y>this.y&&(this.y=t.y),t.z>this.z&&(this.z=t.z),t.w>this.w&&(this.w=t.w),this},maximize3:function(t){return t.x>this.x&&(this.x=t.x),t.y>this.y&&(this.y=t.y),t.z>this.z&&(this.z=t.z),this},minimize:function(t){return t.x<this.x&&(this.x=t.x),t.y<this.y&&(this.y=t.y),t.z<this.z&&(this.z=t.z),t.w<this.w&&(this.w=t.w),this},minimize3:function(t){return t.x<this.x&&(this.x=t.x),t.y<this.y&&(this.y=t.y),t.z<this.z&&(this.z=t.z),this},planeFromNormalAndPoint:function(t,e){var i=t.x,n=t.y,s=t.z;return this.x=i,this.y=n,this.z=s,this.w=-(e.x*i+e.y*n+e.z*s),this},planeFromVectorsAndPoint:function(t,e,i){this.cross(t,e),this.normalize(),this.w=-(i.x*this.x+i.y*this.y+i.z*this.z)},planeFromPoints:(B=new Z,F=new Z,function(t,e,i){Z.subtract(t,i,B),Z.subtract(e,i,F),this.planeFromVectorsAndPoint(B,F,i)}),planeIntersectRay:function(t,e){e=e||new HX.Float4;var i=this.dot3(t.direction);if(1e-5<Math.abs(i)){var n=-(this.dot3(t.origin)+this.w)/i;if(0<n)return e.copyFrom(t.origin),e.addScaled(t.direction,n),!0}return null},angle:function(t){return Math.acos(this.dot3(t)/(this.length*t.length))},angleNormalized:function(t){return Math.acos(this.dot3(t))},distanceTo:function(t){var e=t.x-this.x,i=t.y-this.y,n=t.z-this.z;return Math.sqrt(e*e+i*i+n*n)},squareDistanceTo:function(t){var e=t.x-this.x,i=t.y-this.y,n=t.z-this.z;return e*e+i*i+n*n},dot3:function(t){return t.x*this.x+t.y*this.y+t.z*this.z},dot:function(t){return t.x*this.x+t.y*this.y+t.z*this.z},dot4:function(t){return t.x*this.x+t.y*this.y+t.z*this.z+t.w*this.w},lerp:function(t,e,i){var n=t.x,s=t.y,r=t.z,o=t.w;return this.x=n+(e.x-n)*i,this.y=s+(e.y-s)*i,this.z=r+(e.z-r)*i,this.w=o+(e.w-o)*i,this},cross:function(t,e){var i=t.x,n=t.y,s=t.z,r=e.x,o=e.y,a=e.z;return this.x=n*a-s*o,this.y=s*r-i*a,this.z=i*o-n*r,this.w=0,this},toString:function(){return"Float4("+this.x+", "+this.y+", "+this.z+", "+this.w+")"}},Z.ORIGIN_POINT=new Z(0,0,0,1),Z.ZERO=new Z(0,0,0,0),Z.X_AXIS=new Z(1,0,0,0),Z.Y_AXIS=new Z(0,1,0,0),Z.Z_AXIS=new Z(0,0,1,0),K.EXPANSE_EMPTY=0,K.EXPANSE_INFINITE=1,K.EXPANSE_FINITE=2,K.EXPANSE_INHERIT=3,K._testAABBToSphere=function(t,e){var i,n=e._maximumX,s=e._maximumY,r=e._maximumZ,o=t._minimumX,a=t._minimumY,h=t._minimumZ,u=e._halfExtentX,l=e._center.x,c=e._center.y,_=e._center.z,d=0;return l<o?d+=(i=l-o)*i:n<l&&(d+=(i=l-n)*i),c<a?d+=(i=c-a)*i:s<c&&(d+=(i=c-s)*i),_<h?d+=(i=_-h)*i:r<_&&(d+=(i=_-r)*i),d<u*u},K.prototype={get expanse(){return this._expanse},growToIncludeMesh:function(t){throw new Error("Abstract method!")},growToIncludeBound:function(t){throw new Error("Abstract method!")},growToIncludeMinMax:function(t,e){throw new Error("Abstract method!")},clear:function(t){this._minimumX=this._minimumY=this._minimumZ=0,this._maximumX=this._maximumY=this._maximumZ=0,this._center.set(0,0,0),this._halfExtentX=this._halfExtentY=this._halfExtentZ=0,this._expanse=void 0===t?K.EXPANSE_EMPTY:t},get minimum(){return new Z(this._minimumX,this._minimumY,this._minimumZ,1)},get maximum(){return new Z(this._maximumX,this._maximumY,this._maximumZ,1)},get center(){return this._center},get halfExtent(){return new Z(this._halfExtentX,this._halfExtentY,this._halfExtentZ,0)},getRadius:function(){throw new Error("Abstract method!")},transformFrom:function(t,e){throw new Error("Abstract method!")},intersectsConvexSolid:function(t,e){throw new Error("Abstract method!")},intersectsBound:function(t){throw new Error("Abstract method!")},classifyAgainstPlane:function(t){throw new Error("Abstract method!")},intersectsRay:function(t){throw new Error("Abstract method!")},toString:function(){return"BoundingVolume: [ "+this._minimumX+", "+this._minimumY+", "+this._minimumZ+" ] - [ "+this._maximumX+", "+this._maximumY+", "+this._maximumZ+" ], expanse: "+this._expanse},clone:function(){throw new Error("Abstract method called!")}};var q={FRONT:1,BACK:-1,INTERSECTING:0};function J(){K.call(this,J)}function $(){this.name=null,this._positionBuffer=null,this._normalBuffer=null,this._numVertices=0}(J.prototype=Object.create(K.prototype)).growToIncludeMesh=function(t){if(this._expanse!==K.EXPANSE_INFINITE){var e,i,n,s,r,o,a=t.getVertexAttributeByName("hx_position"),h=a.offset,u=t.getVertexStride(a.streamIndex),l=t.getVertexData(a.streamIndex),c=l.length;for(this._expanse===K.EXPANSE_EMPTY?(s=e=l[h],r=i=l[h+1],o=n=l[h+2],h+=u):(e=this._minimumX,i=this._minimumY,n=this._minimumZ,s=this._maximumX,r=this._maximumY,o=this._maximumZ);h<c;h+=u){var _=l[h],d=l[h+1],f=l[h+2];s<_?s=_:_<e&&(e=_),r<d?r=d:d<i&&(i=d),o<f?o=f:f<n&&(n=f)}this._minimumX=e,this._minimumY=i,this._minimumZ=n,this._maximumX=s,this._maximumY=r,this._maximumZ=o,this._expanse=K.EXPANSE_FINITE,this._updateCenterAndExtent()}},J.prototype.growToIncludeBound=function(t){t._expanse!==K.EXPANSE_EMPTY&&t._expanse!==K.EXPANSE_INHERIT&&this._expanse!==K.EXPANSE_INFINITE&&(t._expanse===K.EXPANSE_INFINITE?this._expanse=K.EXPANSE_INFINITE:this._expanse===K.EXPANSE_EMPTY?(this._minimumX=t._minimumX,this._minimumY=t._minimumY,this._minimumZ=t._minimumZ,this._maximumX=t._maximumX,this._maximumY=t._maximumY,this._maximumZ=t._maximumZ,this._expanse=K.EXPANSE_FINITE):(t._minimumX<this._minimumX&&(this._minimumX=t._minimumX),t._minimumY<this._minimumY&&(this._minimumY=t._minimumY),t._minimumZ<this._minimumZ&&(this._minimumZ=t._minimumZ),t._maximumX>this._maximumX&&(this._maximumX=t._maximumX),t._maximumY>this._maximumY&&(this._maximumY=t._maximumY),t._maximumZ>this._maximumZ&&(this._maximumZ=t._maximumZ)),this._updateCenterAndExtent())},J.prototype.growToIncludeMinMax=function(t,e){this._expanse!==K.EXPANSE_INFINITE&&(this._expanse===K.EXPANSE_EMPTY?(this._minimumX=t.x,this._minimumY=t.y,this._minimumZ=t.z,this._maximumX=e.x,this._maximumY=e.y,this._maximumZ=e.z,this._expanse=K.EXPANSE_FINITE):(t.x<this._minimumX&&(this._minimumX=t.x),t.y<this._minimumY&&(this._minimumY=t.y),t.z<this._minimumZ&&(this._minimumZ=t.z),e.x>this._maximumX&&(this._maximumX=e.x),e.y>this._maximumY&&(this._maximumY=e.y),e.z>this._maximumZ&&(this._maximumZ=e.z)),this._updateCenterAndExtent())},J.prototype.transform=function(t){var e=new J;return e.transformFrom(this,t),e},J.prototype.transformFrom=function(t,e){if(t._expanse===K.EXPANSE_FINITE){var i=e._m,n=i[0],s=i[1],r=i[2],o=i[4],a=i[5],h=i[6],u=i[8],l=i[9],c=i[10],_=t._center.x,d=t._center.y,f=t._center.z,p=this._center.x=n*_+o*d+u*f+i[12],g=this._center.y=s*_+a*d+l*f+i[13],M=this._center.z=r*_+h*d+c*f+i[14];n<0&&(n=-n),s<0&&(s=-s),r<0&&(r=-r),o<0&&(o=-o),a<0&&(a=-a),h<0&&(h=-h),u<0&&(u=-u),l<0&&(l=-l),c<0&&(c=-c),_=t._halfExtentX,d=t._halfExtentY,f=t._halfExtentZ;var A=this._halfExtentX=n*_+o*d+u*f,m=this._halfExtentY=s*_+a*d+l*f,x=this._halfExtentZ=r*_+h*d+c*f;this._minimumX=p-A,this._minimumY=g-m,this._minimumZ=M-x,this._maximumX=p+A,this._maximumY=g+m,this._maximumZ=M+x,this._expanse=t._expanse}else this.clear(t._expanse)},J.prototype.intersectsConvexSolid=function(t,e){if(this._expanse===K.EXPANSE_INFINITE||this._expanse===K.EXPANSE_INHERIT)return!0;if(this._expanse===K.EXPANSE_EMPTY)return!1;for(var i=this._minimumX,n=this._minimumY,s=this._minimumZ,r=this._maximumX,o=this._maximumY,a=this._maximumZ,h=0;h<e;++h){var u=t[h],l=u.x,c=u.y,_=u.z;if(0<l*(0<l?i:r)+c*(0<c?n:o)+_*(0<_?s:a)+u.w)return!1}return!0},J.prototype.intersectsBound=function(t){return this._expanse!==K.EXPANSE_EMPTY&&t._expanse!==K.EXPANSE_EMPTY&&(this._expanse===K.EXPANSE_INFINITE||t._expanse===K.EXPANSE_INFINITE||this._expanse===K.EXPANSE_INHERIT||t._expanse===K.EXPANSE_INHERIT||(t.type===this.type?this._maximumX>t._minimumX&&this._minimumX<t._maximumX&&this._maximumY>t._minimumY&&this._minimumY<t._maximumY&&this._maximumZ>t._minimumZ&&this._minimumZ<t._maximumZ:K._testAABBToSphere(this,t)))},J.prototype.classifyAgainstPlane=function(t){var e=t.x,i=t.y,n=t.z,s=t.w,r=e*this._center.x+i*this._center.y+n*this._center.z+s;e<0&&(e=-e),i<0&&(i=-i),n<0&&(n=-n);var o=e*this._halfExtentX+i*this._halfExtentY+n*this._halfExtentZ;return o<r?q.FRONT:r<-o?q.BACK:q.INTERSECTING},J.prototype.intersectsRay=function(t){if(this._expanse===K.EXPANSE_INFINITE)return!0;if(this._expanse===K.EXPANSE_EMPTY||this._expanse===K.EXPANSE_INHERIT)return!1;var e,i,n=t.origin,s=t.direction,r=n.x,o=n.y,a=n.z,h=s.x,u=s.y,l=s.z,c=-1/0,_=1/0;if(0!==h){var d=1/h;(e=(this._minimumX-r)*d)<(i=(this._maximumX-r)*d)?(c=e,_=i):(c=i,_=e)}return 0!==u&&(d=1/u,(e=(this._minimumY-o)*d)<(i=(this._maximumY-o)*d)?(c<e&&(c=e),i<_&&(_=i)):(c<i&&(c=i),e<_&&(_=e))),0!==l&&(d=1/l,(e=(this._minimumZ-a)*d)<(i=(this._maximumZ-a)*d)?(c<e&&(c=e),i<_&&(_=i)):(c<i&&(c=i),e<_&&(_=e))),0<_&&c<=_},J.prototype.setExplicit=function(t,e){this._minimumX=t.x,this._minimumY=t.y,this._minimumZ=t.z,this._maximumX=e.x,this._maximumY=e.y,this._maximumZ=e.z,this._expanse=K.EXPANSE_FINITE,this._updateCenterAndExtent()},J.prototype._updateCenterAndExtent=function(){var t=this._minimumX,e=this._minimumY,i=this._minimumZ,n=this._maximumX,s=this._maximumY,r=this._maximumZ;this._center.x=.5*(t+n),this._center.y=.5*(e+s),this._center.z=.5*(i+r),this._halfExtentX=.5*(n-t),this._halfExtentY=.5*(s-e),this._halfExtentZ=.5*(r-i)},J.prototype.getRadius=function(){return Math.sqrt(this._halfExtentX*this._halfExtentX+this._halfExtentY*this._halfExtentY+this._halfExtentZ*this._halfExtentZ)},J.prototype.getHalfExtents=function(){return new Z(this._halfExtentX,this._halfExtentY,this._halfExtentZ,0)},J.prototype.clone=function(){var t=new J;return t.growToIncludeBound(this),t},$.prototype={get hasNormals(){return!!this._normalBuffer},get numVertices(){return this._numVertices},get positionBuffer(){return this._positionBuffer},get normalBuffer(){return this._normalBuffer},init:function(t,e){this._numVertices=t.length/3,this._positionBuffer=new W,this._positionBuffer.uploadData(new Float32Array(t)),e&&(this._normalBuffer=new W,this._normalBuffer.uploadData(new Float32Array(e)))}};var tt=0;function et(){this.onBoundsChanged=new r,this.onLayoutChanged=new r,this.onMorphDataCreated=new r,this.name="hx_mesh_"+tt,this.elementType=Xe.TRIANGLES,this._bounds=new J,this._boundsInvalid=!0,this._dynamicBounds=!0,this._vertexBuffers=[],this._vertexStrides=[],this._vertexData=[],this._indexData=void 0,this._vertexUsage=qe.STATIC_DRAW,this._indexUsage=qe.STATIC_DRAW,this._numStreams=0,this._numVertices=0,this._vertexAttributes=[],this._vertexAttributesLookUp={},this._indexBuffer=new H,this._morphTargets={},this._hasMorphNormals=!1,this._defaultMorphTarget=null,this._skeleton=null,this._renderOrderHint=++tt}et.DEFAULT_VERTEX_SIZE=12,et.ID_COUNTER=0,et.createDefaultEmpty=function(t){return(t=t||new et).addVertexAttribute("hx_position",3),t.addVertexAttribute("hx_normal",3),t.addVertexAttribute("hx_tangent",4),t.addVertexAttribute("hx_texCoord",2),t},et.prototype={get bounds(){return this._boundsInvalid&&this._updateBounds(),this._bounds},set bounds(t){this._bounds=t,this.invalidateBounds()},get dynamicBounds(){return this._dynamicBounds},set dynamicBounds(t){t!==this._dynamicBounds&&((this._dynamicBounds=t)?this.invalidateBounds():this._boundsInvalid=!1)},get hasMorphData(){return!!this._defaultMorphTarget},get hasMorphNormals(){return this._hasMorphNormals},hasVertexData:function(t){return!!this._vertexData[t]},getVertexData:function(t){return this._vertexData[t]},setVertexData:function(t,e,i){e=e||0,this._vertexUsage=i||qe.STATIC_DRAW,this._vertexData[e]=t instanceof Float32Array?t:new Float32Array(t),this._vertexBuffers[e]=this._vertexBuffers[e]||new W,this._vertexBuffers[e].uploadData(this._vertexData[e],this._vertexUsage),0===e&&(this._numVertices=t.length/this._vertexStrides[0]),this.invalidateBounds()},getIndexData:function(){return this._indexData},setIndexData:function(t,e){this._indexUsage=e||qe.STATIC_DRAW,t instanceof Uint16Array?(this._indexData=t,this._indexType=Ke.UNSIGNED_SHORT):t instanceof Uint32Array?(this._indexData=t,this._indexType=Ke.UNSIGNED_INT):(this._indexData=new Uint16Array(t),this._indexType=Ke.UNSIGNED_SHORT),this._numIndices=this._indexData.length,this._indexBuffer.uploadData(this._indexData,this._indexUsage)},hasVertexAttribute:function(t){return this._vertexAttributesLookUp.hasOwnProperty(t)},addVertexAttribute:function(t,e,i,n){i=i||0,this._numStreams=Math.max(this._numStreams,i+1);var s=this._vertexStrides[i]||0,r={name:t,offset:s,numComponents:e,streamIndex:i,normalized:n||!1};this._vertexAttributes.push(r),this._vertexAttributesLookUp[t]=r,this._vertexStrides[i]=s+e,this.onLayoutChanged.dispatch()},get numStreams(){return this._numStreams},extractAttributeData:function(t){for(var e=this.getVertexAttributeByName(t),i=this.getVertexStride(e),n=this.getVertexData(e.streamIndex),s=e.numComponents,r=[],o=0,a=e.offset;a<n.length;a+=i)for(var h=0;h<s;++h)r[o++]=n[a+h];return r},generateMorphData:function(t){var e;for(t?(this._hasMorphNormals=!0,e=4):e=8,n=0;n<e;++n)this.addVertexAttribute("hx_morphPosition"+n,3,this._numStreams),t&&this.addVertexAttribute("hx_morphNormal"+n,3,this._numStreams);for(var i=[],n=0;n<this._numVertices;++n)i.push(0,0,0);this._defaultMorphTarget=new W,this._defaultMorphTarget.uploadData(new Float32Array(i),qe.STATIC_DRAW),this.onMorphDataCreated.dispatch(),this.onLayoutChanged.dispatch()},get numVertices(){return this._numVertices},get numIndices(){return this._numIndices},get numVertexAttributes(){return this._vertexAttributes.length},getVertexStride:function(t){return this._vertexStrides[t]},getVertexAttributeByName:function(t){return this._vertexAttributesLookUp[t]},getVertexAttributeByIndex:function(t){return this._vertexAttributes[t]},addMorphTarget:function(t){this._morphTargets[t.name]=t,this._defaultMorphTarget||this.generateMorphData()},removeMorphTarget:function(t){delete this._morphTargets[t.name]},getMorphTarget:function(t){return this._morphTargets[t]},clone:function(){for(var t=new et,e=this._vertexAttributes.length,i=0;i<e;++i){var n=this._vertexAttributes[i];t.addVertexAttribute(n.name,n.numComponents,n.streamIndex)}for(i=0;i<this._numStreams;++i)this._vertexData[i]&&t.setVertexData(this._vertexData[i],i,this._vertexUsage);return this._indexData&&t.setIndexData(this._indexData,this._indexUsage),t.elementType=this.elementType,t},translate:function(t,e,i){t instanceof Z&&(t.y,t.z,t=t.x);var n=this.getVertexAttributeByName("hx_position");if(n){for(var s=this.getVertexStride(n),r=this.getVertexData(n.streamIndex),o=n.offset;o<r.length;o+=s)r[o]+=t,r[o+1]+=t,r[o+2]+=t;this._vertexBuffers[n.streamIndex].uploadData(this._vertexData[n.streamIndex],this._vertexUsage)}},_updateBounds:function(){this._bounds.clear(),this._bounds.growToIncludeMesh(this),this._boundsInvalid=!1},invalidateBounds:function(){this._dynamicBounds&&(this._boundsInvalid=!0,this.onBoundsChanged.dispatch())}};var it,nt,st={create:function(){var t=new et;return t.addVertexAttribute("hx_position",2),t.addVertexAttribute("hx_texCoord",2),t.setVertexData([-1,1,0,1,1,1,1,1,1,-1,1,0,-1,-1,0,0],0),t.setIndexData([0,1,2,0,2,3]),t},_initDefault:function(){st.DEFAULT=st.create()}},rt={assureSize:function(t,e,i,n,s,r){return(t!==i.width||e!==i.height)&&(i.initEmpty(t,e,s,r),n&&n.init(),!0)},copy:function(t,e){U.setRenderTarget(e),U.clear(),Ue.COPY_SHADER.execute(st.DEFAULT,t),U.setRenderTarget(null)},encodeHalfFloat:(it=new Float32Array(1),nt=new Int32Array(it.buffer),function(t){it[0]=t;var e=nt[0],i=e>>16&32768,n=e>>12&2047,s=e>>23&255;return s<103?i:142<s?(i|=31744,i|=(255===s?0:1)&&8388607&e):s<113?i|=((n|=2048)>>114-s)+(n>>113-s&1):(i|=s-112<<10|n>>1,i+=1&n)}),encodeToFloat16Array:function(t){for(var e=rt.encodeHalfFloat,i=[],n=0;n<t.length;++n)i[n]=e(t[n]);return new Uint16Array(i)}},ot=1/Math.log(2),at={DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,sign:function(t){return 0===t?0:0<t?1:-1},isPowerOfTwo:function(t){return!!t&&(t&-t)===t},log2:function(t){return Math.log(t)*ot},clamp:function(t,e,i){return t<e?e:i<t?i:t},saturate:function(t){return at.clamp(t,0,1)},lerp:function(t,e,i){return t+(e-t)*i},linearStep:function(t,e,i){return at.saturate((i-t)/(e-t))},estimateGaussianRadius:function(t,e){return Math.sqrt(-2*t*Math.log(e))},fract:function(t){return t-Math.floor(t)}},ht=0;function ut(){this.name="hx_texture2d_"+ht++,this._default=ut.DEFAULT,this._texture=U.gl.createTexture(),this._width=0,this._height=0,this._format=null,this._dataType=null,this.bind(),this.maxAnisotropy=Be.DEFAULT_TEXTURE_MAX_ANISOTROPY,this.filter=Fe.DEFAULT,this.wrapMode=ke.DEFAULT,this._isReady=!1,U.gl.bindTexture(U.gl.TEXTURE_2D,null)}ut._initDefault=function(){var t=new Uint8Array([255,0,255,255]);(ut.DEFAULT=new ut).uploadData(t,1,1,!0),ut.DEFAULT.filter=Fe.NEAREST_NOMIP},ut.prototype={generateMipmap:function(){var t=U.gl;this.bind(),t.generateMipmap(t.TEXTURE_2D),t.bindTexture(t.TEXTURE_2D,null)},get filter(){return this._filter},set filter(t){var e=U.gl;this._filter=t,this.bind(),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t.min),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,t.mag),e.bindTexture(e.TEXTURE_2D,null),t!==Fe.NEAREST_NOMIP&&t!==Fe.NEAREST||(this.maxAnisotropy=1)},get wrapMode(){return this._wrapMode},set wrapMode(t){var e=U.gl;this._wrapMode=t,this.bind(),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,t.s),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,t.t),e.bindTexture(e.TEXTURE_2D,null)},get maxAnisotropy(){return this._maxAnisotropy},set maxAnisotropy(t){var e=U.gl;t>Be.DEFAULT_TEXTURE_MAX_ANISOTROPY&&(t=Be.DEFAULT_TEXTURE_MAX_ANISOTROPY),this._maxAnisotropy=t,this.bind(),Be.EXT_TEXTURE_FILTER_ANISOTROPIC&&U.gl.texParameteri(e.TEXTURE_2D,Be.EXT_TEXTURE_FILTER_ANISOTROPIC.TEXTURE_MAX_ANISOTROPY_EXT,t),e.bindTexture(e.TEXTURE_2D,null)},get width(){return this._width},get height(){return this._height},get format(){return this._format},get dataType(){return this._dataType},initEmpty:function(t,e,i,n){var s=U.gl;this._format=i=i||Ze.RGBA,this._dataType=n=n||Ke.UNSIGNED_BYTE,this.bind(),this._width=t,this._height=e;var r=Ze.getDefaultInternalFormat(i,n);s.texImage2D(s.TEXTURE_2D,0,r,t,e,0,i,n,null),this._isReady=!0,s.bindTexture(s.TEXTURE_2D,null)},uploadData:function(t,e,i,n,s,r){var o=U.gl;Be.EXT_HALF_FLOAT_TEXTURES&&r===Ke.HALF_FLOAT&&(t=rt.encodeToFloat16Array(t)),this._width=e,this._height=i,this._format=s=s||Ze.RGBA,this._dataType=r=r||Ke.UNSIGNED_BYTE,n=void 0!==n&&n,this.bind(),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,0);var a=Ze.getDefaultInternalFormat(s,r);o.texImage2D(o.TEXTURE_2D,0,a,e,i,0,s,r,t),n&&o.generateMipmap(o.TEXTURE_2D),this._isReady=!0,o.bindTexture(o.TEXTURE_2D,null)},uploadImage:function(t,e,i,n,s,r){var o=U.gl;this._width=e,this._height=i,this._format=s=s||Ze.RGBA,this._dataType=r=r||Ke.UNSIGNED_BYTE,n=void 0===n||n,at.isPowerOfTwo(e)&&at.isPowerOfTwo(i)||(n=!1,this.filter===Fe.NEAREST?this.filter=Fe.NEAREST_NOMIP:this.filter===Fe.BILINEAR?this.filter=Fe.BILINEAR_NOMIP:this.filter!==Fe.TRILINEAR&&this.filter!==Fe.TRILINEAR_ANISOTROPIC||(this.filter=Fe.BILINEAR_NOMIP),this.wrapMode=ke.CLAMP),this.bind(),t&&o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,1);var a=Ze.getDefaultInternalFormat(s,r);o.texImage2D(o.TEXTURE_2D,0,a,s,r,t),n&&o.generateMipmap(o.TEXTURE_2D),this._isReady=!0,o.bindTexture(o.TEXTURE_2D,null)},isReady:function(){return this._isReady},bind:function(t){var e=U.gl;void 0!==t&&e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_2D,this._texture)},toString:function(){return"[Texture2D(name="+this.name+")]"}};var lt=0;function ct(){this.name="hx_texturecube_"+lt++,this._default=ct.DEFAULT,this._texture=U.gl.createTexture(),this._size=0,this._format=null,this._dataType=null,this.bind(),this.filter=Fe.DEFAULT,this.maxAnisotropy=Be.DEFAULT_TEXTURE_MAX_ANISOTROPY,this._isReady=!1}function _t(t,e,i,n){this.enabled=!0,this.srcFactor=t||Ve.ONE,this.dstFactor=e||Ve.ZERO,this.operator=i||He.ADD,this.alphaSrcFactor=null,this.alphaDstFactor=null,this.alphaOperator=null,this.color=n||null}function dt(t,e){this.x=t||0,this.y=e||0}function ft(t,e,i,n){this.points=null,this.decayFactor=i||.99,this.initialDistance=e||1,this.maxTests=n||2e4,this.mode=void 0===t?ft.CIRCULAR:t,this._currentDistance=0,this.reset()}function pt(t,e,i,n){this.points=null,this.mode=void 0===t?pt.SPHERICAL:t,this.initialDistance=e||1,this.decayFactor=i||.99,this.maxTests=n||2e4,this._currentDistance=0,this.reset()}function gt(t,e,i){if(t&&void 0===t[0]&&(t=[t]),this._cubeFace=i,this._colorTextures=t,this._numColorTextures=this._colorTextures?this._colorTextures.length:0,this._depthBuffer=e,this._colorTextures&&1<this._numColorTextures){this._drawBuffers=new Array(this._numColorTextures);for(var n=0;n<this._numColorTextures;++n)this._drawBuffers[n]=Be.EXT_DRAW_BUFFERS.COLOR_ATTACHMENT0_WEBGL+n}else this._drawBuffers=null;this._fbo=U.gl.createFramebuffer()}ct._initDefault=function(){var t=U.gl,e=new Uint8Array([255,0,255,255]);(ct.DEFAULT=new ct).uploadData([e,e,e,e,e,e],1,!0),ct.DEFAULT.filter=Fe.NEAREST_NOMIP,t.bindTexture(t.TEXTURE_CUBE_MAP,null)},ct.prototype={generateMipmap:function(){this.bind();var t=U.gl;t.generateMipmap(t.TEXTURE_CUBE_MAP),t.bindTexture(t.TEXTURE_CUBE_MAP,null)},get filter(){return this._filter},set filter(t){this._filter=t,this.bind();var e=U.gl;e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,t.min),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,t.mag),e.bindTexture(e.TEXTURE_CUBE_MAP,null)},get maxAnisotropy(){return this._maxAnisotropy},set maxAnisotropy(t){t>Be.DEFAULT_TEXTURE_MAX_ANISOTROPY&&(t=Be.DEFAULT_TEXTURE_MAX_ANISOTROPY),this._maxAnisotropy=t,this.bind();var e=U.gl;Be.EXT_TEXTURE_FILTER_ANISOTROPIC&&e.texParameteri(e.TEXTURE_CUBE_MAP,Be.EXT_TEXTURE_FILTER_ANISOTROPIC.TEXTURE_MAX_ANISOTROPY_EXT,t),e.bindTexture(e.TEXTURE_CUBE_MAP,null)},get size(){return this._size},get format(){return this._format},get dataType(){return this._dataType},initEmpty:function(t,e,i){this._format=e=e||Ze.RGBA,this._dataType=i=i||Ke.UNSIGNED_BYTE,this._size=t,this.bind();var n=U.gl,s=Ze.getDefaultInternalFormat(e,i);n.texImage2D(Je.POSITIVE_X,0,s,t,t,0,e,i,null),n.texImage2D(Je.NEGATIVE_X,0,s,t,t,0,e,i,null),n.texImage2D(Je.POSITIVE_Y,0,s,t,t,0,e,i,null),n.texImage2D(Je.NEGATIVE_Y,0,s,t,t,0,e,i,null),n.texImage2D(Je.POSITIVE_Z,0,s,t,t,0,e,i,null),n.texImage2D(Je.NEGATIVE_Z,0,s,t,t,0,e,i,null),this._isReady=!0,n.bindTexture(n.TEXTURE_2D,null)},uploadData:function(t,e,i,n,s){this._size=e,this._format=n=n||Ze.RGBA,this._dataType=s=s||Ke.UNSIGNED_BYTE,i=void 0===i||i,this.bind();var r=U.gl;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,0);var o=Ze.getDefaultInternalFormat(n,s);r.texImage2D(Je.POSITIVE_X,0,o,e,e,0,n,s,t[0]),r.texImage2D(Je.NEGATIVE_X,0,o,e,e,0,n,s,t[1]),r.texImage2D(Je.POSITIVE_Y,0,o,e,e,0,n,s,t[2]),r.texImage2D(Je.NEGATIVE_Y,0,o,e,e,0,n,s,t[3]),r.texImage2D(Je.POSITIVE_Z,0,o,e,e,0,n,s,t[4]),r.texImage2D(Je.NEGATIVE_Z,0,o,e,e,0,n,s,t[5]),i&&r.generateMipmap(r.TEXTURE_CUBE_MAP),this._isReady=!0,r.bindTexture(r.TEXTURE_CUBE_MAP,null)},uploadImages:function(t,e,i,n){e=void 0===e||e,this._format=i,this._dataType=n,this.uploadImagesToMipLevel(t,0,i,n);var s=U.gl;e&&(this.bind(),s.generateMipmap(s.TEXTURE_CUBE_MAP)),this._isReady=!0,s.bindTexture(s.TEXTURE_CUBE_MAP,null)},uploadImagesToMipLevel:function(t,e,i,n){var s=U.gl;this._format=i=i||Ze.RGBA,this._dataType=n=n||Ke.UNSIGNED_BYTE,0===e&&(this._size=t[0].naturalWidth),this.bind(),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,0);var r=Ze.getDefaultInternalFormat(i,n);s.texImage2D(Je.POSITIVE_X,e,r,i,n,t[0]),s.texImage2D(Je.NEGATIVE_X,e,r,i,n,t[1]),s.texImage2D(Je.POSITIVE_Y,e,r,i,n,t[2]),s.texImage2D(Je.NEGATIVE_Y,e,r,i,n,t[3]),s.texImage2D(Je.POSITIVE_Z,e,r,i,n,t[4]),s.texImage2D(Je.NEGATIVE_Z,e,r,i,n,t[5]),s.bindTexture(s.TEXTURE_CUBE_MAP,null)},isReady:function(){return this._isReady},bind:function(t){var e=U.gl;void 0!==t&&e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_CUBE_MAP,this._texture)},toString:function(){return"[TextureCube(name="+this.name+")]"}},_t.prototype={clone:function(){var t=new _t(this.srcFactor,this.dstFactor,this.operator,this.color);return t.alphaDstFactor=this.alphaDstFactor,t.alphaSrcFactor=this.alphaSrcFactor,t.alphaOperator=this.alphaOperator,t}},_t._initDefaults=function(){_t.ADD=new _t(Ve.SOURCE_ALPHA,Ve.ONE),_t.ADD_NO_ALPHA=new _t(Ve.ONE,Ve.ONE),_t.MULTIPLY=new _t(Ve.DESTINATION_COLOR,Ve.ZERO),(_t.ALPHA=new _t(Ve.SOURCE_ALPHA,Ve.ONE_MINUS_SOURCE_ALPHA)).alphaSrcFactor=Ve.ONE,_t.ALPHA.alphaDstFactor=Ve.ONE_MINUS_SOURCE_ALPHA,_t.INV_ALPHA=new _t(Ve.ONE_MINUS_SOURCE_ALPHA,Ve.SOURCE_ALPHA)},dt.add=function(t,e,i){return(i=i||new dt).x=t.x+e.x,i.y=t.y+e.y,i},dt.subtract=function(t,e,i){return(i=i||new dt).x=t.x-e.x,i.y=t.y-e.y,i},dt.scale=function(t,e,i){return(i=i||new dt).x=t.x*e,i.y=t.y*e,i},dt.prototype={set:function(t,e){this.x=t,this.y=e},dot:function(t){return t.x*this.x+t.y*this.y},get lengthSqr(){return this.x*this.x+this.y*this.y},get length(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){var t=1/this.length;this.x*=t,this.y*=t},clone:function(){return new dt(this.x,this.y)},add:function(t){this.x+=t.x,this.y+=t.y},addScaled:function(t,e){this.x+=t.x*e,this.y+=t.y*e},subtract:function(t){this.x-=t.x,this.y-=t.y},subtractScaled:function(t,e){return this.x-=t.x*e,this.y-=t.y*e,this},scale:function(t){this.x*=t,this.y*=t},negate:function(){this.x=-this.x,this.y=-this.y},negativeOf:function(t){this.x=-t.x,this.y=-t.y},abs:function(){this.x=Math.abs(this.x),this.y=Math.abs(this.y)},fromPolarCoordinates:function(t,e){this.x=t*Math.cos(e),this.y=t*Math.sin(e)},copyFrom:function(t){this.x=t.x,this.y=t.y},distanceTo:function(t){var e=t.x-this.x,i=t.y-this.y;return Math.sqrt(e*e+i*i)},squareDistanceTo:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},lerp:function(t,e,i){var n=t.x,s=t.y;this.x=n+(e.x-n)*i,this.y=s+(e.y-s)*i},maximize:function(t){t.x>this.x&&(this.x=t.x),t.y>this.y&&(this.y=t.y)},minimize:function(t){t.x<this.x&&(this.x=t.x),t.y<this.y&&(this.y=t.y)},angle:function(t){return Math.acos(this.dot(t)/(this.length*t.length))},angleNormalized:function(t){return Math.acos(this.dot(t))}},dt.ZERO=new dt(0,0),dt.X_AXIS=new dt(1,0),dt.Y_AXIS=new dt(0,1),ft.SQUARE=0,ft.CIRCULAR=1,ft._initDefault=function(){(ft.DEFAULT=new ft).generatePoints(64),ft.DEFAULT_FLOAT32=new Float32Array(128);for(var t=ft.DEFAULT.points,e=0;e<64;++e){var i=t[e];ft.DEFAULT_FLOAT32[2*e]=i.x,ft.DEFAULT_FLOAT32[2*e+1]=i.y}},ft.prototype={reset:function(){this.points=[],this._currentDistance=this.initialDistance},generatePoints:function(t){for(var e=0;e<t;++e)this.generatePoint()},generatePoint:function(){for(;;){for(var t=0,e=this._currentDistance*this._currentDistance;t++<this.maxTests;){var i=this._getCandidate();if(this._isValid(i,e))return this.points.push(i),i}this._currentDistance*=this.decayFactor}},_getCandidate:function(){for(;;){var t=2*Math.random()-1,e=2*Math.random()-1;if(this.mode===ft.SQUARE||t*t+e*e<=1)return new dt(t,e)}},_isValid:function(t,e){for(var i=this.points.length,n=0;n<i;++n){var s=this.points[n],r=t.x-s.x,o=t.y-s.y;if(r*r+o*o<e)return!1}return!0}},pt.BOX=0,pt.SPHERICAL=1,pt._initDefault=function(){(pt.DEFAULT=new pt).generatePoints(64),pt.DEFAULT_FLOAT32=new Float32Array(192);for(var t=pt.DEFAULT.points,e=0;e<64;++e){var i=t[e];pt.DEFAULT_FLOAT32[3*e]=i.x,pt.DEFAULT_FLOAT32[3*e+1]=i.y,pt.DEFAULT_FLOAT32[3*e+2]=i.z}},pt.prototype={reset:function(){this._currentDistance=this.initialDistance,this.points=[]},generatePoints:function(t){for(var e=0;e<t;++e)this.generatePoint()},generatePoint:function(){for(;;){for(var t=0,e=this._currentDistance*this._currentDistance;t++<this.maxTests;){var i=this._getCandidate();if(this._isValid(i,e))return this.points.push(i),i}this._currentDistance*=this.decayFactor}},_getCandidate:function(){for(;;){var t=2*Math.random()-1,e=2*Math.random()-1,i=2*Math.random()-1;if(this.mode===pt.BOX||t*t+e*e+i*i<=1)return new Z(t,e,i,0)}},_isValid:function(t,e){for(var i=this.points,n=i.length,s=0;s<n;++s){var r=i[s],o=t.x-r.x,a=t.y-r.y,h=t.z-r.z;if(o*o+a*a+h*h<e)return!1}return!0}},gt.prototype={get width(){return this._width},get height(){return this._height},init:function(t){var e=U.gl;e.bindFramebuffer(e.FRAMEBUFFER,this._fbo),this._colorTextures?void 0===this._cubeFace?(this._width=this._colorTextures[0]._width,this._height=this._colorTextures[0]._height):this._height=this._width=this._colorTextures[0].size:(this._width=this._depthBuffer._width,this._height=this._depthBuffer._height);var i=void 0===this._cubeFace?e.TEXTURE_2D:this._cubeFace;if(1===this._numColorTextures){var n=this._colorTextures[0];e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,i,n._texture,0)}else{if(!Be.EXT_DRAW_BUFFERS)throw new Error("Trying to bind multiple render targets without EXT_DRAW_BUFFERS support!");for(var s=0;s<this._numColorTextures;++s)n=this._colorTextures[s],e.framebufferTexture2D(e.FRAMEBUFFER,Be.EXT_DRAW_BUFFERS.COLOR_ATTACHMENT0_WEBGL+s,i,n._texture,0)}if(this._depthBuffer){var r=this._depthBuffer.format===e.DEPTH_STENCIL?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT;this._depthBuffer instanceof ut?e.framebufferTexture2D(e.FRAMEBUFFER,r,e.TEXTURE_2D,this._depthBuffer._texture,0):e.framebufferRenderbuffer(e.FRAMEBUFFER,r,e.RENDERBUFFER,this._depthBuffer._renderBuffer)}var o=e.checkFramebufferStatus(e.FRAMEBUFFER);switch(o&&!t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:console.warn("Failed to initialize FBO: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:console.warn("Failed to initialize FBO: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");break;case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:console.warn("Failed to initialize FBO: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");break;case e.FRAMEBUFFER_UNSUPPORTED:console.warn("Failed to initialize FBO: FRAMEBUFFER_UNSUPPORTED")}return o===e.FRAMEBUFFER_COMPLETE},readPixels:function(){var t,e,i=U.gl,n=this._colorTextures[0];switch(i.bindFramebuffer(i.FRAMEBUFFER,this._fbo),n.format){case Ze.RGB:t=3;break;case Ze.RGBA:t=4}var s=this.width*this.height*t;switch(n.dataType){case Ke.FLOAT:case Ke.HALF_FLOAT:e=new Float32Array(s);break;case Ke.UNSIGNED_BYTE:e=new Uint8Array(s)}return i.readPixels(0,0,this.width,this.height,n.format,n.dataType,e),i.bindFramebuffer(i.FRAMEBUFFER,null),e}};var Mt={getSettersPerPass:function(t){return void 0===Mt._passTable&&Mt._init(),Mt._findSetters(t,Mt._passTable)},getSettersPerInstance:function(t){return void 0===Mt._instanceTable&&Mt._init(),Mt._findSetters(t,Mt._instanceTable)},_findSetters:function(t,e){var i=[];for(var n in e)if(e.hasOwnProperty(n)){var s=t.getTextureIndex(n);if(-1!==s){var r=new e[n];i.push(r),r.slot=s,r.pass=t}}return i},_init:function(){Mt._passTable={},Mt._instanceTable={},Mt._passTable.hx_normalDepthBuffer=At,Mt._passTable.hx_backbuffer=xt,Mt._passTable.hx_frontbuffer=mt,Mt._passTable.hx_ssao=Tt,Mt._passTable.hx_shadowMap=yt,Mt._passTable["hx_diffuseProbes[0]"]=Nt,Mt._passTable["hx_specularProbes[0]"]=Dt,Mt._instanceTable.hx_skinningTexture=Et}};function At(){}function mt(){}function xt(){}function Tt(){}function yt(){}function Nt(){}function Dt(){}function Et(){}At.prototype.execute=function(t){this.pass.setTextureByIndex(this.slot,t._normalDepthBuffer)},mt.prototype.execute=function(t){t._hdrFront&&this.pass.setTextureByIndex(this.slot,t._hdrFront.texture)},xt.prototype.execute=function(t){t._hdrBack&&this.pass.setTextureByIndex(this.slot,t._hdrBack.texture)},Tt.prototype.execute=function(t){this.pass.setTextureByIndex(this.slot,t._ssaoTexture)},yt.prototype.execute=function(t){this.pass.setTextureByIndex(this.slot,t._shadowAtlas.texture)},Nt.prototype.execute=function(t){this.pass.setTextureArrayByIndex(this.slot,t._diffuseProbeArray)},Dt.prototype.execute=function(t){this.pass.setTextureArrayByIndex(this.slot,t._specularProbeArray)},Et.prototype.execute=function(t){this.pass.setTextureByIndex(this.slot,t.skeletonMatrices)};var wt,Lt,It,vt={getSettersPerPass:function(t){return void 0===vt._passTable&&vt._init(),vt._findSetters(t,vt._passTable)},getSettersPerInstance:function(t){return void 0===vt._instanceTable&&vt._init(),vt._findSetters(t,vt._instanceTable)},_findSetters:function(t,e){var i=[];for(var n in e)if(e.hasOwnProperty(n)){var s=t.getUniformBufferIndex(n);if(-1!==s){var r=new e[n];i.push(r),r.slot=s,r.pass=t}}return i},_init:function(){vt._passTable={},vt._instanceTable={},vt._passTable.hx_lights=St,vt._passTable.hx_lightingCells=Ot}};function St(){}function Ot(){}function Ct(t,e,i,n){this.x=t||0,this.y=e||0,this.z=i||0,this.w=void 0===n?1:n}function jt(){this.enabled=!0,this.onChange=new r,this._targets=[]}function bt(){this._position=new Z(0,0,0,1),this._rotation=new Ct,this._euler=new Z(0,0,0,0),this._scale=new Z(1,1,1,1),this._matrix=new Pt,this._eulerInvalid=!0,this._eulerChangeListener=new jt,this._eulerChangeListener.add(this._euler,"x"),this._eulerChangeListener.add(this._euler,"y"),this._eulerChangeListener.add(this._euler,"z"),this._eulerChangeListener.onChange.bind(this._onEulerChanged,this),this._changeListener=new jt,this._changeListener.add(this._position,"x"),this._changeListener.add(this._position,"y"),this._changeListener.add(this._position,"z"),this._changeListener.add(this._scale,"x"),this._changeListener.add(this._scale,"y"),this._changeListener.add(this._scale,"z"),this._changeListener.onChange.bind(this._invalidateMatrix,this),this._rotationChangeListener=new jt,this._rotationChangeListener.add(this._rotation,"x"),this._rotationChangeListener.add(this._rotation,"y"),this._rotationChangeListener.add(this._rotation,"z"),this._rotationChangeListener.add(this._rotation,"w"),this._rotationChangeListener.onChange.bind(this._onRotationChanged,this)}function Pt(t,e,i,n,s,r,o,a,h,u,l,c,_,d,f,p){this.set(t,e,i,n,s,r,o,a,h,u,l,c,_,d,f,p)}St.prototype.execute=function(t){this.pass.setUniformBufferByIndex(this.slot,t._lightingUniformBuffer)},Ot.prototype.execute=function(t){this.pass.setUniformBufferByIndex(this.slot,t._lightingCellsUniformBuffer)},Ct.fromAxisAngle=function(t,e){var i=new Ct;return i.fromAxisAngle(t,e),i},Ct.fromPitchYawRoll=function(t,e,i){var n=new Ct;return n.fromPitchYawRoll(t,e,i),n},Ct.fromEuler=function(t,e,i){var n=new Ct;return n.fromEuler(t,e,i),n},Ct.fromMatrix=function(t){var e=new Ct;return e.fromMatrix(t),e},Ct.fromVectors=function(t,e){var i=new Ct;return i.fromVectors(t,e),i},Ct.prototype={fromAxisAngle:function(t,e){var i=.5*e,n=Math.sin(i)/t.length;return this.x=t.x*n,this.y=t.y*n,this.z=t.z*n,this.w=Math.cos(i),this},fromPitchYawRoll:function(t,e,i){var n=new Pt;return n.fromRotationPitchYawRoll(t,e,i),this.fromMatrix(n),this},fromEuler:function(t,e,i){void 0===e&&(e=t.y,i=t.z,t=t.x);var n=Math.cos(.5*t),s=Math.cos(.5*e),r=Math.cos(.5*i),o=Math.sin(.5*t),a=Math.sin(.5*e),h=Math.sin(.5*i);return this.x=o*s*r+n*a*h,this.y=n*a*r-o*s*h,this.z=n*s*h+o*a*r,this.w=n*s*r-o*a*h,this},toEuler:function(t){t=t||new Z;var e=this.x,i=this.y,n=this.z,s=this.w,r=e*e,o=i*i,a=n*n,h=s*s;return t.x=Math.atan2(-2*(i*n-s*e),h-r-o+a),t.y=Math.asin(2*(e*n+s*i)),t.z=Math.atan2(-2*(e*i-s*n),h+r-o-a),t},fromMatrix:function(t){var e,i=t._m[0],n=t._m[5],s=t._m[10],r=i+n+s;return 0<r?(r+=1,e=1/Math.sqrt(r)*.5,this.x=e*(t._m[6]-t._m[9]),this.y=e*(t._m[8]-t._m[2]),this.z=e*(t._m[1]-t._m[4]),this.w=e*r):n<i&&s<i?(r=i-n-s+1,e=1/Math.sqrt(r)*.5,this.x=e*r,this.y=e*(t._m[1]+t._m[4]),this.z=e*(t._m[8]+t._m[2]),this.w=e*(t._m[6]-t._m[9])):s<n?(r=n-i-s+1,e=1/Math.sqrt(r)*.5,this.x=e*(t._m[1]+t._m[4]),this.y=e*r,this.z=e*(t._m[6]+t._m[9]),this.w=e*(t._m[8]-t._m[2])):(r=s-i-n+1,e=1/Math.sqrt(r)*.5,this.x=e*(t._m[8]+t._m[2]),this.y=e*(t._m[6]+t._m[9]),this.z=e*r,this.w=e*(t._m[1]-t._m[4])),this.normalize(),this},fromVectors:function(t,e){Z.cross(t,e,this),this.w=Math.sqrt(t.lengthSqr*e.lengthSqr)+t.dot(e),this.normalize()},rotate:function(t,e){e=e||new Z;var i=t.x,n=t.y,s=t.z,r=this.x,o=this.y,a=this.z,h=this.w,u=-r*i-o*n-a*s,l=h*i+o*s-a*n,c=h*n-r*s+a*i,_=h*s+r*n-o*i;return e.x=-u*r+l*h-c*a+_*o,e.y=-u*o+l*a+c*h-_*r,e.z=-u*a-l*o+c*r+_*h,e.w=t.w,e},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},set:function(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this},copyFrom:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},get normSquared(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},get norm(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var t=1/Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},conjugate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},inverseOf:function(t){var e=t.x,i=t.y,n=t.z,s=t.w,r=1/(e*e+i*i+n*n+s*s);return this.x=-e*r,this.y=-i*r,this.z=-n*r,this.w=s*r,this},invert:function(){var t=this.x,e=this.y,i=this.z,n=this.w,s=1/(t*t+e*e+i*i+n*n);return this.x=-t*s,this.y=-e*s,this.z=-i*s,this.w=n*s,this},multiply:function(t,e){var i=t.w,n=t.x,s=t.y,r=t.z,o=e.w,a=e.x,h=e.y,u=e.z;return this.x=i*a+n*o+s*u-r*h,this.y=i*h-n*u+s*o+r*a,this.z=i*u+n*h-s*a+r*o,this.w=i*o-n*a-s*h-r*u,this},append:function(t){return this.multiply(t,this)},prepend:function(t){return this.multiply(this,t)},lerp:function(t,e,i){var n=t.w,s=t.x,r=t.y,o=t.z,a=e.w,h=e.x,u=e.y,l=e.z;return n*a+s*h+r*u+o*l<0&&(a=-a,h=-h,u=-u,l=-l),this.x=s+i*(h-s),this.y=r+i*(u-r),this.z=o+i*(l-o),this.w=n+i*(a-n),this.normalize(),this},slerp:function(t,e,i){var n=t.w,s=t.x,r=t.y,o=t.z,a=e.w,h=e.x,u=e.y,l=e.z,c=n*a+s*h+r*u+o*l;if(c<0&&(c=-c,a=-a,h=-h,u=-u,l=-l),c<.95){var _=i*Math.acos(c),d=h-s*c,f=u-r*c,p=l-o*c,g=a-n*c,M=1/Math.sqrt(d*d+f*f+p*p+g*g);d*=M,f*=M,p*=M,g*=M;var A=Math.cos(_),m=Math.sin(_);this.x=s*A+d*m,this.y=r*A+f*m,this.z=o*A+p*m,this.w=n*A+g*m}else this.x=s+i*(h-s),this.y=r+i*(u-r),this.z=o+i*(l-o),this.w=n+i*(a-n),this.normalize();return this},toString:function(){return"Quaternion("+this.x+", "+this.y+", "+this.z+", "+this.w+")"}},jt.prototype={add:function(t,e){var i=this._targets.length;this._targets.push({object:t,propertyName:e,value:t[e]});var n=this,s=n._targets[i];Object.defineProperty(t,e,{get:function(){return s.value},set:function(t){t!==s.value&&(s.value=t,n.enabled&&n.onChange.dispatch())}})},remove:function(t,e){for(var i=0;i<this._targets.length;++i){var n=this._targets[i];n.object===t&&n.propertyName===e&&(delete n.object[n.propertyName],n.object[n.propertyName]=n.value,this._targets.splice(i--,1))}}},bt.prototype={get position(){return this._position},set position(t){this._position.copyFrom(t)},get rotation(){return this._rotation},set rotation(t){this._rotationChangeListener.enabled=!1,this._rotation.copyFrom(t),this._rotationChangeListener.enabled=!0,this._onRotationChanged()},get euler(){return this._eulerInvalid&&(this._eulerChangeListener.enabled=!1,this._rotation.toEuler(this._euler),this._eulerChangeListener.enabled=!0),this._euler},set euler(t){this._eulerChangeListener.enabled=!1,this._euler.copyFrom(t),this._eulerChangeListener.enabled=!0,this._onEulerChanged()},disableMatrixUpdates:function(){this._changeListener.enabled=!1,this._eulerChangeListener.enabled=!1},enableMatrixUpdates:function(){this._changeListener.enabled=!0,this._eulerChangeListener.enabled=!0,this._invalidateMatrix()},get scale(){return this._scale},set scale(t){this._scale.copyFrom(t)},lookAt:function(t){this._matrix.lookAt(t,this._position),this._matrix.appendScale(this._scale),this._applyMatrix()},copyTransform:function(t){this._changeListener.enabled=!1,this._rotationChangeListener.enabled=!1,this._position.copyFrom(t.position),this._rotation.copyFrom(t.rotation),this._scale.copyFrom(t.scale),this._changeListener.enabled=!0,this._rotationChangeListener.enabled=!0,this._eulerInvalid=!0,this._invalidateMatrix()},get matrix(){return this._matrixInvalid&&this._updateMatrix(),this._matrix},set matrix(t){this._matrix.copyFrom(t),this._applyMatrix()},_onEulerChanged:function(){this._rotationChangeListener.enabled=!1,this._rotation.fromEuler(this._euler),this._rotationChangeListener.enabled=!0,this._invalidateMatrix()},_onRotationChanged:function(){this._eulerInvalid=!0,this._invalidateMatrix()},_invalidateMatrix:function(){this._matrixInvalid=!0},_updateMatrix:function(){this._matrix.compose(this),this._matrixInvalid=!1},_applyMatrix:function(){this._matrixInvalid=!1,this._changeListener.enabled=!1,this._rotationChangeListener.enabled=!1,this._matrix.decompose(this),this._changeListener.enabled=!0,this._rotationChangeListener.enabled=!0,this._eulerInvalid=!0},clone:function(){var t=new bt;return t.copyFrom(this),t},copyFrom:function(t){this.matrix=t.matrix}},Pt.add=function(t,e,i){return(i=i||new Pt).copyFrom(t),i.add(e)},Pt.multiply=function(t,e,i){return(i=i||new Pt).copyFrom(t),i.prepend(e)},Pt.prototype={set:function(t,e,i,n,s,r,o,a,h,u,l,c,_,d,f,p){if(void 0!==t&&isNaN(t))this._m=new Float32Array(t);else{var g=this._m=new Float32Array(16);g[0]=void 0===t?1:0,g[1]=s||0,g[2]=h||0,g[3]=_||0,g[4]=e||0,g[5]=void 0===r?1:0,g[6]=u||0,g[7]=d||0,g[8]=i||0,g[9]=o||0,g[10]=void 0===l?1:0,g[11]=f||0,g[12]=n||0,g[13]=a||0,g[14]=c||0,g[15]=void 0===p?1:0}},transform:function(t,e){e=e||new Z;var i=t.x,n=t.y,s=t.z,r=t.w,o=this._m;return e.x=o[0]*i+o[4]*n+o[8]*s+o[12]*r,e.y=o[1]*i+o[5]*n+o[9]*s+o[13]*r,e.z=o[2]*i+o[6]*n+o[10]*s+o[14]*r,e.w=o[3]*i+o[7]*n+o[11]*s+o[15]*r,e},projectPoint:function(t,e){e=e||new Z;var i=t.x,n=t.y,s=t.z,r=this._m,o=1/(r[3]*i+r[7]*n+r[11]*s+r[15]);return e.x=(r[0]*i+r[4]*n+r[8]*s+r[12])*o,e.y=(r[1]*i+r[5]*n+r[9]*s+r[13])*o,e.z=(r[2]*i+r[6]*n+r[10]*s+r[14])*o,e.w=1,e},transformPoint:function(t,e){e=e||new Z;var i=t.x,n=t.y,s=t.z,r=this._m;return e.x=r[0]*i+r[4]*n+r[8]*s+r[12],e.y=r[1]*i+r[5]*n+r[9]*s+r[13],e.z=r[2]*i+r[6]*n+r[10]*s+r[14],e.w=1,e},transformNormal:function(t,e){var i=this._m,n=i[0],s=i[1],r=i[2],o=i[4],a=i[5],h=i[6],u=i[8],l=i[9],c=i[10],_=1/(n*(a*c-l*h)-o*(s*c-l*r)+u*(s*h-a*r)),d=(a*c-l*h)*_,f=(l*r-s*c)*_,p=(s*h-a*r)*_,g=(u*h-o*c)*_,M=(n*c-u*r)*_,A=(o*r-n*h)*_,m=(o*l-u*a)*_,x=(u*s-n*l)*_,T=(n*a-o*s)*_;e=e||new Z;var y=t.x,N=t.y,D=t.z;return e.x=d*y+f*N+p*D,e.y=g*y+M*N+A*D,e.z=m*y+x*N+T*D,e.w=0,e},transformVector:function(t,e){e=e||new Z;var i=t.x,n=t.y,s=t.z,r=this._m;return e.x=r[0]*i+r[4]*n+r[8]*s,e.y=r[1]*i+r[5]*n+r[9]*s,e.z=r[2]*i+r[6]*n+r[10]*s,e.w=0,e},transformExtent:function(t,e){e=e||new Z;var i=t.x,n=t.y,s=t.z,r=this._m,o=r[0],a=r[1],h=r[2],u=r[4],l=r[5],c=r[6],_=r[8],d=r[9],f=r[10];return o<0&&(o=-o),a<0&&(a=-a),h<0&&(h=-h),u<0&&(u=-u),l<0&&(l=-l),c<0&&(c=-c),_<0&&(_=-_),d<0&&(d=-d),f<0&&(f=-f),e.x=o*i+u*n+_*s,e.y=a*i+l*n+d*s,e.z=h*i+c*n+f*s,e.w=0,e},transformQuaternion:function(t,e){return(e=e||new Ct).fromMatrix(this),e.prepend(t),e},copyFrom:function(t){var e=this._m,i=t._m;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this},fromQuaternion:function(t){var e=t.x,i=t.y,n=t.z,s=t.w,r=this._m;return r[0]=1-2*(i*i+n*n),r[1]=2*(e*i+s*n),r[2]=2*(e*n-s*i),r[3]=0,r[4]=2*(e*i-s*n),r[5]=1-2*(e*e+n*n),r[6]=2*(i*n+s*e),r[7]=0,r[8]=2*(e*n+s*i),r[9]=2*(i*n-s*e),r[10]=1-2*(e*e+i*i),r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,this},multiply:function(t,e){var i=t._m,n=e._m,s=i[0],r=i[1],o=i[2],a=i[3],h=i[4],u=i[5],l=i[6],c=i[7],_=i[8],d=i[9],f=i[10],p=i[11],g=i[12],M=i[13],A=i[14],m=i[15],x=n[0],T=n[1],y=n[2],N=n[3],D=n[4],E=n[5],w=n[6],L=n[7],I=n[8],v=n[9],S=n[10],O=n[11],C=n[12],j=n[13],b=n[14],P=n[15],z=this._m;return z[0]=s*x+h*T+_*y+g*N,z[1]=r*x+u*T+d*y+M*N,z[2]=o*x+l*T+f*y+A*N,z[3]=a*x+c*T+p*y+m*N,z[4]=s*D+h*E+_*w+g*L,z[5]=r*D+u*E+d*w+M*L,z[6]=o*D+l*E+f*w+A*L,z[7]=a*D+c*E+p*w+m*L,z[8]=s*I+h*v+_*S+g*O,z[9]=r*I+u*v+d*S+M*O,z[10]=o*I+l*v+f*S+A*O,z[11]=a*I+c*v+p*S+m*O,z[12]=s*C+h*j+_*b+g*P,z[13]=r*C+u*j+d*b+M*P,z[14]=o*C+l*j+f*b+A*P,z[15]=a*C+c*j+p*b+m*P,this},multiplyAffine:function(t,e){var i=t._m,n=e._m,s=i[0],r=i[1],o=i[2],a=i[4],h=i[5],u=i[6],l=i[8],c=i[9],_=i[10],d=i[12],f=i[13],p=i[14],g=n[0],M=n[1],A=n[2],m=n[4],x=n[5],T=n[6],y=n[8],N=n[9],D=n[10],E=n[12],w=n[13],L=n[14],I=this._m;return I[0]=s*g+a*M+l*A,I[1]=r*g+h*M+c*A,I[2]=o*g+u*M+_*A,I[4]=s*m+a*x+l*T,I[5]=r*m+h*x+c*T,I[6]=o*m+u*x+_*T,I[8]=s*y+a*N+l*D,I[9]=r*y+h*N+c*D,I[10]=o*y+u*N+_*D,I[12]=s*E+a*w+l*L+d,I[13]=r*E+h*w+c*L+f,I[14]=o*E+u*w+_*L+p,this},fromRotationAxisAngle:function(t,e){var i=Math.cos(e),n=Math.sin(e),s=1/t.length,r=t.x*s,o=t.y*s,a=t.z*s,h=1-i,u=this._m;return u[0]=h*r*r+i,u[1]=h*r*o+n*a,u[2]=h*r*a-n*o,u[3]=0,u[4]=h*r*o-n*a,u[5]=h*o*o+i,u[6]=h*o*a+n*r,u[7]=0,u[8]=h*r*a+n*o,u[9]=h*o*a-n*r,u[10]=h*a*a+i,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,this},fromEuler:function(t,e,i){var n=Math.cos(t),s=Math.sin(t),r=Math.cos(e),o=Math.sin(e),a=Math.cos(i),h=Math.sin(i),u=this._m;return u[0]=r*a,u[1]=n*h+s*o*a,u[2]=s*h-n*o*a,u[3]=0,u[4]=-r*h,u[5]=n*a-s*o*h,u[6]=s*a+n*o*h,u[7]=0,u[8]=o,u[9]=-s*r,u[10]=n*r,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,this},fromRotationPitchYawRoll:function(t,e,i){var n=Math.cos(t),s=Math.cos(e),r=Math.cos(i),o=Math.sin(t),a=Math.sin(e),h=Math.sin(i),u=-a*n,l=s*n,c=-o,_=-s*h-a*o*r,d=-a*h+o*r*s,f=n*r,p=l*f-c*d,g=c*_-u*f,M=u*d-l*_,A=this._m;return A[0]=p,A[1]=g,A[2]=M,A[3]=0,A[4]=u,A[5]=l,A[6]=c,A[7]=0,A[8]=_,A[9]=d,A[10]=f,A[11]=0,A[12]=0,A[13]=0,A[14]=0,A[15]=1,this},fromTranslation:function(t,e,i){void 0===e&&(e=(t=t.x).y,i=t.z);var n=this._m;return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=t,n[13]=e,n[14]=i,n[15]=1,this},fromScale:function(t,e,i){t instanceof Z?(e=t.y,i=t.z,t=t.x):void 0===e&&(e=i=t);var n=this._m;return n[0]=t,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=i,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this},fromPerspectiveProjection:function(t,e,i,n){var s=1/Math.tan(.5*t),r=s/e,o=1/(i-n),a=this._m;return a[0]=r,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=0,a[6]=-(n+i)*o,a[7]=1,a[8]=0,a[9]=s,a[10]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=2*i*n*o,a[15]=0,this},fromOrthographicOffCenterProjection:function(t,e,i,n,s,r){var o=1/(e-t),a=1/(i-n),h=1/(s-r),u=this._m;return u[0]=2*o,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=0,u[6]=-2*h,u[7]=0,u[8]=0,u[9]=2*a,u[10]=0,u[11]=0,u[12]=-(t+e)*o,u[13]=-(i+n)*a,u[14]=(r+s)*h,u[15]=1,this},fromOrthographicProjection:function(t,e,i,n){var s=1/t,r=1/e,o=1/(i-n),a=this._m;return a[0]=2*s,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=0,a[6]=-2*o,a[7]=0,a[8]=0,a[9]=2*r,a[10]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=(n+i)*o,a[15]=1,this},clone:function(){return new Pt(this._m)},transpose:function(){var t=this._m,e=t[1],i=t[2],n=t[3],s=t[6],r=t[7],o=t[11];return t[1]=t[4],t[2]=t[8],t[3]=t[12],t[4]=e,t[6]=t[9],t[7]=t[13],t[8]=i,t[9]=s,t[11]=t[14],t[12]=n,t[13]=r,t[14]=o,this},determinant3x3:function(t,e){var i=0===e?4:0,n=e<2?8:4,s=3===e?8:12,r=0===t?1:0,o=t<2?2:1,a=3===t?2:3,h=this._m,u=h[i|o],l=h[o|n],c=h[s|o],_=h[i|a],d=h[n|a],f=h[a|s];return h[i|r]*(l*f-c*d)-h[n|r]*(u*f-c*_)+h[s|r]*(u*d-l*_)},cofactor:function(t,e){return(1-((t+e&1)<<1))*this.determinant3x3(t,e)},getCofactorMatrix:function(t,e,i){for(var n=(i=i||new Pt)._m,s=0;s<16;++s)n[s]=this.cofactor(3&s,s>>2);return i},getAdjugate:function(t,e,i){for(var n=(i=i||new Pt)._m,s=0;s<16;++s)n[s]=this.cofactor(s>>2,3&s);return i},determinant:function(){var t=this._m;return t[0]*this.determinant3x3(0,0)-t[4]*this.determinant3x3(0,1)+t[8]*this.determinant3x3(0,2)-t[12]*this.determinant3x3(0,3)},inverseOf:function(t){var e=t.determinant();if(0===e)return null;var i=1/e,n=i*t.cofactor(0,0),s=i*t.cofactor(0,1),r=i*t.cofactor(0,2),o=i*t.cofactor(0,3),a=i*t.cofactor(1,0),h=i*t.cofactor(1,1),u=i*t.cofactor(1,2),l=i*t.cofactor(1,3),c=i*t.cofactor(2,0),_=i*t.cofactor(2,1),d=i*t.cofactor(2,2),f=i*t.cofactor(2,3),p=i*t.cofactor(3,0),g=i*t.cofactor(3,1),M=i*t.cofactor(3,2),A=i*t.cofactor(3,3),m=this._m;return m[0]=n,m[1]=s,m[2]=r,m[3]=o,m[4]=a,m[5]=h,m[6]=u,m[7]=l,m[8]=c,m[9]=_,m[10]=d,m[11]=f,m[12]=p,m[13]=g,m[14]=M,m[15]=A,this},inverseAffineOf:function(t){var e=t._m,i=e[0],n=e[1],s=e[2],r=e[4],o=e[5],a=e[6],h=e[8],u=e[9],l=e[10],c=e[12],_=e[13],d=e[14],f=i*(o*l-u*a)-r*(n*l-u*s)+h*(n*a-o*s);if(0===f)return null;var p=1/f,g=(o*l-u*a)*p,M=(u*s-n*l)*p,A=(n*a-o*s)*p,m=(h*a-r*l)*p,x=(i*l-h*s)*p,T=(r*s-i*a)*p,y=(r*u-h*o)*p,N=(h*n-i*u)*p,D=(i*o-r*n)*p,E=this._m;return E[0]=g,E[1]=M,E[2]=A,E[3]=0,E[4]=m,E[5]=x,E[6]=T,E[7]=0,E[8]=y,E[9]=N,E[10]=D,E[11]=0,E[12]=-g*c-m*_-y*d,E[13]=-M*c-x*_-N*d,E[14]=-A*c-T*_-D*d,E[15]=1,this},writeNormalMatrix:function(t,e){e=e||0;var i=this._m,n=i[0],s=i[1],r=i[2],o=i[4],a=i[5],h=i[6],u=i[8],l=i[9],c=i[10],_=1/(n*(a*c-l*h)-o*(s*c-l*r)+u*(s*h-a*r));t[e]=(a*c-l*h)*_,t[e+1]=(u*h-o*c)*_,t[e+2]=(o*l-u*a)*_,t[e+3]=(l*r-s*c)*_,t[e+4]=(n*c-u*r)*_,t[e+5]=(u*s-n*l)*_,t[e+6]=(s*h-a*r)*_,t[e+7]=(o*r-n*h)*_,t[e+8]=(n*a-o*s)*_},writeData:function(t,e){e=e||0;for(var i=this._m,n=0;n<16;++n)t[e+n]=i[n]},writeData4x3:function(t,e){var i=this._m;t[e=e||0]=i[0],t[e+1]=i[4],t[e+2]=i[8],t[e+3]=i[12],t[e+4]=i[1],t[e+5]=i[5],t[e+6]=i[9],t[e+7]=i[13],t[e+8]=i[2],t[e+9]=i[6],t[e+10]=i[10],t[e+11]=i[14]},invert:function(){return this.inverseOf(this)},invertAffine:function(){return this.inverseAffineOf(this)},append:function(t){return this.multiply(t,this)},prepend:function(t){return this.multiply(this,t)},appendAffine:function(t){return this.multiplyAffine(t,this)},prependAffine:function(t){return this.multiplyAffine(this,t)},add:function(t){var e=this._m,i=t._m;return e[0]+=i[0],e[1]+=i[1],e[2]+=i[2],e[3]+=i[3],e[4]+=i[4],e[5]+=i[5],e[6]+=i[6],e[7]+=i[7],e[8]+=i[8],e[9]+=i[9],e[10]+=i[10],e[11]+=i[11],e[12]+=i[12],e[13]+=i[13],e[14]+=i[14],e[15]+=i[15],this},addAffine:function(t){var e=this._m,i=t._m;return e[0]+=i[0],e[1]+=i[1],e[2]+=i[2],e[4]+=i[4],e[5]+=i[5],e[6]+=i[6],e[8]+=i[8],e[9]+=i[9],e[10]+=i[10],this},subtract:function(t){var e=this._m,i=t._m;return e[0]-=i[0],e[1]-=i[1],e[2]-=i[2],e[3]-=i[3],e[4]-=i[4],e[5]-=i[5],e[6]-=i[6],e[7]-=i[7],e[8]-=i[8],e[9]-=i[9],e[10]-=i[10],e[11]-=i[11],e[12]-=i[12],e[13]-=i[13],e[14]-=i[14],e[15]-=i[15],this},subtractAffine:function(t){var e=this._m,i=t._m;return e[0]-=i[0],e[1]-=i[1],e[2]-=i[2],e[4]-=i[4],e[5]-=i[5],e[6]-=i[6],e[8]-=i[8],e[9]-=i[9],e[10]-=i[10],this},appendScale:function(t,e,i){t instanceof Z?(e=t.y,i=t.z,t=t.x):void 0===e&&(e=i=t);var n=this._m;return n[0]*=t,n[1]*=e,n[2]*=i,n[4]*=t,n[5]*=e,n[6]*=i,n[8]*=t,n[9]*=e,n[10]*=i,n[12]*=t,n[13]*=e,n[14]*=i,this},prependScale:function(t,e,i){t instanceof Z?(e=t.y,i=t.z,t=t.x):void 0===e&&(e=i=t);var n=this._m;return n[0]*=t,n[1]*=t,n[2]*=t,n[3]*=t,n[4]*=e,n[5]*=e,n[6]*=e,n[7]*=e,n[8]*=i,n[9]*=i,n[10]*=i,n[11]*=i,this},appendTranslation:function(t,e,i){void 0===e&&(e=t.y,i=t.z,t=t.x);var n=this._m;return n[12]+=t,n[13]+=e,n[14]+=i,this},prependTranslation:function(t,e,i){void 0===e&&(e=t.y,i=t.z,t=t.x);var n=this._m;return n[12]+=n[0]*t+n[4]*e+n[8]*i,n[13]+=n[1]*t+n[5]*e+n[9]*i,n[14]+=n[2]*t+n[6]*e+n[10]*i,n[15]+=n[3]*t+n[7]*e+n[11]*i,this},appendQuaternion:function(t){var e=this._m,i=t.x,n=t.y,s=t.z,r=t.w,o=1-2*(n*n+s*s),a=2*(i*n+r*s),h=2*(i*s-r*n),u=2*(i*n-r*s),l=1-2*(i*i+s*s),c=2*(n*s+r*i),_=2*(i*s+r*n),d=2*(n*s-r*i),f=1-2*(i*i+n*n),p=e[0],g=e[1],M=e[2],A=e[4],m=e[5],x=e[6],T=e[8],y=e[9],N=e[10],D=e[12],E=e[13],w=e[14];return e[0]=o*p+u*g+_*M,e[1]=a*p+l*g+d*M,e[2]=h*p+c*g+f*M,e[4]=o*A+u*m+_*x,e[5]=a*A+l*m+d*x,e[6]=h*A+c*m+f*x,e[8]=o*T+u*y+_*N,e[9]=a*T+l*y+d*N,e[10]=h*T+c*y+f*N,e[12]=o*D+u*E+_*w,e[13]=a*D+l*E+d*w,e[14]=h*D+c*E+f*w,this},prependQuaternion:function(t){var e=this._m,i=t.x,n=t.y,s=t.z,r=t.w,o=e[0],a=e[1],h=e[2],u=e[4],l=e[5],c=e[6],_=e[8],d=e[9],f=e[10],p=1-2*(n*n+s*s),g=2*(i*n+r*s),M=2*(i*s-r*n),A=2*(i*n-r*s),m=1-2*(i*i+s*s),x=2*(n*s+r*i),T=2*(i*s+r*n),y=2*(n*s-r*i),N=1-2*(i*i+n*n);return e[0]=o*p+u*g+_*M,e[1]=a*p+l*g+d*M,e[2]=h*p+c*g+f*M,e[4]=o*A+u*m+_*x,e[5]=a*A+l*m+d*x,e[6]=h*A+c*m+f*x,e[8]=o*T+u*y+_*N,e[9]=a*T+l*y+d*N,e[10]=h*T+c*y+f*N,this},appendRotationAxisAngle:function(t,e){var i=this._m,n=Math.cos(e),s=Math.sin(e),r=1/t.length,o=t.x*r,a=t.y*r,h=t.z*r,u=1-n,l=u*o*o+n,c=u*o*a+s*h,_=u*o*h-s*a,d=u*o*a-s*h,f=u*a*a+n,p=u*a*h+s*o,g=u*o*h+s*a,M=u*a*h-s*o,A=u*h*h+n,m=i[0],x=i[1],T=i[2],y=i[4],N=i[5],D=i[6],E=i[8],w=i[9],L=i[10],I=i[12],v=i[13],S=i[14];return i[0]=l*m+d*x+g*T,i[1]=c*m+f*x+M*T,i[2]=_*m+p*x+A*T,i[4]=l*y+d*N+g*D,i[5]=c*y+f*N+M*D,i[6]=_*y+p*N+A*D,i[8]=l*E+d*w+g*L,i[9]=c*E+f*w+M*L,i[10]=_*E+p*w+A*L,i[12]=l*I+d*v+g*S,i[13]=c*I+f*v+M*S,i[14]=_*I+p*v+A*S,this},prependRotationAxisAngle:function(t,e){var i=this._m,n=Math.cos(e),s=Math.sin(e),r=1/t.length,o=t.x*r,a=t.y*r,h=t.z*r,u=1-n,l=i[0],c=i[1],_=i[2],d=i[4],f=i[5],p=i[6],g=i[8],M=i[9],A=i[10],m=u*o*o+n,x=u*o*a+s*h,T=u*o*h-s*a,y=u*o*a-s*h,N=u*a*a+n,D=u*a*h+s*o,E=u*o*h+s*a,w=u*a*h-s*o,L=u*h*h+n;return i[0]=l*m+d*x+g*T,i[1]=c*m+f*x+M*T,i[2]=_*m+p*x+A*T,i[4]=l*y+d*N+g*D,i[5]=c*y+f*N+M*D,i[6]=_*y+p*N+A*D,i[8]=l*E+d*w+g*L,i[9]=c*E+f*w+M*L,i[10]=_*E+p*w+A*L,this},getRow:function(t,e){var i=this._m;return(e=e||new Z).x=i[t],e.y=i[4|t],e.z=i[8|t],e.w=i[12|t],e},setRow:function(t,e){var i=this._m;return i[t]=e.x,i[4|t]=e.y,i[8|t]=e.z,i[12|t]=e.w,this},getElement:function(t,e){return this._m[t|e<<2]},setElement:function(t,e,i){return this._m[t|e<<2]=i,this},getColumn:function(t,e){var i=this._m;return t<<=2,(e=e||new Z).x=i[t],e.y=i[1|t],e.z=i[2|t],e.w=i[3|t],e},setColumn:function(t,e){var i=this._m;return i[t<<=2]=e.x,i[1|t]=e.y,i[2|t]=e.z,i[3|t]=e.w,this},copyColumn:function(t,e){var i=this._m,n=e._m;return i[t<<=2]=n[t],i[1|t]=n[1|t],i[2|t]=n[2|t],i[3|t]=n[3|t],this},lookAt:(wt=new Z,Lt=new Z,It=new Z,function(t,e,i){if(i=i||Z.Z_AXIS,Z.subtract(t,e,Lt),Lt.normalize(),Z.cross(Lt,i,wt),Math.abs(wt.lengthSqr)<1e-4){var n=new Z(i.x,i.z,i.y,0);Z.cross(Lt,n,wt),Math.abs(wt.lengthSqr)<=1e-4&&(n.set(i.z,i.y,i.z,0),Z.cross(Lt,n,wt))}wt.normalize(),Z.cross(wt,Lt,It);var s=this._m;return s[0]=wt.x,s[1]=wt.y,s[2]=wt.z,s[3]=0,s[4]=Lt.x,s[5]=Lt.y,s[6]=Lt.z,s[7]=0,s[8]=It.x,s[9]=It.y,s[10]=It.z,s[11]=0,s[12]=e.x,s[13]=e.y,s[14]=e.z,s[15]=1,this}),compose:function(t,e,i){var n=e?t:t.position;return e=e||t.rotation,(i=i||t.scale)?this.fromScale(i):this.copyFrom(Pt.IDENTITY),this.appendQuaternion(e),this.appendTranslation(n),this},decompose:function(t,e,i){var n;t=t||new bt,void 0===e?(e=t.rotation,i=t.scale,n=t.position):n=t;var s=this._m,r=s[0],o=s[1],a=s[2],h=s[4],u=s[5],l=s[6],c=s[8],_=s[9],d=s[10],f=o*l-a*u,p=a*h-r*l,g=r*u-o*h,M=at.sign(f*c+p*_+g*d);i.x=M*Math.sqrt(r*r+o*o+a*a),i.y=M*Math.sqrt(h*h+u*u+l*l),i.z=M*Math.sqrt(c*c+_*_+d*d),.999<i.x&&i.x<1.001&&(i.x=1),.999<i.y&&i.y<1.001&&(i.y=1),.999<i.z&&i.z<1.001&&(i.z=1);var A=this.clone(),m=1/i.x,x=1/i.y,T=1/i.z,y=A._m;return y[0]*=m,y[1]*=m,y[2]*=m,y[4]*=x,y[5]*=x,y[6]*=x,y[8]*=T,y[9]*=T,y[10]*=T,e.fromMatrix(A),this.getColumn(3,n),t},swapColums:function(t,e){var i=this._m;if(t!==e){e<<=2;var n=i[t<<=2],s=i[1|t],r=i[2|t],o=i[3|t];return i[t]=i[e],i[1|t]=i[1|e],i[2|t]=i[2|e],i[3|t]=i[3|e],i[e]=n,i[1|e]=s,i[2|e]=r,i[3|e]=o,this}},toString:function(){for(var t=this._m,e="",i=0;i<16;++i){var n=3&i;0===n&&(e+="["),e+=t[i],e+=3===n?"]\n":"\t , \t"}return e}},Pt.IDENTITY=new Pt,Pt.ZERO=new Pt(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);var zt,Rt,Ut,Bt,Ft,kt,Yt={getSettersPerInstance:function(t){return void 0===Yt._instanceTable&&Yt._init(),Yt._findSetters(t.shader,Yt._instanceTable)},getSettersPerPass:function(t){return void 0===Yt._passTable&&Yt._init(),Yt._findSetters(t.shader,Yt._passTable)},_findSetters:function(t,e){var i=[];for(var n in e){var s=U.gl.getUniformLocation(t.program,n);if(s){var r=new e[n];i.push(r),r.location=s}}return i},_init:function(){Yt._instanceTable={},Yt._passTable={},Yt._instanceTable.hx_worldMatrix=Qt,Yt._instanceTable.hx_worldViewMatrix=Kt,Yt._instanceTable.hx_wvpMatrix=Zt,Yt._instanceTable.hx_inverseWVPMatrix=Vt,Yt._instanceTable.hx_normalWorldMatrix=qt,Yt._instanceTable.hx_normalWorldViewMatrix=Jt,Yt._instanceTable.hx_bindShapeMatrix=de,Yt._instanceTable.hx_bindShapeMatrixInverse=_e,Yt._instanceTable["hx_skinningMatrices[0]"]=fe,Yt._instanceTable["hx_morphWeights[0]"]=pe,Yt._passTable.hx_viewMatrix=re,Yt._passTable.hx_projectionMatrix=Ht,Yt._passTable.hx_inverseProjectionMatrix=Wt,Yt._passTable.hx_viewProjectionMatrix=Gt,Yt._passTable.hx_inverseViewProjectionMatrix=Xt,Yt._passTable.hx_cameraWorldPosition=$t,Yt._passTable.hx_cameraWorldMatrix=te,Yt._passTable.hx_cameraFrustumRange=ee,Yt._passTable.hx_rcpCameraFrustumRange=ie,Yt._passTable.hx_cameraNearPlaneDistance=ne,Yt._passTable.hx_cameraFarPlaneDistance=se,Yt._passTable.hx_renderTargetResolution=oe,Yt._passTable.hx_rcpRenderTargetResolution=he,Yt._passTable.hx_dither2DTextureScale=ue,Yt._passTable.hx_ambientColor=ae,Yt._passTable["hx_poissonDisk[0]"]=le,Yt._passTable["hx_poissonSphere[0]"]=ce}};function Qt(){}function Gt(){}function Xt(){}function Vt(){}function Ht(){}function Wt(){}function Zt(){}function Kt(){this._matrix=new Pt}function qt(){}function Jt(){}function $t(){}function te(){}function ee(){}function ie(){}function ne(){}function se(){}function re(){}function oe(){}function ae(){}function he(){}function ue(){}function le(){}function ce(){}function _e(){}function de(){}function fe(){this._data=new Float32Array(12*ve.OPTIONS.maxSkeletonJoints)}function pe(){}function ge(t){this.shader=t,this.cullMode=Ye.BACK,this.writeColor=!0,this.depthTest=Ge.LESS_EQUAL,this.writeDepth=!0,this.blendState=null,this._textures=new Array(t.numTextures),this._uniformBuffers=new Array(t.numUniformBuffers),this._uniformSettersInstance=Yt.getSettersPerInstance(this),this._uniformSettersPass=Yt.getSettersPerPass(this),this._textureSettersPass=Mt.getSettersPerPass(this),this._textureSettersInstance=Mt.getSettersPerInstance(this),Be.WEBGL_2&&(this._uniformBufferSettersPass=vt.getSettersPerPass(this),this._uniformBufferSettersInstance=vt.getSettersPerInstance(this)),this.setTexture("hx_dither2D",Ue.DEFAULT_2D_DITHER_TEXTURE),this._uniformFuncs={}}function Me(){this._mapping=[],this._input=null,this._values={}}function Ae(t){Me.call(this),this.axisDeadzone=.251,this.hasPosition=!1,this.hasRotation=!1,this.position=new Z,this.rotation=new Ct,this.linearVelocity=new Z(0,0,0,0),this.angularVelocity=new Z(0,0,0,0),this.linearAcceleration=new Z(0,0,0,0),this.angularAcceleration=new Z(0,0,0,0),this._device=t}Qt.prototype.execute=function(t,e){U.gl.uniformMatrix4fv(this.location,!1,e.worldMatrix._m)},Gt.prototype.execute=function(t){U.gl.uniformMatrix4fv(this.location,!1,t.viewProjectionMatrix._m)},Xt.prototype.execute=function(t){U.gl.uniformMatrix4fv(this.location,!1,t.inverseViewProjectionMatrix._m)},Vt.prototype.execute=function(t){U.gl.uniformMatrix4fv(this.location,!1,t.inverseViewProjectionMatrix._m)},Ht.prototype.execute=function(t){U.gl.uniformMatrix4fv(this.location,!1,t.projectionMatrix._m)},Wt.prototype.execute=function(t){U.gl.uniformMatrix4fv(this.location,!1,t.inverseProjectionMatrix._m)},Zt.prototype.execute=(zt=new Pt,Rt=zt._m,function(t,e){zt.multiply(t.viewProjectionMatrix,e.worldMatrix),U.gl.uniformMatrix4fv(this.location,!1,Rt)}),Kt.prototype.execute=(Ut=new Pt,Bt=Ut._m,function(t,e){Ut.multiply(t.viewMatrix,e.worldMatrix),U.gl.uniformMatrix4fv(this.location,!1,Bt)}),qt.prototype.execute=(Ft=new Float32Array(9),function(t,e){e.worldMatrix.writeNormalMatrix(Ft),U.gl.uniformMatrix3fv(this.location,!1,Ft)}),Jt.prototype.execute=(kt=new Float32Array(9),function(t,e){var i=t.viewMatrix._m,n=e.worldMatrix._m,s=i[0],r=i[1],o=i[2],a=i[4],h=i[5],u=i[6],l=i[8],c=i[9],_=i[10],d=i[12],f=i[13],p=i[14],g=n[0],M=n[1],A=n[2],m=n[3],x=n[4],T=n[5],y=n[6],N=n[7],D=n[8],E=n[9],w=n[10],L=n[11],I=s*g+a*M+l*A+d*m,v=r*g+h*M+c*A+f*m,S=o*g+u*M+_*A+p*m,O=s*x+a*T+l*y+d*N,C=r*x+h*T+c*y+f*N,j=o*x+u*T+_*y+p*N,b=s*D+a*E+l*w+d*L,P=r*D+h*E+c*w+f*L,z=o*D+u*E+_*w+p*L,R=1/(I*(C*z-P*j)-O*(v*z-P*S)+b*(v*j-C*S));kt[0]=(C*z-P*j)*R,kt[1]=(b*j-O*z)*R,kt[2]=(O*P-b*C)*R,kt[3]=(P*S-v*z)*R,kt[4]=(I*z-b*S)*R,kt[5]=(b*v-I*P)*R,kt[6]=(v*j-C*S)*R,kt[7]=(O*S-I*j)*R,kt[8]=(I*C-O*v)*R,U.gl.uniformMatrix3fv(this.location,!1,kt)}),$t.prototype.execute=function(t){var e=t.worldMatrix._m;U.gl.uniform3f(this.location,e[12],e[13],e[14])},te.prototype.execute=function(t){var e=t.worldMatrix;U.gl.uniformMatrix4fv(this.location,!1,e._m)},ee.prototype.execute=function(t){U.gl.uniform1f(this.location,t._farDistance-t._nearDistance)},ie.prototype.execute=function(t){U.gl.uniform1f(this.location,1/(t._farDistance-t._nearDistance))},ne.prototype.execute=function(t){U.gl.uniform1f(this.location,t._nearDistance)},se.prototype.execute=function(t){U.gl.uniform1f(this.location,t._farDistance)},re.prototype.execute=function(t){U.gl.uniformMatrix4fv(this.location,!1,t.viewMatrix._m)},oe.prototype.execute=function(t){U.gl.uniform2f(this.location,t._renderTargetWidth,t._renderTargetHeight)},ae.prototype.execute=function(t,e){var i=e._ambientColor;U.gl.uniform3f(this.location,i.r,i.g,i.b)},he.prototype.execute=function(t){U.gl.uniform2f(this.location,1/t._renderTargetWidth,1/t._renderTargetHeight)},ue.prototype.execute=function(){U.gl.uniform2f(this.location,1/Ue.DEFAULT_2D_DITHER_TEXTURE.width,1/Ue.DEFAULT_2D_DITHER_TEXTURE.height)},le.prototype.execute=function(){U.gl.uniform2fv(this.location,ft.DEFAULT_FLOAT32)},ce.prototype.execute=function(){U.gl.uniform3fv(this.location,pt.DEFAULT_FLOAT32)},_e.prototype.execute=function(t,e){var i=e.meshInstance.bindShapeMatrixInverse||Pt.IDENTITY;U.gl.uniformMatrix4fv(this.location,!1,i._m)},de.prototype.execute=function(t,e){var i=e.meshInstance.bindShapeMatrix||Pt.IDENTITY;U.gl.uniformMatrix4fv(this.location,!1,i._m)},fe.prototype.execute=function(t,e){var i=e.skeleton;if(i){for(var n=e.skeletonMatrices,s=i.joints.length,r=0,o=0;o<s;++o)n[o].writeData4x3(this._data,r),r+=12;U.gl.uniform4fv(this.location,this._data)}},pe.prototype.execute=function(t,e){U.gl.uniform1fv(this.location,e.meshInstance._morphWeights)},ge.BASE_PASS=0,ge.NORMAL_DEPTH_PASS=1,ge.DIR_LIGHT_SHADOW_MAP_PASS=2,ge.POINT_LIGHT_SHADOW_MAP_PASS=3,ge.DIR_LIGHT_PASS=4,ge.POINT_LIGHT_PASS=5,ge.SPOT_LIGHT_PASS=6,ge.LIGHT_PROBE_PASS=7,ge.NUM_PASS_TYPES=8,ge.prototype={constructor:ge,updateInstanceRenderState:function(t,e){for(var i=this._textureSettersInstance.length,n=0;n<i;++n)this._textureSettersInstance[n].execute(e);i=this._uniformSettersInstance.length;for(n=0;n<i;++n)this._uniformSettersInstance[n].execute(t,e);if(this._uniformBufferSettersInstance)for(i=this._uniformBufferSettersInstance.length,n=0;n<i;++n)this._uniformBufferSettersInstance[n].execute(e)},updatePassRenderState:function(t,e,i){var n;for(var s in U.setShader(this.shader),this._uniformFuncs)this._uniformFuncs[s]();n=this._uniformSettersPass.length;for(var r=0;r<n;++r)this._uniformSettersPass[r].execute(t,e);for(n=this._textureSettersPass.length,r=0;r<n;++r)this._textureSettersPass[r].execute(e);if(this._uniformBufferSettersPass)for(n=this._uniformBufferSettersPass.length,r=0;r<n;++r)this._uniformBufferSettersPass[r].execute(e);for(n=this._textures.length,r=0;r<n;++r){var o=this._textures[r];o?o.isReady()?o.bind(r):o._default.bind(r):ut.DEFAULT.bind(r)}for(n=this._uniformBuffers.length,r=0;r<n;++r){var a=this._uniformBuffers[r];a&&a.bind(r)}U.setMaterialPassState(this.cullMode,this.depthTest,this.writeDepth,this.writeColor,this.blendState)},getTextureIndex:function(t){return this.shader.getTextureIndex(t)},hasTexture:function(t){return-1!==this.getTextureIndex(t)},setTexture:function(t,e){var i=this.shader.getTextureIndex(t);-1!==i&&(this._textures[i]=e)},setTextureByIndex:function(t,e){this._textures[t]=e},setTextureArray:function(t,e){var i=this.getTextureIndex(t+"[0]");if(-1!==i)for(var n=0,s=e.length;n<s;++n)this._textures[i+n]=e[n]},setTextureArrayByIndex:function(t,e){for(var i=0,n=e.length;i<n;++i)this._textures[t+i]=e[i]},getUniformBufferIndex:function(t){return this.shader.getUniformBufferIndex(t)},setUniformBuffer:function(t,e){var i=this.shader.getUniformBufferIndex(t);-1!==i&&(this._uniformBuffers[i]=e)},setUniformBufferByIndex:function(t,e){this._uniformBuffers[t]=e},getUniformLocation:function(t){return this.shader.getUniformLocation(t)},getAttributeLocation:function(t){return this.shader.getAttributeLocation(t)},setUniformStructArray:function(t,e){for(var i=e.length,n=0;n<i;++n){var s=e[n];for(var r in s)s.hasOwnProperty(r)&&this.setUniform(t+"["+n+"]."+r,e)}},setUniformArray:function(t,e){t+="[0]";var i=this.shader.getUniform(t);if(i){var n,s=U.gl;switch(i.type){case s.FLOAT:n=s.uniform1fv.bind(s,i.location,e);break;case s.FLOAT_VEC2:n=s.uniform2fv.bind(s,i.location,e);break;case s.FLOAT_VEC3:n=s.uniform3fv.bind(s,i.location,e);break;case s.FLOAT_VEC4:n=s.uniform4fv.bind(s,i.location,e);break;case s.FLOAT_MAT4:n=s.uniformMatrix4fv.bind(s,i.location,!1,e);break;case s.INT:n=s.uniform1iv.bind(s,i.location,e);break;case s.INT_VEC2:n=s.uniform2iv.bind(s,i.location,e);break;case s.INT_VEC3:n=s.uniform3iv.bind(s,i.location,e);break;case s.INT_VEC4:n=s.uniform1iv.bind(s,i.location,e);break;case s.BOOL:n=s.uniform1bv.bind(s,i.location,e);break;case s.BOOL_VEC2:n=s.uniform2bv.bind(s,i.location,e);break;case s.BOOL_VEC3:n=s.uniform3bv.bind(s,i.location,e);break;case s.BOOL_VEC4:n=s.uniform4bv.bind(s,i.location,e);break;default:throw new Error("Unsupported uniform format for setting ("+i.type+") for uniform '"+t+"'. May be a todo.")}this._uniformFuncs[t]=n}},setUniform:function(t,e){var i=this.shader.getUniform(t);if(i){var n,s=U.gl;switch(i.type){case s.FLOAT:n=s.uniform1f.bind(s,i.location,e);break;case s.FLOAT_VEC2:n=s.uniform2f.bind(s,i.location,e.x||e[0]||0,e.y||e[1]||0);break;case s.FLOAT_VEC3:n=s.uniform3f.bind(s,i.location,e.x||e.r||e[0]||0,e.y||e.g||e[1]||0,e.z||e.b||e[2]||0);break;case s.FLOAT_VEC4:n=s.uniform4f.bind(s,i.location,e.x||e.r||e[0]||0,e.y||e.g||e[1]||0,e.z||e.b||e[2]||0,e.w||e.a||e[3]||0);break;case s.INT:n=s.uniform1i.bind(s,i.location,e);break;case s.INT_VEC2:n=s.uniform2i.bind(s,i.location,e.x||e[0],e.y||e[1]);break;case s.INT_VEC3:n=s.uniform3i.bind(s,i.location,e.x||e[0],e.y||e[1],e.z||e[2]);break;case s.INT_VEC4:n=s.uniform4i.bind(s,i.location,e.x||e[0],e.y||e[1],e.z||e[2],e.w||e[3]);break;case s.BOOL:n=s.uniform1i.bind(s,i.location,e);break;case s.BOOL_VEC2:n=s.uniform2i.bind(s,i.location,e.x||e[0],e.y||e[1]);break;case s.BOOL_VEC3:n=s.uniform3i.bind(s,i.location,e.x||e[0],e.y||e[1],e.z||e[2]);break;case s.BOOL_VEC4:n=s.uniform4i.bind(s,i.location,e.x||e[0],e.y||e[1],e.z||e[2],e.w||e[3]);break;case s.FLOAT_MAT4:n=s.uniformMatrix4fv.bind(s,i.location,!1,e._m);break;default:throw new Error("Unsupported uniform format for setting. May be a todo.")}this._uniformFuncs[t]=n}}},Me.prototype={onEnabled:function(){throw new Error("Abstract method called!")},onDisabled:function(){throw new Error("Abstract method called!")},map:function(t,e){this._mapping[t]=e},unmap:function(t){this._mapping[t]=void 0},isMapped:function(t){return!!this._mapping[t]},setValue:function(t,e){if(this._input&&this._values[t]!==e){this._values[t]=e;var i=this._mapping[t];i&&this._input.setActionValue(i,e)}},_setInput:function(t){console.assert(!!this._input!=!!t,"Cannot enable or disable inputs twice!"),(this._input=t)?this.onEnabled():this.onDisabled()}},Ae.A=0,Ae.B=1,Ae.X=2,Ae.Y=3,Ae.LB=4,Ae.RB=5,Ae.LT=6,Ae.RT=7,Ae.BACK=8,Ae.START=9,Ae.L3=16,Ae.R3=17,Ae.DPAD_UP=18,Ae.DPAD_DOWN=19,Ae.DPAD_LEFT=20,Ae.DPAD_RIGHT=21,Ae.STICK_LX=256,Ae.STICK_LY=257,Ae.STICK_RX=258,Ae.STICK_RY=259,Ae.PRESS=4096,Ae.TOUCH=8192,Ae.HAND_LEFT="left",Ae.HAND_RIGHT="right",(Ae.prototype=Object.create(Me.prototype,{displayId:{get:function(){return this._device.displayId}},id:{get:function(){return this._device.id}},index:{get:function(){return this._device.index}},mapping:{get:function(){return this._device.mapping}},hand:{get:function(){return this._device.hand}}})).onEnabled=function(){++xe,Se.bind(this._onPreFrame,this)},Ae.prototype.onDisabled=function(){--xe,Se.unbind(this._onPreFrame)},Ae.prototype._onPreFrame=function(){var t=this._device;if(t.connected){for(var e=t.buttons,i=t.axes,n=0,s=e.length;n<s;++n){var r=e[n];this.setValue(n,r.value),this.setValue(n|Ae.PRESS,r.pressed?1:0),void 0!==r.touched&&this.setValue(n|Ae.TOUCH,r.touched?1:0)}var o=this.axisDeadzone;if(0<o){var a=o*o,h=1/(1-o);for(n=0,s=i.length;n<s;n+=2){var u=i[n],l=i[1|n],c=u*u+l*l;if(a<c){var _=Math.sqrt(c),d=(_-o)*h/_;this.setValue(256|n,u*d),this.setValue(257|n,l*d)}else this.setValue(256|n,0),this.setValue(257|n,0)}}else for(n=0,s=i.length;n<s;++n){var f=i[n];this.setValue(256|n,f)}var p=this._device.pose;if(p){var g=p.position,M=p.orientation,A=p.linearVelocity,m=p.angularVelocity,x=p.linearAcceleration,T=p.angularAcceleration;g?(this.position.set(g[0],-g[2],g[1]),this.hasPosition=!0):this.hasPosition=!1,M?(this.rotation.set(M[0],-M[2],M[1],M[3]),this.hasRotation=!0):this.hasRotation=!1,A&&this.linearVelocity.set(A[0],-A[2],A[1]),x&&this.linearAcceleration.set(x[0],-x[2],x[1]),m&&this.angularVelocity.set(m[0],-m[2],m[1]),T&&this.angularAcceleration.set(T[0],-T[2],T[1])}}};var me=[],xe=0,Te=new r,ye=new r;function Ne(){return me}function De(t){console.log("gamepad connected ",t.gamepad.id,t.gamepad.displayId);var e=new Ae(t.gamepad);me[t.gamepad.index]=e,Te.dispatch(e)}function Ee(t){console.log("gamepad disconnected "+t.gamepad.id);var e=t.gamepad.index,i=me[e];delete me[e],ye.dispatch(i)}function we(t){if(this._display=t,this.onGamepadConnected=new r,this.onGamepadDisconnected=new r,this.requestAnimationFrame=t.requestAnimationFrame.bind(t),this.cancelAnimationFrame=t.cancelAnimationFrame.bind(t),this.getEyeParameters=t.getEyeParameters.bind(t),this.getFrameData=t.getFrameData.bind(t),this.capabilities=t.capabilities,this._gamepadLeft=null,this._gamepadRight=null,this.sittingToStandingTransform=null,this.roomSize=void 0,t.stageParameters){if(t.stageParameters.sittingToStandingTransform){this.sittingToStandingTransform=new Pt(t.stageParameters.sittingToStandingTransform);var e=new bt;this.sittingToStandingTransform.decompose(e);var i=e.position.y;e.position.y=-e.position.z,e.position.z=i,i=e.rotation.y,e.rotation.y=-e.rotation.z,e.rotation.z=i,this.sittingToStandingTransform.compose(e)}t.stageParameters.sizeX&&(this.roomSize=new dt(t.stageParameters.sizeX,t.stageParameters.sizeY))}this.sittingToStandingTransform||(this.sittingToStandingTransform=new Pt,this.sittingToStandingTransform.fromTranslation(0,0,ve.OPTIONS.vrUserHeight))}var Le=!(we.prototype={get displayName(){return this._display.displayName},get displayId(){return this._display.displayId},get gamepads(){return this._gamepads},get gamepadLeft(){return this._gamepadLeft},get gamepadRight(){return this._gamepadRight},get isPresenting(){return this._display.isPresenting},exitPresent:function(){this._display.exitPresent()},onEnabled:function(){Te.bind(this._onGamepadConnected,this),ye.bind(this._onGamepadDisconnected,this),Ne().forEach(this._onGamepadConnected.bind(this))},onDisabled:function(){Te.unbind(this._onGamepadConnected,this),ye.unbind(this._onGamepadDisconnected,this)},_onGamepadConnected:function(t){t.displayId===this.displayId&&(t.hand!==Ae.HAND_LEFT||this._gamepadLeft?t.hand!==Ae.HAND_RIGHT||this._gamepadRight||(console.log("Right VR controller connected"),this._gamepadRight=t,this.onGamepadConnected.dispatch(t)):(console.log("Left VR controller connected"),this._gamepadLeft=t,this.onGamepadConnected.dispatch(t)))},_onGamepadDisconnected:function(t){t.displayId===this.displayId&&(t.hand===Ae.HAND_LEFT?(this._gamepadLeft=null,this.onGamepadDisconnected.dispatch(t)):t.hand===Ae.HAND_RIGHT&&(this._gamepadRight=null,this.onGamepadDisconnected.dispatch(t)))}});function Ie(){ve.VR_DISPLAY&&(ve.VR_DISPLAY.onDisabled(),Le=!1,ve.VR_DISPLAY.isPresenting&&ve.VR_DISPLAY.exitPresent(),Be.VR_CAN_PRESENT=!1,ve.VR_DISPLAY=null,ve.VR_LEFT_EYE_PARAMS=null,ve.VR_RIGHT_EYE_PARAMS=null)}var ve={INITIALIZED:!1,OPTIONS:null,TARGET_CANVAS:null,VR_DISPLAY:null,VR_LEFT_EYE_PARAMS:null,VR_RIGHT_EYE_PARAMS:null,AUDIO_CONTEXT:null,CURRENT_FRAME_MARK:0},Se=new r,Oe=new r,Ce=0,je=new o;je.onTick.bind(function(t){++ve.CURRENT_FRAME_MARK,A(ve.CURRENT_FRAME_MARK);var e=(performance||Date).now();(function(){var t=ve.VR_DISPLAY;if(t||xe&&navigator.getGamepads){var e=navigator.getGamepads();if(e)for(var i=0,n=me.length;i<n;++i){var s,r=me[i],o=e[i];r&&o&&(o.displayId===t.displayId&&r._device.hand!==o.hand&&(s=!0,t._onGamepadDisconnected(r)),r._device=o,s&&t._onGamepadConnected(r))}}})(),Se.dispatch(t),b.numDrawCalls=0,b.numTriangles=0,b.numClears=0,Le&&!ve.VR_DISPLAY.isPresenting&&(console.log("VR device stopped presenting, disabling VR"),Ie());ve.VR_DISPLAY||ti();Oe.dispatch(t),ve.VR_DISPLAY&&ve.VR_DISPLAY.isPresenting&&ve.VR_DISPLAY._display.submitFrame();Ce=(performance||Date).now()-e});var be,Pe,ze,Re,Ue={COPY_SHADER:null,DEFAULT_2D_DITHER_TEXTURE:null,DEFAULT_SKINNING_TEXTURE:null},Be={WEBGL_2:!1,EXT_DRAW_BUFFERS:null,EXT_FLOAT_TEXTURES:null,EXT_HALF_FLOAT_TEXTURES:null,EXT_FLOAT_TEXTURES_LINEAR:null,EXT_HALF_FLOAT_TEXTURES_LINEAR:null,EXT_DEPTH_TEXTURE:null,EXT_STANDARD_DERIVATIVES:null,EXT_SHADER_TEXTURE_LOD:null,EXT_TEXTURE_FILTER_ANISOTROPIC:null,EXT_ELEMENT_INDEX_UINT:null,EXT_COLOR_BUFFER_FLOAT:null,EXT_COLOR_BUFFER_HALF_FLOAT:null,DEFAULT_TEXTURE_MAX_ANISOTROPY:0,HDR_FORMAT:0,VR_CAN_PRESENT:!1},Fe={},ke={REPEAT:{s:10497,t:10497},CLAMP:{s:33071,t:33071},DEFAULT:{s:10497,t:10497}},Ye={NONE:null,BACK:1029,FRONT:1028,ALL:1032},Qe={KEEP:7680,ZERO:0,REPLACE:7681,INCREMENT:7682,INCREMENT_WRAP:34055,DECREMENT:7683,DECREMENT_WRAP:34056,INVERT:5386},Ge={DISABLED:null,NEVER:512,LESS:513,EQUAL:514,LESS_EQUAL:515,GREATER:516,NOT_EQUAL:517,GREATER_EQUAL:518,ALWAYS:519},Xe={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},Ve={ZERO:0,ONE:1,SOURCE_COLOR:768,ONE_MINUS_SOURCE_COLOR:769,SOURCE_ALPHA:770,ONE_MINUS_SOURCE_ALPHA:771,DESTINATION_ALPHA:772,ONE_MINUS_DESTINATION_ALPHA:773,DESTINATION_COLOR:774,ONE_MINUS_DESTINATION_COLOR:775,SOURCE_ALPHA_SATURATE:776,CONSTANT_ALPHA:32771,ONE_MINUS_CONSTANT_ALPHA:32772},He={ADD:32774,SUBTRACT:32778,REVERSE_SUBTRACT:32779},We={COLOR:16384,STENCIL:1024,DEPTH:256,COMPLETE:17664},Ze={getDefaultInternalFormat:function(t,e){if(!Be.WEBGL_2)return t;if(e===Ke.FLOAT){if(t===Ze.RGBA)return U.gl.RGBA32F;if(t===Ze.RGB)return U.gl.RGB32F;if(t===Ze.RG)return U.gl.RG32F}if(e===Ke.HALF_FLOAT){if(t===Ze.RGBA)return U.gl.RGBA16F;if(t===Ze.RGB)return U.gl.RGB16F;if(t===Ze.RG)return U.gl.RG16F}return t}},Ke={UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126,HALF_FLOAT:void 0},qe={STATIC_DRAW:35044,DYNAMIC_DRAW:35048},Je={POSITIVE_X:34069,NEGATIVE_X:34070,POSITIVE_Y:34073,NEGATIVE_Y:34074,POSITIVE_Z:34071,NEGATIVE_Z:34072};function $e(){this.preserveDrawingBuffer=!1,this.webgl2=!1,this.maxSkeletonJoints=64,this.maxDirLights=3,this.maxPointSpotLights=20,this.numLightingCellsX=16,this.numLightingCellsY=9,this.maxLightProbes=1,this.ambientOcclusion=null,this.useSkinningTexture=!0,this.hdr=!1,this.useGammaCorrection=!0,this.usePreciseGammaCorrection=!1,this.defaultLightingModel=k.Unlit,this.numShadowCascades=1,this.debug=!1,this.throwOnShaderError=!1,this.shadowFilter=new R,this.transparentBackground=!1,this.vrUserHeight=1.65}function ti(){var t=window.devicePixelRatio||1,e=ve.TARGET_CANVAS,i=Math.round(e.clientWidth*t),n=Math.round(e.clientHeight*t);e.width===i&&e.height===n||(e.width=i,e.height=n)}function ei(){je.start()}function ii(){je.stop()}function ni(t){var e=new ut;return e.initEmpty(8,8,null,t),new gt(e).init(!0)}function si(t){this._amplitude=1/Math.sqrt(2*t*Math.PI),this._expScale=-1/(2*t)}function ri(){this.origin=new Z(0,0,0,1),this.direction=new Z(0,0,0,0)}function oi(){this._flip=!1,this._mesh=null,this._mode=0,this._faceNormals=null,this._faceTangents=null,this._faceBitangents=null}function ai(t){et.call(this),t=t||{},this._createMesh(t),this.bounds=this._getBounds()}function hi(t){ai.call(this,t)}function ui(t,e){ge.call(this,this._generateShader(t,e))}function li(t,e){ge.call(this,this._generateShader(t,e))}function ci(t,e,i){ge.call(this,this._generateShader(t,e,i)),this._colorLocation=this.getUniformLocation("hx_directionalLight.color"),this._dirLocation=this.getUniformLocation("hx_directionalLight.direction"),this._castShadowsLocation=this.getUniformLocation("hx_directionalLight.castShadows"),this._shadowMatricesLocation=this.getUniformLocation("hx_directionalLight.shadowMapMatrices[0]"),this._shadowSplitsLocation=this.getUniformLocation("hx_directionalLight.splitDistances"),this._depthBiasLocation=this.getUniformLocation("hx_directionalLight.depthBias"),this._maxShadowDistanceLocation=this.getUniformLocation("hx_directionalLight.maxShadowDistance"),this._MP_updatePassRenderState=ge.prototype.updatePassRenderState}function _i(t,e,i){ge.call(this,this._generateShader(t,e,i))}function di(t,e){ge.call(this,this._generateShader(t,e))}function fi(){this.position=new Z,this.rotation=new Ct,this.scale=new Z(1,1,1),this.skeletonPose=null}function pi(){this._jointPoses=[],this._skinningTexture=null,this._globalMatrices=null,this._bindMatrices=null,this._skeletonMatricesInvalid=!0}si.prototype={at:function(t){return this._amplitude*Math.pow(Math.E,t*t*this._expScale)}},si.fromRadius=function(t,e){e=e||.01;var i=t/Math.sqrt(-2*Math.log(e));return new si(i*i)},ri.prototype={transformFrom:function(t,e){e.transformPoint(t.origin,this.origin),e.transformVector(t.direction,this.direction),this.direction.normalize()},toString:function(){return"Ray(\norigin: "+this.origin.toString()+"\ndirection: "+this.direction.toString()+"\n)"}},oi.MODE_NORMALS=1,oi.MODE_TANGENTS=2,oi.prototype={generate:function(t,e,i,n){void 0===i&&(i=!0),this._mode=void 0===e?oi.MODE_NORMALS|oi.MODE_TANGENTS:e,this._faceNormals=null,this._faceTangents=null,this._faceBitangents=null,this._flip=n||!1,this._mesh=t,this._addMissingAttributes(t,e),this._positionAttrib=t.getVertexAttributeByName("hx_position"),this._normalAttrib=t.getVertexAttributeByName("hx_normal"),this._tangentAttrib=t.getVertexAttributeByName("hx_tangent"),this._uvAttrib=t.getVertexAttributeByName("hx_texCoord"),this._positionStride=t.getVertexStride(this._positionAttrib.streamIndex),this._normalStride=t.getVertexStride(this._normalAttrib.streamIndex),this._tangentAttrib&&(this._tangentStride=t.getVertexStride(this._tangentAttrib.streamIndex)),this._uvAttrib&&(this._uvStride=t.getVertexStride(this._uvAttrib.streamIndex)),this._calculateFaceVectors(i),this._calculateVertexVectors()},_addMissingAttributes:function(t,e){var i=t.numStreams,n=0;e&oi.MODE_NORMALS&&!t.hasVertexAttribute("hx_normal")&&(t.addVertexAttribute("hx_normal",3,i,!0),n+=3),e&oi.MODE_TANGENTS&&!t.hasVertexAttribute("hx_tangent")&&(t.addVertexAttribute("hx_tangent",4,i,!0),n+=4);for(var s=[],r=0,o=n*t.numVertices;r<o;++r)s[r]=0;t.setVertexData(s,i)},_calculateFaceVectors:function(t){var e=this._mesh._indexData.length;0!=(this._mode&oi.MODE_NORMALS)&&(this._faceNormals=new Array(e)),0!=(this._mode&oi.MODE_TANGENTS)&&(this._faceTangents=new Array(e),this._faceBitangents=new Array(e));for(var i=new Z,n=new Z,s=new Z,r=new Z,o=new Z,a=new Z,h=new dt,u=new dt,l=new dt,c=new dt,_=new dt,d=this._positionAttrib.offset,f=this._mesh.getVertexData(this._positionAttrib.streamIndex),p=this._uvAttrib?this._uvAttrib.offset:0,g=this._uvAttrib?this._mesh.getVertexData(this._uvAttrib.streamIndex):null,M=0;M<e;M+=3)this._getFloat3At(M,d,this._positionStride,r,f),this._getFloat3At(M+1,d,this._positionStride,o,f),this._getFloat3At(M+2,d,this._positionStride,a,f),g&&(this._getFloat2At(M,p,this._uvStride,h,g),this._getFloat2At(M+1,p,this._uvStride,u,g),this._getFloat2At(M+2,p,this._uvStride,l,g)),o.subtract(r),a.subtract(r),this._faceNormals&&(this._flip?Z.cross(a,o,i):Z.cross(o,a,i),t||i.normalize(),this._faceNormals[M]=i.x,this._faceNormals[M+1]=i.y,this._faceNormals[M+2]=i.z),this._faceTangents&&(dt.subtract(u,h,c),dt.subtract(l,h,_),Z.scale(o,_.y,n),Z.scale(a,c.y,s),Z.subtract(n,s,i),.001<i.lengthSqr&&i.normalize(),this._faceTangents[M]=i.x,this._faceTangents[M+1]=i.y,this._faceTangents[M+2]=i.z,Z.scale(o,_.x,n),Z.scale(a,c.x,n),Z.subtract(s,n,i),this._faceBitangents[M]=i.x,this._faceBitangents[M+1]=i.y,this._faceBitangents[M+2]=i.z)},_calculateVertexVectors:function(){this._zeroVectors();for(var t=this._faceTangents?[]:null,e=this._mesh._indexData,i=this._normalAttrib.offset,n=this._mesh.getVertexData(this._normalAttrib.streamIndex),s=this._tangentAttrib?this._tangentAttrib.offset:0,r=this._tangentAttrib?this._mesh.getVertexData(this._tangentAttrib.streamIndex):null,o=e.length,a=0;a<o;++a){var h=e[a],u=i+h*this._normalStride,l=3*Math.floor(a/3);if(this._faceNormals&&(n[u]+=this._faceNormals[l],n[u+1]+=this._faceNormals[l+1],n[u+2]+=this._faceNormals[l+2]),this._faceTangents){var c=s+h*this._tangentStride;r[c]+=this._faceTangents[l],r[c+1]+=this._faceTangents[l+1],r[c+2]+=this._faceTangents[l+2];var _=3*h;t[_]+=this._faceBitangents[l],t[_+1]+=this._faceBitangents[l+1],t[_+2]+=this._faceBitangents[l+2]}}this._normalize(t)},_zeroVectors:function(){for(var t=this._mesh.getVertexData(this._normalAttrib.streamIndex),e=this._mesh.getVertexStride(this._normalAttrib.streamIndex),i=this._normalAttrib.offset,n=this._tangentAttrib?this._mesh.getVertexData(this._tangentAttrib.streamIndex):null,s=this._tangentAttrib?this._mesh.getVertexStride(this._tangentAttrib.streamIndex):0,r=this._tangentAttrib?this._tangentAttrib.offset:0,o=t.length/e,a=0;a<o;++a)this._mode&oi.MODE_NORMALS&&(t[i]=0,t[i+1]=0,t[i+2]=0,i+=e),this._mode&oi.MODE_TANGENTS&&(n[r]=0,n[r+1]=0,n[r+2]=0,r+=s)},_normalize:function(t){for(var e=this._mesh.getVertexData(this._normalAttrib.streamIndex),i=this._normalAttrib.offset,n=this._tangentAttrib?this._mesh.getVertexData(this._tangentAttrib.streamIndex):null,s=this._tangentAttrib?this._tangentAttrib.offset:0,r=e.length/this._normalStride,o=new Z,a=new Z,h=new Z,u=new Z,l=0;l<r;++l)o.x=e[i],o.y=e[i+1],o.z=e[i+2],this._mode&oi.MODE_NORMALS&&(o.normalize(),e[i]=o.x,e[i+1]=o.y,e[i+2]=o.z,i+=this._normalStride),this._mode&oi.MODE_TANGENTS&&(a.x=n[s],a.y=n[s+1],a.z=n[s+2],a.lengthSqr<1e-4?a.set(1,1,1,1):a.normalize(),h.x=t[0],h.y=t[1],h.z=t[2],Z.cross(o,a,u),n[s]=a.x,n[s+1]=a.y,n[s+2]=a.z,n[s+3]=0<h.dot3(u)?-1:1,s+=this._tangentStride);this._mesh.setVertexData(e,this._normalAttrib.streamIndex),this._tangentAttrib&&this._normalAttrib.streamIndex!==this._tangentAttrib.streamIndex&&this._mesh.setVertexData(n,this._tangentAttrib.streamIndex)},_getFloat3At:function(t,e,i,n,s){var r=e+this._mesh._indexData[t]*i;n.x=s[r],n.y=s[r+1],n.z=s[r+2]},_getFloat2At:function(t,e,i,n,s){var r=e+this._mesh._indexData[t]*i;n.x=s[r],n.y=s[r+1]}},ai._ATTRIBS=function(){this.positions=[],this.uvs=null,this.normals=null,this.vertexColors=null,this.indices=[]},(ai.prototype=Object.create(et.prototype))._generate=function(t,e){throw new Error("Abstract method called!")},ai.prototype._createMesh=function(t){var e=new ai._ATTRIBS,i=void 0===t.uvs||t.uvs,n=void 0===t.normals||t.normals,s=void 0===t.tangents||t.tangents;this.addVertexAttribute("hx_position",3),n&&(this.addVertexAttribute("hx_normal",3),e.normals=[]),s&&this.addVertexAttribute("hx_tangent",4),i&&(this.addVertexAttribute("hx_texCoord",2),e.uvs=[]),this._generate(e,t);var r=e.vertexColors;r&&this.addVertexAttribute("hx_vertexColor",3);for(var o=t.scaleU||1,a=t.scaleV||1,h=e.positions.length/3,u=0,l=0,c=0,_=[],d=0;d<h;++d)_[u++]=e.positions[c],_[u++]=e.positions[c+1],_[u++]=e.positions[c+2],n&&(_[u++]=e.normals[c],_[u++]=e.normals[c+1],_[u++]=e.normals[c+2]),s&&(u+=4),i&&(_[u++]=e.uvs[l++]*o,_[u++]=e.uvs[l++]*a),r&&(_[u++]=e.vertexColors[c],_[u++]=e.vertexColors[c+1],_[u++]=e.vertexColors[c+2]),c+=3;this.setVertexData(_,0),this.setIndexData(e.indices);var f=0;(n&&0===e.normals.length&&(f|=oi.MODE_NORMALS),s&&(f|=oi.MODE_TANGENTS),f)&&(new oi).generate(this,f)},ai.prototype._getBounds=function(){return new J},hi.prototype=Object.create(ai.prototype),hi.ALIGN_X=1,hi.ALIGN_Y=2,hi.ALIGN_Z=3,hi.prototype._generate=function(t,e){var i,n,s,r,o,a=(e=e||{}).alignment||hi.ALIGN_Z,h=e.numSegmentsH||1,u=e.numSegmentsW||16,l=e.radius||.5,c=e.height||1,_=void 0!==e.doubleSided&&e.doubleSided,d=t.positions,f=t.uvs,p=t.normals,g=t.indices,M=1/u,A=1/h;for(i=0;i<=h;++i){var m=(i*A-.5)*c;for(n=0;n<=u;++n){o=n*M*Math.PI*2;var x=Math.sin(o),T=Math.cos(o);switch(s=x*l,r=T*l,a){case hi.ALIGN_X:d.push(-m,s,r),p&&p.push(0,x,T);break;case hi.ALIGN_Z:d.push(s,r,-m),p&&p.push(x,T,0);break;default:d.push(s,m,r),p&&p.push(x,0,T)}f&&f.push(1-n*M,i*A)}}for(i=0;i<h;++i)for(n=0;n<u;++n){var y=u+1,N=n+i*y;g.push(N,N+y+1,N+y),g.push(N,N+1,N+y+1),_&&(g.push(N,N+y,N+y+1),g.push(N,N+y+1,N+1))}var D=d.length/3,E=.5*c;for(n=0;n<u;++n){o=n*M*Math.PI*2;var w=Math.sin(o),L=Math.cos(o);switch(s=w*l,r=L*l,w=.5*-w+.5,L=.5*L+.5,a){case hi.ALIGN_X:d.push(E,s,r),d.push(-E,s,r),p&&(p.push(1,0,0),p.push(-1,0,0)),f&&(f.push(L,1-w),f.push(1-L,1-w));break;case hi.ALIGN_Z:d.push(s,r,E),d.push(s,r,-E),p&&(p.push(0,0,1),p.push(0,0,-1)),f&&(f.push(w,L),f.push(1-w,L));break;default:d.push(s,-E,r),d.push(s,E,r),p&&(p.push(0,-1,0),p.push(0,1,0)),f&&(f.push(w,L),f.push(w,1-L))}}for(n=1;n<u-1;++n){var I=n<<1;g.push(D,D+I+2,D+I),g.push(D+1,D+I+1,D+I+3)}},(ui.prototype=Object.create(ge.prototype))._generateShader=function(t,e){var i="#define HX_SKIP_NORMALS\n#define HX_SKIP_SPECULAR\n",n=i+d.get("snippets_geometry.glsl")+"\n"+e+"\n"+d.get("material_unlit_fragment.glsl");return new Q(i+t+"\n"+d.get("material_unlit_vertex.glsl"),n)},(li.prototype=Object.create(ge.prototype))._generateShader=function(t,e){var i="#define HX_SKIP_NORMALS\n#define HX_SKIP_SPECULAR\n",n=i+d.get("snippets_geometry.glsl")+"\n"+ve.OPTIONS.shadowFilter.getGLSL()+"\n"+e+"\n"+d.get("material_dir_shadow_fragment.glsl");return new Q(i+t+"\n"+d.get("material_unlit_vertex.glsl"),n)},(ci.prototype=Object.create(ge.prototype)).updatePassRenderState=(be=new Z,Pe=new Pt,ze=new Float32Array(64),function(t,e,i){var n=U.gl,s=i._scaledIrradiance;if(n.useProgram(this.shader.program),t.viewMatrix.transformVector(i.direction,be),n.uniform3f(this._colorLocation,s.r,s.g,s.b),n.uniform3f(this._dirLocation,be.x,be.y,be.z),n.uniform1i(this._castShadowsLocation,i.castShadows?1:0),i.castShadows){for(var r=ve.OPTIONS.numShadowCascades,o=i._cascadeSplitDistances,a=0,h=0;h<r;++h){Pe.multiply(i.getShadowMatrix(h),t.worldMatrix);for(var u=Pe._m,l=0;l<16;++l)ze[a++]=u[l]}n.uniformMatrix4fv(this._shadowMatricesLocation,!1,ze),n.uniform4f(this._shadowSplitsLocation,o[0],o[1],o[2],o[3]),n.uniform1f(this._depthBiasLocation,i.depthBias),n.uniform1f(this._maxShadowDistanceLocation,o[r-1])}this._MP_updatePassRenderState(t,e)}),ci.prototype._generateShader=function(t,e,i,n){var s={};return new Q(t+"\n"+d.get("material_fwd_dir_vertex.glsl",s),d.get("snippets_geometry.glsl",s)+"\n"+i+"\n\n\n"+ve.OPTIONS.shadowFilter.getGLSL()+"\n"+d.get("directional_light.glsl")+"\n"+e+"\n"+d.get("material_fwd_dir_fragment.glsl"))},(_i.prototype=Object.create(ge.prototype))._generateShader=function(t,e,i){var n="#derivatives\n",s={HX_NUM_DIR_LIGHTS:ve.OPTIONS.maxDirLights,HX_NUM_POINT_SPOT_LIGHTS:ve.OPTIONS.maxPointSpotLights,HX_NUM_LIGHT_PROBES:ve.OPTIONS.maxLightProbes,HX_CELL_STRIDE:ve.OPTIONS.maxPointSpotLights+1,HX_NUM_CELLS_X:ve.OPTIONS.numLightingCellsX,HX_NUM_CELLS_Y:ve.OPTIONS.numLightingCellsY,HX_CELL_ARRAY_LEN:Math.ceil(ve.OPTIONS.numLightingCellsX*ve.OPTIONS.numLightingCellsY*(ve.OPTIONS.maxPointSpotLights+1)/4)};return Be.EXT_SHADER_TEXTURE_LOD&&(n+="#texturelod\n"),new Q(t+"\n"+d.get("material_fwd_clustered_vertex.glsl",s),n+d.get("snippets_geometry.glsl")+"\n"+i+"\n\n\n"+ve.OPTIONS.shadowFilter.getGLSL()+"\n"+d.get("directional_light.glsl",s)+"\n"+d.get("point_light.glsl")+"\n"+d.get("spot_light.glsl")+"\n"+d.get("light_probe.glsl")+"\n"+e+"\n"+d.get("material_fwd_clustered_fragment.glsl"))},(di.prototype=Object.create(ge.prototype))._generateShader=function(t,e){var i="#define HX_SKIP_NORMALS\n#define HX_SKIP_SPECULAR\n",n=i+d.get("snippets_geometry.glsl")+"\n"+e+"\n"+d.get("material_fwd_base_fragment.glsl");return new Q(i+t+"\n"+d.get("material_fwd_base_vertex.glsl"),n)},fi.prototype={copyFrom:function(t){this.rotation.copyFrom(t.rotation),this.position.copyFrom(t.position),this.scale.copyFrom(t.scale)},toString:function(){return"[SkeletonJointPose]"}},pi.prototype={get numJoints(){return this._jointPoses.length},getJointPose:function(t){return this._jointPoses[t]},setJointPose:function(t,e){(this._jointPoses[t]=e).skeletonPose=this},invalidateGlobalPose:function(){this._skeletonMatricesInvalid=!0},interpolate:function(t,e,i){t=t._jointPoses,e=e._jointPoses;var n=t.length;this._jointPoses.length!==n&&this._initJointPoses(n);for(var s=this._jointPoses,r=0;r<n;++r){var o=s[r];o.rotation.slerp(t[r].rotation,e[r].rotation,i),o.position.lerp(t[r].position,e[r].position,i),o.scale.lerp(t[r].scale,e[r].scale,i)}},copyBindPose:function(t){for(var e=new Pt,i=t.joints,n=0,s=i.length;n<s;++n){var r=i[n],o=this._jointPoses[n]=new fi;e.inverseAffineOf(r.inverseBindPose),0<=r.parentIndex&&e.append(i[r.parentIndex].inverseBindPose),e.decompose(o)}},copyFrom:function(t){t=t._jointPoses;var e=this._jointPoses,i=t.length;this._jointPoses.length!==i&&this._initJointPoses(i);for(var n=0;n<i;++n)e[n].copyFrom(t[n])},_initJointPoses:function(t){this._jointPoses.length=t;for(var e=0;e<t;++e)this.setJointPose(e,new fi)},getGlobalMatrix:function(t,e){return(this._skeletonMatricesInvalid||this._skeleton!==t)&&this._updateSkeletonMatrices(t),this._skeleton=t,this._globalMatrices[e]},getBindMatrices:function(t){return(this._skeletonMatricesInvalid||this._skeleton!==t)&&this._updateSkeletonMatrices(t),this._skeleton=t,this._skinningTexture||this._bindMatrices},_updateSkeletonMatrices:function(t){var e=this._globalMatrices,i=this._bindMatrices,n=t.joints,s=n.length;e&&e.length===s||(this._generateGlobalSkeletonData(t),e=this._globalMatrices,i=this._bindMatrices);for(var r=0;r<s;++r){var o=this._jointPoses[r],a=e[r],h=n[r],u=h.parentIndex;a.compose(o),-1!==u&&a.append(e[u]),t.applyInverseBindPose?i[r].multiplyAffine(a,h.inverseBindPose):i[r].copyFrom(a)}ve.OPTIONS.useSkinningTexture&&this._updateSkinningTexture()},_generateGlobalSkeletonData:function(t){this._globalMatrices=[],this._bindMatrices=[];for(var e=0,i=t.joints.length;e<i;++e)this._globalMatrices[e]=new Pt,this._bindMatrices[e]=new Pt;ve.OPTIONS.useSkinningTexture&&(this._skinningTexture=new ut,this._skinningTexture.filter=Fe.NEAREST_NOMIP,this._skinningTexture.wrapMode=ke.CLAMP)},_updateSkinningTexture:function(){Re=Re||new Float32Array(3*ve.OPTIONS.maxSkeletonJoints*4);for(var t=this._bindMatrices,e=t.length,i=0,n=0;n<3;++n){for(var s=0;s<e;++s){var r=t[s]._m;Re[i++]=r[n],Re[i++]=r[n+4],Re[i++]=r[n+8],Re[i++]=r[n+12]}for(s=e;s<ve.OPTIONS.maxSkeletonJoints;++s)Re[i++]=0,Re[i++]=0,Re[i++]=0,Re[i++]=0}this._skinningTexture.uploadData(Re,ve.OPTIONS.maxSkeletonJoints,3,!1,Ze.RGBA,Ke.FLOAT)},clone:function(){var t=new pi;return t.copyFrom(this),t}};var gi,Mi=0;function Ai(){bt.call(this),this.meta={},this.name="hx_scenenode_"+Mi++,this._matrixInvalid=!0,this._worldMatrix=new Pt,this._worldMatrixInvalid=!0,this._parent=null,this._scene=null,this._visible=!0,this._ancestorsVisible=!0,this.raycast=!0,this._children=[],this._isOnRoot=!1,this._skeleton=null,this._skeletonPose=null,this._skeletonRoot=null,this._renderOrderHint=0,this._Transform_applyMatrix=bt.prototype._applyMatrix,this._Transform_invalidateMatrix=bt.prototype._invalidateMatrix}function mi(){this._hash=[]}function xi(t,e){var i=e.shader;this.attributes=[],this.morphPositionAttributes=[],this.morphNormalAttributes=[],this._numAttributes=-1;for(var n=0;n<t.numVertexAttributes;++n){var s=t.getVertexAttributeByIndex(n),r=i.getAttributeLocation(s.name);if(0<=r){var o=t.getVertexStride(s.streamIndex),a={index:r,offset:4*s.offset,external:!1,numComponents:s.numComponents,stride:4*o,streamIndex:s.streamIndex,normalized:s.normalized};0===s.name.indexOf("hx_morphPosition")&&(this.morphPositionAttributes.push(a),a.external=!0),0===s.name.indexOf("hx_morphNormal")&&(this.morphNormalAttributes.push(a),a.external=!0),this.attributes[r]=a,this._numAttributes=Math.max(this._numAttributes,r+1)}}}function Ti(){this.name="",this.entity=null,this._enabled=!0,this._bounds=null,this._boundsInvalid=!0}(Ai.prototype=Object.create(bt.prototype,{parent:{get:function(){return this._parent}},isOnRoot:{get:function(){return this._isOnRoot}},numChildren:{get:function(){return this._children.length}},visible:{get:function(){return this._visible},set:function(t){this._visible=t;for(var e=0,i=this._children.length;e<i;++e)this._children[e]._updateAncestorsVisible(t&&this._ancestorsVisible)}},hierarchyVisible:{get:function(){return this._visible&&this._ancestorsVisible}},worldMatrix:{get:function(){return this._worldMatrixInvalid&&this._updateWorldMatrix(),this._worldMatrix}},skeleton:{get:function(){return this._skeleton},set:function(t){if(t){var e=new pi;e.copyBindPose(t)}this._bindSkeleton(t,e,this)}},skeletonPose:{get:function(){return this._skeletonPose}}})).attach=function(t){if(t instanceof Array)for(var e=t.length,i=0;i<e;++i)this.attach(t[i]);else this._updateChildAdded(t),this._children.push(t)},Ai.prototype._updateChildAdded=function(t){t._parent&&t._parent.detach(t),t._isOnRoot=this._scene&&this._parent===this._scene._rootNode,t._parent=this,t._setScene(this._scene),t._updateAncestorsVisible(this._visible&&this._ancestorsVisible),this._skeleton&&t._bindSkeleton(this._skeleton,this._skeletonPose,this._skeletonRoot)},Ai.prototype.attachAfter=function(t,e){if(e._parent!==this)throw new Error("Reference child not a child of the scene node");this._updateChildAdded(t);var i=this._children.indexOf(e);this._children.splice(i+1,0,t)},Ai.prototype.isContainedIn=function(t){for(var e=this._parent;e;){if(e===t)return!0;e=e._parent}return!1},Ai.prototype.contains=function(t){if(0<=this._children.indexOf(t))return!0;for(var e=this._children.length,i=0;i<e;++i)if(this._children[i].contains(t))return!0;return!1},Ai.prototype.detach=function(t){var e=this._children.indexOf(t);if(e<0)throw new Error("Trying to remove a scene object that is not a child");t._parent=null,t._isOnRoot=!1,t._updateAncestorsVisible(!0),t._setScene(null),t.skeleton===this._skeleton&&(t.skeleton=null),this._children.splice(e,1)},Ai.prototype.getChild=function(t){return this._children[t]},Ai.prototype.getChildIndex=function(t){return this._children.indexOf(t)},Ai.prototype.destroy=function(){for(this._parent&&this._parent.detach(this);this._children.length;)this._children[0].destroy()},Ai.prototype._applyMatrix=function(){this._Transform_applyMatrix(),this._invalidateWorldMatrix()},Ai.prototype.findNodeByName=function(t){if(this.name===t)return this;for(var e=this._children.length,i=0;i<e;++i){var n=this._children[i].findNodeByName(t);if(n)return n}},Ai.prototype.findMaterialByName=function(t){for(var e=0,i=this._children.length;e<i;++e){var n=this._children[e].findMaterialByName(t);if(n)return n}},Ai.prototype._setScene=function(t){this._scene=t;for(var e=this._children.length,i=0;i<e;++i)this._children[i]._setScene(t);this._isOnRoot=!!t&&this._parent===this._scene._rootNode},Ai.prototype._invalidateMatrix=function(){this._Transform_invalidateMatrix(),this._invalidateWorldMatrix()},Ai.prototype._invalidateWorldMatrix=function(){this._worldMatrixInvalid=!0;for(var t=this._children.length,e=0;e<t;++e)this._children[e]._invalidateWorldMatrix()},Ai.prototype._updateWorldMatrix=function(){this._parent?this._worldMatrix.multiply(this._parent.worldMatrix,this.matrix):this._worldMatrix.copyFrom(this.matrix),this._worldMatrixInvalid=!1},Ai.prototype.toString=function(){return"[SceneNode(name="+this.name+")]"},Ai.prototype.applyFunction=function(t){t(this);for(var e=this._children.length,i=0;i<e;++i)this._children[i].applyFunction(t)},Ai.prototype.applyFunctionConditional=function(t){if(t(this))for(var e=this._children.length,i=0;i<e;++i)this._children[i].applyFunctionConditional(t)},Ai.prototype._updateAncestorsVisible=function(t){this._ancestorsVisible=t;for(var e=0,i=this._children.length;e<i;++e)this._children[e]._updateAncestorsVisible(this._visible&&t)},Ai.prototype.copyFrom=function(t){bt.prototype.copyFrom.call(this,t),this.name=t.name,this.visible=t.visible,this.raycast=t.raycast;for(var e=0,i=t._children.length;e<i;++e)this.attach(t._children[e].clone())},Ai.prototype.clone=function(){var t=new Ai;return t.copyFrom(this),t},Ai.prototype._bindSkeleton=function(t,e,i){this._skeleton=t,this._skeletonPose=e,this._skeletonRoot=i;for(var n=0,s=this._children.length;n<s;++n)this._children[n]._bindSkeleton(t,e,i)},mi.prototype={isBitSet:function(t){var e=t>>5;return t&=~(e<<5),this._hash[e]&1<<t},setBit:function(t){var e=this._hash,i=t>>5;t&=~(i<<5),e[i]=(e[i]||0)|1<<t},clearBit:function(t){var e=this._hash,i=t>>5;t&=~(i<<5),e[i]=(e[i]||0)&~(1<<t)},zero:function(){for(var t=this._hash,e=t.length,i=0;i<e;++i)t[i]=0},OR:function(t){var e=this._hash;t=t._hash;for(var i=Math.max(e.length,t.length),n=0;n<i;++n)e[n]=(e[n]||0)|(t[n]||0)},AND:function(t){var e=this._hash;t=t._hash;for(var i=Math.max(e.length,t.length),n=0;n<i;++n)e[n]=(e[n]||0)&(t[n]||0)},NOT:function(){for(var t=this._hash,e=t.length,i=0;i<e;++i)t[i]=~(t[i]||0)},contains:function(t){for(var e=this._hash,i=t._hash,n=0,s=i.length;n<s;++n){var r=i[n];if((e[n]&r)!==r)return!1}return!0},clone:function(){for(var t=new mi,e=this._hash.length,i=0;i<e;++i)t._hash[i]=this._hash[i];return t},toString:function(){var t="",e=this._hash,i=e.length;if(0===i)return"0b0";for(var n=0;n<i;++n){for(var s=(e[n]||0).toString(2);s.length<32;)s="0"+s;t=s+t}return"0b"+t}},Ti.COMPONENT_ID=0,Ti.create=(gi=0,function(t,e,i){i=i||Ti,t.prototype=Object.create(i.prototype,e),t.COMPONENT_ID=++gi,t.prototype.COMPONENT_ID=t.COMPONENT_ID}),Ti.prototype={get bounds(){return this._boundsInvalid&&(this._bounds&&this._updateBounds(),this._boundsInvalid=!1),this._bounds},onAdded:function(){},onRemoved:function(){},onUpdate:null,get enabled(){return this._enabled},set enabled(t){this.entity&&(t?this.onAdded():this.onRemoved()),this._enabled=t},acceptVisitor:null,_updateBounds:function(){},invalidateBounds:function(){this._boundsInvalid=!0,this.entity&&this.entity.invalidateBounds()},clone:function(){throw new Error("Abstract method called!")},broadcast:function(t,e){if(this.entity){var i=this.entity.messenger;i.broadcast.apply(i,arguments)}},hasListeners:function(t){return!!this.entity&&this.entity.messenger.hasListeners(t)},bindListener:function(t,e,i){this.entity.messenger.bind(t,e,i)},unbindListener:function(t,e){this.entity.messenger.unbind(t,e)}};var yi,Ni,Di,Ei,wi,Li,Ii,vi,Si,Oi,Ci,ji,bi=0;function Pi(t,e){Ti.call(this),this.name="hx_meshinstance_"+bi++,this.castShadows=!0,this.skeletonPose=null,this.bindShapeMatrix=null,this.bindShapeMatrixInverse=null,this._bounds=new J,this._morphPositions=null,this._morphNormals=null,this._morphWeights=null,this._meshMaterialLinkInvalid=!0,this._vertexLayouts=null,this._morphPose=null,this._skeleton=null,this.mesh=t,this.material=e}function zi(){this._signals={}}function Ri(t){if(Ai.call(this),this.messenger=new zi,this._componentHash=new mi,this._components=[],this._requiresUpdates=!1,this._onComponentsChange=new r,this._boundsInvalid=!0,this._worldBoundsInvalid=!0,this._worldBounds=this._createBoundingVolume(),this._bounds=this._createBoundingVolume(),t instanceof Array)for(var e=0;e<t.length;++e)this.addComponent(t[e]);else t&&this.addComponent(t);this._SceneNode_invalidateWorldMatrix=Ai.prototype._invalidateWorldMatrix,this._SceneNode_setScene=Ai.prototype._setScene}function Ui(){Ti.call(this),this._scaledIrradiance=new h,this._intensity=.2,this._color=new h(1,1,1),this._colorChangeListener=new jt,this._colorChangeListener.add(this._color,"r"),this._colorChangeListener.add(this._color,"g"),this._colorChangeListener.add(this._color,"b"),this._colorChangeListener.onChange.bind(this._updateScaledIrradiance,this),this._scaledIrradiance=new h,this._updateScaledIrradiance()}function Bi(){this._Light_updateScaledIrradiance=Ui.prototype._updateScaledIrradiance,Ui.call(this),this.intensity=3.1415,this.depthBias=0,this._castShadows=!1,this.shadowQualityBias=0}function Fi(){Bi.call(this),this._direction=new Z,this._cascadeSplitRatios=[],this._cascadeSplitDistances=[],this._initCascadeSplitProperties(),this._bounds=new J}function ki(){K.call(this,ki)}function Yi(){Bi.call(this),this._radius=100,this.intensity=3.1415,this.shadowQualityBias=2,this._shadowTiles=null,this._bounds=new ki}function Qi(t,e){Ti.call(this),this.intensity=1,this._specularTexture=e,this._diffuseTexture=t,this._size=void 0,this._bounds=new ki,this._bounds.clear(K.EXPANSE_INFINITE)}function Gi(){Bi.call(this),this._radius=50,this._innerAngle=1.2,this._outerAngle=1.3,this._cosInner=Math.cos(.5*this._innerAngle),this._cosOuter=Math.cos(.5*this._outerAngle),this.intensity=3.1415,this.shadowQualityBias=1,this._shadowMatrix=null,this._shadowTile=null,this._bounds=new ki}function Xi(t,e,i,n){this._dirLights=null,this._pointLights=null,this._spotLights=null,this._diffuseLightProbes=null,this._specularLightProbes=null,ge.call(this,this._generateShader(t,e,i,n)),this._getUniformLocations(),this._assignLightProbes(),this._MP_updatePassRenderState=ge.prototype.updatePassRenderState}function Vi(t,e,i){ge.call(this,this._generateShader(t,e,i)),this._colorLocation=this.getUniformLocation("hx_pointLight.color"),this._posLocation=this.getUniformLocation("hx_pointLight.position"),this._radiusLocation=this.getUniformLocation("hx_pointLight.radius"),this._rcpRadiusLocation=this.getUniformLocation("hx_pointLight.rcpRadius"),this._castShadowsLocation=this.getUniformLocation("hx_pointLight.castShadows"),this._depthBiasLocation=this.getUniformLocation("hx_pointLight.depthBias"),this._shadowMatrixLocation=this.getUniformLocation("hx_pointLight.shadowMapMatrix"),this._shadowTilesLocation=this.getUniformLocation("hx_pointLight.shadowTiles[0]"),this._MP_updatePassRenderState=ge.prototype.updatePassRenderState}function Hi(t,e,i){ge.call(this,this._generateShader(t,e,i)),this._diffuseSlot=this.getTextureIndex("hx_diffuseProbeMap"),this._specularSlot=this.getTextureIndex("hx_specularProbeMap"),this._numMipsLocation=this.getUniformLocation("hx_specularProbeNumMips"),this._intensityLocation=this.getUniformLocation("hx_probeIntensity"),this._localLocation=this.getUniformLocation("hx_probeLocal"),this._sizeLocation=this.getUniformLocation("hx_probeSize"),this._positionLocation=this.getUniformLocation("hx_probePosition"),this._MP_updatePassRenderState=ge.prototype.updatePassRenderState}function Wi(t,e,i){ge.call(this,this._generateShader(t,e,i)),this._colorLocation=this.getUniformLocation("hx_spotLight.color"),this._posLocation=this.getUniformLocation("hx_spotLight.position"),this._radiusLocation=this.getUniformLocation("hx_spotLight.radius"),this._anglesLocation=this.getUniformLocation("hx_spotLight.angleData"),this._dirLocation=this.getUniformLocation("hx_spotLight.direction"),this._rcpRadiusLocation=this.getUniformLocation("hx_spotLight.rcpRadius"),this._castShadowsLocation=this.getUniformLocation("hx_spotLight.castShadows"),this._depthBiasLocation=this.getUniformLocation("hx_spotLight.depthBias"),this._shadowMatrixLocation=this.getUniformLocation("hx_spotLight.shadowMapMatrix"),this._shadowTileLocation=this.getUniformLocation("hx_spotLight.shadowTile"),this._MP_updatePassRenderState=ge.prototype.updatePassRenderState}function Zi(t,e){ge.call(this,this._generateShader(t,e))}Ti.create(Pi,{skeleton:{get:function(){return this._skeleton},set:function(t){var e=new pi;e.copyBindPose(t),this._bindSkeleton(t,e,null)}},skeletonMatrices:{get:function(){return this.skeletonPose?this.skeletonPose.getBindMatrices(this._skeleton):null}},morphPose:{get:function(){return this._morphPose},set:function(t){this._morphPose&&this._morphPose.onChange.unbind(this._onMorphChanged),this._morphPose=t,this._morphPose?(this._morphPose.onChange.bind(this._onMorphChanged,this),this._onMorphChanged()):this._clearMorph()}},mesh:{get:function(){return this._mesh},set:function(t){this._mesh!==t&&(this._mesh&&(this._mesh.onLayoutChanged.unbind(this._onMaterialOrMeshChange),this._mesh.onBoundsChanged.unbind(this.invalidateBounds),this._mesh.onMorphDataCreated.unbind(this._initMorphData)),(this._mesh=t).onLayoutChanged.bind(this._onMaterialOrMeshChange,this),t.onBoundsChanged.bind(this.invalidateBounds,this),t.onMorphDataCreated.bind(this._initMorphData,this),this._initMorphData(),this._meshMaterialLinkInvalid=!0,this.invalidateBounds())}},material:{get:function(){return this._material},set:function(t){this._material&&this._material.onChange.unbind(this._onMaterialOrMeshChange),this._material=t,this._material&&(this._material.onChange.bind(this._onMaterialOrMeshChange,this),this._material._setUseSkinning(!!this._skeleton),this._material._setUseMorphing(this._mesh.hasMorphData,this._mesh.hasMorphNormals)),this._meshMaterialLinkInvalid=!0}}}),Pi.prototype.updateRenderState=function(t){this._meshMaterialLinkInvalid&&this._linkMeshWithMaterial();var e=this._mesh._vertexBuffers;this._mesh._indexBuffer.bind();for(var i,n=this._vertexLayouts[t],s=n.morphPositionAttributes,r=n.morphNormalAttributes,o=U.gl,a=s.length,h=0;h<a;++h){i=s[h];var u=this._morphPositions[h]||this._mesh._defaultMorphTarget;u.bind(),o.vertexAttribPointer(i.index,i.numComponents,o.FLOAT,i.normalized,i.stride,i.offset)}if(this._morphNormals)for(a=r.length,h=0;h<a;++h)i=r[h],(u=this._morphNormals[h]||this._mesh._defaultMorphTarget).bind(),o.vertexAttribPointer(i.index,i.numComponents,o.FLOAT,!1,i.stride,i.offset);var l=n.attributes;for(a=n._numAttributes,U.enableAttributes(n._numAttributes),h=0;h<a;++h)(i=l[h])?i.external||(e[i.streamIndex].bind(),o.vertexAttribPointer(h,i.numComponents,o.FLOAT,!1,i.stride,i.offset)):U.gl.disableVertexAttribArray(h)},Pi.prototype._initVertexLayouts=function(){this._vertexLayouts=new Array(ge.NUM_PASS_TYPES);for(var t=0;t<ge.NUM_PASS_TYPES;++t){var e=this._material.getPass(t);e&&(this._vertexLayouts[t]=new xi(this._mesh,e))}},Pi.prototype._linkMeshWithMaterial=function(){this._initVertexLayouts(),this._meshMaterialLinkInvalid=!1},Pi.prototype._onMaterialOrMeshChange=function(){this._meshMaterialLinkInvalid=!0},Pi.prototype.toString=function(){return"[MeshInstance(mesh="+this._mesh.name+")]"},Pi.prototype.acceptVisitor=function(t){t.visitMeshInstance(this,this.entity)},Pi.prototype._onMorphChanged=function(){for(var t=0;t<8;++t){var e=this._morphPose.getMorphTargetName(t),i=null;if(e&&(i=this._mesh.getMorphTarget(e)),i){var n=this._morphPose.getWeight(e),s=i.positionBuffer,r=i.hasNormals?i.normalBuffer:null;this._setMorphTarget(t,s,r,n)}else this._setMorphTarget(t,null,null,0)}},Pi.prototype._clearMorph=function(){for(var t=0;t<8;++t)this._setMorphTarget(t,null,null,0)},Pi.prototype._setMorphTarget=function(t,e,i,n){t>=this._morphWeights.length||(this._morphPositions[t]=e,i&&this._morphNormals&&(this._morphNormals[t]=i),this._morphWeights[t]=e?n:0)},Pi.prototype._updateBounds=function(){this._bounds=this._mesh.bounds},Pi.prototype._initMorphData=function(){if(this._morphPositions=null,this._morphNormals=null,this._morphWeights=null,this._mesh.hasMorphData){this._morphPositions=[];var t=8;this._mesh.hasMorphNormals&&(this._morphNormals=[],t=4),this._morphWeights=new Float32Array(t);for(var e=0;e<t;++e)this._morphWeights[e]=0;this._material&&this._material._setUseMorphing(this._mesh.hasMorphData,this._mesh.hasMorphNormals)}},Pi.prototype.clone=function(){var t=new Pi(this._mesh,this._material);return t.castShadows=this.castShadows,this.skeleton&&(t.skeleton=this.skeleton),this.skeletonPose&&(t.skeletonPose=this.skeletonPose.clone()),t},Pi.prototype._bindSkeleton=function(t,e,i){this._skeleton=t,this.skeletonPose=e,this.bindShapeMatrix=i,this.bindShapeMatrixInverse=null,i&&(this.bindShapeMatrixInverse=new Pt,this.bindShapeMatrixInverse.inverseAffineOf(i)),this._material&&this._material._setUseSkinning(!!this._skeleton)},zi.prototype={broadcast:function(t,e){var i=this._signals[t];i&&i.dispatch.apply(i,arguments)},bind:function(t,e,i){var n=this._signals[t];n||(n=new r,this._signals[t]=n),n.bind(e,i)},unbind:function(t,e){var i=this._signals[t];i.unbind(e),i.hasListeners||delete this._signals[t]},hasListeners:function(t){return!!this._signals[t]}},(Ri.prototype=Object.create(Ai.prototype,{worldBounds:{get:function(){return this._worldBoundsInvalid&&(this._updateWorldBounds(),this._worldBoundsInvalid=!1),this._worldBounds}},bounds:{get:function(){return this._boundsInvalid&&(this._updateBounds(),this._boundsInvalid=!1),this._bounds}}})).findMaterialByName=function(t){for(var e=0,i=this._components.length;e<i;++e){var n=this._components[e];if(n instanceof Pi&&n.material.name===t)return n.material}return Ai.prototype.findMaterialByName.call(this,t)},Ri.prototype.addComponent=function(t){if(t.entity)throw new Error("Component already added to an entity!");var e=this._componentHash;this._componentHash=this._componentHash.clone(),this._components.push(t),this._componentHash.setBit(t.COMPONENT_ID),this._requiresUpdates=this._requiresUpdates||!!t.onUpdate,t.entity=this,t.enabled&&t.onAdded(),t.bounds&&this.invalidateBounds(),this._onComponentsChange.dispatch(this,e)},Ri.prototype._invalidateWorldMatrix=function(){this._SceneNode_invalidateWorldMatrix(),this._invalidateWorldBounds(),this._scene&&this._scene._partitioning.markEntityForUpdate(this)},Ri.prototype.invalidateBounds=function(){this._boundsInvalid=!0,this._invalidateWorldBounds()},Ri.prototype._invalidateWorldBounds=function(){this._worldBoundsInvalid=!0},Ri.prototype._updateWorldBounds=function(){this._worldBounds.transformFrom(this.bounds,this.worldMatrix)},Ri.prototype._updateBounds=function(){var t=this._components;this._bounds.clear();for(var e=0,i=t.length;e<i;++e){var n=t[e].bounds;n&&this._bounds.growToIncludeBound(n)}},Ri.prototype.removeComponent=function(t){var e=!1,i=0,n=[],s=this._componentHash;this._componentHash=new mi;for(var r=0,o=this._components.length;r<o;++r){var a=this._components[r];a!==t&&(n[i++]=a,e=e||!!t.onUpdate,this._componentHash.setBit(a.COMPONENT_ID))}this._requiresUpdates=e,this._onComponentsChange.dispatch(this,s),this._components=n,t.entity=null,t.enabled&&t.onRemoved(),t.bounds&&this.invalidateBounds()},Ri.prototype.addComponents=function(t){for(var e=0;e<t.length;++e)this.addComponent(t[e])},Ri.prototype.removeComponents=function(t){for(var e=0;e<t.length;++e)this.removeComponent(t[e])},Ri.prototype.destroy=function(){Ai.prototype.destroy.call(this),this._components&&this.removeComponents(this._components)},Ri.prototype.hasComponentType=function(t){return this._componentHash.contains(t.COMPONENT_ID)},Ri.prototype.getFirstComponentByType=function(t){for(var e=0,i=this._components.length;e<i;++e){var n=this._components[e];if(n instanceof t)return n}return null},Ri.prototype.getComponentsByType=function(t){for(var e=[],i=0,n=this._components.length;i<n;++i){var s=this._components[i];s instanceof t&&e.push(s)}return e},Ri.prototype.getComponentByName=function(t){for(var e=0,i=this._components.length;e<i;++e){var n=this._components[e];if(n.name===t)return n}return null},Ri.prototype.update=function(t){for(var e=this._components,i=0,n=e.length;i<n;++i){var s=e[i];s.enabled&&s.onUpdate&&s.onUpdate(t)}},Ri.prototype._setScene=function(t){this._scene&&(this._scene.entityEngine.unregisterEntity(this),this._scene.partitioning.unregisterEntity(this)),t&&(t.entityEngine.registerEntity(this),t.partitioning.registerEntity(this)),this._SceneNode_setScene(t),this._invalidateWorldBounds()},Ri.prototype._createBoundingVolume=function(){return new J},Ri.prototype.acceptVisitor=function(t){for(var e=this._components,i=0,n=e.length;i<n;++i){var s=e[i];s.acceptVisitor&&s.enabled&&s.acceptVisitor(t)}},Ri.prototype.copyFrom=function(t){Ai.prototype.copyFrom.call(this,t);for(var e=0,i=t._components.length;e<i;++e)this.addComponent(t._components[e].clone())},Ri.prototype.clone=function(){var t=new Ri;return t.copyFrom(this),t},Ri.prototype._bindSkeleton=function(t,e,i){for(var n,s=0,r=this._components.length;s<r;++s){var o=this._components[s];o._bindSkeleton&&(t&&!n&&i!==this&&((n=i.worldMatrix.clone()).invertAffine(),n.prependAffine(this.worldMatrix)),o._bindSkeleton(t,e,n))}Ai.prototype._bindSkeleton.call(this,t,e,i)},Ri.prototype._updateChildAdded=function(t){Ai.prototype._updateChildAdded.call(this,t),this.invalidateBounds()},(Ui.prototype=Object.create(Ti.prototype,{color:{get:function(){return this._color},set:function(t){this._colorChangeListener.enabled=!1,isNaN(t)?this._color.copyFrom(t):this._color.set(t),this._colorChangeListener.enabled=!0,this._updateScaledIrradiance()}},intensity:{get:function(){return this._intensity},set:function(t){this._intensity=t,this._updateScaledIrradiance()}}})).luminance=function(){return this._color.luminance()*this._intensity},Ui.prototype._updateScaledIrradiance=function(){ve.OPTIONS.useGammaCorrection?this._color.gammaToLinear(this._scaledIrradiance):this._scaledIrradiance.copyFrom(this._color),this._scaledIrradiance.r*=this._intensity,this._scaledIrradiance.g*=this._intensity,this._scaledIrradiance.b*=this._intensity},Ui.prototype.copyFrom=function(t){this.color=t.color,this.intensity=t.intensity},(Bi.prototype=Object.create(Ui.prototype)).acceptVisitor=function(t){t.visitLight(this)},Bi.prototype._updateScaledIrradiance=function(){this._Light_updateScaledIrradiance();var t=1/Math.PI;this._scaledIrradiance.r*=t,this._scaledIrradiance.g*=t,this._scaledIrradiance.b*=t},Bi.prototype.copyFrom=function(t){Ui.prototype.copyFrom.call(this,t),this.shadowQualityBias=t.shadowQualityBias,this.castShadows=t.castShadows,this.depthBias=t.depthBias},Ti.create(Fi,{numAtlasPlanes:{get:function(){return ve.OPTIONS.numShadowCascades}},castShadows:{get:function(){return this._castShadows},set:function(t){this._castShadows!==t&&(this._castShadows=t,this._shadowMatrices=t&&t?[new Pt,new Pt,new Pt,new Pt]:null)}},direction:{get:function(){var t=this._direction;return this.entity&&this.entity.worldMatrix.getColumn(1,t),t}},cascadeSplitDistances:{get:function(){return this._cascadeSplitDistances}}},Bi),Fi.prototype.setCascadeRatios=function(t,e,i,n){this._cascadeSplitRatios[0]=t,this._cascadeSplitRatios[1]=e,this._cascadeSplitRatios[2]=i,this._cascadeSplitRatios[3]=n},Fi.prototype._initCascadeSplitProperties=function(){for(var t=1,e=ve.OPTIONS.numShadowCascades-1;0<=e;--e)this._cascadeSplitRatios[e]=t,this._cascadeSplitDistances[e]=0,t*=.5},Fi.prototype.getShadowMatrix=function(t){return this._shadowMatrices[t]},Fi.prototype._updateBounds=function(){this._bounds.clear(K.EXPANSE_INFINITE)},Fi.prototype.toString=function(){return"[DirectionalLight(name="+this.name+")]"},Fi.prototype.clone=function(){var t=new Fi;return t.copyFrom(this),t},(ki.prototype=Object.create(K.prototype)).setExplicit=function(t,e){this._center.copyFrom(t),this._halfExtentX=this._halfExtentY=this._halfExtentZ=e,this._expanse=K.EXPANSE_FINITE,this._updateMinAndMax()},ki.prototype.growToIncludeMesh=function(t){if(this._expanse!==K.EXPANSE_INFINITE){var e,i,n,s,r,o,a=t.getVertexAttributeByName("hx_position"),h=a.offset,u=t.getVertexStride(a.streamIndex),l=t.getVertexData(a.streamIndex),c=l.length;for(this._expanse===K.EXPANSE_EMPTY?(s=e=l[h],r=i=l[h+1],o=n=l[h+2],h+=u):(e=this._minimumX,i=this._minimumY,n=this._minimumZ,s=this._maximumX,r=this._maximumY,o=this._maximumZ);h<c;h+=u){var _=l[h],d=l[h+1],f=l[h+2];s<_?s=_:_<e&&(e=_),r<d?r=d:d<i&&(i=d),o<f?o=f:f<n&&(n=f)}var p=.5*(s+e),g=.5*(r+i),M=.5*(o+n),A=0;for(h=a.offset;h<c;h+=u){var m=p-l[h],x=g-l[h+1],T=M-l[h+2],y=m*m+x*x+T*T;A<y&&(A=y)}this._center.x=p,this._center.y=g,this._center.z=M;var N=Math.sqrt(A);this._halfExtentX=N,this._halfExtentY=N,this._halfExtentZ=N,this._expanse=K.EXPANSE_FINITE,this._updateMinAndMax()}},ki.prototype.growToIncludeBound=function(t){if(t._expanse!==K.EXPANSE_EMPTY&&t._expanse!==K.EXPANSE_INHERIT&&this._expanse!==K.EXPANSE_INFINITE){if(t._expanse===K.EXPANSE_INFINITE)this._expanse=K.EXPANSE_INFINITE;else if(this._expanse===K.EXPANSE_EMPTY)this._center.x=t._center.x,this._center.y=t._center.y,this._center.z=t._center.z,t.type===this.type?(this._halfExtentX=t._halfExtentX,this._halfExtentY=t._halfExtentY,this._halfExtentZ=t._halfExtentZ):this._halfExtentX=this._halfExtentY=this._halfExtentZ=t.getRadius(),this._expanse=K.EXPANSE_FINITE;else{var e=this._minimumX,i=this._minimumY,n=this._minimumZ,s=this._maximumX,r=this._maximumY,o=this._maximumZ;t._maximumX>s&&(s=t._maximumX),t._maximumY>r&&(r=t._maximumY),t._maximumZ>o&&(o=t._maximumZ),t._minimumX<e&&(e=t._minimumX),t._minimumY<i&&(i=t._minimumY),t._minimumZ<n&&(n=t._minimumZ),this._center.x=.5*(e+s),this._center.y=.5*(i+r),this._center.z=.5*(n+o);var a=s-this._center.x,h=r-this._center.y,u=o-this._center.z,l=Math.sqrt(a*a+h*h+u*u);this._halfExtentX=this._halfExtentY=this._halfExtentZ=l}this._updateMinAndMax()}},ki.prototype.growToIncludeMinMax=function(t,e){var i=new J;i.growToIncludeMinMax(t,e),this.growToIncludeBound(i)},ki.prototype.getRadius=function(){return this._halfExtentX},ki.prototype.transform=function(t){var e=new ki;return e.transformFrom(this,t),e},ki.prototype.transformFrom=function(t,e){if(t._expanse===K.EXPANSE_INFINITE||t._expanse===K.EXPANSE_EMPTY)this.clear(t._expanse);else{var i=e._m,n=i[0],s=i[1],r=i[2],o=i[4],a=i[5],h=i[6],u=i[8],l=i[9],c=i[10],_=t._center.x,d=t._center.y,f=t._center.z;this._center.x=n*_+o*d+u*f+i[12],this._center.y=s*_+a*d+l*f+i[13],this._center.z=r*_+h*d+c*f+i[14],n<0&&(n=-n),s<0&&(s=-s),r<0&&(r=-r),o<0&&(o=-o),a<0&&(a=-a),h<0&&(h=-h),u<0&&(u=-u),l<0&&(l=-l),c<0&&(c=-c);var p=n*(_=t._halfExtentX)+o*(d=t._halfExtentY)+u*(f=t._halfExtentZ),g=s*_+a*d+l*f,M=r*_+h*d+c*f,A=Math.sqrt(p*p+g*g+M*M);this._halfExtentX=this._halfExtentY=this._halfExtentZ=A,this._minimumX=this._center.x-this._halfExtentX,this._minimumY=this._center.y-this._halfExtentY,this._minimumZ=this._center.z-this._halfExtentZ,this._maximumX=this._center.x+this._halfExtentX,this._maximumY=this._center.y+this._halfExtentY,this._maximumZ=this._center.z+this._halfExtentZ,this._expanse=K.EXPANSE_FINITE}},ki.prototype.intersectsConvexSolid=function(t,e){if(this._expanse===K.EXPANSE_INFINITE||this._expanse===K.EXPANSE_INHERIT)return!0;if(this._expanse===K.EXPANSE_EMPTY)return!1;for(var i=this._center.x,n=this._center.y,s=this._center.z,r=this._halfExtentX,o=0;o<e;++o){var a=t[o];if(r<a.x*i+a.y*n+a.z*s+a.w)return!1}return!0},ki.prototype.intersectsBound=function(t){if(this._expanse===K.EXPANSE_EMPTY||t._expanse===K.EXPANSE_EMPTY)return!1;if(this._expanse===K.EXPANSE_INFINITE||t._expanse===K.EXPANSE_INFINITE||this._expanse===K.EXPANSE_INHERIT||t._expanse===K.EXPANSE_INHERIT)return!0;if(t.type===this.type){var e=this._center.x-t._center.x,i=this._center.y-t._center.y,n=this._center.z-t._center.z,s=this._halfExtentX+t._halfExtentX;return e*e+i*i+n*n<s*s}return K._testAABBToSphere(t,this)},ki.prototype.classifyAgainstPlane=function(t){var e=t.x*this._center.x+t.y*this._center.y+t.z*this._center.z+t.w,i=this._halfExtentX;return i<e?q.FRONT:e<-i?q.BACK:q.INTERSECTING},ki.prototype._updateMinAndMax=function(){var t=this._center.x,e=this._center.y,i=this._center.z,n=this._halfExtentX;this._minimumX=t-n,this._minimumY=e-n,this._minimumZ=i-n,this._maximumX=t+n,this._maximumY=e+n,this._maximumZ=i+n},ki.prototype.intersectsRay=function(t){if(this._expanse===K.EXPANSE_INFINITE)return!0;if(this._expanse===K.EXPANSE_EMPTY||this._expanse===K.EXPANSE_INHERIT)return!1;var e,i=this._center.x,n=this._center.y,s=this._center.z,r=this._halfExtentX,o=t.origin,a=t.direction,h=o.x,u=o.y,l=o.z,c=a.x,_=a.y,d=a.z,f=i-h,p=n-u,g=s-l,M=f*c+p*_+g*d;if(0<M){var A=h+M*c,m=u+M*_,x=l+M*d;e=(A=i-A)*A+(m=n-m)*m+(x=s-x)*x}else e=f*f+p*p+g*g;return e<=r*r},ki.prototype.clone=function(){var t=new ki;return t.growToIncludeBound(this),t},Ti.create(Yi,{numAtlasPlanes:{get:function(){return 6}},castShadows:{get:function(){return this._castShadows},set:function(t){if(this._castShadows=t){this._shadowTiles=[];for(var e=0;e<6;++e)this._shadowTiles[e]=new Z}else this._shadowTiles=null}},radius:{get:function(){return this._radius},set:function(t){this._radius=t,this.invalidateBounds()}}},Bi),Yi.prototype._updateBounds=function(){this._bounds.setExplicit(Z.ORIGIN_POINT,this._radius)},Yi.prototype.toString=function(){return"[PointLight(name="+this.name+")]"},Yi.prototype.copyFrom=function(t){Bi.prototype.copyFrom.call(this,t),this.radius=t.radius},Yi.prototype.clone=function(){var t=new Yi;return t.copyFrom(this),t},Qi.powerRange0=98e-5,Qi.powerRange1=.9921,Ti.create(Qi,{specularTexture:{get:function(){return this._specularTexture}},diffuseTexture:{get:function(){return this._diffuseTexture}},size:{get:function(){return this._size},set:function(t){this._size!==t&&((this._size=t)?this._bounds.setExplicit(Z.ORIGIN_POINT,t):this._bounds.clear(K.EXPANSE_INFINITE))}}}),Qi.prototype.acceptVisitor=function(t){t.visitLight(this)},Qi.prototype.clone=function(){var t=new Qi(this._diffuseTexture,this._specularTexture);return t.size=this.size,t.intensity=this.intensity,t},Ti.create(Gi,{numAtlasPlanes:{get:function(){return 1}},castShadows:{get:function(){return this._castShadows},set:function(t){this._castShadows!==t&&((this._castShadows=t)?(this._shadowMatrix=new Pt,this._shadowTile=new Z):(this._shadowMatrix=null,this._shadowTile=null))}},shadowMatrix:{get:function(){return this._shadowMatrix}},shadowTile:{get:function(){return this._shadowTile}},radius:{get:function(){return this._radius},set:function(t){this._radius=t,this.invalidateBounds()}},innerAngle:{get:function(){return this._innerAngle},set:function(t){this._innerAngle=at.clamp(t,0,Math.PI),this._outerAngle=at.clamp(this._outerAngle,this._innerAngle,Math.PI),this._cosInner=Math.cos(.5*this._innerAngle),this._cosOuter=Math.cos(.5*this._outerAngle),this.invalidateBounds()}},outerAngle:{get:function(){return this._outerAngle},set:function(t){this._outerAngle=at.clamp(t,0,Math.PI),this._innerAngle=at.clamp(this._innerAngle,0,this._outerAngle),this._cosInner=Math.cos(.5*this._innerAngle),this._cosOuter=Math.cos(.5*this._outerAngle),this.invalidateBounds()}}},Bi),Gi.prototype._updateBounds=(yi=new Z,function(){var t=this._radius/(2*this._cosOuter);yi.set(0,t,0),this._bounds.setExplicit(yi,t)}),Gi.prototype.toString=function(){return"[SpotLight(name="+this.name+")]"},Gi.prototype.copyFrom=function(t){Bi.prototype.copyFrom.call(this,t),this.radius=t.radius,this.innerAngle=t.innerAngle,this.outerAngle=t.outerAngle},Gi.prototype.clone=function(){var t=new Gi;return t.copyFrom(this),t},(Xi.prototype=Object.create(ge.prototype)).updatePassRenderState=function(t,e){U.gl.useProgram(this.shader.program),this._assignDirLights(t),this._assignPointLights(t),this._assignSpotLights(t),this._assignLightProbes(t),this._MP_updatePassRenderState(t,e)},Xi.prototype._generateShader=function(t,e,i,n){this._dirLights=[],this._pointLights=[],this._spotLights=[],this._diffuseLightProbes=[],this._specularLightProbes=[];for(var s=0;s<n.length;++s){var r=n[s];r instanceof Fi?this._dirLights.push(r):r instanceof Yi?this._pointLights.push(r):r instanceof Gi?this._spotLights.push(r):r instanceof Qi&&(r.diffuseTexture&&this._diffuseLightProbes.push(r),r.specularTexture&&this._specularLightProbes.push(r))}var o=[],a=this._diffuseLightProbes.length,h=this._specularLightProbes.length,u={HX_NUM_DIR_LIGHTS:this._dirLights.length,HX_NUM_POINT_LIGHTS:this._pointLights.length,HX_NUM_SPOT_LIGHTS:this._spotLights.length,HX_NUM_DIFFUSE_PROBES:a,HX_NUM_SPECULAR_PROBES:h};return this._diffProbeIntensityData=new Float32Array(a),this._specProbeIntensityData=new Float32Array(h),this._specProbeMipData=new Float32Array(h),Be.EXT_SHADER_TEXTURE_LOD&&(o+="#texturelod\n"),new Q(t+"\n"+d.get("material_fwd_fixed_vertex.glsl",u),o+d.get("snippets_geometry.glsl")+"\n"+i+"\n\n\n"+ve.OPTIONS.shadowFilter.getGLSL()+"\n"+d.get("directional_light.glsl",u)+"\n"+d.get("point_light.glsl")+"\n"+d.get("spot_light.glsl")+"\n"+d.get("light_probe.glsl")+"\n"+e+"\n"+d.get("material_fwd_fixed_fragment.glsl"))},Xi.prototype._assignDirLights=(Ni=new Z,Di=new Pt,Ei=new Float32Array(64),function(t){var e=this._dirLights;if(e)for(var i=e.length,n=U.gl,s=0;s<i;++s){var r=e[s],o=this._dirLocations[s];if(t.viewMatrix.transformVector(r.direction,Ni),r.entity.hierarchyVisible){var a=r._scaledIrradiance;if(n.uniform3f(o.color,a.r,a.g,a.b),n.uniform3f(o.direction,Ni.x,Ni.y,Ni.z),n.uniform1i(o.castShadows,r.castShadows?1:0),r.castShadows){for(var h=ve.OPTIONS.numShadowCascades,u=r._cascadeSplitDistances,l=0,c=0;c<h;++c){Di.multiply(r.getShadowMatrix(c),t.worldMatrix);for(var _=Di._m,d=0;d<16;++d)Ei[l++]=_[d]}n.uniformMatrix4fv(o.matrices,!1,Ei),n.uniform4f(o.splits,u[0],u[1],u[2],u[3]),n.uniform1f(o.depthBias,r.depthBias),n.uniform1f(o.maxShadowDistance,u[h-1])}}else n.uniform3f(o.color,0,0,0)}}),Xi.prototype._assignPointLights=(wi=new Z,Li=new Float32Array(24),function(t){var e=this._pointLights;if(e)for(var i=U.gl,n=e.length,s=0;s<n;++s){var r=this._pointLocations[s],o=e[s],a=o.entity;if(a.worldMatrix.getColumn(3,wi),t.viewMatrix.transformPoint(wi,wi),a.hierarchyVisible){var h=o._scaledIrradiance;if(i.uniform3f(r.color,h.r,h.g,h.b),i.uniform3f(r.position,wi.x,wi.y,wi.z),i.uniform1f(r.radius,o._radius),i.uniform1f(r.rcpRadius,1/o._radius),i.uniform1i(r.castShadows,o.castShadows?1:0),o.castShadows){i.uniformMatrix4fv(r.matrix,!1,t.worldMatrix._m),i.uniform1f(r.depthBias,o.depthBias);var u=0;for(s=0;s<6;++s){var l=o._shadowTiles[s];Li[u++]=l.x,Li[u++]=l.y,Li[u++]=l.z,Li[u++]=l.w}i.uniform4fv(r.tiles,Li)}}else i.uniform3f(r.color,0,0,0)}}),Xi.prototype._assignSpotLights=(Ii=new Z,vi=new Pt,function(t){var e=this._spotLights;if(e)for(var i=U.gl,n=e.length,s=0;s<n;++s){var r=this._spotLocations[s],o=e[s],a=o.entity,h=a.worldMatrix,u=t.viewMatrix;if(h.getColumn(3,Ii),u.transformPoint(Ii,Ii),a.hierarchyVisible){var l=o._scaledIrradiance;if(i.uniform3f(r.color,l.r,l.g,l.b),i.uniform3f(r.position,Ii.x,Ii.y,Ii.z),i.uniform1f(r.radius,o._radius),i.uniform1f(r.rcpRadius,1/o._radius),i.uniform2f(r.angleData,o._cosOuter,1/Math.max(o._cosInner-o._cosOuter,1e-5)),h.getColumn(1,Ii),u.transformVector(Ii,Ii),i.uniform3f(r.direction,Ii.x,Ii.y,Ii.z),i.uniform1i(r.castShadows,o.castShadows?1:0),o.castShadows){vi.multiply(o.shadowMatrix,t.worldMatrix),i.uniformMatrix4fv(r.matrix,!1,vi._m),i.uniform1f(r.depthBias,o.depthBias);var c=o._shadowTile;i.uniform4f(r.tile,c.x,c.y,c.z,c.w)}}else i.uniform3f(r.color,0,0,0)}}),Xi.prototype._assignLightProbes=function(){for(var t,e=[],i=[],n=this._diffProbeIntensityData,s=this._diffuseLightProbes,r=s.length,o=0;o<r;++o){t=s[o],e[o]=t.diffuseTexture;var a=t.entity.hierarchyVisible?1:0;n[o]=t.intensity*a}var h=this._specProbeIntensityData;r=(s=this._specularLightProbes).length;var u=this._specProbeMipData;for(o=0;o<r;++o){var l=(t=s[o]).specularTexture;i[o]=l,u[o]=Math.floor(at.log2(l.size));a=t.entity.hierarchyVisible?1:0;h[o]=t.intensity*a}0<e.length&&(this.setTextureArray("hx_diffuseProbeMaps",e),this.setUniformArray("hx_diffuseProbeIntensities",n)),0<i.length&&(this.setTextureArray("hx_specularProbeMaps",i),this.setUniformArray("hx_specularProbeNumMips",u),this.setUniformArray("hx_specularProbeIntensities",h))},Xi.prototype._getUniformLocations=function(){this._dirLocations=[],this._pointLocations=[],this._spotLocations=[];for(var t=0;t<this._dirLights.length;++t)this._dirLocations.push({color:this.getUniformLocation("hx_directionalLights["+t+"].color"),direction:this.getUniformLocation("hx_directionalLights["+t+"].direction"),matrices:this.getUniformLocation("hx_directionalLights["+t+"].shadowMapMatrices[0]"),splits:this.getUniformLocation("hx_directionalLights["+t+"].splitDistances"),depthBias:this.getUniformLocation("hx_directionalLights["+t+"].depthBias"),maxShadowDistance:this.getUniformLocation("hx_directionalLights["+t+"].maxShadowDistance"),castShadows:this.getUniformLocation("hx_directionalLights["+t+"].castShadows")});for(t=0;t<this._pointLights.length;++t)this._pointLocations.push({color:this.getUniformLocation("hx_pointLights["+t+"].color"),position:this.getUniformLocation("hx_pointLights["+t+"].position"),radius:this.getUniformLocation("hx_pointLights["+t+"].radius"),rcpRadius:this.getUniformLocation("hx_pointLights["+t+"].rcpRadius"),castShadows:this.getUniformLocation("hx_pointLights["+t+"].castShadows"),depthBias:this.getUniformLocation("hx_pointLights["+t+"].depthBias"),matrix:this.getUniformLocation("hx_pointLights["+t+"].shadowMapMatrix"),tiles:this.getUniformLocation("hx_pointLights["+t+"].shadowTiles[0]")});for(t=0;t<this._spotLights.length;++t)this._spotLocations.push({color:this.getUniformLocation("hx_spotLights["+t+"].color"),position:this.getUniformLocation("hx_spotLights["+t+"].position"),direction:this.getUniformLocation("hx_spotLights["+t+"].direction"),radius:this.getUniformLocation("hx_spotLights["+t+"].radius"),rcpRadius:this.getUniformLocation("hx_spotLights["+t+"].rcpRadius"),angleData:this.getUniformLocation("hx_spotLights["+t+"].angleData"),castShadows:this.getUniformLocation("hx_spotLights["+t+"].castShadows"),matrix:this.getUniformLocation("hx_spotLights["+t+"].shadowMapMatrix"),tile:this.getUniformLocation("hx_spotLights["+t+"].shadowTile"),depthBias:this.getUniformLocation("hx_spotLights["+t+"].depthBias")})},(Vi.prototype=Object.create(ge.prototype)).updatePassRenderState=(Si=new Z,Oi=new Float32Array(24),function(t,e,i){var n=U.gl,s=i._scaledIrradiance;if(n.useProgram(this.shader.program),i.entity.worldMatrix.getColumn(3,Si),t.viewMatrix.transformPoint(Si,Si),n.uniform3f(this._colorLocation,s.r,s.g,s.b),n.uniform3f(this._posLocation,Si.x,Si.y,Si.z),n.uniform1f(this._radiusLocation,i._radius),n.uniform1f(this._rcpRadiusLocation,1/i._radius),n.uniform1i(this._castShadowsLocation,i.castShadows?1:0),i.castShadows){for(var r=0,o=0;o<6;++o){var a=i._shadowTiles[o];Oi[r++]=a.x,Oi[r++]=a.y,Oi[r++]=a.z,Oi[r++]=a.w}n.uniform4fv(this._shadowTilesLocation,Oi),n.uniform1f(this._depthBiasLocation,i.depthBias),n.uniformMatrix4fv(this._shadowMatrixLocation,!1,t.worldMatrix._m)}this._MP_updatePassRenderState(t,e)}),Vi.prototype._generateShader=function(t,e,i){var n={};return new Q(t+"\n"+d.get("material_fwd_point_vertex.glsl",n),d.get("snippets_geometry.glsl",n)+"\n"+i+"\n\n\n"+ve.OPTIONS.shadowFilter.getGLSL()+"\n"+d.get("point_light.glsl")+"\n"+e+"\n"+d.get("material_fwd_point_fragment.glsl"))},(Hi.prototype=Object.create(ge.prototype)).updatePassRenderState=function(t,e,i){var n=U.gl;n.useProgram(this.shader.program),this._textures[this._diffuseSlot]=i.diffuseTexture||Ue.DARK_CUBE_TEXTURE;var s=i.specularTexture||Ue.DARK_CUBE_TEXTURE;this._textures[this._specularSlot]=s,n.uniform1f(this._numMipsLocation,Math.floor(at.log2(s.size))),n.uniform1f(this._localLocation,i._size?1:0),n.uniform1f(this._intensityLocation,i.intensity),n.uniform1f(this._sizeLocation,i._size||0);var r=i.entity.worldMatrix._m;n.uniform3f(this._positionLocation,r[12],r[13],r[14]),this._MP_updatePassRenderState(t,e)},Hi.prototype._generateShader=function(t,e,i){var n="";return Be.EXT_SHADER_TEXTURE_LOD&&(n+="#texturelod\n"),new Q(t+"\n"+d.get("material_fwd_probe_vertex.glsl"),n+d.get("snippets_geometry.glsl")+"\n"+i+"\n\n\n"+d.get("light_probe.glsl")+"\n"+e+"\n"+d.get("material_fwd_probe_fragment.glsl"))},(Wi.prototype=Object.create(ge.prototype)).updatePassRenderState=(Ci=new Z,ji=new Pt,function(t,e,i){var n=U.gl,s=i._scaledIrradiance;n.useProgram(this.shader.program);var r=i.entity.worldMatrix,o=t.viewMatrix;if(r.getColumn(3,Ci),o.transformPoint(Ci,Ci),n.uniform3f(this._colorLocation,s.r,s.g,s.b),n.uniform3f(this._posLocation,Ci.x,Ci.y,Ci.z),r.getColumn(1,Ci),o.transformVector(Ci,Ci),n.uniform3f(this._dirLocation,Ci.x,Ci.y,Ci.z),n.uniform1f(this._radiusLocation,i._radius),n.uniform1f(this._rcpRadiusLocation,1/i._radius),n.uniform2f(this._anglesLocation,i._cosOuter,1/Math.max(i._cosInner-i._cosOuter,1e-5)),n.uniform1i(this._castShadowsLocation,i.castShadows?1:0),i.castShadows){var a=i._shadowTile;n.uniform1f(this._depthBiasLocation,i.depthBias),n.uniform4f(this._shadowTileLocation,a.x,a.y,a.z,a.w),ji.multiply(i._shadowMatrix,t.worldMatrix),n.uniformMatrix4fv(this._shadowMatrixLocation,!1,ji._m)}this._MP_updatePassRenderState(t,e)}),Wi.prototype._generateShader=function(t,e,i){var n={};return new Q(t+"\n"+d.get("material_fwd_spot_vertex.glsl",n),d.get("snippets_geometry.glsl",n)+"\n"+i+"\n\n\n"+ve.OPTIONS.shadowFilter.getGLSL()+"\n"+d.get("spot_light.glsl")+"\n"+e+"\n"+d.get("material_fwd_spot_fragment.glsl"))},(Zi.prototype=Object.create(ge.prototype))._generateShader=function(t,e){var i="#define HX_SKIP_SPECULAR\n",n=i+d.get("snippets_geometry.glsl")+"\n"+e+"\n"+d.get("material_normal_depth_fragment.glsl");return new Q(i+t+"\n"+d.get("material_normal_depth_vertex.glsl"),n)};var Ki={FORWARD_DYNAMIC:0,FORWARD_FIXED:1,NUM_PATHS:2};function qi(t,e){ge.call(this,this._generateShader(t,e)),this._rcpRadiusLocation=this.getUniformLocation("hx_rcpRadius"),this._MP_updatePassRenderState=ge.prototype.updatePassRenderState}(qi.prototype=Object.create(ge.prototype)).updatePassRenderState=function(t,e,i){this._MP_updatePassRenderState(t,e),U.gl.uniform1f(this._rcpRadiusLocation,1/i._radius)},qi.prototype._generateShader=function(t,e){var i="#define HX_SKIP_NORMALS\n#define HX_SKIP_SPECULAR\n",n=i+d.get("snippets_geometry.glsl")+"\n"+ve.OPTIONS.shadowFilter.getGLSL()+"\n"+e+"\n"+d.get("material_point_shadow_fragment.glsl");return new Q(i+t+"\n"+d.get("material_point_shadow_vertex.glsl"),n)};var Ji=0;function $i(t,e,i){this.onChange=new r,this.name="hx_material_"+Ji,this._cullMode=Ye.BACK,this._writeDepth=!0,this._writeColor=!0,this._passes=new Array($i.NUM_PASS_TYPES),this.renderOrder=0,this._renderOrderHint=Ji,this._shaderRenderOrderHint=0,this._renderPath=null,this._textures={},this._uniforms={},this._fixedLights=null,this._useMorphing=!1,this._useNormalMorphing=!1,this._useSkinning=!1,this._geometryVertexShader=t,this._geometryFragmentShader=e,this._lightingModel=i||ve.OPTIONS.defaultLightingModel,this._initialized=!1,this._blendState=null,this._additiveBlendState=_t.ADD,this.needsNormalDepth=!1,this.needsBackbuffer=!1,++Ji}function tn(t){$i.call(this),t=t||{},this._color=t.color||new h(1,1,1,1),this._emissiveColor=t.emissiveColor||new h(0,0,0,1),this._doubleSided=!!t.doubleSided,this._specularMapMode=t.specularMapMode||tn.SPECULAR_MAP_ROUGHNESS_ONLY,this._colorMap=t.colorMap||null,this._normalMap=t.normalMap||null,this._specularMap=t.specularMap||null,this._maskMap=t.maskMap||null,this._occlusionMap=t.occlusionMap||null,this._colorMapScale=null,this._colorMapOffset=null,this._normalMapScale=null,this._normalMapOffset=null,this._specularMapScale=null,this._specularMapOffset=null,this._maskMapScale=null,this._maskMapOffset=null,this._emissionMapScale=null,this._emissionMapOffset=null,this._metallicness=void 0===t.metallicness?0:t.metallicness,this._alpha=void 0===t.alpha?1:t.alpha,this._roughness=void 0===t.roughness?.5:t.roughness,this._roughnessRange=void 0===t.roughnessRange?.5:t.roughnessRange,this._normalSpecularReflectance=void 0===t.normalSpecularReflectance?.027:t.normalSpecularReflectance,this._alphaThreshold=void 0===t.alphaThreshold?1:t.alphaThreshold,this._useVertexColors=!!t.useVertexColors,this.color=this._color,this.emissiveColor=this._emissiveColor,this.alpha=this._alpha,this.metallicness=this._metallicness,this.roughness=this._roughness,this.normalSpecularReflectance=this._normalSpecularReflectance,void 0!==t.lightingModel&&(this.lightingModel=t.lightingModel)}function en(){Ri.call(this);var t=new hi({height:1,radius:.01,alignment:hi.ALIGN_X}),e=new hi({height:1,radius:.01,alignment:hi.ALIGN_Y}),i=new hi({height:1,radius:.01,alignment:hi.ALIGN_Z});t.translate(.5,0,0),e.translate(0,.5,0),i.translate(0,0,.5);var n=new tn({color:16711680,lightingModel:k.Unlit}),s=new tn({color:65280,lightingModel:k.Unlit}),r=new tn({color:255,lightingModel:k.Unlit});this.addComponent(new Pi(t,n)),this.addComponent(new Pi(e,s)),this.addComponent(new Pi(i,r))}function nn(t){ai.call(this,t)}function sn(){Ti.call(this)}function rn(t){this.onEntityAdded=new r,this.onEntityRemoved=new r,this.onDisposed=new r,this._hash=t,this._entities=[],this._usageCount=0}function on(){this._updateableEntities=[],this._entities=[],this._entitySets={},this._systems=[],Se.bind(this._update,this)}function an(){this._entities=[]}$i.ID_COUNTER=0,$i.prototype={init:function(){if(!this._initialized&&this._geometryVertexShader&&this._geometryFragmentShader){this.needsNormalDepth=!1,this.needsBackbuffer=!1;var t=this._geometryVertexShader,e=this._geometryFragmentShader;this._useSkinning&&(t="#define HX_USE_SKINNING\n"+t),this._useMorphing&&(t="#define HX_USE_MORPHING\n"+t,this._useNormalMorphing&&(t="#define HX_USE_NORMAL_MORPHING\n"+t)),this._lightingModel?this._fixedLights?(this._renderPath=Ki.FORWARD_FIXED,this.setPass(ge.BASE_PASS,new Xi(t,e,this._lightingModel,this._fixedLights))):Be.WEBGL_2?(this._renderPath=Ki.FORWARD_DYNAMIC,this.setPass(ge.BASE_PASS,new _i(t,e,this._lightingModel,null))):(this._renderPath=Ki.FORWARD_DYNAMIC,this.setPass(ge.BASE_PASS,new di(t,e)),this.setPass(ge.DIR_LIGHT_PASS,new ci(t,e,this._lightingModel)),this.setPass(ge.POINT_LIGHT_PASS,new Vi(t,e,this._lightingModel)),this.setPass(ge.SPOT_LIGHT_PASS,new Wi(t,e,this._lightingModel)),this.setPass(ge.LIGHT_PROBE_PASS,new Hi(t,e,this._lightingModel))):(this._renderPath=Ki.FORWARD_FIXED,this.setPass(ge.BASE_PASS,new ui(t,e))),this.setPass(ge.DIR_LIGHT_SHADOW_MAP_PASS,new li(t,e)),this.setPass(ge.POINT_LIGHT_SHADOW_MAP_PASS,new qi(t,e)),this.setPass(ge.NORMAL_DEPTH_PASS,new Zi(t,e)),this._shaderRenderOrderHint=this._passes[ge.BASE_PASS].shader.renderOrderHint,this._initialized=!0}},get initialized(){return this._initialized},get blendState(){return this._blendState},set blendState(t){(this._blendState=t)?(this._additiveBlendState=t.clone(),this._additiveBlendState.dstFactor=Ve.ONE):this._additiveBlendState=_t.ADD,this._invalidate()},get fixedLights(){return this._fixedLights},set fixedLights(t){this._fixedLights!==t&&(this._fixedLights=t,this._invalidate())},get lightingModel(){return this._lightingModel},set lightingModel(t){this._lightingModel=t,this._invalidate()},get writeDepth(){return this._writeDepth},set writeDepth(t){!(this._writeDepth=t)&&this._passes[ge.NORMAL_DEPTH_PASS]?this._passes[ge.NORMAL_DEPTH_PASS]=null:t&&!this._passes[ge.NORMAL_DEPTH_PASS]&&this._invalidate();for(var e=0;e<ge.NUM_PASS_TYPES;++e)this._passes[e]&&(this._passes[e].writeDepth=t)},get writeColor(){return this._writeColor},set writeColor(t){this._writeColor=t;for(var e=0;e<ge.NUM_PASS_TYPES;++e)this._passes[e]&&(this._passes[e].writeColor=t)},get cullMode(){return this._cullMode},set cullMode(t){this._cullMode=t;for(var e=0;e<ge.NUM_PASS_TYPES;++e)e!==ge.DIR_LIGHT_SHADOW_MAP_PASS&&e!==ge.POINT_LIGHT_SHADOW_MAP_PASS&&this._passes[e]&&(this._passes[e].cullMode=t)},get renderPath(){return this._initialized||this.init(),this._renderPath},getPass:function(t){return this._initialized||this.init(),this._passes[t]},setPass:function(t,e){if(this._passes[t]=e){for(var i in e.cullMode=t===ge.DIR_LIGHT_SHADOW_MAP_PASS||t===ge.POINT_LIGHT_SHADOW_MAP_PASS?ve.OPTIONS.shadowFilter.getCullMode():this._cullMode,e.writeDepth=this._writeDepth,e.writeColor=this._writeColor,ge.DIR_LIGHT_PASS<=t&&t<=ge.LIGHT_PROBE_PASS&&(e.blendState=this._additiveBlendState),t===ge.BASE_PASS&&(e.blendState=this._blendState),e.hasTexture("hx_normalDepthBuffer")&&(this.needsNormalDepth=!0),e.hasTexture("hx_backbuffer")&&(this.needsBackbuffer=!0),this._textures)if(this._textures.hasOwnProperty(i)){var n=this._textures[i];n instanceof Array?e.setTextureArray(i,n):e.setTexture(i,n)}for(var s in this._uniforms)this._uniforms.hasOwnProperty(s)&&("]"===s.charAt(s.length-1)?e.setUniformArray(s.substr(0,s.length-3),this._uniforms[s]):e.setUniform(s,this._uniforms[s]))}this.onChange.dispatch()},hasPass:function(t){return this._initialized||this.init(),!!this._passes[t]},setTexture:function(t,e){e?this._textures[t]=e:delete this._textures[t];for(var i=0;i<ge.NUM_PASS_TYPES;++i)this._passes[i]&&this._passes[i].setTexture(t,e)},setTextureArray:function(t,e){e?this._textures[t]=e:delete this._textures[t];for(var i=0;i<ge.NUM_PASS_TYPES;++i)this._passes[i]&&this._passes[i].setTextureArray(t,e)},setUniform:function(t,e,i){if(void 0===i&&(i=!0),i||!this._uniforms.hasOwnProperty(t)){this._uniforms[t]=e;for(var n=0;n<ge.NUM_PASS_TYPES;++n)this._passes[n]&&this._passes[n].setUniform(t,e)}},setUniformArray:function(t,e,i){if(void 0===i&&(i=!0),i||!this._uniforms.hasOwnProperty(t+"[0]")){this._uniforms[t+"[0]"]=e;for(var n=0;n<ge.NUM_PASS_TYPES;++n)this._passes[n]&&this._passes[n].setUniformArray(t,e)}},_setUseSkinning:function(t){this._useSkinning!==t&&this._invalidate(),this._useSkinning=t},_setUseMorphing:function(t,e){this._useSkinning===t&&this._useNormalMorphing===e||this._invalidate(),this._useMorphing=t,this._useNormalMorphing=e},_invalidate:function(){this._initialized=!1,this._passes=new Array($i.NUM_PASS_TYPES),this.onChange.dispatch()},toString:function(){return"[Material(name="+this.name+")]"}},tn.roughnessFromShininess=function(t){return Math.sqrt(2/(t+2))},tn.SPECULAR_MAP_ROUGHNESS_ONLY=1,tn.SPECULAR_MAP_ALL=2,tn.SPECULAR_MAP_SHARE_NORMAL_MAP=3,tn.SPECULAR_MAP_METALLIC_ROUGHNESS=4,(tn.prototype=Object.create($i.prototype,{doubleSided:{get:function(){return this._doubleSided},set:function(t){this._doubleSided!==t&&this._invalidate(),this._doubleSided=t,this.cullMode=t?Ye.NONE:Ye.BACK}},alpha:{get:function(){return this._alpha},set:function(t){this._alpha=at.saturate(t),this.setUniform("alpha",this._alpha)}},useVertexColors:{get:function(){return this._useVertexColors},set:function(t){this._useVertexColors!==t&&this._invalidate(),this._useVertexColors=t}},color:{get:function(){return this._color},set:function(t){this._color=isNaN(t)?t:new h(t),this.setUniform("color",this._color)}},colorMap:{get:function(){return this._colorMap},set:function(t){console.log(this.name,t),!!this._colorMap!=!!t&&this._invalidate(),this._colorMap=t,this.setTexture("colorMap",t)}},normalMap:{get:function(){return this._normalMap},set:function(t){!!this._normalMap!=!!t&&this._invalidate(),this.setTexture("normalMap",t),this._normalMap=t}},occlusionMap:{get:function(){return this._occlusionMap},set:function(t){!!this._occlusionMap!=!!t&&this._invalidate(),this.setTexture("occlusionMap",t),this._occlusionMap=t}},emissiveColor:{get:function(){return this._emissiveColor},set:function(t){this._emissiveColor=isNaN(t)?t:new h(t),this.setUniform("emissiveColor",this._emissiveColor)}},emissionMap:{get:function(){return this._emissionMap},set:function(t){!!this._emissionMap!=!!t&&this._invalidate(),this.setTexture("emissionMap",t),this._emissionMap=t}},specularMap:{get:function(){return this._specularMap},set:function(t){!!this._specularMap!=!!t&&this._invalidate(),this.setTexture("specularMap",t),this._specularMap=t}},maskMap:{get:function(){return this._maskMap},set:function(t){!!this._maskMap!=!!t&&this._invalidate(),this.setTexture("maskMap",t),this._maskMap=t}},specularMapMode:{get:function(){return this._specularMapMode},set:function(t){this._specularMapMode!==t&&this._invalidate(),this._specularMapMode=t}},metallicness:{get:function(){return this._metallicness},set:function(t){this._metallicness=at.saturate(t),this.setUniform("metallicness",this._metallicness)}},normalSpecularReflectance:{get:function(){return this._normalSpecularReflectance},set:function(t){this._normalSpecularReflectance=at.saturate(t),this.setUniform("normalSpecularReflectance",this._normalSpecularReflectance)}},roughness:{get:function(){return this._roughness},set:function(t){this._roughness=t,this.setUniform("roughness",this._roughness)}},roughnessRange:{get:function(){return this._roughnessRange},set:function(t){this._roughnessRange=t,this.setUniform("roughnessRange",2*this._roughnessRange)}},colorMapScale:{get:function(){return this._colorMapScale},set:function(t){this._handleTexProp("colorMap","Scale",t)}},colorMapOffset:{get:function(){return this._colorMapOffset},set:function(t){this._handleTexProp("colorMap","Offset",t)}},normalMapScale:{get:function(){return this._normalMapScale},set:function(t){this._handleTexProp("normalMap","Scale",t)}},normalMapOffset:{get:function(){return this._normalMapOffset},set:function(t){this._handleTexProp("normalMap","Offset",t)}},specularMapScale:{get:function(){return this._specularMapScale},set:function(t){this._handleTexProp("specularMap","Scale",t)}},specularMapOffset:{get:function(){return this._specularMapOffset},set:function(t){this._handleTexProp("specularMap","Offset",t)}},maskMapScale:{get:function(){return this._maskMapScale},set:function(t){this._handleTexProp("maskMap","Scale",t)}},maskMapOffset:{get:function(){return this._maskMapOffset},set:function(t){this._handleTexProp("maskMap","Offset",t)}},emissionMapScale:{get:function(){return this._emissionMapScale},set:function(t){this._handleTexProp("emissionMap","Scale",t)}},emissionMapOffset:{get:function(){return this._emissionMapOffset},set:function(t){this._handleTexProp("emissionMap","Offset",t)}},alphaThreshold:{get:function(){return this._alphaThreshold},set:function(t){t=at.saturate(t),1===this._alphaThreshold!=(1===t)&&this._invalidate(),this._alphaThreshold=t,this.setUniform("alphaThreshold",t)}}})).init=function(){var t=this._generateDefines();this._geometryVertexShader=d.get("default_geometry_vertex.glsl",t),this._geometryFragmentShader=d.get("default_geometry_fragment.glsl",t),$i.prototype.init.call(this)},tn.prototype._generateDefines=function(){var t={};switch(this._colorMap&&(t.COLOR_MAP=1),this._useVertexColors&&(t.VERTEX_COLORS=1),this._normalMap&&(t.NORMAL_MAP=1),this._occlusionMap&&(t.OCCLUSION_MAP=1),this._emissionMap&&(t.EMISSION_MAP=1),this._maskMap&&(t.MASK_MAP=1),this._alphaThreshold<1&&(t.ALPHA_THRESHOLD=1),this._specularMapMode){case tn.SPECULAR_MAP_ROUGHNESS_ONLY:this._specularMap&&(t.ROUGHNESS_MAP=1);break;case tn.SPECULAR_MAP_ALL:this._specularMap&&(t.SPECULAR_MAP=1);break;case tn.SPECULAR_MAP_METALLIC_ROUGHNESS:this._specularMap&&(t.METALLIC_ROUGHNESS_MAP=1);break;default:t.NORMAL_ROUGHNESS_MAP=1}return this._doubleSided&&(t.DOUBLE_SIDED=1),(this._colorMapOffset||this._colorMapScale)&&(t.COLOR_MAP_SCALE_OFFSET=1),(this._normalMapOffset||this._normalMapScale)&&(t.NORMAL_MAP_SCALE_OFFSET=1),(this._specularMapOffset||this._specularMapScale)&&(t.SPECULAR_MAP_SCALE_OFFSET=1),(this._maskMapOffset||this._maskMapScale)&&(t.MASK_MAP_SCALE_OFFSET=1),(this._emissionMapOffset||this._emissionMapScale)&&(t.EMISSION_MAP_SCALE_OFFSET=1),t},tn.prototype._handleTexProp=function(t,e,i){var n=t+e;!!this[e="_"+n]!=!!i&&this._invalidate(),(this[e]=i)&&this.setUniform(n,i)},en.prototype=Object.create(Ai.prototype),(nn.prototype=Object.create(ai.prototype))._generate=function(t,e){for(var i=(e=e||{}).numSegmentsW||16,n=e.numSegmentsH||10,s=e.radius||.5,r=e.invert?-1:1,o=void 0!==e.doubleSided&&e.doubleSided,a=t.positions,h=t.uvs,u=t.normals,l=1/i,c=1/n,_=0;_<=n;++_){var d=_*c,f=d*Math.PI,p=-Math.cos(f),g=Math.sin(f);r<0&&(d=1-d);for(var M=0;M<=i;++M){var A=M*l,m=A*Math.PI*2;r&&(A=1-A);var x=Math.cos(m)*g*r,T=p*r,y=Math.sin(m)*g*r;a.push(x*s,y*s,T*s),u&&u.push(x*r,y*r,T*r),h&&h.push(A,d)}}var N=t.indices;for(_=0;_<n;++_)for(M=0;M<i;++M){var D=i+1,E=M+_*D;N.push(E,E+D+1,E+D),N.push(E,E+1,E+D+1),o&&(N.push(E,E+D,E+D+1),N.push(E,E+D+1,E+1))}},nn.prototype._getBounds=function(){return new ki},Ti.create(sn),sn.prototype.onAdded=function(){var t=this.entity.skeleton;if(t){this._debugEntity=new Ri,this.entity.attach(this._debugEntity),this._entities=[];var e=new tn,i=new nn({radius:.15}),n=new hi({radius:.1,height:1,alignment:hi.ALIGN_Y});n.translate(0,.5,0),e.color=16711935,e.lightingModel=k.Unlit,e.renderOrder=1e5,e.getPass(ge.BASE_PASS).depthTest=Ge.ALWAYS;for(var s=0;s<t.joints.length;++s){var r=t.joints[s].parentIndex,o=new Ri,a=new Pi(-1===r?i:n,e);o.addComponent(a),this._entities[s]=o,this._debugEntity.attach(o)}}},sn.prototype.onRemoved=function(){this._debugEntity&&this.entity.detach(this._debugEntity)},sn.prototype.onUpdate=function(t){if(this._debugEntity)for(var e=this.entity.skeleton,i=e.joints,n=this.entity.skeletonPose,s=0,r=i.length;s<r;++s){var o=i[s],a=n.getGlobalMatrix(e,s),h=o.parentIndex,u=this._entities[s];if(a.getColumn(3,u.position),-1<h){parent=this._entities[h];var l=u.matrix,c=parent.position.distanceTo(u.position);l.lookAt(parent.position,u.position),l.prependScale(1,c,1),u.matrix=l}}},rn.prototype={get numEntities(){return this._entities.length},getEntity:function(t){return this._entities[t]},_containsComponentHash:function(t){this._hash.contains(t)},_add:function(t){this._entities.push(t),this.onEntityAdded.dispatch(t)},_remove:function(t){this.onEntityRemoved.dispatch(t);var e=this._entities.indexOf(t);this._entities.splice(e,1)},_increaseUsage:function(){++this._usageCount},free:function(){0==--this._usageCount&&this.onDisposed.dispatch(this)}},on.prototype={startSystem:function(t){if(0<=this._systems.indexOf(t))throw new Error("System already running!");this._systems.push(t),t._onStarted(this)},stopSystem:function(t){var e=this._systems.push(t);if(e<0)throw new Error("System not running!");this._systems.splice(e,1),t.onStopped()},getEntitySet:function(t){for(var e=new mi,i=t.length,n=0;n<i;++n)e.setBit(t[n].COMPONENT_ID);var s=e.toString(),r=this._entitySets[s];if(!r)for((r=new rn(e)).onDisposed.bind(this._onSetDisposed,this),this._entitySets[s]=r,i=this._entities.length,n=0;n<i;++n){var o=this._entities[n];o._componentHash.contains(e)&&r._add(o)}return r._increaseUsage(),r},registerEntity:function(e){this._entities.push(e),e._onComponentsChange.bind(this._onEntityComponentsChange,this),e._requiresUpdates&&this._addUpdatableEntity(e),_.forEach(this._entitySets,function(t){e._componentHash.contains(t._hash)&&t._add(e)})},unregisterEntity:function(e){var t=this._entities.indexOf(e);this._entities.splice(t),e._onComponentsChange.unbind(this),e._requiresUpdates&&this._removeUpdatableEntity(e),_.forEach(this._entitySets,function(t){e._componentHash.contains(t._hash)&&t._remove(e)})},_onEntityComponentsChange:function(n,s){n._requiresUpdates?this._addUpdatableEntity(n):this._removeUpdatableEntity(n),_.forEach(this._entitySets,function(t){var e=s.contains(t._hash),i=n._componentHash.contains(t._hash);!e&&i?t._add(n):e&&!i&&t._remove(n)})},_addUpdatableEntity:function(t){this._updateableEntities.indexOf(t)<0&&this._updateableEntities.push(t)},_removeUpdatableEntity:function(t){var e=this._updateableEntities.indexOf(t);0<=e&&this._updateableEntities.splice(e,1)},_update:function(t){for(var e=this._updateableEntities,i=e.length,n=0;n<i;++n)e[n].update(t);var s=this._systems;for(i=s.length,n=0;n<i;++n)s[n].onUpdate(t)},_onSetDisposed:function(t){delete this._entitySets[t._hash]}},an.prototype={acceptVisitor:function(t){for(var e=this._entities,i=0,n=e.length;i<n;++i){var s=e[i];t.qualifies(s)&&s.acceptVisitor(t)}},markEntityForUpdate:function(t){},registerEntity:function(t){this._entities.push(t)},unregisterEntity:function(t){var e=this._entities.indexOf(t);this._entities.splice(e,1)}};var hn=0;function un(t){this.name="hx_scene_"+hn++,this._entityEngine=new on,this._partitioning=new an,this._rootNode=t||new Ri,this._rootNode.name="Root",this.skybox=null,this._rootNode._setScene(this)}function ln(e){var i=null,n=null;this.getItem=function(){var t;return i?i=(t=i).next:((t=new e).next=n,n=t),t},this.reset=function(){i=n}}un.prototype={get rootNode(){return this._rootNode},findNodeByName:function(t){return this._rootNode.findNodeByName(t)},findMaterialByName:function(t){return this._rootNode.findMaterialByName(t)},attach:function(t){this._rootNode.attach(t)},detach:function(t){this._rootNode.detach(t)},destroy:function(){this._rootNode.destroy()},get numChildren(){return this._rootNode.numChildren},getChild:function(t){return this._rootNode.getChild(t)},contains:function(t){this._rootNode.contains(t)},acceptVisitor:function(t){t.visitScene(this),this._partitioning.acceptVisitor(t)},getEntitySet:function(t){return this._entityEngine.getEntitySet(t)},get entityEngine(){return this._entityEngine},get partitioning(){return this._partitioning},startSystem:function(t){(t.scene=this)._entityEngine.startSystem(t)},stopSystem:function(t){t.scene=null,this._entityEngine.stopSystem(t)},get worldBounds(){return this._rootNode.worldBounds},applyFunction:function(t){this._rootNode.applyFunction(t)}};var cn=new J;function _n(){this._proxyMatrix=null,this._proxyBounds=null,this._proxy=null,this._proxyStack=[],this._matrixStack=[],this._stackIndex=-1,this._matrixPool=new ln(Pt),this._proxyBoundsInvalid=!1}function dn(t){$i.call(this);var e=d.get("default_skybox_vertex.glsl"),i=d.get("default_skybox_fragment.glsl");this.writeDepth=!1,this.cullMode=Ye.NONE;var n=new ui(e,i);this.setPass(ge.BASE_PASS,n),this._renderPath=Ki.FORWARD_FIXED,this._initialized=!0,this._renderOrder=Number.POSITIVE_INFINITY,this.setTexture("hx_skybox",t)}function fn(t){ai.call(this,t)}function pn(t){Ri.call(this),t instanceof $i||(t=new dn(t));var e=new fn({width:1,invert:!0});e.bounds.clear(K.EXPANSE_INFINITE),e._boundsInvalid=!1,this._meshInstance=new Pi(e,t),this.addComponent(this._meshInstance)}function gn(){this.worldMatrix=null,this.proxyMatrix=new Pt,this.meshInstance=null,this.skeleton=null,this.skeletonMatrices=null,this.material=null,this.renderOrderHint=0,this.worldBounds=null,this.next=null}_n.prototype={reset:function(){this._matrixPool.reset()},qualifies:function(t){},visitLight:function(t){},visitAmbientLight:function(t){},visitMeshInstance:function(t){},visitScene:function(t){},visitEffect:function(t){},pushProxy:function(t){var e;this._proxyMatrix?(e=this._matrixPool.getItem(),Pt.multiply(this._proxyMatrix,t.worldMatrix,e),this._proxyBounds=cn,this._proxyBoundsInvalid=!0):(e=t.worldMatrix,this._proxyBounds=t.worldBounds,this._proxyBoundsInvalid=!1),this._proxy=t,this._proxyMatrix=e,this._matrixStack.push(e),this._proxyStack.push(t)},popProxy:function(){this._matrixStack.pop(),this._proxyStack.pop();var t=this._matrixStack.length;0===t?(this._proxy=null,this._proxyMatrix=null,this._proxyBounds=null):(this._proxyMatrix=this._matrixStack[t-1],this._proxy=this._proxyStack[t-1],1===t?(this._proxyBounds=this._proxy.worldBounds,this._proxyBoundsInvalid=!1):1<t&&(this._proxyBounds=cn,this._proxyBoundsInvalid=!0))},getProxiedBounds:function(t){return this._proxyMatrix?(this._proxyBoundsInvalid&&(this._proxyBounds.transformFrom(this._proxy.bounds,this._proxyMatrix),this._proxyBoundsInvalid=!1),this._proxyBounds):t.worldBounds},getProxiedMatrix:function(t){if(this._proxyMatrix){var e=this._matrixPool.getItem();return Pt.multiply(this._proxyMatrix,t.worldMatrix,e)}return t.worldMatrix}},dn.prototype=Object.create($i.prototype),(fn.prototype=Object.create(ai.prototype))._generate=function(t,e){var i,n,s,r,o,a,h,u,l=e.numSegmentsW||1,c=e.numSegmentsH||e.numSegmentsW||1,_=e.numSegmentsD||e.numSegmentsW||1,d=e.width||1,f=e.height||d,p=e.depth||d,g=e.invert?-1:1,M=void 0!==e.doubleSided&&e.doubleSided,A=1/l,m=1/c,x=1/_,T=.5*d,y=.5*f,N=.5*p,D=t.positions,E=t.uvs,w=t.normals,L=t.indices;for(h=0;h<=c;++h)for(n=f*(o=h*m)-y,g<0&&(o=1-o),a=0;a<=l;++a)i=d*(r=a*A)-T,g<0&&(r=1-r),D.push(i*g,N*g,n*g),D.push(-i*g,-N*g,n*g),w&&(w.push(0,1,0),w.push(0,-1,0)),E&&(E.push(r,o),E.push(r,o));for(h=0;h<=c;++h)for(n=f*(o=h*m)-y,u=0;u<=_;++u)s=p*(r=u*x)-N,D.push(-T,s*g,n),D.push(T,-s*g,n),w&&(w.push(-g,0,0),w.push(g,0,0)),E&&(E.push(r,o),E.push(r,o));for(u=0;u<=_;++u)for(s=p*(o=u*x)-N,a=0;a<=l;++a)i=d*(r=a*A)-T,D.push(i,-s*g,y),D.push(i,s*g,-y),w&&(w.push(0,0,g),w.push(0,0,-g)),E&&(E.push(1-r,1-o),E.push(1-r,1-o));for(var I=0,v=0;v<3;++v){for(var S=1===v?_:l,O=2===v?_:c,C=0;C<O;++C)for(var j=0;j<S;++j){var b=S+1,P=I+j+C*b,z=P<<1,R=P+b+1<<1,U=P+b<<1,B=P+1<<1;L.push(z,U,R),L.push(z,R,B),L.push(1|z,1|U,1|R),L.push(1|z,1|R,1|B)}I+=(S+1)*(O+1)}var F=0;if(M)for(;0<F;)L.push(L[0],L[2],L[1]),L.push(L[3],L[5],L[4]),F+=6},(pn.prototype=Object.create(Ri.prototype,{material:{get:function(){return this._meshInstance.material},set:function(t){this._meshInstance.material=t}}})).setTexture=function(t){this.material.setTexture("hx_skybox",t)},pn.prototype.copyFrom=function(t){Ri.prototype.copyFrom.call(this,t)},pn.prototype.clone=function(){var t=new pn(this._meshInstance.material);return t.copyFrom(this),t};var Mn,An=function(t,e){var i,n=t.material,s=e.material;return 0!==(i=n._renderOrder-s._renderOrder)?i:0!==(i=n._shaderRenderOrderHint-s._shaderRenderOrderHint)?i:0!==(i=n._renderOrderHint-s._renderOrderHint)?i:t.renderOrderHint-e.renderOrderHint},mn=function(t,e){var i=t.material._renderOrder-e.material._renderOrder;return 0!==i?i:e.renderOrderHint-t.renderOrderHint},xn=function(t,e){return t.shadowQualityBias-e.shadowQualityBias};function Tn(){_n.call(this),this._renderItemPool=new ln(gn),this._opaques=[],this._transparents=null,this._camera=null,this._cameraYAxis=new Z,this._frustumPlanes=null,this.shadowCasters=null,this.lights=null,this.effects=null,this.ambientColor=new h,this.needsNormalDepth=!1,this.needsBackbuffer=!1,this.numShadowPlanes=0,this.shadowPlaneBuckets=null}function yn(t,e,i,n,s,r){Ti.call(this),this._bounds=new J,this._bounds.clear(K.EXPANSE_INFINITE),this._terrainSize=t||512,this._minElevation=e,this._maxElevation=i,this._numLevels=n||4,this._container=new Ai,this._detail=r||32;var o=2*Math.ceil(.5*this._detail);this._snapSize=this._terrainSize/this._detail/Math.pow(2,this._numLevels),(this._material=s).setUniform("hx_elevationOffset",e),s.setUniform("hx_elevationScale",i-e),this._initMeshes(o),this._initTree()}function Nn(){Ri.call(this),this._node=null,this._Entity_acceptVisitor=Ri.prototype.acceptVisitor,this._Entity_updateBounds=Ri.prototype._updateBounds,this._growBounds=this._growBounds.bind(this)}function Dn(){this._entityEngine=null,this._sets=[],this.scene=null}function En(){Ti.call(this),this._subs=[]}function wn(t,e){this.time=t||0,this.value=e}Tn.MAX_SHADOW_QUALITY_BUCKETS=4,(Tn.prototype=Object.create(_n.prototype)).getOpaqueRenderList=function(t){return this._opaques[t]},Tn.prototype.getTransparentRenderList=function(){return this._transparents},Tn.prototype.collect=function(t,e){this.reset(),(this._camera=t).worldMatrix.getColumn(1,this._cameraYAxis),this._frustumPlanes=t.frustum.planes,this._reset(),e.acceptVisitor(this);for(var i=0;i<Ki.NUM_PATHS;++i)this._opaques[i].sort(An);this._transparents.sort(mn),this.shadowCasters.sort(xn),this._camera.acceptVisitorPost(this)},Tn.prototype.qualifies=function(t,e){return t.hierarchyVisible&&(e||t.worldBounds.intersectsConvexSolid(this._frustumPlanes,6))},Tn.prototype.visitScene=function(t){var e=t.skybox;e&&this.visitMeshInstance(e._meshInstance)},Tn.prototype.visitEffect=function(t){this.needsNormalDepth=this.needsNormalDepth||t.needsNormalDepth,this.effects.push(t)},Tn.prototype.visitMeshInstance=function(t){if(t.enabled){var e=t.entity,i=this.getProxiedBounds(e),n=this._cameraYAxis,s=n.x,r=n.y,o=n.z,a=t.skeleton,h=t.skeletonMatrices,u=this._renderItemPool,l=this._opaques,c=this._transparents,_=t.material,d=_.renderPath;this.needsNormalDepth=this.needsNormalDepth||_.needsNormalDepth,this.needsBackbuffer=this.needsBackbuffer||_.needsBackbuffer;var f=u.getItem();f.material=_,f.meshInstance=t,f.skeleton=a,f.skeletonMatrices=h;var p=i._center;f.renderOrderHint=p.x*s+p.y*r+p.z*o,f.worldMatrix=this.getProxiedMatrix(e),(_.blendState||_.needsBackbuffer?c:l[d]).push(f)}},Tn.prototype.visitAmbientLight=function(t){var e=t._scaledIrradiance;this.ambientColor.r+=e.r,this.ambientColor.g+=e.g,this.ambientColor.b+=e.b},Tn.prototype.visitLight=function(t){if(this.lights.push(t),t.castShadows){this.shadowCasters.push(t),this.numShadowPlanes+=t.numAtlasPlanes;var e=t.shadowQualityBias;this.shadowPlaneBuckets[e]+=t.numAtlasPlanes}},Tn.prototype._reset=function(){this._renderItemPool.reset();for(var t=0;t<Ki.NUM_PATHS;++t)this._opaques[t]=[];for(this._transparents=[],this.lights=[],this.shadowCasters=[],this.effects=[],this.needsNormalDepth=ve.OPTIONS.ambientOcclusion,this.ambientColor.set(0,0,0,1),this.numShadowPlanes=0,this.shadowPlaneBuckets=[],t=0;t<Tn.MAX_SHADOW_QUALITY_BUCKETS;++t)this.shadowPlaneBuckets[t]=0},Ti.create(yn,{terrainSize:{get:function(){return this._terrainSize}}}),yn.prototype.onAdded=function(){this.entity.attach(this._container)},yn.prototype.onRemoved=function(){this.entity.detach(this._container)},yn.prototype._createMesh=function(t,e,i,n){var s=1/e,r=new et,o=t*s,a=.5*o;r.addVertexAttribute("hx_position",3),r.addVertexAttribute("hx_normal",3),r.addVertexAttribute("hx_cellSize",1);for(var h=[],u=[],l=i?e-1:e,c=e+1,_=0;_<=l;++_)for(var d=(_*s-.5)*t,f=0;f<=e;++f){var p=(f*s-.5)*t,g=n||f!==e||_!==e?o:a;if(h.push(p,d,0,0,0,1,g),f!==e&&_!==l){var M=f+_*c;u.push(M,M+c+1,M+c),u.push(M,M+1,M+c+1)}}var A=h.length/7;if(i)for(d=(e*s-.5)*t,f=0;f<=e;++f)p=(f*s-.5)*t,h.push(p,d,0,0,0,1),h.push(a),f!==e&&(M=f+l*c,h.push(p+a,d,0,0,0,1,a),u.push(M,A+2*f+1,A+2*f),u.push(M+1,A+2*f+1,M),u.push(A+2*f+2,A+2*f+1,M+1));return r.setVertexData(h,0),r.setIndexData(u),r.dynamicBounds=!1,r.bounds.clear(),r.bounds.growToIncludeMinMax(new Z(-t,-t,this._minElevation),new Z(t,t,this._maxElevation)),r},yn.prototype._initMeshes=function(t){this._meshes=[];for(var e=.25*this._terrainSize,i=0;i<this._numLevels;++i){if(i===this._numLevels-1){var n=this._createMesh(e,t,!1,!0);this._meshes[i]={edge:n,corner:n}}else this._meshes[i]={edge:this._createMesh(e,t,!0,!1),corner:this._createMesh(e,t,!1,!1)};e*=.5}},yn.prototype._initTree=function(){for(var t=.25*this._terrainSize,e=0;e<4;++e)for(var i=this._terrainSize*(e/4-.5)+.5*t,n=0;n<4;++n){var s=this._terrainSize*(n/4-.5)+.5*t,r=0,o=0;if(1===n?r=1:2===n&&(r=-1),1===e?o=1:2===e&&(o=-1),r&&o)this._subDivide(s,i,r,o,1,.5*t);else{var a=0,h="edge";n%3==e%3?(h="corner",0===n&&0===e&&(a=0),0===n&&3===e&&(a=1),3===n&&3===e&&(a=2),3===n&&0===e&&(a=-1)):(3===e&&(a=2),3===n&&(a=-1),0===n&&(a=1)),this._addMesh(s,i,0,a,h)}}},yn.prototype._addMesh=function(t,e,i,n,s){var r=new Ri,o=new Pi(this._meshes[i][s],this._material);r.addComponent(o),r.position.set(t,e,0),r.rotation.fromAxisAngle(Z.Z_AXIS,-n*Math.PI*.5),this._container.attach(r)},yn.prototype._subDivide=function(t,e,i,n,s,r){r*=.5;for(var o=-1;o<=1;o+=2)for(var a=-1;a<=1;a+=2)if(a!==i||o!==n||s===this._numLevels-1){var h=0,u="corner";t<0&&e<0?a<0&&0<o?(u="edge",h=1):(0<a&&o<0&&(u="edge"),h=0):0<t&&0<e?0<a&&o<0?(u="edge",h=-1):(a<0&&0<o&&(u="edge"),h=2):t<0&&0<e?0<a&&0<o?(u="edge",h=2):(a<0&&o<0&&(u="edge"),h=1):0<t&&e<0&&(a<0&&o<0?(u="edge",h=0):(0<a&&0<o&&(u="edge"),h=-1)),this._addMesh(t+r*a,e+r*o,s,h,u)}s<this._numLevels-1&&this._subDivide(t+r*i,e+r*n,i,n,s+1,r)},yn.prototype.onUpdate=function(){if(this._camera){var t=this._camera.position,e=this._container.position,i=this.entity.position;e.x=Math.round(t.x/this._snapSize)*this._snapSize-i.x,e.y=Math.round(t.y/this._snapSize)*this._snapSize-i.y}},yn.prototype.acceptVisitor=function(t){t instanceof Tn&&(this._camera=t._camera)},yn.prototype.clone=function(){return new yn(this._terrainSize,this._minElevation,this._maxElevation,this._numLevels,this._material,this._detail)},(Nn.prototype=Object.create(Ri.prototype,{node:{get:function(){return this._node},set:function(t){this._node=t,this.invalidateBounds()}}})).acceptVisitor=function(t){this._Entity_acceptVisitor(t),t.pushProxy(this),this._traverse(this._node,t),t.popProxy()},Nn.prototype._traverse=function(t,e){if(t.acceptVisitor){if(!e.qualifies(t,!0))return;t.acceptVisitor(e,this.worldMatrix)}for(var i=0,n=t._children.length;i<n;++i){var s=t._children[i];this._traverse(s,e)}},Nn.prototype._updateBounds=function(){this._Entity_updateBounds(),this._node.applyFunction(this._growBounds)},Nn.prototype._growBounds=(Mn=new J,function(t){t.bounds&&(Mn.transformFrom(t.bounds,t.worldMatrix),this._bounds.growToIncludeBound(Mn))}),Dn.prototype={onStarted:function(){},onStopped:function(){},onUpdate:function(t){},getEntitySet:function(t){var e=this._entityEngine.getEntitySet(t);return this._sets.push(e),e},_onStarted:function(t){this._entityEngine=t,this.onStarted()},_onStopped:function(){for(var t=0;t<this._sets;++t)this._sets[t].free();this._sets=[]}},Ti.create(En),En.prototype.addComponent=function(t){if(t.entity)throw new Error("Component already added to an entity!");this._subs.push(t)},En.prototype.removeComponent=function(t){var e=this._subs.indexOf(t);0<=e&&this._subs.splice(e,1)},En.prototype.onAdded=function(){for(var t=0;t<this._subs.length;++t){var e=this._subs[t];e.entity=this.entity,e.onAdded()}},En.prototype.onRemoved=function(){for(var t=0;t<this._subs.length;++t){var e=this._subs[t];e.onRemoved(),e.entity=null}},En.prototype.onUpdate=function(t){for(var e=this._subs.length,i=0;i<e;++i){this._subs[i].onUpdate(t)}},En.prototype.clone=function(){for(var t=new En,e=0;e<this._subs.length;++e)t.addComponent(this._subs[e].clone());return t};var Ln=0;function In(){this.duration=0,this.name="hx_animationclip_"+Ln++,this.looping=!0,this._keyFrames=[],this._framesInvalid=!0}function vn(t){this.playbackRate=1,this.clip=t,this._time=0,this._isPlaying=!0,this._currentFrameIndex=0,this._timeChanged=!0,this.looping=t.looping,this.wraps=0,this.frame1=0,this.frame2=0,this.ratio=0}function Sn(){this._weights={},this._stateInvalid=!0,this._knownTargets=[],this.onChange=new r,this._sortMorphs=this._sortMorphs.bind(this)}In.prototype={get numKeyFrames(){return this._keyFrames.length},addKeyFrame:function(t){this._framesInvalid=!0,this._keyFrames.push(t),t.time>this.duration&&(this.duration=t.time)},_updateFrames:function(){this._keyFrames.sort(function(t,e){return t.time-e.time});var t=this._keyFrames[0],e=this._keyFrames[this._keyFrames.length-1];0<t.time&&this._keyFrames.unshift(new wn(0,t.value)),e.time<this.duration&&this._keyFrames.push(new wn(this.duration,e.value)),this._framesInvalid=!1},getKeyFrame:function(t){return this._framesInvalid&&this._updateFrames(),this._keyFrames[t]},toString:function(){return"[AnimationClip(name="+this.name+")"}},vn.prototype={get time(){return this._time},set time(t){this.looping||(t=at.clamp(t,0,this.clip.duration)),this._time!==t&&(this._time=t,this._timeChanged=!0)},play:function(){this._isPlaying=!0},stop:function(){this._isPlaying=!1},update:function(t){if(!(this._isPlaying&&0!==t)&&!this._timeChanged)return!1;this._timeChanged=!1,this._isPlaying&&(t*=this.playbackRate,this._time+=t);var e,i,n=this.clip,s=n.numKeyFrames,r=s-1,o=n.duration,a=0;if(this.looping||(this._time>o?(this._time=o,this._isPlaying=!1):this._time<0&&(this._time=0,this._isPlaying=!1)),0<=t){for(;this.looping&&this._time>=o;)this._currentFrameIndex=0,this._time-=o,++a;for(;++this._currentFrameIndex===s&&(this._currentFrameIndex=0),(i=n.getKeyFrame(this._currentFrameIndex)).time<this._time;);--this._currentFrameIndex,e=n.getKeyFrame(this._currentFrameIndex)}else{for(;this.looping&&this._time<0;)this._currentFrameIndex=r,this._time+=o,++a;for(++this._currentFrameIndex;--this._currentFrameIndex<0&&(this._currentFrameIndex=s),(e=n.getKeyFrame(this._currentFrameIndex)).time>this._time;);}return this.wraps=a,this.frame1=e,this.frame2=i,this.ratio=(this._time-e.time)/(i.time-e.time),!0}},Sn.prototype={getWeight:function(t){return this._weights[t]},getMorphTargetName:function(t){return this._knownTargets[t]},setWeight:function(t,e){var i=this._weights[t];i!==e&&(void 0===i&&this._knownTargets.push(t),this._stateInvalid=!0,this._weights[t]=e)},update:function(){if(this._stateInvalid){this._weights;this._knownTargets.sort(this._sortMorphs),this._stateInvalid=!1,this.onChange.dispatch()}},clone:function(){var t=new Sn;for(var e in this._weights)t.setWeight(e,this._weights[e]);return t},_sortMorphs:function(t,e){return this._weights[e.name]-this._weights[t.name]}};var On=0;function Cn(t){Ti.call(this),this.name="hx_morphanimation_"+On++,this._morphPose=t||new Sn}Ti.create(Cn,{morphPose:{get:function(){return this._morphPose},set:function(t){this._morphPose=t,this._assignMorphPose(t)}}}),Cn.prototype.setWeight=function(t,e){this._morphPose.setWeight(t,e)},Cn.prototype.onAdded=function(){this._assignMorphPose(this._morphPose)},Cn.prototype.onRemoved=function(){this._assignMorphPose(null)},Cn.prototype.onUpdate=function(t){this._morphPose.update()},Cn.prototype._assignMorphPose=function(t){for(var e=this.entity.getComponentsByType(Pi),i=0,n=e.length;i<n;++i)e[i].morphPose=t},Cn.prototype.clone=function(){var t=new Cn(this._morphPose.clone());return t.name=this.name,t};var jn=0;function bn(){Ti.call(this),this.name="hx_layeredanimation_"+jn++,this.playbackRate=1,this._layers=[],this._time=0,this._looping=!0}Ti.create(bn,{time:{get:function(){return this._time},set:function(t){this._time=t;for(var e=0;e<this._layers.length;++e)this._layers[e].time=t}},looping:{get:function(){return this._looping},set:function(t){this._looping=t;for(var e=0;e<this._layers.length;++e)this._layers[e].looping=!0}}}),bn.prototype.addLayer=function(t){this._layers.push(t),t.time=this._time,t.looping=this._looping},bn.prototype.removeLayer=function(t){var e=this._layers.indexOf(t);0<=e&&this._layers.splice(e,1)},bn.prototype.onAdded=function(){for(var t=this._collectPotentialTargets(),e=0,i=this._layers.length;e<i;++e)this._layers[e].resolveTarget(t)},bn.prototype.onRemoved=function(){for(var t=0,e=this._layers.length;t<e;++t)this._layers[t].resolveTarget(null)},bn.prototype.onUpdate=function(t){t*=this.playbackRate,this._time+=t;for(var e=this._layers.length,i=0;i<e;++i)this._layers[i].update(t)},bn.prototype.clone=function(){var t=new bn;t.name=this.name,t.looping=this.looping,t.playbackRate=this.playbackRate,t.time=this.time;for(var e=0,i=this._layers.length;e<i;++e){var n=this._layers[e];t.addLayer(n.clone())}return t},bn.prototype._collectPotentialTargets=function(){var r={};return this.entity.applyFunction(function(t){if((r[t.name]=t)instanceof Ri){for(var e=t.getComponentsByType(Pi),i=0,n=e.length;i<n;++i)r[e[i].name]=e[i],this._collectPotentialJoints(e[i],r);var s=t.getComponentsByType(Cn);for(i=0,n=s.length;i<n;++i)r[s[i].name]=s[i]}}.bind(this)),r},bn.prototype._collectPotentialJoints=function(t,e){var i=t.skeleton;if(i){for(var n=i.joints,s=0,r=n.length;s<r;++s)e[n[s].name]=t.skeletonPose.getJointPose(s);return!1}};var Pn=0;function zn(t,e,i){this.name="hx_animationlayer_"+Pn++,this._clip=i,this._playhead=new vn(i),this._targetName=t,this._targetObject=null,this._propertyName=e}function Rn(t,e,i){zn.call(this,t,e,i)}function Un(t,e,i){zn.call(this,t,e,i)}function Bn(t,e,i){zn.call(this,t,e,i)}function Fn(){this.name="",this.applyInverseBindPose=!0,this.joints=[]}function kn(){this.numJoints=-1,this.name=null,this.rootJointDeltaPosition=new Z,this.pose=new pi}function Yn(t){kn.call(this),this._playhead=new vn(t),this._rootPosition=new Z,this.name=t.name,this.numJoints=t.getKeyFrame(0).value._jointPoses.length;var e=t.getKeyFrame(t.numKeyFrames-1).value._jointPoses[0].position,i=t.getKeyFrame(0).value._jointPoses[0].position;this._clipRootDelta=Z.subtract(e,i)}function Qn(t){this.transferRootJoint=!1,this.rootNode=t}function Gn(t){Ti.call(this),t instanceof In&&(t=new Yn(t)),this._blendTree=new Qn(t)}function Xn(){kn.call(this),this.numJoints=0,this._value=0,this._child1=null,this._child2=null,this.minValue=0,this.maxValue=1,this._t=0,this._valueChanged=!1}function Vn(t){kn.call(this),this.skeleton=t,this._poseInvalid=!0,this.pose.copyBindPose(t),this._poseLookUp={};for(var e=t.joints,i=0,n=e.length;i<n;++i){var s=e[i];this._poseLookUp[s.name]=this.pose._jointPoses[i]}this.numJoints=e.length}zn.prototype={get looping(){return this._playhead.looping},set looping(t){this._playhead.looping=t},get time(){return this._playhead.time},set time(t){this._playhead.time=t},get duration(){return this._clip.duration},getKeyFrame:function(t){return this._clip.getKeyFrame(t)},update:function(t){},resolveTarget:function(t){null!==t?(this._targetObject=t[this._targetName],this._targetObject||console.warn("Animation target '"+this._targetName+"' not found"),this._verifyTarget()):this._targetObject=null},_verifyTarget:function(){},toString:function(){return"[AnimationLayer(name="+this.name+")"},clone:function(){throw new Error("Abstract method called!")}},(Rn.prototype=Object.create(zn.prototype))._verifyTarget=function(){l.assert(this._targetObject[this._propertyName]instanceof Z,"Type mismatch!"),this._skeletonPose=this._targetObject instanceof fi?this._targetObject.skeletonPose:null},Rn.prototype.update=function(t){var e=this._playhead;e.update(t)&&(this._targetObject[this._propertyName].lerp(e.frame1.value,e.frame2.value,e.ratio),this._skeletonPose&&this._skeletonPose.invalidateGlobalPose())},Rn.prototype.clone=function(){return new Rn(this._targetName,this._propertyName,this._clip)},(Un.prototype=Object.create(zn.prototype))._verifyTarget=function(){l.assert(this._targetObject[this._propertyName]instanceof Ct,"Type mismatch!"),this._skeletonPose=this._targetObject instanceof fi?this._targetObject.skeletonPose:null},Un.prototype.update=function(t){var e=this._playhead;e.update(t)&&(this._targetObject[this._propertyName].slerp(e.frame1.value,e.frame2.value,e.ratio),this._skeletonPose&&this._skeletonPose.invalidateGlobalPose())},Un.prototype.clone=function(){return new Un(this._targetName,this._propertyName,this._clip)},(Bn.prototype=Object.create(zn.prototype))._verifyTarget=function(){this._targetObject instanceof Pi?this._targetObject=this._targetObject.morphPose:l.assert(this._targetObject instanceof Cn,"Type mismatch!")},Bn.prototype.update=function(t){var e=this._playhead;if(e.update(t)){var i=at.lerp(e.frame1.value,e.frame2.value,e.ratio);this._targetObject.setWeight(this._propertyName,i)}},Bn.prototype.clone=function(){return new Bn(this._targetName,this._propertyName,this._clip)},Fn.prototype={toString:function(){return"[Skeleton(name="+this.name+")"}},kn.prototype={findNode:function(t){return this.name===t?this:this._queryChildren(t)},update:function(t,e){},_queryChildren:function(t){throw new Error("Abstract method called!")}},(Yn.prototype=Object.create(kn.prototype,{looping:{get:function(){return this._playhead.looping},set:function(t){this._playhead.looping=t}},duration:{get:function(){return this._playhead.clip.duration}},playbackRate:{get:function(){return this._playhead.playbackRate},set:function(t){this._playhead.playbackRate=t}},time:{get:function(){return this._playhead.time},set:function(t){this._playhead.time=t}}})).play=function(){this._playhead.play()},Yn.prototype.stop=function(){this._playhead.stop()},Yn.prototype.update=function(t,e){if(!this._playhead.update(t))return!1;var i=this._playhead;return this.pose.interpolate(i.frame1.value,i.frame2.value,i.ratio),e&&this._transferRootJointTransform(i.wraps,t),!0},Yn.prototype._transferRootJointTransform=function(t,e){var i=this.pose._jointPoses[0].position,n=this._rootPosition,s=this.rootJointDeltaPosition;Z.subtract(i,n,s),0<e&&0<t?s.addScaled(this._clipRootDelta,t):e<0&&0<t&&s.addScaled(this._clipRootDelta,-t),this._rootPosition.copyFrom(i),i.set(0,0,0)},Yn.prototype._queryChildren=function(t){return null},Qn.prototype={get targetSkeletonPose(){return this.rootNode.pose},set targetSkeletonPose(t){this.rootNode.pose=t},get rootJointDeltaPosition(){return this.rootNode.rootJointDeltaPosition},update:function(t){var e=this.rootNode.update(t,this.transferRootJoint);return e&&this.rootNode.pose.invalidateGlobalPose(),e},getNode:function(t){return this.rootNode.findNode(t)}},Ti.create(Gn,{transferRootJoint:{get:function(){return this._blendTree.transferRootJoint},set:function(t){this._blendTree.transferRootJoint=t}},applyInverseBindPose:{get:function(){return this._blendTree.applyInverseBindPose},set:function(t){this._blendTree.applyInverseBindPose=t}},animationNode:{get:function(){return this._blendTree.rootNode},set:function(t){this._blendTree.rootNode=t}}}),Gn.prototype.onAdded=function(){this._blendTree.targetSkeletonPose=this.entity.skeletonPose},Gn.prototype.onUpdate=function(t){if(this._blendTree.update(t)){var e=this.entity.matrix,i=this._blendTree.rootJointDeltaPosition;e.prependTranslation(i),this.entity.matrix=e}},Gn.prototype.getNode=function(t){return this._blendTree.getNode(t)},Gn.prototype.clone=function(){var t=new Gn(this._blendTree.rootNode);return t.transferRootJoint=this.transferRootJoint,t.applyInverseBindPose=this.applyInverseBindPose,t},(Xn.prototype=Object.create(kn.prototype,{value:{get:function(){return this._value},set:function(t){t=at.clamp(t,this.minValue,this.maxValue),this._value!==t&&(this._valueChanged=!0),this._value=t,this._t=(this._value-this.minValue)/(this.maxValue-this.minValue)}},child1:{get:function(){return this._child1},set:function(t){if(this._child1=t,this._child2&&t.numJoints!==this._child2.numJoints)throw new Error("Incompatible child nodes (numJoints mismatch)!");this.numJoints=t.numJoints}},child2:{get:function(){return this._child2},set:function(t){if(this._child2=t,this._child1&&t.numJoints!==this._child1.numJoints)throw new Error("Incompatible child nodes (numJoints mismatch)!")}}})).update=function(t,e){var i=this._child1.update(t,e);i=(i=this._child2.update(t,e)||i)||this._valueChanged;var n=this._t;return i&&(.999<n?this.pose.copyFrom(this._child1.pose):n<.001?this.pose.copyFrom(this._child2.pose):this.pose.interpolate(this._child1.pose,this._child2.pose,this._t),this._valueChanged=!1),i},Xn.prototype._queryChildren=function(t){return this._child1.findNode(t)||this._child2.findNode(t)},(Vn.prototype=Object.create(kn.prototype)).update=function(t){var e=this._poseInvalid;return this._poseInvalid=!1,e},Vn.prototype.setJointRotation=function(t,e){this._getJointPose(t).rotation.copyFrom(e),this._poseInvalid=!0},Vn.prototype.setJointTranslation=function(t,e){this._getJointPose(t).position.copyFrom(e),this._poseInvalid=!0},Vn.prototype.setJointScale=function(t,e){this._getJointPose(t).scale.copyFrom(e),this._poseInvalid=!0},Vn.prototype._getJointPose=function(t){return t instanceof String?this._poseLookUp[t]:this.pose._jointPoses[t]},Vn.prototype._queryChildren=function(t){return null};var Hn=0;function Wn(){this.name="hx_joint_"+Hn++,this.parentIndex=-1,this.inverseBindPose=new Pt}function Zn(){kn.call(this),this.numJoints=0,this._children=[],this._clips={}}function Kn(t,e){this.buffer=t||null,this.looping=e||!1}Wn.prototype={toString:function(){return"[SkeletonJoint]"}},(Zn.prototype=Object.create(kn.prototype)).addClip=function(t){this._clips[t.name]=t},Zn.prototype.getClip=function(t){return this._clips[t]},Zn.prototype.fadeTo=function(t,e,i,n){var s=new Yn(this._clips[t]);void 0!==n&&(s.looping=n),0===e&&!1===s.looping&&(this._children=[]),this.numJoints=s.numJoints,this._children.unshift({node:s,weight:0===e?1:0,fadeSpeed:0===e?1e4:1/e,sync:i})},Zn.prototype.update=function(t,e){var i=this._children.length,n=0,s=0,r=void 0;for(c=0;c<i;++c){var o=this._children[c],a=o.node;o.sync&&(n+=(r=o).node.duration*o.weight,s+=o.weight)}if(0!==s&&(n/=s),r)var h=r.duration/n,u=(r.time+t*h)/r.duration;for(var l=1<i&&0<t,c=0;c<i;++c){a=(o=this._children[c]).node,o.sync?(a.time=a.duration*u,l=a.update(0,e)||l):l=a.update(t,e)||l;var _=o.weight+t*o.fadeSpeed;if(!1===a.looping){1<_&&(_=1);var d=(a.duration-a.time)*o.fadeSpeed;d<=1&&(_*=d,d<.001&&1!==i&&(--i,this._children.splice(c--,1)))}else if(.999<_){o.weight=1,this._children.splice(c+1);break}o.weight=_}if(!l)return!1;var f=this._children.length-1;a=this._children[f].node;var p=this.rootJointDeltaPosition,g=this.pose;for(g.copyFrom(a.pose),e&&p.copyFrom(a.rootJointDeltaPosition),c=f-1;0<=c;--c)a=(o=this._children[c]).node,e&&p.lerp(p,a.rootJointDeltaPosition,o.weight),g.interpolate(g,a.pose,o.weight);return!0},Yn.prototype._queryChildren=function(t){return null},Kn.prototype={};function qn(t){Ti.call(this),this.name="",this.autoplay=!1,this.clip=t,this._source=null,this._gain=ve.AUDIO_CONTEXT.createGain(),this._panner=ve.AUDIO_CONTEXT.createPanner(),this._panner.connect(this._gain)}qn.PLAY_MESSAGE="hx_audioPlay",qn.STOP_MESSAGE="hx_audioStop",Ti.create(qn,{gain:{get:function(){return this._gain.gain.value},set:function(t){this._gain.gain.value=t}},coneInnerAngle:{get:function(){return this._coneInnerAngle},set:function(t){this._coneInnerAngle=t,this._panner.coneInnerAngle=t*at.RAD_TO_DEG}},coneOuterAngle:{get:function(){return this._coneOuterAngle},set:function(t){this._coneOuterAngle=t,this._panner.coneOuterAngle=t*at.RAD_TO_DEG}},coneOuterGain:{get:function(){return this._panner.coneOuterGain},set:function(t){this._panner.coneOuterGain=t}},distanceModel:{get:function(){return this._panner.distanceModel},set:function(t){this._panner.distanceModel=t}},maxDistance:{get:function(){return this._panner.maxDistance},set:function(t){this._panner.maxDistance=t}},panningModel:{get:function(){return this._panner.panningModel},set:function(t){this._panner.panningModel=t}},refDistance:{get:function(){return this._panner.refDistance},set:function(t){this._panner.refDistance=t}},rolloffFactor:{get:function(){return this._panner.rolloffFactor},set:function(t){this._panner.rolloffFactor=t}}}),qn.prototype.onAdded=function(){this._gain.connect(ve.AUDIO_CONTEXT.destination),this.autoplay&&this.play(),this.bindListener(qn.PLAY_MESSAGE,this._onPlayMessage,this),this.bindListener(qn.STOP_MESSAGE,this._onStopMessage,this)},qn.prototype.onRemoved=function(){this.unbindListener(qn.PLAY_MESSAGE,this._onPlayMessage),this.unbindListener(qn.STOP_MESSAGE,this._onStopMessage),this.stop()},qn.prototype.play=function(t){var e=this.entity.worldMatrix._m,i=this._panner;i.positionX?(i.positionX.value=e[12],i.positionY.value=e[13],i.positionZ.value=e[14],i.orientationX.value=e[4],i.orientationY.value=e[5],i.orientationZ.value=e[6]):(i.setPosition(e[12],e[13],e[14]),i.setOrientation(e[4],e[5],e[6])),void 0!==t&&(this._gain.gain.value=t),this._source=ve.AUDIO_CONTEXT.createBufferSource(),this._source.buffer=this.clip.buffer,this._source.loop=this.clip.looping,this._source.connect(this._panner),this._source.start()},qn.prototype.stop=function(){this._source&&(this._source.stop(),this._source.disconnect(),this._source=null,this._gain.disconnect())},qn.prototype.clone=function(){var t=new qn(this.clip);return t.name=this.name,t},qn.prototype.onUpdate=function(t){if(this._source&&this._source.isPlaying){var e=ve.AUDIO_CONTEXT.currentTime,i=this.entity.worldMatrix._m,n=this._panner;n.positionX?(n.positionX.setValueAtTime(i[12],e),n.positionY.setValueAtTime(i[13],e),n.positionZ.setValueAtTime(i[14],e),n.orientationX.setValueAtTime(i[4],e),n.orientationY.setValueAtTime(i[5],e),n.orientationZ.setValueAtTime(i[6],e)):(n.setPosition(i[12],i[13],i[14]),n.setOrientation(i[4],i[5],i[6]))}},qn.prototype._onPlayMessage=function(t,e,i){e===this.name&&this.play(i)},qn.prototype._onStopMessage=function(t,e){e===this.name&&this.stop()};var Jn,$n,ts,es,is=null;function ns(){Ti.call(this)}function ss(){this.planes=new Array(6),this.corners=new Array(8);for(var t=0;t<6;++t)this.planes[t]=new Z;for(t=0;t<8;++t)this.corners[t]=new Z}function rs(){Ri.call(this),this._renderTargetWidth=0,this._renderTargetHeight=0,this._viewProjectionMatrixInvalid=!0,this._viewProjectionMatrix=new Pt,this._inverseProjectionMatrix=new Pt,this._inverseViewProjectionMatrix=new Pt,this._projectionMatrix=new Pt,this._viewMatrix=new Pt,this._projectionMatrixDirty=!0,this._clusterPlanesDirty=!0,this._nearDistance=.1,this._farDistance=1e3,this._frustum=new ss,this._Entity_invalidateWorldMatrix=Ri.prototype._invalidateWorldMatrix,this.position.set(0,-1,0)}function os(){rs.call(this),this._vFOV=1.047198,this._aspectRatio=1}function as(){rs.call(this),this._height=10,this._aspectRatio=1}function hs(){rs.call(this),this._left=-1,this._right=1,this._top=1,this._bottom=-1}Ti.create(ns),ns.prototype.onAdded=function(){console.assert(!is,"Can only have one active AudioListener!"),is=ve.AUDIO_CONTEXT.listener},ns.prototype.onRemoved=function(){is.positionX?(is.positionX.value=0,is.positionY.value=0,is.positionZ.value=0,is.forwardX.value=0,is.forwardY.value=0,is.forwardZ.value=1,is.upX.value=0,is.upY.value=1,is.upZ.value=0):(is.setPosition(0,0,0),is.setOrientation(0,0,1,0,1,0)),is=null},ns.prototype.onUpdate=function(){var t,e=ve.AUDIO_CONTEXT.currentTime,i=this.entity;i.worldMatrixLeft?((t=(Jn=Pt.add(i.worldMatrixLeft,i.worldMatrixRight,Jn))._m)[12]*=.5,t[13]*=.5,t[14]*=.5):t=i.worldMatrix._m;var n=t[12];n==n&&(is.positionX?(is.positionX.setValueAtTime(n,e),is.positionY.setValueAtTime(t[13],e),is.positionZ.setValueAtTime(t[14],e),is.forwardX.setValueAtTime(t[4],e),is.forwardY.setValueAtTime(t[5],e),is.forwardZ.setValueAtTime(t[6],e),is.upX.setValueAtTime(t[8],e),is.upY.setValueAtTime(t[9],e),is.upZ.setValueAtTime(t[10],e)):(is.setPosition(n,t[13],t[14]),is.setOrientation(t[4],t[5],t[6],t[8],t[9],t[10])))},ss.PLANE_LEFT=0,ss.PLANE_RIGHT=1,ss.PLANE_BOTTOM=2,ss.PLANE_TOP=3,ss.PLANE_NEAR=4,ss.PLANE_FAR=5,ss.CLIP_SPACE_CORNERS=[new Z(-1,-1,-1,1),new Z(1,-1,-1,1),new Z(1,1,-1,1),new Z(-1,1,-1,1),new Z(-1,-1,1,1),new Z(1,-1,1,1),new Z(1,1,1,1),new Z(-1,1,1,1)],ss.prototype={update:function(t,e){this._updatePlanes(t),this._updateCorners(e)},_updatePlanes:function(t){var e=t._m,i=this.planes,n=i[ss.PLANE_LEFT],s=i[ss.PLANE_RIGHT],r=i[ss.PLANE_TOP],o=i[ss.PLANE_BOTTOM],a=i[ss.PLANE_NEAR],h=i[ss.PLANE_FAR],u=e[0],l=e[4],c=e[8],_=e[12],d=e[1],f=e[5],p=e[9],g=e[13],M=e[2],A=e[6],m=e[10],x=e[14],T=e[3],y=e[7],N=e[11],D=e[15];n.x=-(T+u),n.y=-(y+l),n.z=-(N+c),n.w=-(D+_),n.normalizeAsPlane(),s.x=u-T,s.y=l-y,s.z=c-N,s.w=_-D,s.normalizeAsPlane(),o.x=-(T+d),o.y=-(y+f),o.z=-(N+p),o.w=-(D+g),o.normalizeAsPlane(),r.x=d-T,r.y=f-y,r.z=p-N,r.w=g-D,r.normalizeAsPlane(),a.x=-(T+M),a.y=-(y+A),a.z=-(N+m),a.w=-(D+x),a.normalizeAsPlane(),h.x=M-T,h.y=A-y,h.z=m-N,h.w=x-D,h.normalizeAsPlane()},_updateCorners:function(t){for(var e=this.corners,i=0;i<8;++i){var n=e[i];t.transform(ss.CLIP_SPACE_CORNERS[i],n),n.scale(1/n.w)}}},(rs.prototype=Object.create(Ri.prototype,{nearDistance:{get:function(){return this._nearDistance},set:function(t){this._nearDistance!==t&&(this._nearDistance=t,this._invalidateProjectionMatrix())}},farDistance:{get:function(){return this._farDistance},set:function(t){this._farDistance!==t&&(this._farDistance=t,this._invalidateProjectionMatrix())}},clusterPlanesW:{get:function(){return this._viewProjectionMatrixInvalid&&this._updateViewProjectionMatrix(),this._clusterPlanesDirty&&this._updateClusterPlanes(),this._clusterPlanesW}},clusterPlanesH:{get:function(){return this._projectionMatrixDirty&&this._updateProjectionMatrix(),this._clusterPlanesDirty&&this._updateClusterPlanes(),this._clusterPlanesH}},viewProjectionMatrix:{get:function(){return this._viewProjectionMatrixInvalid&&this._updateViewProjectionMatrix(),this._viewProjectionMatrix}},viewMatrix:{get:function(){return this._viewProjectionMatrixInvalid&&this._updateViewProjectionMatrix(),this._viewMatrix}},projectionMatrix:{get:function(){return this._projectionMatrixDirty&&this._updateProjectionMatrix(),this._projectionMatrix}},inverseViewProjectionMatrix:{get:function(){return this._viewProjectionMatrixInvalid&&this._updateViewProjectionMatrix(),this._inverseViewProjectionMatrix}},inverseProjectionMatrix:{get:function(){return this._projectionMatrixDirty&&this._updateProjectionMatrix(),this._inverseProjectionMatrix}},frustum:{get:function(){return this._viewProjectionMatrixInvalid&&this._updateViewProjectionMatrix(),this._frustum}}})).getRay=function(t,e){var i=new ri,n=i.direction;return n.set(t,e,1,1),this.inverseProjectionMatrix.transform(n,n),n.homogeneousProject(),this.worldMatrix.transformVector(n,n),n.normalize(),this.worldMatrix.getColumn(3,i.origin),i},rs.prototype._setRenderTargetResolution=function(t,e){this._renderTargetWidth=t,this._renderTargetHeight=e},rs.prototype._invalidateViewProjectionMatrix=function(){this._viewProjectionMatrixInvalid=!0},rs.prototype._invalidateWorldMatrix=function(){this._Entity_invalidateWorldMatrix(),this._invalidateViewProjectionMatrix()},rs.prototype._updateViewProjectionMatrix=function(){this._viewMatrix.inverseAffineOf(this.worldMatrix),this._viewProjectionMatrix.multiply(this.projectionMatrix,this._viewMatrix),this._inverseProjectionMatrix.inverseOf(this._projectionMatrix),this._inverseViewProjectionMatrix.inverseOf(this._viewProjectionMatrix),this._frustum.update(this._viewProjectionMatrix,this._inverseViewProjectionMatrix),this._viewProjectionMatrixInvalid=!1},rs.prototype._invalidateProjectionMatrix=function(){this._projectionMatrixDirty=!0,this._clusterPlanesDirty=!0,this._invalidateViewProjectionMatrix()},rs.prototype._updateProjectionMatrix=function(){throw new Error("Abstract method!")},rs.prototype._updateBounds=function(){this._bounds.clear(K.EXPANSE_INFINITE)},rs.prototype.toString=function(){return"[Camera(name="+this.name+")]"},rs.prototype._initClusterPlanes=function(){this._clusterPlanesW=[],this._clusterPlanesH=[];for(var t=0;t<=ve.OPTIONS.numLightingCellsX;++t)this._clusterPlanesW[t]=new Z;for(t=0;t<=ve.OPTIONS.numLightingCellsY;++t)this._clusterPlanesH[t]=new Z},rs.prototype._updateClusterPlanes=($n=new Z,ts=new Z,es=new Z,function(){if(this._clusterPlanesDirty){var t=2/ve.OPTIONS.numLightingCellsX,e=2/ve.OPTIONS.numLightingCellsY;this._clusterPlanesW||this._initClusterPlanes();for(var i=this._inverseProjectionMatrix,n=-1,s=0;s<=ve.OPTIONS.numLightingCellsX;++s)$n.set(n,0,0,1),ts.set(n,0,1,1),es.set(n,1,0,1),i.projectPoint($n,$n),i.projectPoint(ts,ts),i.projectPoint(es,es),this._clusterPlanesW[s].planeFromPoints($n,ts,es),n+=t;var r=-1;for(s=0;s<=ve.OPTIONS.numLightingCellsY;++s)this._clusterPlanesH[s],$n.set(0,r,0,1),ts.set(1,r,0,1),es.set(0,r,1,1),i.projectPoint($n,$n),i.projectPoint(ts,ts),i.projectPoint(es,es),this._clusterPlanesH[s].planeFromPoints($n,ts,es),r+=e;this._clusterPlanesDirty=!1}}),rs.prototype.copyFrom=function(t){Ri.prototype.copyFrom.call(this,t),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance},rs.prototype.acceptVisitorPost=Ri.prototype.acceptVisitor,rs.prototype.acceptVisitor=function(t){},(os.prototype=Object.create(rs.prototype,{verticalFOV:{get:function(){return this._vFOV},set:function(t){this._vFOV!==t&&(this._vFOV=t,this._invalidateProjectionMatrix())}}}))._setAspectRatio=function(t){this._aspectRatio!==t&&(this._aspectRatio=t,this._invalidateProjectionMatrix())},os.prototype._setRenderTargetResolution=function(t,e){rs.prototype._setRenderTargetResolution.call(this,t,e),this._setAspectRatio(t/e)},os.prototype._updateProjectionMatrix=function(){this._projectionMatrix.fromPerspectiveProjection(this._vFOV,this._aspectRatio,this._nearDistance,this._farDistance),this._projectionMatrixDirty=!1},os.prototype.copyFrom=function(t){rs.prototype.copyFrom.call(this,t),this.verticalFOV=t.verticalFOV},os.prototype.clone=function(){var t=new os;return t.copyFrom(this),t},(as.prototype=Object.create(rs.prototype,{height:{get:function(){return this._height},set:function(t){this._height!==t&&(this._height=t,this._invalidateProjectionMatrix())}}}))._setAspectRatio=function(t){this._aspectRatio!==t&&(this._aspectRatio=t,this._invalidateProjectionMatrix())},as.prototype._setRenderTargetResolution=function(t,e){rs.prototype._setRenderTargetResolution.call(this,t,e),this._setAspectRatio(t/e)},as.prototype._updateProjectionMatrix=function(){this._projectionMatrix.fromOrthographicProjection(this._height*this._aspectRatio,this._height,this._nearDistance,this._farDistance),this._projectionMatrixDirty=!1},as.prototype.copyFrom=function(t){rs.prototype.copyFrom.call(this,t),this.height=t.height},as.prototype.clone=function(){var t=new as;return t.copyFrom(this),t},(hs.prototype=Object.create(rs.prototype)).setBounds=function(t,e,i,n){this._left=t,this._right=e,this._top=i,this._bottom=n,this._invalidateProjectionMatrix()},hs.prototype._updateProjectionMatrix=function(){this._projectionMatrix.fromOrthographicOffCenterProjection(this._left,this._right,this._top,this._bottom,this._nearDistance,this._farDistance),this._projectionMatrixDirty=!1},hs.prototype.copyFrom=function(t){rs.prototype.copyFrom.call(this,t),this.setBounds(t._left,t._right,t._top,t._bottom)},hs.prototype.clone=function(){var t=new hs;return t.copyFrom(this),t};var us=new Pt([1,0,0,0,0,0,-1,0,0,1,0,0,0,0,0,1]);function ls(){rs.call(this),this._projectionMatrixDirty=!1}function cs(){ls.call(this),this._cameraLeft=new ls,this._cameraRight=new ls,this.attach(this._cameraLeft),this.attach(this._cameraRight),this._frameData=new VRFrameData}(ls.prototype=Object.create(rs.prototype))._updateProjectionMatrix=function(){},ls.prototype._invalidateProjectionMatrix=function(){},ls.prototype.updateMatrices=function(t,e){this._viewMatrix.set(t),this._viewMatrix.prepend(us),this._projectionMatrix.set(e),this._projectionMatrixDirty=!1,this._matrix.inverseAffineOf(this._viewMatrix)&&this._applyMatrix()},(cs.prototype=Object.create(ls.prototype,{worldMatrixLeft:{get:function(){return this._cameraLeft.worldMatrix}},worldMatrixRight:{get:function(){return this._cameraRight.worldMatrix}}}))._updateVR=function(){ve.VR_DISPLAY.getFrameData(this._frameData),this._cameraLeft.updateMatrices(this._frameData.leftViewMatrix,this._frameData.leftProjectionMatrix,this.useRoomScale),this._cameraRight.updateMatrices(this._frameData.rightViewMatrix,this._frameData.rightProjectionMatrix,this.useRoomScale);var t=this._cameraLeft.frustum,e=this._cameraRight.frustum,i=this._frustum.planes,n=this._frustum.corners,s=t.planes,r=e.planes,o=t.corners,a=e.corners;i[ss.PLANE_LEFT]=s[ss.PLANE_LEFT],i[ss.PLANE_RIGHT]=r[ss.PLANE_RIGHT],i[ss.PLANE_TOP]=s[ss.PLANE_TOP],i[ss.PLANE_BOTTOM]=s[ss.PLANE_BOTTOM],i[ss.PLANE_NEAR]=s[ss.PLANE_NEAR],i[ss.PLANE_FAR]=s[ss.PLANE_FAR],n[0]=o[0],n[1]=a[1],n[2]=a[2],n[3]=o[3],n[4]=o[4],n[5]=a[5],n[6]=a[6],n[7]=o[7],this._viewProjectionMatrixInvalid=!1,this._projectionMatrixDirty=!1},cs.prototype.toString=function(){return"[VRCamera(name="+this.name+")]"};var _s=0,ds=1,fs={_isMobile:void 0,get isMobile(){if(void 0===this._isMobile){var t=/AppleWebKit/.test(navigator.userAgent)&&/Mobile\/\w+/.test(navigator.userAgent);this._isMobile=t||/Android|webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(navigator.userAgent)}return this._isMobile},get endian(){var t=new ArrayBuffer(4),e=new Uint32Array(t),i=new Uint8Array(t);return e[0]=3735928559,239===i[0]?ds:222===i[0]?_s:void 0}};function ps(t){this._dataView=t,this.offset=0,this.endian=ds,this._hostEndian=fs.endian,this.getUint8=this.getUint8.bind(this),this.getUint16=this.getUint16.bind(this),this.getUint32=this.getUint32.bind(this),this.getInt8=this.getInt8.bind(this),this.getInt16=this.getInt16.bind(this),this.getInt32=this.getInt32.bind(this),this.getFloat32=this.getFloat32.bind(this),this.getFloat64=this.getFloat64.bind(this)}function gs(t,e){var i=new Q(t=t||d.get("default_post_vertex.glsl"),e);ge.call(this,i),this.cullMode=Ye.NONE,this.depthTest=Ge.DISABLED,this.writeDepth=!1,this._vertexLayout=null,this.mesh=st.DEFAULT,this.setTexture("hx_dither2D",Ue.DEFAULT_2D_DITHER_TEXTURE)}function Ms(t){t=Math.floor(t),this._initWeights(t);var e={RADIUS:t,NUM_WEIGHTS:t+1},i=d.get("gaussian_blur_vertex.glsl",e),n=d.get("gaussian_blur_fragment.glsl",e);gs.call(this,i,n),this.setUniformArray("gaussianWeights",new Float32Array(this._weights))}function As(){Ti.call(this),this.needsNormalDepth=!1,this.outputsGamma=!1,this._mesh=null}function ms(t,e,i,n){As.call(this),this._downScale=i||4,this._targetWidth=-1,this._targetHeight=-1,t=t||100,t/=this._downScale,this._thresholdPass=new gs(null,d.get("bloom_threshold_fragment.glsl")),this._compositePass=new gs(d.get("bloom_composite_vertex.glsl"),d.get("bloom_composite_fragment.glsl")),this._blurPass=new Ms(t),this._blurSourceSlot=this._blurPass.getTextureIndex("sourceTexture"),this._thresholdWidth=-1,this._thresholdHeight=-1,this._thresholdMaps=[],this._smallFBOs=[];for(var s=0;s<2;++s)this._thresholdMaps[s]=new ut,this._thresholdMaps[s].filter=Fe.BILINEAR_NOMIP,this._thresholdMaps[s].wrapMode=ke.CLAMP,this._smallFBOs[s]=new gt([this._thresholdMaps[s]]);this._anisotropy=n||1,this._strength=void 0===e?1:e,Be.EXT_HALF_FLOAT_TEXTURES_LINEAR&&Be.EXT_HALF_FLOAT_TEXTURES?this.thresholdLuminance=ve.OPTIONS.hdr:this.thresholdLuminance=.9,this._compositePass.setTexture("bloomTexture",this._thresholdMaps[0]),this.strength=this._strength}function xs(t,e){e||(e=t),As.call(this),this.radius=e,this._blurPass=new Ms(e),this._blurSourceSlot=this._blurPass.getTextureIndex("sourceTexture"),this._numSamples=t}function Ts(){gs.call(this,null,d.get("copy_fragment.glsl"))}function ys(t){if(this._adaptive=void 0!==t&&t,this._adaptive&&(!Be.EXT_SHADER_TEXTURE_LOD||!Be.EXT_COLOR_BUFFER_HALF_FLOAT))return console.log("Warning: adaptive tone mapping not supported, using non-adaptive"),void(this._adaptive=!1);As.call(this),this._toneMapPass=this._createToneMapPass(),this._adaptive&&(this._extractLuminancePass=new gs(null,d.get("tonemap_reference_fragment.glsl")),this._extractLuminancePass.blendState=new _t(Ve.CONSTANT_ALPHA,Ve.ONE_MINUS_CONSTANT_ALPHA,He.ADD,new h(1,1,1,1)),this._luminanceMap=new ut,this._luminanceMap.initEmpty(256,256,Ze.RGBA,Be.EXT_HALF_FLOAT_TEXTURES.HALF_FLOAT_OES),this._luminanceFBO=new gt(this._luminanceMap),this._luminanceFBO.init(),this.adaptationRate=500,this._toneMapPass.setTexture("hx_luminanceMap",this._luminanceMap),this._toneMapPass.setUniform("hx_luminanceMipLevel",at.log2(this._luminanceMap._width))),this.key=.25,this.exposure=0}function Ns(t){ys.call(this,t),this.outputsGamma=!0}function Ds(t,e,i,n){As.call(this),this._fogPass=new gs(d.get("fog_vertex.glsl"),d.get("fog_fragment.glsl")),this.needsNormalDepth=!0,this.density=void 0===t?.001:t,this._tint=new h(1,1,1,1),void 0!==e&&(this.tint=e),this.startDistance=void 0===n?0:n,this.heightFallOff=void 0===i?.01:i}function Es(){As.call(this),this._pass=new gs(null,d.get("fxaa_fragment.glsl")),this._pass.setUniform("edgeThreshold",.25),this._pass.setUniform("edgeThresholdMin",1/16),this._pass.setUniform("edgeSharpness",100)}function ws(t,e){32<(t=t||4)&&(t=32),32<(e=e||4)&&(e=32),this._numRays=t,this._numSamplesPerRay=e,this._strength=1,this._bias=.1,this._fallOffDistance=1,this._radius=.5,this.scale=.5,this._sampleDirTexture=null,this._ditherTexture=null,As.call(this)}function Ls(t){64<(t=t||16)&&(t=64),this._numSamples=t,this._strength=1,this._fallOffDistance=1,this._radius=.5,this.scale=.5,this._ditherTexture=null,As.call(this)}function Is(t){ys.call(this,t)}function vs(){this.onAction=new r,this._values={},this._plugins=[]}function Ss(){Me.call(this),this.mode=Ss.MODE_KEY_LOCATION,this._onKeyUp=this._onKeyUp.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._axisMap={}}function Os(){Me.call(this),this.sensitivityX=1,this.sensitivityY=-1,this.sensitivityWheel=-.0035,this._onMouseMove=this._onMouseMove.bind(this),this._onMouseDown=this._onMouseDown.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onMouseLeave=this._onMouseLeave.bind(this),this._previousX=void 0,this._previousY=void 0,this._mouseX=void 0,this._mouseY=void 0,this._wheelX=null,this._wheelY=null,this._buttonMask=0}ps.prototype={get byteLength(){return this._dataView.byteLength},get bytesAvailable(){return this._dataView.byteLength-this.offset},getChar:function(){return String.fromCharCode(this.getUint8())},getUint8:function(){return this._dataView.getUint8(this.offset++)},getUint16:function(){var t=this._dataView.getUint16(this.offset,this.endian);return this.offset+=2,t},getUint32:function(){var t=this._dataView.getUint32(this.offset,this.endian);return this.offset+=4,t},getInt8:function(){return this._dataView.getInt8(this.offset++)},getInt16:function(){var t=this._dataView.getInt16(this.offset,this.endian);return this.offset+=2,t},getInt32:function(){var t=this._dataView.getInt32(this.offset,this.endian);return this.offset+=4,t},getInt64AsFloat64:function(){var t,e;return this.endian===ds?(t=this._dataView.getUint32(this.offset,this.endian),e=this._dataView.getInt32(this.offset+4,this.endian)):(e=this._dataView.getInt32(this.offset,this.endian),t=this._dataView.getUint32(this.offset+4,this.endian)),this.offset+=8,t+4294967296*e},getFloat32:function(){var t=this._dataView.getFloat32(this.offset,this.endian);return this.offset+=4,t},getFloat64:function(){var t=this._dataView.getFloat64(this.offset,this.endian);return this.offset+=8,t},skipAlign:function(t){for(;this.offset%t;)++this.offset},getUint8Array:function(t){return this._readArray(t,Uint8Array,1,this.getUint8)},getUint16Array:function(t){return this._readArray(t,Uint16Array,2,this.getUint16)},getUint32Array:function(t){return this._readArray(t,Uint32Array,4,this.getUint32)},getInt8Array:function(t){return this._readArray(t,Int8Array,1,this.getInt8)},getInt16Array:function(t){return this._readArray(t,Int16Array,2,this.getInt16)},getInt32Array:function(t){return this._readArray(t,Int32Array,4,this.getInt32)},getInt64AsFloat64Array:function(t){for(var e=new Float64Array(t),i=0;i<t;++i)e[i]=this.getInt64AsFloat64();return e},getFloat32Array:function(t){return this._readArray(t,Float32Array,4,this.getFloat32)},getFloat64Array:function(t){return this._readArray(t,Float64Array,8,this.getFloat64)},getString:function(t){if(!t)return this._get0String();for(var e="",i=0;i<t;++i)e+=this.getChar();return e},_get0String:function(){var t="";do{var e=this.getUint8();e&&(t+=String.fromCharCode(e))}while(0!==e);return t},_readArray:function(t,e,i,n){if(this.offset%i==0&&this.endian===this._hostEndian){var s=new e(this._dataView.buffer,this.offset,t);return this.offset+=t*i,s}s=new Float64Array(t);for(var r=0;r<t;++r)s[r]=n();return s}},(gs.prototype=Object.create(ge.prototype,{mesh:{get:function(){return this._mesh},set:function(t){this._mesh!==t&&(this._mesh=t,this._vertexLayout=new xi(this._mesh,this))}}})).draw=function(t){this.updateRenderState(t),U.drawElements(U.gl.TRIANGLES,6,0)},gs.prototype.updateRenderState=function(t){var e=t._camera;this.updateInstanceRenderState(e),this.updatePassRenderState(e,t),this._mesh._vertexBuffers[0].bind(),this._mesh._indexBuffer.bind();for(var i=this._vertexLayout,n=i.attributes,s=n.length,r=0;r<s;++r){var o=n[r];U.gl.vertexAttribPointer(o.index,o.numComponents,U.gl.FLOAT,!1,o.stride,o.offset)}U.enableAttributes(i._numAttributes)},(Ms.prototype=Object.create(gs.prototype))._initWeights=function(t){this._weights=[];for(var e=si.fromRadius(t,.01),i=0,n=0;n<=t;++n)this._weights[n]=e.at(n),i+=0<n?2*this._weights[n]:1;for(i=1/i,n=0;n<=t;++n)this._weights[n]*=i},Ti.create(As,{hdrTarget:{get:function(){return this._renderer._hdrFront.fbo}},hdrSource:{get:function(){return this._renderer._hdrBack.texture}}}),As.prototype.isSupported=function(){return!0},As.prototype.render=function(t,e){this._renderer=t,this.draw(t,e)},As.prototype.draw=function(t){throw new Error("Abstract method error!")},As.prototype.onAdded=function(){},As.prototype.onRemoved=function(){},As.prototype._swapHDRFrontAndBack=function(){this._renderer._swapHDRFrontAndBack()},As.prototype.acceptVisitor=function(t){t.visitEffect(this)},(ms.prototype=Object.create(As.prototype,{strength:{get:function(){return this._strength},set:function(t){this._strength=t,this._compositePass.setUniform("strength",this._strength)}},thresholdLuminance:{get:function(){return this._thresholdLuminance},set:function(t){this._thresholdLuminance=t,this._thresholdPass.setUniform("threshold",t)}}}))._initTextures=function(){for(var t=0;t<2;++t)this._thresholdWidth=Math.ceil(this._targetWidth/this._downScale),this._thresholdHeight=Math.ceil(this._targetHeight/this._downScale),this._thresholdMaps[t].initEmpty(this._thresholdWidth,this._thresholdHeight,Ze.RGB,Be.HDR_FORMAT),this._smallFBOs[t].init()},ms.prototype.draw=function(t,e){this._renderer._width===this._targetWidth&&this._renderer._height===this._targetHeight||(this._targetWidth=this._renderer._width,this._targetHeight=this._renderer._height,this._initTextures()),U.setRenderTarget(this._smallFBOs[0]),U.clear(),this._thresholdPass.draw(t),U.setRenderTarget(this._smallFBOs[1]),U.clear(),this._blurPass.setTextureByIndex(this._blurSourceSlot,this._thresholdMaps[0]),this._blurPass.setUniform("stepSize",{x:1/this._thresholdWidth,y:0}),this._blurPass.draw(t),U.setRenderTarget(this._smallFBOs[0]),U.clear(),this._blurPass.setTextureByIndex(this._blurSourceSlot,this._thresholdMaps[1]),this._blurPass.setUniform("stepSize",{x:0,y:this._anisotropy/this._thresholdHeight}),this._blurPass.draw(t),U.setRenderTarget(this.hdrTarget),U.clear(),this._compositePass.draw(t)},(xs.prototype=Object.create(As.prototype)).draw=function(t,e){var i=this.radius/this._numSamples;U.setRenderTarget(this.hdrTarget),U.clear(),this._blurPass.setTextureByIndex(this._blurSourceSlot,this.hdrSource),this._blurPass.setUniform("stepSize",{x:i/this.hdrSource.width,y:0}),this._blurPass.draw(t),this._swapHDRFrontAndBack(),U.setRenderTarget(this.hdrTarget),U.clear(),this._blurPass.setTextureByIndex(this._blurSourceSlot,this.hdrSource),this._blurPass.setUniform("stepSize",{x:0,y:i/this.hdrSource.height}),this._blurPass.draw(t)},(Ts.prototype=Object.create(gs.prototype)).setSourceTexture=function(t){this.setTexture("sampler",t)},(ys.prototype=Object.create(As.prototype,{exposure:{get:function(){return this._exposure},set:function(t){this._exposure=t,this._toneMapPass.setUniform("hx_exposure",Math.pow(2,t))}},key:{get:function(){return this._key},set:function(t){this._key=t,this._toneMapPass.setUniform("hx_key",t)}}}))._createToneMapPass=function(){throw new Error("Abstract method called!")},ys.prototype.draw=function(t,e){if(this._adaptive){var i=0<this.adaptationRate?e/this.adaptationRate:1;1<i&&(i=1),this._extractLuminancePass.blendState.color.a=i,U.setRenderTarget(this._luminanceFBO),this._extractLuminancePass.draw(t),this._luminanceMap.generateMipmap()}U.setRenderTarget(this.hdrTarget),U.clear(),this._toneMapPass.draw(t)},(Ns.prototype=Object.create(ys.prototype))._createToneMapPass=function(){var t={},e="";return this._adaptive&&(t.HX_ADAPTIVE=1,e="#texturelod\n"),new gs(null,e+d.get("snippets_tonemap.glsl",t)+"\n"+d.get("tonemap_filmic_fragment.glsl"))},(Ds.prototype=Object.create(As.prototype,{density:{get:function(){return this._density},set:function(t){this._density=t,this._fogPass.setUniform("density",t)}},tint:{get:function(){return this._tint},set:function(t){this._tint.copyFrom(t),ve.OPTIONS.useGammaCorrection&&this._tint.gammaToLinear(),this._fogPass.setUniform("tint",{x:t.r,y:t.g,z:t.b})}},startDistance:{get:function(){return this._startDistance},set:function(t){this._startDistance=t,this._fogPass.setUniform("startDistance",t)}},heightFallOff:{get:function(){return this._heightFallOff},set:function(t){this._heightFallOff=t,this._fogPass.setUniform("heightFallOff",t)}}})).draw=function(t,e){U.setRenderTarget(this.hdrTarget),U.clear(),this._fogPass.draw(t)},(Es.prototype=Object.create(As.prototype)).draw=function(t,e){U.setRenderTarget(this.hdrTarget),U.clear(),this._pass.draw(t)},(ws.prototype=Object.create(As.prototype,{sampleRadius:{get:function(){return this._radius},set:function(t){this._radius=t,this._aoPass&&this._aoPass.setUniform("halfSampleRadius",.5*this._radius)}},fallOffDistance:{get:function(){return this._fallOffDistance},set:function(t){this._fallOffDistance=t,this._aoPass&&this._aoPass.setUniform("rcpFallOffDistance",1/this._fallOffDistance)}},strength:{get:function(){return this._strength},set:function(t){this._strength=t,this._aoPass&&this._aoPass.setUniform("strengthPerRay",this._strength/this._numRays)}},bias:{get:function(){return this._bias},set:function(t){this._bias=t,this._aoPass&&this._aoPass.setUniform("bias",this._bias)}}})).init=function(){this._aoPass=new gs(d.get("hbao_vertex.glsl"),d.get("hbao_fragment.glsl",{NUM_RAYS:this._numRays,NUM_SAMPLES_PER_RAY:this._numSamplesPerRay})),this._blurPass=new gs(d.get("ao_blur_vertex.glsl"),d.get("ao_blur_fragment.glsl")),this._initSampleDirTexture(),this._initDitherTexture(),this._aoPass.setUniform("strengthPerRay",this._strength/this._numRays),this._aoPass.setUniform("rcpFallOffDistance",1/this._fallOffDistance),this._aoPass.setUniform("halfSampleRadius",.5*this._radius),this._aoPass.setUniform("bias",this._bias),this._aoPass.setTexture("ditherTexture",this._ditherTexture),this._aoPass.setTexture("sampleDirTexture",this._sampleDirTexture),this._sourceTextureSlot=this._blurPass.getTextureIndex("source"),this._aoTexture=new ut,this._aoTexture.filter=Fe.BILINEAR_NOMIP,this._aoTexture.wrapMode=ke.CLAMP,this._backTexture=new ut,this._backTexture.filter=Fe.BILINEAR_NOMIP,this._backTexture.wrapMode=ke.CLAMP,this._fbo1=new gt(this._backTexture),this._fbo2=new gt(this._aoTexture)},ws.prototype.getAOTexture=function(){return this._aoTexture},ws.prototype.draw=function(t,e){var i=this._renderer._width*this.scale,n=this._renderer._height*this.scale;rt.assureSize(i,n,this._aoTexture,this._fbo2)&&(rt.assureSize(i,n,this._backTexture,this._fbo1),this._aoPass.setUniform("ditherScale",{x:.25*i,y:.25*n})),U.setClearColor(h.WHITE),U.setRenderTarget(this._fbo1),U.clear(),this._aoPass.draw(t),U.setRenderTarget(this._fbo2),U.clear(),this._blurPass.setUniform("pixelSize",{x:1/i,y:1/n}),this._blurPass.setTextureByIndex(this._sourceTextureSlot,this._backTexture),this._blurPass.draw(t),U.setClearColor(h.BLACK)},ws.prototype._initSampleDirTexture=function(){this._sampleDirTexture=new ut;for(var t=[],e=0,i=0;i<256;++i){var n=i/256*2*Math.PI,s=.5*Math.cos(n)+.5,r=.5*Math.sin(n)+.5;t[e]=Math.round(255*s),t[e+1]=Math.round(255*r),t[e+2]=0,t[e+3]=255,e+=4}this._sampleDirTexture.uploadData(new Uint8Array(t),256,1,!1),this._sampleDirTexture.filter=Fe.NEAREST_NOMIP,this._sampleDirTexture.wrapMode=ke.REPEAT},ws.prototype._initDitherTexture=function(){this._ditherTexture=new ut;var t,e=[],i=0,n=[],s=[];for(t=0;t<16;++t)n.push(t/16),s.push(t/15);_.shuffle(n),_.shuffle(s);for(var r=t=0;r<4;++r)for(var o=0;o<4;++o){var a=n[t],h=s[t];++t,e[i]=Math.round(255*a),e[i+1]=Math.round(255*h),e[i+2]=0,e[i+3]=255,i+=4}this._ditherTexture.uploadData(new Uint8Array(e),4,4,!1),this._ditherTexture.filter=Fe.NEAREST_NOMIP,this._ditherTexture.wrapMode=ke.REPEAT},(Ls.prototype=Object.create(As.prototype,{sampleRadius:{get:function(){return this._radius},set:function(t){this._radius=t,this._ssaoPass&&this._ssaoPass.setUniform("sampleRadius",this._radius)}},fallOffDistance:{get:function(){return this._fallOffDistance},set:function(t){this._fallOffDistance=t,this._ssaoPass&&this._ssaoPass.setUniform("rcpFallOffDistance",1/this._fallOffDistance)}},strength:{get:function(){return this._strength},set:function(t){this._strength=t,this._ssaoPass&&this._ssaoPass.setUniform("strengthPerSample",2*this._strength/this._numSamples)}}})).init=function(){this._ssaoPass=new gs(null,d.get("ssao_fragment.glsl",{NUM_SAMPLES:this._numSamples})),this._blurPass=new gs(d.get("ao_blur_vertex.glsl"),d.get("ao_blur_fragment.glsl")),this._initSamples(),this._initDitherTexture(),this._ssaoPass.setUniform("strengthPerSample",2*this._strength/this._numSamples),this._ssaoPass.setUniform("rcpFallOffDistance",1/this._fallOffDistance),this._ssaoPass.setUniform("sampleRadius",this._radius),this._ssaoPass.setTexture("ditherTexture",this._ditherTexture),this._sourceTextureSlot=this._blurPass.getTextureIndex("source"),this._ssaoTexture=new ut,this._ssaoTexture.filter=Fe.BILINEAR_NOMIP,this._ssaoTexture.wrapMode=ke.CLAMP,this._backTexture=new ut,this._backTexture.filter=Fe.BILINEAR_NOMIP,this._backTexture.wrapMode=ke.CLAMP,this._fbo1=new gt(this._backTexture),this._fbo2=new gt(this._ssaoTexture)},Ls.prototype.getAOTexture=function(){return this._ssaoTexture},Ls.prototype._initSamples=function(){for(var t=[],e=0,i=pt.DEFAULT.points,n=0;n<this._numSamples;++n){var s=i[n];t[e++]=Math.pow(s.x,2),t[e++]=Math.pow(s.y,2),t[e++]=Math.pow(s.z,2)}this._ssaoPass.setUniformArray("samples",new Float32Array(t))},Ls.prototype.draw=function(t,e){var i=this._renderer._width*this.scale,n=this._renderer._height*this.scale;rt.assureSize(i,n,this._ssaoTexture,this._fbo2)&&(rt.assureSize(i,n,this._backTexture,this._fbo1),this._ssaoPass.setUniform("ditherScale",{x:.25*i,y:.25*n})),U.setClearColor(h.WHITE),U.setRenderTarget(this._fbo1),U.clear(),this._ssaoPass.draw(t),U.setRenderTarget(this._fbo2),U.clear(),this._blurPass.setUniform("pixelSize",{x:1/i,y:1/n}),this._blurPass.setTextureByIndex(this._sourceTextureSlot,this._backTexture),this._blurPass.draw(t),U.setClearColor(h.BLACK)},Ls.prototype._initDitherTexture=function(){this._ditherTexture=new ut,this._ditherTexture.uploadData(new Uint8Array([126,255,126,255,135,253,105,255,116,51,26,255,137,57,233,255,139,254,121,255,56,61,210,255,227,185,73,255,191,179,30,255,107,245,173,255,205,89,34,255,191,238,138,255,56,233,125,255,198,228,161,255,85,13,164,255,140,248,168,255,147,237,65,255]),4,4,!1),this._ditherTexture.filter=Fe.NEAREST_NOMIP,this._ditherTexture.wrapMode=ke.REPEAT},(Is.prototype=Object.create(ys.prototype))._createToneMapPass=function(){var t={},e="";return this._adaptive&&(t.HX_ADAPTIVE=1,e+="#texturelod\n"),new gs(null,e+d.get("snippets_tonemap.glsl",t)+"\n"+d.get("tonemap_reinhard_fragment.glsl"))},vs.prototype={enable:function(t){0<=this._plugins.indexOf(t)||(this._plugins.push(t),t._setInput(this))},disable:function(t){var e=this._plugins.indexOf(t);this._plugins.splice(e,1),t._setInput(null)},setActionValue:function(t,e){this._values[t]!==e&&(this._values[t]=e,this.onAction.dispatch(t,e))},getValue:function(t){return this._values[t]||0}},Ss.MODE_KEY_VALUE=0,Ss.MODE_KEY_LOCATION=1,(Ss.prototype=Object.create(Me.prototype)).mapAxis=function(t,e,i,n){n=n||1;this._axisMap[t]={value:-n,opposite:e,isDown:!1},this._axisMap[e]={value:n,opposite:t,isDown:!1},this.map(t,i),this.map(e,i)},Ss.prototype.unmap=function(t){Me.prototype.unmap.call(t),delete this._axisMap[t]},Ss.prototype.onEnabled=function(){document.addEventListener("keydown",this._onKeyDown),document.addEventListener("keyup",this._onKeyUp)},Ss.prototype.onDisabled=function(){document.removeEventListener("keydown",this._onKeyDown),document.removeEventListener("keyup",this._onKeyUp)},Ss.prototype._onKeyDown=function(t){var e=this.mode?t.code||t.keyCode:t.key||t.keyCode;if(this.isMapped(e)){var i=this._axisMap[e];if(i){var n=this._axisMap[i.opposite];i.isDown=!0,n.isDown?this.setValue(e,0):this.setValue(e,i.value)}else this.setValue(e,1);t.preventDefault()}},Ss.prototype._onKeyUp=function(t){var e=this.mode?t.code||t.keyCode:t.key||t.keyCode;if(this.isMapped(e)){var i=this._axisMap[e];if(i){var n=this._axisMap[i.opposite];i.isDown=!1,n.isDown?this.setValue(e,n.value):this.setValue(e,0)}else this.setValue(e,0);t.preventDefault()}},Os.MOVE_X=0,Os.MOVE_Y=1,Os.BUTTON_LEFT=2,Os.BUTTON_RIGHT=3,Os.BUTTON_MIDDLE=4,Os.WHEEL_X=5,Os.WHEEL_Y=6,Os.POS_X=7,Os.POS_Y=8,Os.DRAG_X=9,Os.DRAG_Y=10,Os.prototype=Object.create(Me.prototype);var Cs={0:Os.BUTTON_LEFT,1:Os.BUTTON_MIDDLE,2:Os.BUTTON_RIGHT};function js(){Me.call(this),this.sensitivityX=1,this.sensitivityY=-1,this.sensitivityWheel=-.0035,this._onMouseMove=this._onMouseMove.bind(this),this._onMouseDown=this._onMouseDown.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onCanvasClick=this._onCanvasClick.bind(this),this._onPointerLockChange=this._onPointerLockChange.bind(this),this._wheelX=null,this._wheelY=null,this._movementX=null,this._movementY=null}Os.prototype.onEnabled=function(){Se.bind(this._onPreFrame,this),document.addEventListener("mousemove",this._onMouseMove),ve.TARGET_CANVAS.addEventListener("mouseenter",this._onMouseEnter),ve.TARGET_CANVAS.addEventListener("mouseleave",this._onMouseLeave),ve.TARGET_CANVAS.addEventListener("mousedown",this._onMouseDown),document.addEventListener("mouseup",this._onMouseUp),ve.TARGET_CANVAS.addEventListener("wheel",this._onMouseWheel)},Os.prototype.onDisabled=function(){Se.unbind(this._onPreFrame),document.removeEventListener("mousemove",this._onMouseMove),ve.TARGET_CANVAS.removeEventListener("mouseenter",this._onMouseEnter),ve.TARGET_CANVAS.removeEventListener("mouseleave",this._onMouseLeave),ve.TARGET_CANVAS.removeEventListener("mousedown",this._onMouseDown),document.removeEventListener("mouseup",this._onMouseUp),ve.TARGET_CANVAS.removeEventListener("wheel",this._onMouseWheel),document.body.oncontextmenu=null},Os.prototype.map=function(t,e){Me.prototype.map.call(this,t,e),t===Os.BUTTON_RIGHT&&(document.body.oncontextmenu=function(){return!1})},Os.prototype.unmap=function(t){Me.prototype.unmap.call(this,t),t===Os.BUTTON_RIGHT&&(document.body.oncontextmenu=null)},Os.prototype._onMouseDown=function(t){this._buttonMask=t.buttons;var e=Cs[t.button];e&&this.setValue(e,1)},Os.prototype._onMouseUp=function(t){this._buttonMask=t.buttons;var e=Cs[t.button];e&&this.setValue(e,0)},Os.prototype._onMouseMove=function(t){this._updatePos(t.clientX,t.clientY)},Os.prototype._updatePos=function(t,e){var i=ve.TARGET_CANVAS.getBoundingClientRect();this._mouseX=at.saturate((t-i.left)/i.width),this._mouseY=at.saturate((e-i.top)/i.height)},Os.prototype._onPreFrame=function(){var t=this._mouseX,e=this._mouseY,i=ve.TARGET_CANVAS.width/ve.TARGET_CANVAS.height;if(void 0!==this._previousX){var n=(t-this._previousX)*this.sensitivityX,s=(e-this._previousY)*this.sensitivityY;this.setValue(Os.MOVE_X,n*i),this.setValue(Os.MOVE_Y,s),1&this._buttonMask?(this.setValue(Os.DRAG_X,n*i),this.setValue(Os.DRAG_Y,s)):(this.setValue(Os.DRAG_X,0),this.setValue(Os.DRAG_Y,0))}this._previousX=t,this._previousY=e,this.setValue(Os.POS_X,t),this.setValue(Os.POS_Y,e),this.setValue(Os.WHEEL_X,this._wheelX*this.sensitivityWheel),this.setValue(Os.WHEEL_Y,this._wheelY*this.sensitivityWheel),this._wheelX=0,this._wheelY=0},Os.prototype._onMouseLeave=function(t){this._updatePos(t.clientX,t.clientY)},Os.prototype._onMouseEnter=function(t){this._updatePos(t.clientX,t.clientY);var e=this._buttonMask,i=t.buttons;0!=(1&e)&&0==(1&i)&&this.setValue(Os.BUTTON_LEFT,0),0!=(2&e)&&0==(2&i)&&this.setValue(Os.BUTTON_RIGHT,0),0!=(4&e)&&0==(4&i)&&this.setValue(Os.BUTTON_MIDDLE,0),this._buttonMask=i},Os.prototype._onMouseWheel=function(t){(this.isMapped(Os.WHEEL_X)||this.isMapped(Os.WHEEL_Y))&&(this._wheelX+=at.sign(t.deltaX),this._wheelY+=at.sign(t.deltaY),t.preventDefault())},js.isSupported=function(){return!!ve.TARGET_CANVAS.requestPointerLock},js.MOVE_X=0,js.MOVE_Y=1,js.BUTTON_LEFT=2,js.BUTTON_RIGHT=3,js.BUTTON_MIDDLE=4,js.WHEEL_X=5,js.WHEEL_Y=6,js.prototype=Object.create(Me.prototype);var bs={0:js.BUTTON_LEFT,1:js.BUTTON_MIDDLE,2:js.BUTTON_RIGHT};function Ps(){Me.call(this),this.sensitivityX=1,this.sensitivityY=1,this.sensitivityPinch=1,this._onTouchMove=this._onTouchMove.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._previousX=void 0,this._previousY=void 0,this._touchX=void 0,this._touchY=void 0,this._pinchDistance=0}js.prototype.onEnabled=function(){ve.TARGET_CANVAS.addEventListener("click",this._onCanvasClick),Se.bind(this._onPreFrame,this),document.addEventListener("mousemove",this._onMouseMove),ve.TARGET_CANVAS.addEventListener("mousedown",this._onMouseDown),document.addEventListener("mouseup",this._onMouseUp),ve.TARGET_CANVAS.addEventListener("wheel",this._onMouseWheel),document.addEventListener("pointerlockchange",this._onPointerLockChange),document.addEventListener("mozpointerlockchange",this._onPointerLockChange)},js.prototype.onDisabled=function(){ve.TARGET_CANVAS.removeEventListener("click",this._onCanvasClick),document.exitPointerLock(),Se.unbind(this._onPreFrame),document.removeEventListener("mousemove",this._onMouseMove),ve.TARGET_CANVAS.removeEventListener("mousedown",this._onMouseDown),document.removeEventListener("mouseup",this._onMouseUp),ve.TARGET_CANVAS.removeEventListener("wheel",this._onMouseWheel),document.removeEventListener("pointerlockchange",this._onPointerLockChange),document.removeEventListener("mozpointerlockchange",this._onPointerLockChange)},js.prototype._onCanvasClick=function(){ve.TARGET_CANVAS.requestPointerLock()},js.prototype._onMouseDown=function(t){var e=bs[t.button];e&&this.setValue(e,1)},js.prototype._onMouseUp=function(t){var e=bs[t.button];e&&this.setValue(e,0)},js.prototype._onMouseMove=function(t){var e=ve.TARGET_CANVAS.getBoundingClientRect();this._movementX=t.movementX/e.width,this._movementY=t.movementY/e.height},js.prototype._onPreFrame=function(){var t=ve.TARGET_CANVAS;if(document.pointerLockElement===t){var e=t.width/t.height;this.setValue(js.MOVE_X,this._movementX*e*this.sensitivityX),this.setValue(js.MOVE_Y,this._movementY*this.sensitivityY),this._movementX=0,this._movementY=0,this.setValue(js.WHEEL_X,this._wheelX*this.sensitivityWheel),this.setValue(js.WHEEL_Y,this._wheelY*this.sensitivityWheel),this._wheelX=0,this._wheelY=0}},js.prototype._onMouseWheel=function(t){(this.isMapped(js.WHEEL_X)||this.isMapped(js.WHEEL_Y))&&(this._wheelX+=at.sign(t.deltaX),this._wheelY+=at.sign(t.deltaY),t.preventDefault())},js.prototype._onPointerLockChange=function(t){this._movementX=0,this._movementY=0,this.setValue(js.MOVE_X,0),this.setValue(js.MOVE_Y,0),this.setValue(js.WHEEL_X,0),this.setValue(js.WHEEL_Y,0),this.setValue(js.BUTTON_LEFT,0),this.setValue(js.BUTTON_RIGHT,0),this.setValue(js.BUTTON_MIDDLE,0)},Ps.MOVE_X=0,Ps.MOVE_Y=1,Ps.POS_X=2,Ps.POS_Y=3,Ps.PINCH=4,Ps.TAP=5,(Ps.prototype=Object.create(Me.prototype)).onEnabled=function(){Se.bind(this._onPreFrame,this),document.addEventListener("touchmove",this._onTouchMove),document.addEventListener("touchstart",this._onTouchStart),document.addEventListener("touchend",this._onTouchEnd)},Ps.prototype.onDisabled=function(){Se.unbind(this._onPreFrame),document.removeEventListener("touchmove",this._onTouchMove),document.removeEventListener("touchstart",this._onTouchStart),document.removeEventListener("touchend",this._onTouchEnd)},Ps.prototype._onTouchStart=function(t){var e=t.touches.length;1===e&&this.setValue(Ps.TAP,1),this._previousX=void 0,this._previousY=void 0;var i=t.touches[0];if(1===e)this._updatePos(i.clientX,i.clientY);else if(2===e){var n=t.touches[1],s=i.screenX-n.screenX,r=i.screenY-n.screenY;this._pinchDistance=Math.sqrt(s*s+r*r),this._touchX=void 0,this._touchY=void 0}},Ps.prototype._onTouchEnd=function(t){this._previousX=void 0,this._previousY=void 0;var e=t.touches.length,i=t.touches[0];0===e?this.setValue(Ps.TAP,0):1===e&&this._updatePos(i.clientX,i.clientY)},Ps.prototype._onTouchMove=function(t){t.preventDefault();var e=t.touches.length,i=t.touches[0];if(1===e)this._updatePos(i.clientX,i.clientY);else if(2===e){var n=t.touches[1],s=i.screenX-n.screenX,r=i.screenY-n.screenY,o=Math.sqrt(s*s+r*r),a=(o-this._pinchDistance)/this._pinchDistance;this._pinchDistance=o,this.setValue(Ps.PINCH,a*this.sensitivityPinch)}},Ps.prototype._updatePos=function(t,e){this._touchX=t/window.innerWidth,this._touchY=e/window.innerHeight},Ps.prototype._onPreFrame=function(){var t=this._touchX,e=this._touchY,i=window.innerWidth/window.innerHeight;if(void 0!==this._previousX){var n=(t-this._previousX)*this.sensitivityX,s=(e-this._previousY)*this.sensitivityY;this.setValue(Ps.MOVE_X,n*i),this.setValue(Ps.MOVE_Y,s)}this._previousX=t,this._previousY=e,this.setValue(Ps.POS_X,t),this.setValue(Ps.POS_Y,e)};var zs=function(t){var e=t.lastIndexOf("/"),i={};return 0<=e?(i.path=t.substr(0,e+1),i.filename=t.substr(e+1)):(i.path="./",i.filename=t),i};function Rs(t){this._params=void 0,this._data=null,this._timeout=0,this._method="GET",this._type=Rs.DATA_TEXT,this._headers=t||{}}function Us(t,e){this._dataType=void 0===e?Rs.DATA_TEXT:e,this._containerType=t,this.onComplete=null,this.onProgress=null,this.onFail=null,this.fileMap=null,this.options={},this.path="",this.filename=""}function Bs(t){this.onComplete=new r,this.onProgress=new r,this.onFail=new r,this.fileMap={},this.options={},this._headers={},this._importerType=t,this.crossOrigin=void 0}function Fs(t,e){this.onComplete=new r,this.onProgress=new r,this.fileMap={},this._numLoaded=0,this._queue=[],this._assets={},t&&"/"!==t.charAt(t.length-1)&&(t+="/"),this.basePath=t||"",this.crossOrigin=e}function ks(){Us.call(this,Kn,Us.TYPE_BINARY)}function Ys(){Us.call(this,ct)}function Qs(){Us.call(this,ut,Us.TYPE_IMAGE)}Rs.ERROR_TIME_OUT=408,Rs.METHOD_GET="get",Rs.METHOD_POST="post",Rs.DATA_TEXT=0,Rs.DATA_BINARY=1,Rs.prototype={get type(){return this._type},set type(t){this._type=t},get method(){return this._method},set method(t){this._method=t},get timeoutDuration(){return this._timeout},set timeoutDuration(t){this._timeout=t},get parameters(){return this._params},set parameters(t){this._params=t},get data(){return this._data},setRequestHeader:function(t,e){this._headers[t]=e},load:function(t){var e=new XMLHttpRequest;for(var i in e.open(this._method,t,!0),this._headers)this._headers.hasOwnProperty(i)&&e.setRequestHeader(i,this._headers[i]);this._timeout&&(e.timeout=this._timeout,e.ontimeout=function(){n.onError(Rs.ERROR_TIME_OUT)}),this._type===Rs.DATA_BINARY?e.responseType="arraybuffer":e.overrideMimeType("application/json");var n=this;e.onreadystatechange=function(){var t=this.DONE||4;this.readyState===t&&(200===this.status?(this._data=n._type===Rs.DATA_TEXT?e.responseText:new DataView(e.response),n.onComplete&&n.onComplete(this._data)):n.onError&&n.onError(this.status))},e.send(this._params)},onComplete:function(t){},onError:function(t){}},Us.prototype={get dataType(){return this._dataType},createContainer:function(){return new this._containerType},parse:function(t,e){},_notifyComplete:function(t){this.onComplete&&(this.onComplete instanceof r?this.onComplete.dispatch(t):this.onComplete(t))},_notifyProgress:function(t){this.onProgress&&(this.onProgress instanceof r?this.onProgress.dispatch(t):this.onProgress(t))},_notifyFailure:function(t){this.onFail instanceof r?(this.onFail.hasListeners||console.error(t),this.onFail.dispatch(t)):this.onFail(t)},_correctURL:function(t){return this.path+(this.fileMap.hasOwnProperty(t)?this.fileMap[t]:t).replace("\\","/")}},Us.TYPE_TEXT=Rs.DATA_TEXT,Us.TYPE_BINARY=Rs.DATA_BINARY,Us.TYPE_IMAGE=2,Bs.prototype={setRequestHeader:function(t,e){this._headers[t]=e},load:function(t,e){var i=new this._importerType;return e=e||i.createContainer(),i.onComplete=this.onComplete,i.onProgress=this.onProgress,i.onFail=this.onFail,i.fileMap=this.fileMap,i.options=this.options,t instanceof Blob?this._importFromFile(t,e,i):this._importFromFilename(t,e,i),e},_fail:function(t){console.warn("Failed loading "+filename+". Error code: "+t),this.onFail&&(this.onFail instanceof r?this.onFail.dispatch(t):this.onFail(t))},_importFromFile:function(t,e,i){var n=new FileReader;switch(n.onerror=function(t){self._fail.call(self,t)},i.dataType){case Us.TYPE_TEXT:n.onload=function(){i.parse(n.result,e)},n.readAsText(t);break;case Us.TYPE_BINARY:n.onload=function(){i.parse(new DataView(n.result),e)},n.readAsArrayBuffer(t);break;case Us.TYPE_IMAGE:var s=document.createElementNS("http://www.w3.org/1999/xhtml","img");n.onload=function(){s.src=n.result,i.parse(s,e)},n.readAsDataURL(t)}},_importFromFilename:function(t,e,i){var n=zs(t);if(i.path=n.path,i.filename=n.filename,i.dataType===Us.TYPE_IMAGE){var s=document.createElementNS("http://www.w3.org/1999/xhtml","img");s.crossOrigin=this.options.crossOrigin,s.addEventListener("load",function(){i.parse(s,e)}),s.addEventListener("error",function(){console.warn("Failed loading asset '"+t+"'"),r._fail.call(r)}),s.src=t}else{var r=this,o=new Rs(this._headers);o.type=i.dataType,o.onComplete=function(t){i.parse(t,e)},o.onError=function(t){r._fail.call(r,t)},o.load(t)}}},Fs.Type={JSON:0,ASSET:1,PLAIN_TEXT:2,RAW_BINARY:3},Fs.prototype={queueAsset:function(t,e,i,n,s,r){this._queue.push({id:t,file:e instanceof Blob?e:this.basePath+e,type:i,parser:n,options:s,target:r})},load:function(){if(0!==this._queue.length){var t=this._queue[this._numLoaded];switch(t.type){case Fs.Type.JSON:this._json(t.file,t.id);break;case Fs.Type.PLAIN_TEXT:this._plainText(t.file,t.id);break;case Fs.Type.RAW_BINARY:this._rawBinary(t.file,t.id);break;case Fs.Type.ASSET:this._asset(t.file,t.id,t.parser,t.options,t.target);break;default:throw new Error("Unknown asset type "+t.type+"!")}}else this.onComplete.dispatch(this)},get:function(t){return this._assets[t]},addAsset:function(t,e){this._assets[t]=e},mergeLibrary:function(t){_.forEach(t._assets,function(t,e){this.addAsset(e,t)}.bind(this))},_json:function(t,e){var i=this;this._loadText(t,function(t){i._assets[e]=JSON.parse(t),i._onAssetLoaded()})},_plainText:function(t,e){var i=this;this._loadText(t,function(t){i._assets[e]=t,i._onAssetLoaded()})},_loadText:function(t,e){if(t instanceof Blob){var i=new FileReader;i.onload=function(){e(i.result)},i.readAsText(t)}else{var n=new XMLHttpRequest;n.overrideMimeType("application/json"),n.open("GET",t,!0),n.onreadystatechange=function(){4===n.readyState&&200===n.status&&e(n.responseText)},n.send(null)}},_rawBinary:function(t,e){var i=this;if(t instanceof Blob){var n=new FileReader;n.onload=function(){i._assets[e]=data,i._onAssetLoaded()},n.readAsArrayBuffer(t)}else{var s=new Rs;s.type=Rs.DATA_BINARY,s.onComplete=function(t){i._assets[e]=t,i._onAssetLoaded()},s.load(t)}},_asset:function(t,e,i,n,s){var r=new Bs(i);r.fileMap=this.fileMap,r.options=n||{},r.options.crossOrigin=this.crossOrigin,r.onComplete.bind(function(){this._onAssetLoaded()},this),r.onProgress.bind(function(t){this.onProgress.dispatch((this._numLoaded+t)/this._queue.length)},this),this._assets[e]=r.load(t,s),this._assets[e].name=e},_onAssetLoaded:function(){++this._numLoaded,this.onProgress.dispatch(this._numLoaded/this._queue.length),this._numLoaded===this._queue.length?this.onComplete.dispatch(this):this.load()}},(ks.prototype=Object.create(Us.prototype)).parse=function(t,e){ve.AUDIO_CONTEXT.decodeAudioData(t.buffer,this._onDecoded.bind(this,e),this._onFailed.bind(this))},ks.prototype._onDecoded=function(t,e){t.buffer=e,this._notifyComplete(t)},ks.prototype._onFailed=function(){this._notifyFailure("Failed to decode audio data")},(Ys.prototype=Object.create(Us.prototype)).parse=function(t,e){var i=JSON.parse(t),n=[i.files.posX,i.files.negX,i.files.posY,i.files.negY,i.files.posZ,i.files.negZ];i.loadMips?this._loadMipChain(n,e):this._loadFaces(n,e)},Ys.prototype._loadFaces=function(t,e){for(var i=void 0===this.options.generateMipmaps||this.options.generateMipmaps,n=[],s=this,r=function(){s._notifyFailure("Failed loading texture '"+t[0]+"'")},o=function(){s._notifyProgress(this.nextID/6),n[this.nextID].src=s.path+t[this.nextID]},a=function(){e.uploadImages(n,i),s._notifyComplete(e)},h=0;h<6;++h){var u=document.createElementNS("http://www.w3.org/1999/xhtml","img");u.crossOrigin=this.options.crossOrigin,u.nextID=h+1,h<5?u.addEventListener("load",o):u.addEventListener("load",a),u.addEventListener("error",r),n[h]=u}n[0].src=s.path+t[0]},Ys.prototype._loadMipChain=function(l,c){for(var _,d=[],f=this,t=document.createElementNS("http://www.w3.org/1999/xhtml","img"),p=[],e=0;e<6;++e)p[e]=l[e].replace("%m","0");t.addEventListener("load",function(){t.naturalWidth===t.naturalHeight&&at.isPowerOfTwo(t.naturalWidth)?(_=at.log2(t.naturalWidth)+1,function(){for(var t=[],e=6*_,i=1,n=0,s=1;s<_;++s){for(var r=0;r<6;++r)p.push(l[r].replace("%m",s.toString())),t.push(i),n+=i;i*=.5}var o=function(){f._notifyFailure("Failed loading texture")},a=function(){f._notifyProgress(t[this.nextID]/n),d[this.nextID].src=f.path+p[this.nextID]},h=function(){for(var t=0;t<_;++t)c.uploadImagesToMipLevel(d.slice(6*t,6*t+6),t);c._isReady=!0,f._notifyComplete(c)};for(s=1;s<e;++s){var u=document.createElementNS("http://www.w3.org/1999/xhtml","img");u.crossOrigin=f.options.crossOrigin,u.nextID=s+1,s<e-1?u.addEventListener("load",a):u.addEventListener("load",h),u.addEventListener("onError",o),d[s]=u}d[1].src=f.path+p[1]}(),d[0]=t):f._notifyFailure("Failed loading mipchain: incorrect dimensions")}),t.addEventListener("error",function(){f._notifyFailure("Failed loading texture")}),t.src=f.path+p[0]},(Qs.prototype=Object.create(Us.prototype)).parse=function(t,e){var i=void 0===this.options.generateMipmaps||this.options.generateMipmaps;e.uploadImage(t,t.naturalWidth,t.naturalHeight,i),this._notifyComplete(e)};var Gs=Qs;function Xs(){Us.call(this,$i),Xs._initPropertyMap()}function Vs(){Ui.call(this),this._bounds=new J}function Hs(){this.onComplete=new r,this.onProgress=new r,this._queue=[],this._childQueues=[],this._currentIndex=0,this._isRunning=!1,this._timeout=void 0}(Xs.prototype=Object.create(Us.prototype)).parse=function(t,e){(t=JSON.parse(t)).class?(this._isClass=!0,this._applyClass(t.class,e)):this._isClass=!1,this._loadShaders(t,e)},Xs.prototype._applyClass=function(t,e){var i;switch(t){case"BasicMaterial":i=tn;break;default:throw new Error("Unknown material class!")}for(var n in Object.assign(e,i.prototype),i.prototype)Object.prototype.hasOwnProperty.call(i.prototype,n)&&(e[n]=i.prototype[n]);for(var s=Object.getOwnPropertyNames(i.prototype),r=0;r<s.length;++r){var o=s[r],a=Object.getOwnPropertyDescriptor(i.prototype,o);Object.defineProperty(e,o,a)}i.call(e)},Xs.prototype._gatherShaderFiles=function(t){var e=[];if(!this._isClass){var i=t.geometry,n=i.vertexShader,s=i.fragmentShader;e.indexOf(n)<0&&e.push(this._correctURL(n)),e.indexOf(s)<0&&e.push(this._correctURL(s))}var r=t.lightingModel;return r&&"unlit"!==r&&e.indexOf(r)<0&&e.push(this._correctURL(r)),e},Xs.prototype._loadShaders=function(t,e){var i=this._gatherShaderFiles(t);this._shaderLibrary=new Fs(null,this.options.crossOrigin),this._shaderLibrary.fileMap=this.fileMap;for(var n=0;n<i.length;++n)this._shaderLibrary.queueAsset(i[n],i[n],Fs.Type.PLAIN_TEXT);this._shaderLibrary.onComplete.bind(function(){this._processMaterial(t,e),this._loadTextures(t,e)},this),this._shaderLibrary.load()},Xs.prototype._processMaterial=function(t,e){var i="";if(!this._isClass){this.options.defines&&_.forEach(this.options.defines,function(t,e){i+="#define "+e+" "+t+"\n"}.bind(this));var n=i+this._shaderLibrary.get(this._correctURL(t.geometry.vertexShader)),s=i+this._shaderLibrary.get(this._correctURL(t.geometry.fragmentShader));e._geometryVertexShader=n,e._geometryFragmentShader=s,e.init()}if("unlit"===t.lightingModel?e.lightingModel=k.Unlit:t.lightingModel&&(e.lightingModel=this._shaderLibrary.get(this._correctURL(t.lightingModel))),this._applyUniforms(t,e),this._isClass&&this._applyProperties(t,e),t.hasOwnProperty("cullMode")&&(e.cullMode=Xs._PROPERTY_MAP[t.cullMode]),t.hasOwnProperty("writeDepth")&&(e.writeDepth=t.writeDepth),t.hasOwnProperty("blend")){var r=new _t,o=t.blend;o.hasOwnProperty("source")&&(r.srcFactor=Xs._PROPERTY_MAP[o.source]),o.hasOwnProperty("destination")&&(r.dstFactor=Xs._PROPERTY_MAP[o.destination]),o.hasOwnProperty("operator")&&(r.operator=Xs._PROPERTY_MAP[o.operator]),e.blendState=r}},Xs.prototype._applyProperties=function(t,e){if(t.properties)for(var i in t.properties)if(t.properties.hasOwnProperty(i)){var n=t.properties[i],s=typeof e[i];if("number"===s||"boolean"===s)e[i]=n;else if(e[i]instanceof h)e[i]=new h(n[0],n[1],n[2],n[3]);else if(e[i]instanceof dt)e[i]=new h(n[0],n[1]);else{if(!(e[i]instanceof Z))throw new Error("Unsupport property format!");e[i]=new Z(n[0],n[1],n[2],n[3])}}},Xs.prototype._applyUniforms=function(t,e){if(t.uniforms)for(var i in t.uniforms)if(t.uniforms.hasOwnProperty(i)){var n=t.uniforms[i];isNaN(n)?e.setUniform(i,{x:n[0],y:n[1],z:n[2],w:n[3]},!1):e.setUniform(i,n,!1)}},Xs.prototype._loadTextures=function(e,i){var t=[];for(var n in e.textures)e.textures.hasOwnProperty(n)&&(t.push(this._correctURL(e.textures[n])),i.setTexture(n,ut.DEFAULT));this._textureLibrary=new Fs(null,this.options.crossOrigin),this._textureLibrary.fileMap=this.fileMap;for(var s=0;s<t.length;++s)this._textureLibrary.queueAsset(t[s],t[s],Fs.Type.ASSET,Qs);this._textureLibrary.onComplete.bind(function(){for(var t in e.textures)e.textures.hasOwnProperty(t)&&(this._isClass?i[t]=this._textureLibrary.get(this._correctURL(e.textures[t])):i.setTexture(t,this._textureLibrary.get(this._correctURL(e.textures[t]))));this._notifyComplete(i)},this),this._textureLibrary.load()},Xs._PROPERTY_MAP=null,Xs._initPropertyMap=function(){Xs._PROPERTY_MAP=Xs._PROPERTY_MAP||{back:Ye.BACK,front:Ye.FRONT,both:Ye.ALL,none:null,one:Ve.ONE,zero:Ve.ZERO,sourceColor:Ve.SOURCE_COLOR,oneMinusSourceColor:Ve.ONE_MINUS_SOURCE_COLOR,sourceAlpha:Ve.SOURCE_ALPHA,oneMinusSourceAlpha:Ve.ONE_MINUS_SOURCE_ALPHA,destinationAlpha:Ve.DST_ALPHA,oneMinusDestinationAlpha:Ve.ONE_MINUS_DESTINATION_ALPHA,destinationColor:Ve.DESTINATION_COLOR,sourceAlphaSaturate:Ve.SOURCE_ALPHA_SATURATE,add:He.ADD,subtract:He.SUBTRACT,reverseSubtract:He.REVERSE_SUBTRACT,always:Ge.ALWAYS,disabled:Ge.DISABLED,equal:Ge.EQUAL,greater:Ge.GREATER,greaterEqual:Ge.GREATER_EQUAL,less:Ge.LESS,lessEqual:Ge.LESS_EQUAL,never:Ge.NEVER,notEqual:Ge.NOT_EQUAL}},Ti.create(Vs,{},Ui),Vs.prototype.acceptVisitor=function(t){t.visitAmbientLight(this)},Vs.prototype._updateBounds=function(){this._bounds.clear(K.EXPANSE_INFINITE)},Vs.prototype.clone=function(){var t=new Vs;return t.copyFrom(this),t},Hs.prototype={get isRunning(){return this._isRunning},queue:function(t,e){var i=1===arguments.length?[t]:Array.apply(null,arguments);this._queue.push({func:t,args:i.slice(1)})},addChildQueue:function(t){this._childQueues.push(t)},execute:function(){if(this._isRunning)throw new Error("Already running!");this._isRunning=!0,this._currentIndex=0,this._executeTask()},cancel:function(){this._isRunning&&(void 0!==this._timeout&&clearTimeout(this._timeout),this._isRunning=!1,this._timeout=void 0)},_executeTask:function(){this._timeout=setTimeout(this._executeImpl.bind(this))},_executeImpl:function(){if(this._isRunning)if(this.onProgress.dispatch(this._currentIndex/this._queue.length),0<this._childQueues.length){var t=this._childQueues.shift();t.onComplete.bind(this._executeImpl,this),t.execute()}else if(this._queue.length===this._currentIndex)this._isRunning=!1,this.onComplete.dispatch();else{var e=this._queue[this._currentIndex];e.func.apply(this,e.args),++this._currentIndex,this._executeTask()}}};var Ws={toCube:function(t,e,i,n){i=i||!0,e=e||t.height,Ws._EQUI_TO_CUBE_SHADER||(Ws._EQUI_TO_CUBE_SHADER=new Q(d.get("2d_to_cube_vertex.glsl"),d.get("equirectangular_to_cube_fragment.glsl"))),this._createRenderCubeGeometry();var s=U.gl;(n=n||new ct).initEmpty(e,t.format,t.dataType);var r=[Je.POSITIVE_X,Je.NEGATIVE_X,Je.POSITIVE_Y,Je.NEGATIVE_Y,Je.POSITIVE_Z,Je.NEGATIVE_Z];U.setShader(Ws._EQUI_TO_CUBE_SHADER);var o=Ws._EQUI_TO_CUBE_SHADER.getUniformLocation("source"),a=Ws._EQUI_TO_CUBE_SHADER.getAttributeLocation("hx_position"),h=Ws._EQUI_TO_CUBE_SHADER.getAttributeLocation("corner");s.uniform1i(o,0),t.bind(0),Ws._TO_CUBE_VERTICES.bind(),Ws._TO_CUBE_INDICES.bind(),s.vertexAttribPointer(a,2,s.FLOAT,!1,20,0),s.vertexAttribPointer(h,3,s.FLOAT,!1,20,8),U.enableAttributes(2);for(var u=U.getCurrentRenderTarget(),l=0;l<6;++l){var c=new gt(n,null,r[l]);c.init(),U.setRenderTarget(c),U.drawElements(s.TRIANGLES,6,6*l)}return U.setRenderTarget(u),i&&n.generateMipmap(),Be.EXT_SHADER_TEXTURE_LOD||(n.filter=Fe.BILINEAR_NOMIP),n},_createRenderCubeGeometry:function(){if(!Ws._TO_CUBE_VERTICES){Ws._TO_CUBE_VERTICES=new W,Ws._TO_CUBE_INDICES=new H,Ws._TO_CUBE_VERTICES.uploadData(new Float32Array([1,1,1,-1,-1,-1,1,1,-1,1,-1,-1,1,1,1,1,-1,1,1,-1,1,1,-1,-1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,1,-1,-1,1,-1,-1,-1,1,1,1,-1,1,1,1,1,1,-1,-1,-1,-1,1,1,-1,-1,-1,-1,1,1,-1,1,-1,-1,1,-1,-1,-1,-1,1,-1,1,-1,1,1,-1,1,1,1,1,1,-1,1,-1,1,1,-1,-1,-1,-1,1,1,-1,1,-1,1,1,1,1,-1,-1,-1,1,-1,-1,-1])),Ws._TO_CUBE_INDICES.uploadData(new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]))}}};function Zs(){this.defaultScene=null,this.defaultCamera=null,this.scenes={},this.meshes={},this.materials={},this.entities={},this.cameras={}}var Ks=[Xe.POINTS,Xe.LINES,Xe.LINE_STRIP,Xe.LINE_LOOP,Xe.TRIANGLES,Xe.TRIANGLE_STRIP,Xe.TRIANGLE_FAN],qs={20:Ke.UNSIGNED_BYTE,21:Ke.UNSIGNED_SHORT,22:Ke.UNSIGNED_INT,30:Ke.FLOAT},Js=[Ye.NONE,Ye.FRONT,Ye.BACK,Ye.ALL],$s=[Ve.ZERO,Ve.ONE,Ve.SOURCE_COLOR,Ve.ONE_MINUS_SOURCE_COLOR,Ve.SOURCE_ALPHA,Ve.ONE_MINUS_SOURCE_ALPHA,Ve.DESTINATION_COLOR,Ve.ONE_MINUS_DESTINATION_COLOR,Ve.DESTINATION_ALPHA,Ve.ONE_MINUS_DESTINATION_ALPHA,Ve.SOURCE_ALPHA_SATURATE,Ve.CONSTANT_ALPHA,Ve.ONE_MINUS_CONSTANT_ALPHA],tr=[He.ADD,He.SUBTRACT,He.REVERSE_SUBTRACT],er=0,ir=1,nr=3,sr=4,rr=5,or=9,ar=10,hr=11,ur=12,lr=13,cr=14,_r=15,dr=21,fr=22,pr=24,gr={2:Ai,3:Ri,6:Pi,7:Fn,8:Wn,9:Fi,10:Gi,11:Yi,12:Vs,13:Qi,14:os,15:as,16:ut,17:ct,18:_t,19:In,20:Gn,23:pn,24:Nn},Mr=0,Ar=1,mr=2,xr=3,Tr=4,yr=5,Nr=6,Dr=7,Er=8,wr=10,Lr=11,Ir=12,vr=13,Sr=14,Or=20,Cr=21,jr=22,br=23,Pr=24,zr=25,Rr=26,Ur=30,Br=31,Fr=32,kr=33,Yr=40,Qr=41,Gr=42,Xr=50,Vr=51,Hr=60,Wr=61,Zr=62,Kr=63,qr=64,Jr=65,$r=66,to=67,eo=68,io=69,no=70,so=71,ro=72,oo=73,ao=80,ho=81,uo=82,lo=83,co=84,_o=85,fo=90,po=91,go=92,Mo=100,Ao=110,mo=111,xo=112,To=120,yo=121,No=122,Do=123,Eo=124,wo=125,Lo=126,Io=127,vo=128,So=129;function Oo(){Us.call(this,Zs,Rs.DATA_BINARY),this._objects=null,this._scenes=null,this._padArrays=!0,this._defaultSceneIndex=0,this._version=null,this._generator=null,this._lights=null,this._dependencyLib=null}function Co(t,e,i){var n;switch(t){case Ke.UNSIGNED_BYTE:n="getUint8";break;case Ke.UNSIGNED_SHORT:n="getUint16";break;case Ke.UNSIGNED_INT:n="getUint32";break;case Ke.FLOAT:n="getFloat32"}return 1===e?new Z(i[n](),i[n](),i[n]()):2===e?new Z(i[n](),i[n](),i[n](),i[n]()):3===e?new Ct(i[n](),i[n](),i[n](),i[n]()):i[n]()}function jo(t){var e=t.getUint8();return 0===e?k.Unlit:1===e?k.GGX:2===e?k.GGX_FULL:3===e?k.BlinnPhong:void 0}function bo(t,e){return(e=e||new h).set(t.getFloat32(),t.getFloat32(),t.getFloat32()),e}function Po(t,e){return(e=bo(t,e)).a=t.getFloat32(),e}function zo(t,e){e?e.copyFrom(Pt.IDENTITY):e=new Pt;for(var i=0;i<4;++i)for(var n=0;n<3;++n)e.setElement(n,i,t.getFloat32());return e}function Ro(t,e){return(e=e||new Z).set(t.getFloat32(),t.getFloat32(),t.getFloat32()),e}function Uo(t,e){return(e=e||new Ct).set(t.getFloat32(),t.getFloat32(),t.getFloat32(),t.getFloat32()),e}function Bo(t,e,i){var n;e._indexType===Ke.UNSIGNED_SHORT?(i._padArrays&&t.skipAlign(2),n=t.getUint16Array(e._numIndices)):(i._padArrays&&t.skipAlign(4),n=t.getUint32Array(e._numIndices)),e.setIndexData(n)}function Fo(t,e){var i=t.getString(),n=t.getUint8(),s=qs[t.getUint8()],r=t.getUint8();console.assert(s===Ke.FLOAT,"HX only supports float32 vertex attribute data"),e.addVertexAttribute(i,n,r,"hx_normal"===i||"hx_tangent"===i)}function ko(t,e,i){var n=e._numVertices*e.getVertexStride(0);i._padArrays&&t.skipAlign(4);for(var s=t.getFloat32Array(n),r=0;e._vertexData[r];)++r;e.setVertexData(s,r)}function Yo(t,e,i,n){e instanceof Ai&&(t.attach(e),e instanceof rs&&1===i&&(n.defaultCamera=e))}function Qo(t,e,i,n){e instanceof Ti?t.addComponent(e):Yo(t,e,i,n)}function Go(t,e,i,n){e instanceof pn?t.skybox=e:Qo(t,e,i,n)}Oo.prototype=Object.create(Us.prototype),Oo.VERSION="0.1.0",Oo.prototype.parse=function(t,e){if(this._target=e,this._stream=new ps(t),"HX"!==this._stream.getString(2))throw new Error("Invalid file hash!");this._defaultSceneIndex=0,this._lightingMode=0,this._objects=[],this._scenes=[],this._meshes=[],this._lights=null,this._dependencyLib=new Fs(null,this.options.crossOrigin),this._parseHeader(),this._parseObjectList(),e.defaultScene=this._scenes[this._defaultSceneIndex],this._calcMissingMeshData()},Oo.prototype._calcMissingMeshData=function(){for(var t=new Hs,e=new oi,i=0,n=this._meshes.length;i<n;++i){var s=0,r=this._meshes[i];r.hasVertexAttribute("hx_normal")||(s|=oi.MODE_NORMALS),r.hasVertexAttribute("hx_tangent")||(s|=oi.MODE_TANGENTS),t.queue(e.generate.bind(e,r,s))}t.onComplete.bind(this._loadDependencies,this),t.execute()},Oo.prototype._loadDependencies=function(){this._dependencyLib.onComplete.bind(this._onDependenciesLoaded,this),this._dependencyLib.onProgress.bind(this._notifyProgress,this),this._dependencyLib.load()},Oo.prototype._onDependenciesLoaded=function(){this._parseLinkList(),this._notifyComplete(this._target)},Oo.prototype._parseHeader=function(){var t,e=this._stream;do{switch(t=e.getUint32()){case Ir:this._padArrays=!!e.getUint8();break;case vr:this._defaultSceneIndex=e.getUint8();break;case Sr:this._lightingMode=e.getUint8(),1===this._lightingMode&&(this._lights=[]);break;case wr:this._version=e.getString();break;case Lr:this._generator=e.getString()}}while(t!==Mr);if(this._version!==Oo.VERSION)throw new Error("Incompatible file version!")},Oo.prototype._parseObjectList=function(){var t,e,i=this._stream;do{switch(t=i.getUint32()){case ir:e=this._parseObject(un,i),this._scenes.push(e),this._target.scenes[e.name]=e;break;case sr:e=this._parseObject(et,i),this._meshes.push(e),this._target.meshes[e.name]=e;break;case rr:e=this._parseBasicMaterial(i),this._target.materials[e.name]=e;break;case dr:e=this._parseSkeletonPose(i);break;case fr:e=this._parseKeyFrame(i);break;case cr:case _r:e=this._parseObject(gr[t],i),this._target.cameras[e.name]=e;break;case nr:case pr:for(e=this._parseObject(gr[t],i);this._target.entities[e.name];)e.name=e.name+"_";this._target.entities[e.name]=e;break;case er:return;case or:case hr:case ar:case ur:case lr:e=this._parseObject(gr[t],i),this._lights&&e&&this._lights.push(e);break;default:var n=gr[t];if(!n)throw new Error("Unknown object type "+t+" at 0x"+(i.offset-4).toString(16));e=this._parseObject(n,i)}e&&this._objects.push(e)}while(t!==er)},Oo.prototype._parseObject=function(t,e){var i=new t;return this._readProperties(e,i),i},Oo.prototype._parseKeyFrame=function(t){var e,i=new wn,n=Ke.FLOAT,s=0;do{switch(e=t.getUint32()){case Ao:i.time=t.getFloat32();break;case Nr:n=qs[t.getUint8()];break;case Dr:s=t.getUint8();break;case Er:i.value=Co(n,s,t)}}while(e!==Mr);return i},Oo.prototype._parseSkeletonPose=function(t){var e,i=new pi,n=0,s=0,r=0;function o(t){return i.getJointPose(t)||i.setJointPose(t,new fi),i.getJointPose(t)}do{switch(e=t.getUint32()){case Ur:Ro(t,o(n++).position);break;case Br:Uo(t,o(s++).rotation);break;case Fr:Ro(t,o(r++).scale)}}while(e!==Mr);return i},Oo.prototype._parseBasicMaterial=function(t){var e=new tn;return e.roughness=.5,1===this._lightingMode&&(e.fixedLights=this._lights),this._readProperties(t,e),e},Oo.prototype._readProperties=function(t,e){var i;do{switch(i=t.getUint32()){case Ar:e.name=t.getString();break;case mr:this._handleURL(t.getString(),e);break;case xr:e.castShadows=!!t.getUint8();break;case Or:e._numVertices=t.getUint32();break;case Cr:e._numIndices=t.getUint32();break;case br:e._indexType=qs[t.getUint8()];break;case Pr:Bo(t,e,this);break;case jr:e.elementType=Ks[t.getUint8()];break;case zr:Fo(t,e);break;case Rr:ko(t,e,this);break;case Ur:Ro(t,e.position);break;case Br:Uo(t,e.rotation);break;case Fr:Ro(t,e.scale);break;case kr:e.visible=!!t.getUint8();break;case Tr:e.color=bo(t);break;case yr:e.color=Po(t);break;case Yr:e.intensity=t.getFloat32();break;case Qr:e.radius=t.getFloat32();break;case Gr:e.innerAngle=t.getFloat32(),e.outerAngle=t.getFloat32();break;case Xr:e.wrapMode=t.getUint8()?ke.REPEAT:ke.CLAMP;break;case Vr:e.filter=[Fe.NEAREST,Fe.BILINEAR,Fe.TRILINEAR,Fe.TRILINEAR_ANISOTROPIC||Fe.TRILINEAR,Fe.NEAREST_NOMIP,Fe.BILINEAR_NOMIP][t.getUint8()];break;case Hr:e.useVertexColors=!!t.getUint8();break;case Wr:e.alpha=t.getFloat32();break;case Zr:e.emissiveColor=bo(t);break;case Kr:e.specularMapMode=t.getUint8();break;case qr:e.metallicness=t.getFloat32();break;case Jr:e.normalSpecularReflectance=t.getFloat32();break;case $r:e.roughness=t.getFloat32();break;case to:e.roughnessRange=t.getFloat32();break;case eo:e.alphaThreshold=t.getFloat32();break;case io:e.lightingModel=jo(t);break;case no:e.cullMode=Js[t.getUint8()];break;case so:e.blendState=[null,_t.ADD,_t.MULTIPLY,_t.ALPHA][t.getUint8()];break;case ro:e.writeDepth=!!t.getUint8();break;case oo:e.writeColor=!!t.getUint8();break;case To:e.colorMapScale=new dt(t.getFloat32(),t.getFloat32());break;case yo:e.colorMapOffset=new dt(t.getFloat32(),t.getFloat32());break;case No:e.normalMapScale=new dt(t.getFloat32(),t.getFloat32());break;case Do:e.normalMapOffset=new dt(t.getFloat32(),t.getFloat32());break;case Eo:e.specularMapScale=new dt(t.getFloat32(),t.getFloat32());break;case wo:e.specularMapOffset=new dt(t.getFloat32(),t.getFloat32());break;case vo:e.emissionMapScale=new dt(t.getFloat32(),t.getFloat32());break;case So:e.emissionMapOffset=new dt(t.getFloat32(),t.getFloat32());break;case Lo:e.maskMapScale=new dt(t.getFloat32(),t.getFloat32());break;case Io:e.maskMapOffset=new dt(t.getFloat32(),t.getFloat32());break;case ao:e.srcFactor=$s[t.getUint8()];break;case ho:e.dstFactor=$s[t.getUint8()];break;case uo:e.operator=tr[t.getUint8()];break;case lo:e.alphaSrcFactor=$s[t.getUint8()];break;case co:e.alphaDstFactor=$s[t.getUint8()];break;case _o:e.alphaOperator=tr[t.getUint8()];break;case fo:e.nearDistance=t.getFloat32(),e.farDistance=t.getFloat32();break;case po:e.verticalFOV=t.getFloat32();break;case go:e.height=t.getFloat32();break;case Mo:zo(t,e.inverseBindPose);break;case mo:e.looping=!!t.getUint8();break;case xo:e.playbackRate=t.getFloat32()}}while(i!==Mr)},Oo.prototype._handleURL=function(t,e){var i;switch(t.toLowerCase().substr(t.lastIndexOf(".")+1)){case"jpg":case"jpeg":case"png":i=Qs;break;default:e instanceof ut&&(i=Qs)}this._dependencyLib.queueAsset(name,this._correctURL(t),Fs.Type.ASSET,i,null,e)},Oo.prototype._parseLinkList=function(){for(var t=this._stream,e={},i=[],n=[],s=[];t.bytesAvailable;){var r=t.getUint32(),o=t.getUint32(),a=t.getUint8(),h=this._objects[r],u=this._objects[o];if(u instanceof Fn)i.push({child:u,parent:h,meta:a});else if(u instanceof Gn)n.push({child:u,parent:h,meta:a});else if(h instanceof un)Go(h,u,a,this._target);else if(h instanceof Nn&&1===a)h.node=u;else if(h instanceof Ri)Qo(h,u,a,this._target);else if(h instanceof Ai)Yo(h,u,a,this._target);else if(h instanceof Pi)Ho(h,u);else if(h instanceof $i)Vo(h,u,a);else if(h instanceof Qi)Zo(h,u,a);else if(h instanceof pn)Wo(h,u);else if(h instanceof Fn)Ko(h,u,-1),e[o]=h;else if(h instanceof Wn){var l=e[r];Ko(l,u,l.joints.indexOf(h)),e[o]=l}else h instanceof Gn?qo(h,u,a,s):h instanceof wn?h.value=u:h instanceof In&&h.addKeyFrame(u)}for(var c=0,_=i.length;c<_;++c){h=(d=i[c]).parent,u=d.child,h.skeleton=u}for(c=0,_=n.length;c<_;++c){var d;h=(d=n[c]).parent,u=d.child,h.addComponent(u)}for(c=0,_=s.length;c<_;++c)s[c]()};var Xo={0:"colorMap",1:"normalMap",2:"specularMap",3:"occlusionMap",4:"emissionMap",5:"maskMap"};function Vo(t,e,i){e instanceof _t?t.blendState=e:e instanceof ut&&(t[Xo[i]]=e)}function Ho(t,e){e instanceof $i?t.material=e:e instanceof et&&(t.mesh=e)}function Wo(t,e){e instanceof ut&&(e=Ws.toCube(e,e.height,!0)),skybox.setTexture(e)}function Zo(t,e,i){e instanceof ut&&(e=Ws.toCube(e,e.height,!0)),0===i?parent.diffuseTexture=e:parent.specularTexture=e}function Ko(t,e,i){e.parentIndex=i,t.joints.push(e)}function qo(t,e,i,n){e instanceof In&&(t.animationNode||(t.animationNode=new Zn),console.assert(t.animationNode instanceof Zn,"Can't assign clip directly to skeleton when also assigning blend trees"),t.animationNode.addClip(e),1===i&&n.push(t.animationNode.fadeTo.bind(t.animationNode,e.name,0,!1)))}function Jo(){Us.call(this,ct,Us.TYPE_IMAGE)}(Jo.prototype=Object.create(Us.prototype)).parse=function(t,e){var i=new ut;i.wrapMode=ke.REPEAT,i.uploadImage(t,t.naturalWidth,t.naturalHeight,!0);var n=void 0===this.options.generateMipmaps||this.options.generateMipmaps;Ws.toCube(i,this.options.size,n,e),this._notifyComplete(e)};var $o=Jo,ta={from8BitTexture:function(t,e,i){var n=U.gl;e=e||!0;var s=i||new ut;s.initEmpty(t.width,t.height);var r=new gt(s);r.init();var o=new ut;o.initEmpty(t.width,t.height);var a=new gt(o);a.init();var h=new G(d.get("greyscale_to_rgba8.glsl")),u=U.getCurrentRenderTarget();U.setRenderTarget(r),U.clear(),h.execute(st.DEFAULT,t),e&&i.generateMipmap();var l=new G(d.get("smooth_heightmap_fragment.glsl")),c=n.getUniformLocation(l.program,"reference"),_=n.getUniformLocation(l.program,"stepSize");return n.uniform1i(c,1),t.bind(1),U.setRenderTarget(a),U.clear(),n.uniform2f(_,1/t.width,0),l.execute(st.DEFAULT,s),o.generateMipmap(),U.setRenderTarget(r),U.clear(),n.uniform2f(_,0,1/t.height),l.execute(st.DEFAULT,o),e&&i.generateMipmap(),U.setRenderTarget(u),s}};function ea(){Us.call(this,ut,Us.TYPE_IMAGE)}(ea.prototype=Object.create(Us.prototype)).parse=function(t,e){var i=new ut;i.wrapMode=ke.REPEAT,i.uploadImage(t,t.naturalWidth,t.naturalHeight,!0);var n=void 0===this.options.generateMipmaps||this.options.generateMipmaps;ta.from8BitTexture(i,n,e),this._notifyComplete(e)};var ia,na,sa,ra,oa,aa,ha,ua=ea;function la(){this._renderBuffer=U.gl.createRenderbuffer(),this._format=null}function ca(t,e,i,n,s,r){for(var o=n.length,a=null,h=null,u=0;u<o;++u){var l=n[u],c=l.material.getPass(i);if(c){var _=l.meshInstance;c!==a&&(c.updatePassRenderState(e,t,s),a=c,h=null),c.updateInstanceRenderState(e,l,s),h!==_._mesh&&(_.updateRenderState(i),h=_._mesh);var d=_._mesh;U.drawElements(d.elementType,d._numIndices,0,d._indexType)}}return U.setBlendState(null),o}function _a(t,e,i,n){this.x=t||0,this.y=e||0,this.width=i||0,this.height=n||0}function da(){this._texture=new ut,this._depthBuffer=new la,this._fbo=new gt(this._texture,this._depthBuffer),ve.OPTIONS.shadowFilter.blurShader&&(this._fboNoDepth=new gt(this._texture,null),this._texture2=new ut,this._fbo2=new gt(this._texture2,null))}function fa(){_n.call(this),this._renderCameras=null,this._cameraYAxis=new Z,this._bounds=new J,this._cullPlanes=null,this._numCullPlanes=0,this._renderList=[],this._renderItemPool=new ln(gn)}function pa(){this._inverseLightMatrix=new Pt,this._collectorCamera=new hs,this._maxY=0,this._numCullPlanes=0,this._cullPlanes=[],this._localBounds=new J,this._casterCollector=new fa,this._shadowMapCameras=function(){for(var t=[],e=0;e<ve.OPTIONS.numShadowCascades;++e)t[e]=new hs;return t}()}function ga(){_n.call(this),this._lightBounds=null,this._renderLists=[],this._renderItemPool=new ln(gn),this._octantPlanes=[],this._cameraPos=null,this._octantPlanes[0]=new Z(0,1,-1,0),this._octantPlanes[1]=new Z(1,0,-1,0),this._octantPlanes[2]=new Z(-1,0,-1,0),this._octantPlanes[3]=new Z(0,-1,-1,0),this._octantPlanes[4]=new Z(1,1,0,0),this._octantPlanes[5]=new Z(-1,1,0,0);for(var t=0;t<6;++t)this._octantPlanes[t].normalize()}function Ma(){this._casterCollector=new ga,this._scene=null,this._initFaces()}function Aa(){_n.call(this),this._frustumPlanes=null,this._renderList=[],this._renderItemPool=new ln(gn),this._cameraYAxis=new Z}function ma(){this._casterCollector=new Aa,this._camera=new os,this._camera.nearDistance=.01}function xa(t){if(this.renderTarget=t||null,this._width=0,this._height=0,this.depthPrepass=!1,this._gammaApplied=!1,this._copyTextureShader=new X("xyzw",!0),this._applyGamma=new V,this._camera=null,this._activeCamera=null,this._scene=null,this._depthBuffer=this._createDepthBuffer(),this._hdrBack=new xa.HDRBuffers(this._depthBuffer),this._hdrFront=new xa.HDRBuffers(this._depthBuffer),this._renderCollector=new Tn,this._normalDepthBuffer=new ut,this._normalDepthBuffer.filter=Fe.BILINEAR_NOMIP,this._normalDepthBuffer.wrapMode=ke.CLAMP,this._normalDepthFBO=new gt(this._normalDepthBuffer,this._depthBuffer),this._backgroundColor=h.BLACK.clone(),this.debugMode=xa.DebugMode.NONE,this._ssaoTexture=null,this._cascadeShadowRenderer=new pa,this._omniShadowRenderer=new Ma,this._spotShadowRenderer=new ma,this._shadowAtlas=new da(!!ve.OPTIONS.shadowFilter.blurShader),this._shadowAtlas.resize(2048,2048),Be.WEBGL_2){var e=16+320*ve.OPTIONS.maxDirLights+16*ve.OPTIONS.maxLightProbes+224*ve.OPTIONS.maxPointSpotLights;this._diffuseProbeArray=[],this._specularProbeArray=[],this._lightingUniformBuffer=new Y(e),this._lightingDataView=new DataView(new ArrayBuffer(e)),this._numCells=ve.OPTIONS.numLightingCellsX*ve.OPTIONS.numLightingCellsY,this._cellStride=ve.OPTIONS.maxPointSpotLights+1,this._lightingCellsUniformBuffer=new Y(this._numCells*this._cellStride*4),this._cellData=new Int32Array(this._numCells*this._cellStride);for(var i=0;i<e;++i)this._lightingDataView.setInt8(i,0)}}function Ta(t,e,i,n){var s=new ct,r=new ct;e=e||Ke.UNSIGNED_BYTE,s.initEmpty(4,null,e),r.initEmpty(t,null,e),i=i||.1,n=n||1e3,Qi.call(this,s,r),this._cameras=[],this._specularFBOs=[],this._diffuseFBOs=[];var o=new la;o.init(t,t,!1);for(var a=[],h=0;h<6;++h)a[h]=new Ct;a[0].fromAxisAngle(Z.Y_AXIS,.5*Math.PI),a[1].fromAxisAngle(Z.Y_AXIS,.5*-Math.PI),a[2].fromAxisAngle(Z.X_AXIS,.5*-Math.PI),a[3].fromAxisAngle(Z.X_AXIS,.5*Math.PI),a[4].fromAxisAngle(Z.Y_AXIS,0),a[5].fromAxisAngle(Z.Y_AXIS,Math.PI),this._diffuseScene=new un,this._diffuseScene.skybox=new pn(r);var u=[Je.POSITIVE_X,Je.NEGATIVE_X,Je.POSITIVE_Y,Je.NEGATIVE_Y,Je.POSITIVE_Z,Je.NEGATIVE_Z];for(h=0;h<6;++h){var l=new os;l.nearDistance=i,l.farDistance=n,l.verticalFOV=.5*Math.PI,l.rotation.copyFrom(a[h]),l.scale.set(1,-1,1),this._cameras.push(l);var c=new gt(r,o,u[h]);c.init(),this._specularFBOs.push(c),(c=new gt(s,null,u[h])).init(),this._diffuseFBOs.push(c)}this._renderer=new xa}function ya(){Dn.call(this),this._onLightAddedFuncs={},this._onLightRemovedFuncs={},this._queue=null}function Na(t,e){t.fixedLights=e,t.init()}function Da(t){Q.call(this);var e=U.gl,i={RADIUS:t,RCP_NUM_SAMPLES:"float("+1/(1+2*t)+")"},n=d.get("copy_vertex.glsl",i),s=d.get("esm_blur_fragment.glsl",i);this.init(n,s),this._textureLocation=e.getUniformLocation(this.program,"source"),this._directionLocation=e.getUniformLocation(this.program,"direction"),this._positionAttributeLocation=e.getAttribLocation(this.program,"hx_position"),this._texCoordAttributeLocation=e.getAttribLocation(this.program,"hx_texCoord"),e.useProgram(this.program),e.uniform1i(this._textureLocation,0)}function Ea(t){var e=U.gl;Q.call(this);var i={RADIUS:t,RCP_NUM_SAMPLES:"float("+1/(1+2*t)+")"},n=d.get("copy_vertex.glsl",i),s=d.get("vsm_blur_fragment.glsl",i);this.init(n,s),this._textureLocation=e.getUniformLocation(this.program,"source"),this._directionLocation=e.getUniformLocation(this.program,"direction"),this._positionAttributeLocation=e.getAttribLocation(this.program,"hx_position"),this._texCoordAttributeLocation=e.getAttribLocation(this.program,"hx_texCoord"),e.useProgram(this.program),e.uniform1i(this._textureLocation,0)}function wa(){z.call(this),this.lightBleedReduction=.5,this.minVariance=.001,this.useHalfFloat=!0,this._blurRadius=2}function La(){z.call(this),this.shadowMapFilter=Fe.BILINEAR_NOMIP,this._expScaleFactor=80,this._blurRadius=1,this._darkeningFactor=.35}function Ia(){z.call(this),this.softness=.001,this.numShadowSamples=6,this.dither=!1}function va(t){ai.call(this,t)}function Sa(t){ai.call(this,t)}function Oa(t){ai.call(this,t)}function Ca(t){ai.call(this,t),this.elementType=Xe.LINES}function ja(t){ai.call(this,t),this.elementType=Xe.LINES}function ba(){xa.call(this),this._leftTarget=new xa.HDRBuffers(this._depthBuffer),this._leftRect=new _a,this._rightRect=new _a}function Pa(){this._views=[]}la.prototype={get width(){return this._width},get height(){return this._height},get format(){return this._format},init:function(t,e,i){var n=U.gl;i=void 0===i||i,this._width=t,this._height=e,this._format=i?n.DEPTH_STENCIL:n.DEPTH_COMPONENT16,n.bindRenderbuffer(n.RENDERBUFFER,this._renderBuffer),n.renderbufferStorage(n.RENDERBUFFER,this._format,t,e),n.bindRenderbuffer(n.RENDERBUFFER,null)}},da.prototype={get fbo(){return this._fbo},get texture(){return this._texture},get size(){return this._size},resize:function(t){if(this._size!==t){if(this._size=t,this._texture.initEmpty(t,t,ve.OPTIONS.shadowFilter.getShadowMapFormat(),ve.OPTIONS.shadowFilter.getShadowMapDataType()),this._texture.filter=ve.OPTIONS.shadowFilter.getShadowMapFilter(),this._texture.filter!==Fe.NEAREST_NOMIP&&this._texture.filter!==Fe.BILINEAR_NOMIP)throw new Error("ShadowAtlas does not support mipmaps!");this._depthBuffer.init(t,t,!1),this._fbo.init(),this._texture2&&(this._texture2.initEmpty(t,t,ve.OPTIONS.shadowFilter.getShadowMapFormat(),ve.OPTIONS.shadowFilter.getShadowMapDataType()),this._texture2.filter=Fe.NEAREST_NOMIP,this._fboNoDepth.init(),this._fbo2.init())}},getNextRect:function(){return this._rects[this._currentRectIndex++]},initRects:function(t,e){this._currentRectIndex=0,this._rects=[new _a(0,0,this._size,this._size)];for(var i=t.length,n=0;n<i;++n){var s=t[n];if(!(0<(e-=s)))return void this._divideLast(s,this._rects);this._divideLast(s+1,this._rects)}},blur:function(){var t=ve.OPTIONS.shadowFilter,e=t.blurShader;if(e){this._texture.filter=Fe.NEAREST_NOMIP;for(var i=t.numBlurPasses,n=0;n<i;++n)U.setRenderTarget(this._fbo2),U.clear(),e.execute(st.DEFAULT,this._texture,1/this._size,0),U.setRenderTarget(this._fboNoDepth),U.clear(),e.execute(st.DEFAULT,this._texture2,0,1/this._size);this._texture.filter=t.getShadowMapFilter()}},_divideLast:function(t,e){if(!(t<=1))for(var i=e[e.length-1],n=Math.floor(Math.sqrt(t)),s=Math.ceil(t/n),r=i.x,o=i.y,a=i.width/n,h=i.height/s,u=0,l=0;l<s;++l)for(var c=0;c<n;++c){var _;if(i?(_=i,i=null):(_=new _a,e.push(_)),_.x=r+c*a,_.y=o+l*h,_.width=a,_.height=h,++u===t)return _}}},(fa.prototype=Object.create(_n.prototype)).getRenderList=function(t){return this._renderList[t]},fa.prototype.collect=function(t,e){this.reset(),(this._collectorCamera=t).worldMatrix.getColumn(1,this._cameraYAxis),this._bounds.clear(),this._renderItemPool.reset();for(var i=ve.OPTIONS.numShadowCascades,n=0;n<i;++n)this._renderList[n]=[];for(e.acceptVisitor(this),n=0;n<i;++n)this._renderList[n].sort(An)},fa.prototype.getBounds=function(){return this._bounds},fa.prototype.setRenderCameras=function(t){this._renderCameras=t},fa.prototype.setCullPlanes=function(t,e){this._cullPlanes=t,this._numCullPlanes=e},fa.prototype.visitMeshInstance=function(t){if(t.castShadows&&t.enabled){var e=t.skeleton,i=t.skeletonMatrices,n=t.entity,s=this.getProxiedBounds(n);this._bounds.growToIncludeBound(s);for(var r=ge.DIR_LIGHT_SHADOW_MAP_PASS,o=ve.OPTIONS.numShadowCascades,a=this._cameraYAxis,h=a.x,u=a.y,l=a.z,c=0;c<o;++c){var _=this._renderList[c],d=this._renderCameras[c];if(s.intersectsConvexSolid(d.frustum.planes,4)){var f=t.material;if(f.hasPass(r)){var p=this._renderItemPool.getItem();p.pass=f.getPass(r),p.meshInstance=t,p.worldMatrix=this.getProxiedMatrix(n),p.material=f,p.skeleton=e,p.skeletonMatrices=i;var g=s._center;p.renderOrderHint=g.x*h+g.y*u+g.z*l,p.worldBounds=s,_.push(p)}}}}},fa.prototype.qualifies=function(t,e){return t.hierarchyVisible&&(e||t.worldBounds.intersectsConvexSolid(this._cullPlanes,this._numCullPlanes))},pa.prototype={render:function(t,e,i,n){this._inverseLightMatrix.inverseAffineOf(t.entity.worldMatrix),this._updateCollectorCamera(t,i),this._updateSplits(t,i),this._updateCullPlanes(t,i),this._collectShadowCasters(n),this._updateCascadeCameras(t,e,i,this._casterCollector.getBounds());for(var s=ge.DIR_LIGHT_SHADOW_MAP_PASS,r=ve.OPTIONS.numShadowCascades,o=1/e.size,a=0;a<r;++a){var h=e.getNextRect();U.setViewport(h);var u=t._shadowMatrices[a],l=this._shadowMapCameras[a];u.copyFrom(l.viewProjectionMatrix),u.appendScale(.5),u.appendTranslation(.5,.5,.5),u.appendScale(h.width*o,h.height*o,1),u.appendTranslation(h.x*o,h.y*o,0),ca(this,l,s,this._casterCollector.getRenderList(a))}},_updateCollectorCamera:function(t,e){var i=e.frustum.corners,n=new Z,s=new Z,r=new Z;this._inverseLightMatrix.transformPoint(i[0],n),s.copyFrom(n);for(var o=1;o<8;++o)this._inverseLightMatrix.transformPoint(i[o],r),n.minimize(r),s.maximize(r);this._maxY=s.y,this._collectorCamera.matrix.copyFrom(t.entity.worldMatrix),this._collectorCamera._invalidateWorldMatrix(),this._collectorCamera.setBounds(n.x,s.x+1,s.z+1,n.z)},_updateSplits:function(t,e){for(var i=e.nearDistance,n=e.farDistance-i,s=ve.OPTIONS.numShadowCascades,r=t._cascadeSplitDistances,o=t._cascadeSplitRatios,a=0;a<s;++a)r[a]=i+o[a]*n},_updateCascadeCameras:function(t,e,i,n){this._localBounds.transformFrom(n,this._inverseLightMatrix);for(var s=this._localBounds.minimum,r=this._localBounds.maximum,o=new Z,a=new Z,h=new Z,u=new Z,l=i.frustum.corners,c=0,_=ve.OPTIONS.numShadowCascades,d=0;d<_;++d){var f=t._cascadeSplitRatios[d],p=this._shadowMapCameras[d];p.matrix=t.entity.worldMatrix;for(var g=0;g<4;++g){var M=l[g],A=l[g+4],m=M.x,x=M.y,T=M.z,y=A.x-m,N=A.y-x,D=A.z-T;o.x=m+y*c,o.y=x+N*c,o.z=T+D*c,a.x=m+y*f,a.y=x+N*f,a.z=T+D*f,this._inverseLightMatrix.transformPoint(o,o),this._inverseLightMatrix.transformPoint(a,a),0===g?(h.copyFrom(o),u.copyFrom(o)):(h.minimize(o),u.maximize(o)),h.minimize(a),u.maximize(a)}c=f,u.y=Math.min(this._maxY,u.y);var E=Math.max(h.x,s.x),w=Math.min(u.x,r.x),L=Math.max(h.z,s.z),I=Math.min(u.z,r.z),v=w-E,S=I-L;v=1*Math.ceil(v/1),S=1*Math.ceil(S/1),v=Math.max(v,1),S=Math.max(S,1);var O=e.size/v*.5,C=e.size/S*.5;w=(E=Math.floor(E*O)/O)+v,I=(L=Math.floor(L*C)/C)+S;var j=ve.OPTIONS.shadowFilter.softness?ve.OPTIONS.shadowFilter.softness:.002;p.setBounds(E-j,w+j,I+j,L-j),p.nearDistance=s.y,p.farDistance=u.y}},_updateCullPlanes:function(t,e){for(var i=this._collectorCamera.frustum,n=i.planes,s=0;s<4;++s)this._cullPlanes[s]=n[s];this._numCullPlanes=4,n=(i=e.frustum).planes;for(var r=t.direction,o=0;o<6;++o){var a=n[o];.001<a.dot3(r)&&(this._cullPlanes[this._numCullPlanes++]=a)}},_collectShadowCasters:function(t){this._casterCollector.setCullPlanes(this._cullPlanes,this._numCullPlanes),this._casterCollector.setRenderCameras(this._shadowMapCameras),this._casterCollector.collect(this._collectorCamera,t)}},(ga.prototype=Object.create(_n.prototype)).getRenderList=function(t){return this._renderLists[t]},ga.prototype.setLightBounds=function(t){this._lightBounds=t},ga.prototype.collect=function(t,e){this.reset(),this._cameras=t,this._renderLists=[];for(var i=this._cameraPos=t[0].position,n=0;n<6;++n){var s=this._octantPlanes[n];s.w=-(i.x*s.x+i.y*s.y+i.z*s.z),this._renderLists[n]=[]}for(this._renderItemPool.reset(),e.acceptVisitor(this),n=0;n<6;++n)this._renderLists[n].sort(An)},ga.prototype.visitMeshInstance=function(t){if(t.castShadows&&t.enabled){var e=t.entity,i=this.getProxiedBounds(e),n=this.getProxiedMatrix(e),s=this._octantPlanes,r=i.classifyAgainstPlane(s[0]),o=i.classifyAgainstPlane(s[1]),a=i.classifyAgainstPlane(s[2]),h=i.classifyAgainstPlane(s[3]),u=i.classifyAgainstPlane(s[4]),l=i.classifyAgainstPlane(s[5]);0<=o&&a<=0&&0<=u&&l<=0&&this._addTo(t,0,i,n),o<=0&&0<=a&&u<=0&&0<=l&&this._addTo(t,1,i,n),0<=r&&h<=0&&0<=u&&0<=l&&this._addTo(t,2,i,n),r<=0&&0<=h&&u<=0&&l<=0&&this._addTo(t,3,i,n),r<=0&&o<=0&&a<=0&&h<=0&&this._addTo(t,4,i,n),0<=r&&0<=o&&0<=a&&0<=h&&this._addTo(t,5,i,n)}},ga.prototype._addTo=function(t,e,i,n){var s=t.skeleton,r=t.skeletonMatrices,o=this._renderItemPool,a=this._cameraPos,h=a.x,u=a.y,l=a.z,c=this._renderLists[e],_=t.material,d=o.getItem();d.material=_,d.meshInstance=t,d.skeleton=s,d.skeletonMatrices=r;var f=i._center,p=h-f.x,g=u-f.y,M=l-f.z;d.renderOrderHint=p*p+g*g+M*M,d.worldMatrix=n,d.worldBounds=i,c.push(d)},ga.prototype.qualifies=function(t,e){return t.hierarchyVisible&&(e||t.worldBounds.intersectsBound(this._lightBounds))},Ma.prototype={render:(ia=new Z,function(t,e,i,n){var s=t.entity;s.worldMatrix.getColumn(3,ia);for(var r=0;r<6;++r){var o=this._cameras[r],a=t._radius;o.farDistance=a,o.position.copyFrom(ia)}this._casterCollector.setLightBounds(s.worldBounds),this._casterCollector.collect(this._cameras,n),U.setInvertCulling(!0);var h=1/e.size;for(r=0;r<6;++r){var u=e.getNextRect(),l=this._cameras[r];U.setViewport(u);var c=u.width*h,_=u.height*h,d=u.x*h,f=u.y*h;t._shadowTiles[r].set(.5*c,.5*_,.5*c+d,.5*_+f),ca(this,l,ge.POINT_LIGHT_SHADOW_MAP_PASS,this._casterCollector.getRenderList(r),t)}U.setInvertCulling(!1),U.setColorMask(!0)}),_initFaces:function(){this._cameras=[],(new Ct).fromAxisAngle(Z.Z_AXIS,Math.PI);for(var t=[],e=0;e<6;++e)t[e]=new Ct;for(t[0].fromAxisAngle(Z.Z_AXIS,.5*-Math.PI),t[1].fromAxisAngle(Z.Z_AXIS,.5*Math.PI),t[2].fromAxisAngle(Z.Z_AXIS,0),t[3].fromAxisAngle(Z.Z_AXIS,Math.PI),t[4].fromAxisAngle(Z.X_AXIS,.5*Math.PI),t[5].fromAxisAngle(Z.X_AXIS,.5*-Math.PI),e=0;e<6;++e){var i=new os;i.nearDistance=.01,i.verticalFOV=.5*Math.PI,i.rotation.copyFrom(t[e]),i.scale.set(1,1,-1),this._cameras.push(i)}}},(Aa.prototype=Object.create(_n.prototype)).getRenderList=function(){return this._renderList},Aa.prototype.collect=function(t,e){this.reset(),this._camera=t,this._renderList=[],t.worldMatrix.getColumn(1,this._cameraYAxis),this._frustumPlanes=t.frustum.planes,this._renderItemPool.reset(),e.acceptVisitor(this),this._renderList.sort(An)},Aa.prototype.visitMeshInstance=function(t){if(t.castShadows&&t.enabled){var e=t.entity,i=this.getProxiedBounds(e),n=this._cameraYAxis,s=n.x,r=n.y,o=n.z,a=t.skeleton,h=t.skeletonMatrices,u=this._renderItemPool,l=this._renderList,c=t.material,_=u.getItem();_.material=c,_.meshInstance=t,_.skeleton=a,_.skeletonMatrices=h;var d=i._center;_.renderOrderHint=d.x*s+d.y*r+d.z*o,_.worldMatrix=this.getProxiedMatrix(e),_.worldBounds=i,l.push(_)}},Aa.prototype.qualifies=function(t,e){return t.visible&&(e||t.worldBounds.intersectsConvexSolid(this._frustumPlanes,6))},ma.prototype={render:function(t,e,i,n){this._camera.verticalFOV=t.outerAngle,this._camera.farDistance=t._radius,this._camera.matrix.copyFrom(t.entity.worldMatrix),this._camera._invalidateWorldMatrix(),this._casterCollector.collect(this._camera,n);var s=e.getNextRect(),r=1/e.size;U.setViewport(s),t.shadowMatrix.copyFrom(this._camera.viewProjectionMatrix);var o=s.width*r,a=s.height*r,h=s.x*r,u=s.y*r;t._shadowTile.set(.5*o,.5*a,.5*o+h,.5*a+u),ca(this,this._camera,ge.POINT_LIGHT_SHADOW_MAP_PASS,this._casterCollector.getRenderList(),t)}},xa.DebugMode={NONE:0,SSAO:1,NORMAL_DEPTH:2,SHADOW_MAP:3},(xa.HDRBuffers=function(t){this.texture=new ut,this.texture.filter=Fe.BILINEAR_NOMIP,this.texture.wrapMode=ke.CLAMP,this.fbo=new gt(this.texture),this.fboDepth=new gt(this.texture,t)}).prototype={resize:function(t,e){this.texture.initEmpty(t,e,Ze.RGBA,Be.HDR_FORMAT),this.fbo.init(),this.fboDepth.init()}},xa.prototype={get shadowMapSize(){return this._shadowAtlas.width},set shadowMapSize(t){this._shadowAtlas.resize(t,t)},get backgroundColor(){return this._backgroundColor},set backgroundColor(t){t instanceof h?this._backgroundColor.copyFrom(t):this._backgroundColor.set(t)},get camera(){return this._camera},render:function(t,e,i){this._camera=t,this._scene=e,this._updateSize(this.renderTarget),t._setRenderTargetResolution(this._width,this._height),this._renderCollector.collect(t,e),this._ambientColor=this._renderCollector.ambientColor,this._renderShadowCasters(),this._renderView(t,e,i),this._renderToScreen(),U.setBlendState(),U.setDepthMask(!0)},_renderView:function(t,e,i){this._gammaApplied=!1,this._activeCamera=t,this._scene=e,Be.WEBGL_2&&t._updateClusterPlanes(),U.setDepthMask(!0),U.setColorMask(!0),this._renderNormalDepth(),this._renderAO(),U.setRenderTarget(this._hdrFront.fboDepth),U.setClearColor(this._backgroundColor),U.clear(),this._renderDepthPrepass(),Be.WEBGL_2?this._renderClustered():this._renderForward(),this._swapHDRFrontAndBack(),this._renderEffects(i),U.setColorMask(!0)},_renderDepthPrepass:function(){this._depthPrepass&&(U.lockColorMask(!1),ca(this,this._activeCamera,ge.NORMAL_DEPTH_PASS,this._renderCollector.getOpaqueRenderList(Ki.FORWARD_FIXED)),ca(this,this._activeCamera,ge.NORMAL_DEPTH_PASS,this._renderCollector.getOpaqueRenderList(Ki.FORWARD_DYNAMIC)),U.unlockColorMask(!0))},_renderClustered:function(){var t,e=this._renderCollector.lights,i=e.length,n=this._lightingDataView,s=this._cellData,r=this._camera,o=ve.OPTIONS.maxDirLights,a=ve.OPTIONS.maxLightProbes,h=ve.OPTIONS.maxPointSpotLights,u=16,l=320*o+u,c=16*a+l,_=0,d=0,f=0,p=ve.OPTIONS.numLightingCellsX*ve.OPTIONS.numLightingCellsY,g=this._cellStride;for(t=0;t<p;++t)s[t*g]=0;for(t=0;t<a;++t)this._diffuseProbeArray[t]=ct.DEFAULT,this._specularProbeArray[t]=ct.DEFAULT;for(t=0;t<i;++t){var M=e[t];M instanceof Fi&&_<o?(this.writeDirectionalLight(M,r,n,u),u+=320,++_):M instanceof Qi&&f<a?(this.writeLightProbe(M,n,l),M.diffuseTexture&&(this._diffuseProbeArray[f]=M.diffuseTexture),M.specularTexture&&(this._specularProbeArray[f]=M.specularTexture),l+=16,++f):M instanceof Yi&&d<h?(this.writePointSpotLight(M,r,n,c,!1,s,d),c+=224,++d):M instanceof Gi&&d<h&&(this.writePointSpotLight(M,r,n,c,!0,s,d),c+=224,++d)}n.setInt32(0,_,!0),n.setInt32(4,f,!0),n.setInt32(8,d,!0),this._lightingUniformBuffer.uploadData(this._lightingDataView),this._lightingCellsUniformBuffer.uploadData(this._cellData),ca(this,this._activeCamera,ge.BASE_PASS,this._renderCollector.getOpaqueRenderList(Ki.FORWARD_FIXED)),ca(this,this._activeCamera,ge.BASE_PASS,this._renderCollector.getOpaqueRenderList(Ki.FORWARD_DYNAMIC)),this._renderCollector.needsBackbuffer&&this._copyBackbuffer(),ca(this,this._activeCamera,ge.BASE_PASS,this._renderCollector.getTransparentRenderList(Ki.FORWARD_FIXED)),ca(this,this._activeCamera,ge.BASE_PASS,this._renderCollector.getTransparentRenderList(Ki.FORWARD_DYNAMIC))},writePointSpotLight:(oa=new Z,aa=new Z,ha=new Pt,function(t,e,i,n,s,r,o){var a,h=t._scaledIrradiance,u=t.entity.worldMatrix,l=e.viewMatrix;if(i.setFloat32(n,h.r,!0),i.setFloat32(n+4,h.g,!0),i.setFloat32(n+8,h.b,!0),i.setFloat32(n+12,t.radius,!0),u.getColumn(3,oa),l.transformPoint(oa,oa),i.setFloat32(n+16,oa.x,!0),i.setFloat32(n+20,oa.y,!0),i.setFloat32(n+24,oa.z,!0),i.setFloat32(n+28,1/t.radius,!0),s?(u.getColumn(1,aa),l.transformVector(aa,aa),i.setFloat32(n+32,aa.x,!0),i.setFloat32(n+36,aa.y,!0),i.setFloat32(n+40,aa.z,!0),i.setUint32(n+112,1,!0),i.setFloat32(n+120,t._cosOuter,!0),i.setFloat32(n+124,1/Math.max(t._cosInner-t._cosOuter,1e-5),!0)):i.setUint32(n+112,0,!0),i.setUint32(n+116,t.castShadows?1:0,!0),t.castShadows){var c;if(i.setFloat32(n+44,t.depthBias,!0),s){ha.multiply(t._shadowMatrix,e.worldMatrix),c=ha._m;var _=t._shadowTile;i.setFloat32(n+128,_.x,!0),i.setFloat32(n+132,_.y,!0),i.setFloat32(n+136,_.z,!0),i.setFloat32(n+140,_.w,!0)}else{c=e.worldMatrix._m,a=n+128;for(var d=0;d<6;++d)_=t._shadowTiles[d],i.setFloat32(a,_.x,!0),i.setFloat32(a+4,_.y,!0),i.setFloat32(a+8,_.z,!0),i.setFloat32(a+12,_.w,!0),a+=16}a=n+48;for(var f=0;f<16;++f)i.setFloat32(a,c[f],!0),a+=4}s&&l.transformPoint(t.entity.worldBounds.center,oa),this.assignToCells(t,e,o,oa,r,s?aa:null)}),assignToCells:(ra=new Z,function(t,e,i,n,s,r){var o=this._cellStride,a=t.entity.worldBounds.getRadius(),h=ve.OPTIONS.numLightingCellsX,u=ve.OPTIONS.numLightingCellsY,l=e._clusterPlanesW,c=e._clusterPlanesH;e.projectionMatrix.projectPoint(n,ra);var _=Math.floor((.5*ra.x+.5)*h),d=Math.floor((.5*ra.y+.5)*u);_<0?_=0:h<=_&&(_=h-1),d<0?d=0:u<=d&&(d=u-1);for(var f,p,g=_,M=_,A=_;0<=A&&!(l[g=A].dot4(n)>a);--A);for(A=_+1;A<h&&!(-l[(M=A)+1].dot4(n)>a);++A);for(var m=d;0<=m;--m){for(A=g;A<=M;++A)p=++s[f=(A+m*h)*o],s[f+p]=i;if(c[m].dot4(n)>a)break}for(m=d+1;m<u;++m){for(A=g;A<=M;++A)p=++s[f=(A+m*h)*o],s[f+p]=i;if(-c[m+1].dot4(n)>a)break}}),writeLightProbe:function(t,e,i){e.setUint32(i,t.diffuseTexture?1:0,!0);var n=t.specularTexture;if(n){e.setUint32(i+4,1,!0);var s=Math.floor(at.log2(n.size));e.setFloat32(i+8,s,!0)}else e.setUint32(i+4,0,!0);e.setUint32(i+12,t.intensity,!0)},writeDirectionalLight:(na=new Z,sa=new Pt,function(t,e,i,n){var s=t._scaledIrradiance;if(i.setFloat32(n,s.r,!0),i.setFloat32(n+4,s.g,!0),i.setFloat32(n+8,s.b,!0),e.viewMatrix.transformVector(t.direction,na),i.setFloat32(n+16,na.x,!0),i.setFloat32(n+20,na.y,!0),i.setFloat32(n+24,na.z,!0),i.setUint32(n+28,t.castShadows?1:0,!0),t.castShadows){for(var r=ve.OPTIONS.numShadowCascades,o=t._cascadeSplitDistances,a=sa._m,h=n+32,u=0;u<r;++u){sa.multiply(t.getShadowMatrix(u),e.worldMatrix);for(var l=0;l<16;++l)i.setFloat32(h,a[l],!0),h+=4}i.setFloat32(n+288,o[0],!0),i.setFloat32(n+292,o[1],!0),i.setFloat32(n+296,o[2],!0),i.setFloat32(n+300,o[3],!0),i.setFloat32(n+304,t.depthBias,!0),i.setFloat32(n+308,o[r-1],!0)}}),_copyBackbuffer:function(){U.setRenderTarget(this._hdrBack.fbo),U.clear(),this._copyTextureShader.execute(st.DEFAULT,this._hdrFront.texture),U.setRenderTarget(this._hdrFront.fboDepth)},_renderForward:function(){this._renderForwardOpaque(),this._renderCollector.needsBackbuffer&&this._copyBackbuffer(),this._renderForwardTransparent()},_renderForwardOpaque:function(){ca(this,this._activeCamera,ge.BASE_PASS,this._renderCollector.getOpaqueRenderList(Ki.FORWARD_FIXED));var t=this._renderCollector.getOpaqueRenderList(Ki.FORWARD_DYNAMIC);0!==t.length&&this._renderOpaqueDynamicMultipass(t)},_renderOpaqueDynamicMultipass:function(t){ca(this,this._activeCamera,ge.BASE_PASS,t);for(var e=this._renderCollector.lights,i=e.length,n=0;n<i;++n){var s=e[n];s instanceof Qi?ca(this,this._activeCamera,ge.LIGHT_PROBE_PASS,t,s):s instanceof Fi?ca(this,this._activeCamera,ge.DIR_LIGHT_PASS,t,s):s instanceof Yi?this._renderLightPassIfIntersects(s,ge.POINT_LIGHT_PASS,t):s instanceof Gi&&this._renderLightPassIfIntersects(s,ge.SPOT_LIGHT_PASS,t)}},_renderForwardTransparent:function(){for(var t=this._renderCollector.lights,e=t.length,i=this._renderCollector.getTransparentRenderList(),n=i.length,s=0;s<n;++s){var r=i[s];if(this._renderSingleItemSingleLight(ge.BASE_PASS,r),r.material._renderPath===Ki.FORWARD_DYNAMIC)for(var o=0;o<e;++o){var a=t[o];if(a instanceof Qi)this._renderSingleItemSingleLight(ge.LIGHT_PROBE_PASS,r,a);else if(a instanceof Fi){var h=a.castShadows?ge.DIR_LIGHT_SHADOW_PASS:ge.DIR_LIGHT_PASS;this._renderSingleItemSingleLight(h,r,a)}else a instanceof Yi?this._renderLightPassIfIntersects(a,ge.POINT_LIGHT_PASS,i):a instanceof Gi&&this._renderLightPassIfIntersects(a,ge.SPOT_LIGHT_PASS,i)}}U.setBlendState()},_renderLightPassIfIntersects:function(t,e,i){for(var n=t.entity.worldBounds,s=i.length,r=0;r<s;++r){var o=i[r];o.material.getPass(e)&&(n.intersectsBound(o.worldBounds)&&this._renderSingleItemSingleLight(e,o,t))}},_renderSingleItemSingleLight:function(t,e,i){var n=e.material.getPass(t);if(n){var s=e.meshInstance;n.updatePassRenderState(this._activeCamera,this,i),n.updateInstanceRenderState(this._activeCamera,e,i),s.updateRenderState(t);var r=s._mesh;U.drawElements(r.elementType,r._numIndices,0,r._indexType)}},_renderNormalDepth:function(){var t=this._renderCollector,e=t.getOpaqueRenderList(Ki.FORWARD_DYNAMIC),i=t.getOpaqueRenderList(Ki.FORWARD_FIXED);t.needsNormalDepth&&(U.setRenderTarget(this._normalDepthFBO),U.setClearColor(h.BLUE),U.clear(),ca(this,this._activeCamera,ge.NORMAL_DEPTH_PASS,e,null),ca(this,this._activeCamera,ge.NORMAL_DEPTH_PASS,i,null))},_renderAO:function(){var t=ve.OPTIONS.ambientOcclusion;t&&(this._ssaoTexture=t.getAOTexture(),t.render(this,0))},_renderShadowCasters:function(){this._shadowAtlas.initRects(this._renderCollector.shadowPlaneBuckets,this._renderCollector.numShadowPlanes);var t=this._renderCollector.shadowCasters,e=t.length;U.setRenderTarget(this._shadowAtlas.fbo),U.setClearColor(h.WHITE),U.clear();for(var i=0;i<e;++i){var n=t[i];n instanceof Fi?this._cascadeShadowRenderer.render(n,this._shadowAtlas,this._camera,this._scene):n instanceof Yi?this._omniShadowRenderer.render(n,this._shadowAtlas,this._camera,this._scene):n instanceof Gi&&this._spotShadowRenderer.render(n,this._shadowAtlas,this._camera,this._scene)}this._shadowAtlas.blur()},_renderEffect:function(t,e){this._gammaApplied=this._gammaApplied||t.outputsGamma,t.render(this,e)},_renderToScreen:function(){if(U.setRenderTarget(this.renderTarget),U.clear(),this.debugMode){var t;switch(this.debugMode){case xa.DebugMode.NORMAL_DEPTH:t=this._normalDepthBuffer;break;case xa.DebugMode.SHADOW_MAP:t=this._shadowAtlas.texture;break;case xa.DebugMode.SSAO:t=this._ssaoTexture}this._copyTextureShader.execute(st.DEFAULT,t)}else this._present()},_present:function(){this._gammaApplied?this._copyTextureShader.execute(st.DEFAULT,this._hdrBack.texture):this._applyGamma.execute(st.DEFAULT,this._hdrBack.texture)},_renderEffects:function(t){var e=this._renderCollector.effects;if(e)for(var i=e.length,n=0;n<i;++n){var s=e[n];s.isSupported()&&(this._renderEffect(s,t),this._swapHDRFrontAndBack())}},_updateSize:function(){var t,e;this.renderTarget?(t=this.renderTarget.width,e=this.renderTarget.height):(t=ve.TARGET_CANVAS.width,e=ve.TARGET_CANVAS.height),this._width===t&&this._height===e||(this._width=t,this._height=e,this._depthBuffer.init(this._width,this._height,!0),this._hdrBack.resize(this._width,this._height),this._hdrFront.resize(this._width,this._height),this._normalDepthBuffer.initEmpty(t,e),this._normalDepthFBO.init())},_swapHDRFrontAndBack:function(){var t=this._hdrBack;this._hdrBack=this._hdrFront,this._hdrFront=t},_createDepthBuffer:function(){return new la}},Ti.create(Ta,{},Qi),Ta.prototype.render=function(){var t=this._specularTexture,e=this._diffuseTexture;this._specularTexture=Ue.DARK_CUBE_TEXTURE,this._diffuseTexture=Ue.DARK_CUBE_TEXTURE;var i=this.entity.worldMatrix.getColumn(3),n=this.entity._scene;U.setInvertCulling(!0);for(var s=0;s<6;++s)this._cameras[s].position.copyFrom(i),this._renderer.render(this._cameras[s],n,0,this._specularFBOs[s]);for(t.generateMipmap(),s=0;s<6;++s)this._renderer.render(this._cameras[s],this._diffuseScene,0,this._diffuseFBOs[s]);e.generateMipmap(),U.setInvertCulling(!1),this._diffuseTexture=e,this._specularTexture=t},Ta.prototype.clone=function(){var t=new Ta(this._diffuseTexture.size,this._diffuseTexture.dataType,this._cameras[0].nearDistance,this._cameras[0].farDistance);return t.size=this.size,t.intensity=this.intensity,t},(ya.prototype=Object.create(Dn.prototype)).onStarted=function(){this._lights=[],this._meshSet=this.getEntitySet([Pi]),this._meshSet.onEntityAdded.bind(this._onMeshInstanceAdded,this),this._pointSet=this._initSet(Yi),this._spotSet=this._initSet(Gi),this._dirSet=this._initSet(Fi),this._probeSet=this._initSet(Qi),this._assignLights()},ya.prototype.onStopped=function(){this._meshSet.onEntityAdded.unbind(this._onMeshInstanceAdded),this._destroySet(this._pointSet,Yi),this._destroySet(this._spotSet,Gi),this._destroySet(this._dirSet,Fi),this._destroySet(this._probeSet,Qi),this._meshSet.free()},ya.prototype._initSet=function(t){var e=this.getEntitySet([t]);return this._onLightAddedFuncs[t]=this._onLightAdded.bind(this,t),this._onLightRemovedFuncs[t]=this._onLightRemoved.bind(this,t),e.onEntityAdded.bind(this._onLightAddedFuncs[t]),e.onEntityRemoved.bind(this._onLightRemovedFuncs[t]),function(t,e,i){for(var n=0,s=e.numEntities;n<s;++n){var r=e.getEntity(n).getFirstComponentByType(i);t.push(r)}}(this._lights,e,t),e},ya.prototype._destroySet=function(t,e){t.onEntityAdded.unbind(this._onLightAddedFuncs[e]),t.onEntityRemoved.unbind(this._onLightRemovedFuncs[e]),t.free()},ya.prototype._onLightAdded=function(t,e){var i=e.getFirstComponentByType(t);this._lights.push(i),this._assignLights()},ya.prototype._onLightRemoved=function(t,e){var i=e.getFirstComponentByType(t),n=this._lights.indexOf(i);this._lights.splice(n,1),this._assignLights()},ya.prototype._onMeshInstanceAdded=function(t){this._queueOrAssign(t,this._lights)},ya.prototype._assignLights=function(){this._queue&&this._queue.cancel();for(var t=0,e=this._meshSet.numEntities;t<e;++t)this._queueOrAssign(this._meshSet.getEntity(t))},ya.prototype._queueOrAssign=function(t){this._queue&&this._queue.isRunning||(this._queue=new Hs);var e=t.getFirstComponentByType(Pi).material;e._initialized?this._queue.queue(Na,e,this._lights):Na(e,this._lights),this._queue.isRunning||this._queue.execute()},(Da.prototype=Object.create(Q.prototype)).execute=function(t,e,i,n){var s=U.gl;U.setDepthTest(Ge.DISABLED),U.setCullMode(Ye.NONE),t._vertexBuffers[0].bind(),t._indexBuffer.bind(),U.setShader(this),e.bind(0),s.vertexAttribPointer(this._positionAttributeLocation,2,s.FLOAT,!1,16,0),s.vertexAttribPointer(this._texCoordAttributeLocation,2,s.FLOAT,!1,16,8),U.enableAttributes(2),s.uniform2f(this._directionLocation,i,n),U.drawElements(Xe.TRIANGLES,6,0)},(Ea.prototype=Object.create(Q.prototype)).execute=function(t,e,i,n){var s=U.gl;U.setDepthTest(Ge.DISABLED),U.setCullMode(Ye.NONE),t._vertexBuffers[0].bind(),t._indexBuffer.bind(),U.setShader(this),e.bind(0),s.vertexAttribPointer(this._positionAttributeLocation,2,Ke.FLOAT,!1,16,0),s.vertexAttribPointer(this._texCoordAttributeLocation,2,Ke.FLOAT,!1,16,8),U.enableAttributes(2),s.uniform2f(this._directionLocation,i,n),U.drawElements(s.TRIANGLES,6,0)},(wa.prototype=Object.create(z.prototype,{blurRadius:{get:function(){return this._blurRadius},set:function(t){this._blurRadius=t,this._invalidateBlurShader()}}})).getGLSL=function(){var t=this._getDefines();return d.get("shadow_vsm.glsl",t)},wa.prototype.getCullMode=function(){return Ye.BACK},wa.prototype.getShadowMapFilter=function(){return Fe.BILINEAR_NOMIP},wa.prototype.getShadowMapFormat=function(){return Be.EXT_COLOR_BUFFER_HALF_FLOAT||Be.EXT_COLOR_BUFFER_FLOAT?Ze.RG||Ze.RGB:Ze.RGBA},wa.prototype.getShadowMapDataType=function(){return Be.EXT_COLOR_BUFFER_HALF_FLOAT&&this.useHalfFloat?Ke.HALF_FLOAT:Be.EXT_COLOR_BUFFER_FLOAT?Ke.FLOAT:Ke.UNSIGNED_BYTE},wa.prototype._createBlurShader=function(){return new Ea(this._blurRadius)},wa.prototype._getDefines=function(){var t=1-this.lightBleedReduction;return{HX_VSM_MIN_VARIANCE:"float("+this.minVariance+")",HX_VSM_LIGHT_BLEED_REDUCTION:"float("+this.lightBleedReduction+")",HX_VSM_RCP_LIGHT_BLEED_REDUCTION_RANGE:"float("+1/t+")"}},(La.prototype=Object.create(z.prototype,{blurRadius:{get:function(){return this._blurRadius},set:function(t){this._blurRadius=t,this._invalidateBlurShader()}},darkeningFactor:{get:function(){return this._darkeningFactor},set:function(t){this._darkeningFactor=t}},expScaleFactor:{get:function(){return this._expScaleFactor},set:function(t){this._expScaleFactor=t}}})).getCullMode=function(){return Ye.BACK},La.prototype.getShadowMapFilter=function(){return Fe.BILINEAR_NOMIP},La.prototype.getShadowMapFormat=function(){return Ze.RG||Ze.RGB},La.prototype.getShadowMapDataType=function(){return Ke.FLOAT},La.prototype.getGLSL=function(){var t=this._getDefines();return d.get("shadow_esm.glsl",t)},La.prototype._getDefines=function(){return{HX_ESM_CONSTANT:"float("+this._expScaleFactor+")",HX_ESM_DARKENING:"float("+this._darkeningFactor+")"}},La.prototype._createBlurShader=function(){return new Da(this._blurRadius)},(Ia.prototype=Object.create(z.prototype)).getGLSL=function(){var t={HX_PCF_NUM_SHADOW_SAMPLES:this.numShadowSamples,HX_PCF_RCP_NUM_SHADOW_SAMPLES:"float("+1/this.numShadowSamples+")",HX_PCF_SOFTNESS:this.softness};return this.dither&&(t.HX_PCF_DITHER_SHADOWS=1),d.get("shadow_pcf.glsl",t)},va.prototype=Object.create(ai.prototype),va.ALIGN_X=1,va.ALIGN_Y=2,va.ALIGN_Z=3,va.prototype._generate=function(t,e){var i,n,s,r,o,a=(e=e||{}).alignment||va.ALIGN_Z,h=e.numSegmentsH||1,u=e.numSegmentsW||16,l=e.radius||.5,c=e.height||1,_=void 0!==e.doubleSided&&e.doubleSided,d=t.positions,f=t.uvs,p=t.normals,g=t.indices,M=1/u,A=1/h;for(i=0;i<=h;++i){var m=(1-i*A)*l,x=(i*A-.5)*c;for(n=0;n<=u;++n){o=n*M*Math.PI*2;var T=Math.sin(o),y=Math.cos(o);switch(s=T*m,r=y*m,a){case va.ALIGN_X:d.push(x,r,s),p&&p.push(0,y,T);break;case va.ALIGN_Z:d.push(s,-r,x),p&&p.push(T,-y,0);break;default:d.push(s,x,r),p&&p.push(T,0,y)}f&&f.push(1-n*M,i*A)}}var N,D=u+1;for(n=0;n<u;++n){for(i=0;i<h-1;++i)N=n+i*D,g.push(N,N+D+1,N+D),g.push(N,N+1,N+D+1),_&&(g.push(N,N+D,N+D+1),g.push(N,N+D+1,N+1));N=n+(h-1)*D,g.push(N,N+1,N+D+1)}var E=d.length/3,w=.5*c;for(n=0;n<u;++n){o=n*M*Math.PI*2;var L=Math.sin(o),I=Math.cos(o);switch(s=L*l,r=I*l,L=.5*-L+.5,I=.5*I+.5,a){case va.ALIGN_X:d.push(-w,r,s),p&&p.push(-1,0,0),f&&f.push(I,1-L);break;case va.ALIGN_Z:d.push(s,-r,-w),p&&p.push(0,0,-1),f&&f.push(L,I);break;default:d.push(s,-w,r),p&&p.push(0,-1,0),f&&f.push(L,I)}}for(n=1;n<u-1;++n)g.push(E,E+n+1,E+n)},Sa.prototype=Object.create(ai.prototype),Sa.ALIGN_XZ=1,Sa.ALIGN_XY=2,Sa.ALIGN_YZ=3,Sa.prototype._generate=function(t,e){var i=(e=e||{}).alignment||Sa.ALIGN_XY,n=e.numSegmentsW||1,s=e.numSegmentsH||1,r=e.width||1,o=e.height||1,a=void 0!==e.doubleSided&&e.doubleSided,h=t.positions,u=t.uvs,l=t.normals,c=t.indices,_=1/n,d=1/s,f=0,p=0,g=0,M=0,A=0,m=0,x=0,T=0;i===Sa.ALIGN_XY?m=1:i===Sa.ALIGN_XZ?A=1:M=1;for(var y=0;y<=s;++y)for(var N=(y*d-.5)*o,D=0;D<=n;++D){var E=(D*_-.5)*r;if(i===Sa.ALIGN_XY?(f=E,p=N):(i===Sa.ALIGN_XZ?f=E:p=E,g=N),x=1-D*_,T=y*d,h.push(f,p,g),l&&l.push(M,A,m),u&&u.push(x,T),a&&(h.push(f,p,g),l&&l.push(-M,-A,-m),u&&u.push(1-x,T)),D!==n&&y!==s){var w=n+1,L=D+y*w,I=a?1:0;c.push(L<<I,L+w+1<<I,L+w<<I),c.push(L<<I,L+1<<I,L+w+1<<I),a&&(c.push(1+(L+w<<I),1+(L+w+1<<I),1+(L<<I)),c.push(1+(L+w+1<<I),1+(L+1<<I),1+(L<<I)))}}},Oa.prototype=Object.create(ai.prototype),Oa.ALIGN_XY=1,Oa.ALIGN_XZ=2,Oa.ALIGN_YZ=3,Oa.prototype._generate=function(t,e){for(var i=(e=e||{}).numSegmentsW||15,n=e.numSegmentsH||20,s=e.radius||.5,r=e.tubeRadius||.1,o=e.alignment||Oa.ALIGN_XY,a=void 0!==e.doubleSided&&e.doubleSided,h=t.positions,u=t.uvs,l=t.normals,c=1/i,_=1/n,d=0;d<=n;++d)for(var f=d*_,p=f*Math.PI*2,g=Math.cos(p),M=Math.sin(p),A=0;A<=i;++A){var m=A*c,x=m*Math.PI*2,T=Math.cos(x),y=Math.sin(x),N=s+g*r;switch(o){case Oa.ALIGN_XZ:h.push(T*N,-M*r,y*N),l&&l.push(T*g,-M,y*g);break;case Oa.ALIGN_XY:h.push(T*N,y*N,M*r),l&&l.push(T*g,y*g,M);break;case Oa.ALIGN_YZ:h.push(M*r,T*N,y*N),l&&l.push(M,T*g,y*g)}u&&u.push(m,1-f)}for(var D=t.indices,E=0;E<n;++E)for(var w=0;w<i;++w){var L=i+1,I=w+E*L;D.push(I,I+L+1,I+L),D.push(I,I+1,I+L+1),a&&(D.push(I,I+L,I+L+1),D.push(I,I+L+1,I+1))}},(Ca.prototype=Object.create(ai.prototype))._generate=function(t,e){var i=e.width||1,n=.5*i,s=.5*(e.height||i),r=.5*(e.depth||i),o=t.positions,a=t.indices;o.push(-n,-r,-s),o.push(n,-r,-s),o.push(-n,-r,s),o.push(n,-r,s),o.push(-n,r,-s),o.push(n,r,-s),o.push(-n,r,s),o.push(n,r,s),a.push(0,1),a.push(2,3),a.push(0,2),a.push(1,3),a.push(4,5),a.push(6,7),a.push(4,6),a.push(5,7),a.push(0,4),a.push(2,6),a.push(1,5),a.push(3,7)},ja.prototype=Object.create(ai.prototype),ja.ALIGN_XZ=1,ja.ALIGN_XY=2,ja.ALIGN_YZ=3,ja.prototype._generate=function(t,e){for(var i=(e=e||{}).alignment||ja.ALIGN_XY,n=e.numSegmentsW||1,s=e.numSegmentsH||1,r=e.width||1,o=e.height||1,a=t.positions,h=t.indices,u=1/n,l=1/s,c=0,_=0,d=0,f=0;f<=s;++f)for(var p=(f*l-.5)*o,g=0;g<=n;++g){var M=(g*u-.5)*r;if(i===ja.ALIGN_XY?(c=M,_=p):(i===ja.ALIGN_XZ?c=M:_=M,d=p),a.push(c,_,d),g!==n&&f!==s){var A=n+1,m=g+f*A;h.push(m,m+1),h.push(m+1,m+A+1),h.push(m+A+1,m+A),h.push(m+A,m)}}},(ba.prototype=Object.create(xa.prototype)).render=function(t,e,i){console.assert(t instanceof cs,"Must use VRCamera with VRRenderer!"),ve.VR_DISPLAY.depthNear=t.nearDistance,ve.VR_DISPLAY.depthFar=t.farDistance,this._camera=t,this._scene=e,t._updateVR(),this._updateSize(this.renderTarget),this._camera._setRenderTargetResolution(this._width,this._height),this._renderCollector.collect(t,e),this._ambientColor=this._renderCollector.ambientColor,this._renderShadowCasters(),this._renderView(t._cameraLeft,e,i);var n=this._leftTarget;this._leftTarget=this._hdrBack,this._hdrBack=n,this._renderView(t._cameraRight,e,i),this._renderToScreen()},ba.prototype._present=function(){this._gammaApplied?(U.setViewport(this._leftRect),this._copyTextureShader.execute(st.DEFAULT,this._leftTarget.texture),U.setViewport(this._rightRect),this._copyTextureShader.execute(st.DEFAULT,this._hdrBack.texture)):(U.setViewport(this._leftRect),this._applyGamma.execute(st.DEFAULT,this._leftTarget.texture),U.setViewport(this._rightRect),this._applyGamma.execute(st.DEFAULT,this._hdrBack.texture)),U.setViewport()},ba.prototype._updateSize=function(){var t,e;this.renderTarget?(t=.5*this.renderTarget.width,e=this.renderTarget.height):(t=.5*ve.TARGET_CANVAS.width,e=ve.TARGET_CANVAS.height),this._width===t&&this._height===e||(this._width=t,this._height=e,this._depthBuffer.init(this._width,this._height,!0),this._hdrBack.resize(this._width,this._height),this._hdrFront.resize(this._width,this._height),this._leftTarget.resize(this._width,this._height),this._normalDepthBuffer.initEmpty(t,e),this._normalDepthFBO.init(),this._leftRect.width=t,this._leftRect.height=e,this._rightRect.width=t,this._rightRect.height=e,this._rightRect.x=t)},Pa.prototype={addView:function(t){t._texture=new ut,t._texture.filter=Fe.BILINEAR_NOMIP,t._texture.wrapMode=ke.CLAMP,t._fbo=new gt(t._texture),t._renderer=new xa(t._fbo),this._views.push(t)},removeView:function(t){t._fbo=null,t._texture=null,t._renderer=null;var e=this._views.indexOf(t);this._views.splice(e,1)},render:function(t,e){for(var i=ve.TARGET_CANVAS.clientWidth,n=ve.TARGET_CANVAS.clientHeight,s=this._views.length,r=0;r<s;++r){var o=this._views[r],a=Math.floor(i*o.widthRatio),h=Math.floor(n*o.heightRatio);o._texture.width===a&&o._texture.height===h||(o._texture.initEmpty(a,h),o._fbo.init()),o._renderer.render(o.camera,o.scene,t)}U.setRenderTarget(e),U.clear();var u=new _a;for(r=0;r<s;++r)o=this._views[r],u.x=Math.floor(o.xRatio*i),u.y=Math.floor((1-o.yRatio-o.heightRatio)*n),u.width=o._texture.width,u.height=o._texture.height,U.setViewport(u),Ue.COPY_SHADER.execute(st.DEFAULT,o._texture)}};var za={execute:function(t){Ue.COPY_SHADER.execute(st.DEFAULT,t)}},Ra={getFromImage:function(t){var e=document.createElement("canvas");return e.width=t.naturalWidth,e.height=t.naturalHeight,e.getContext("2d").drawImage(t,0,0),e.getImageData(0,0,e.width,e.height)}},Ua={merge:function(t,e,i){var n=new ut;n.initEmpty(t.width,t.height);var s=new gt(n);U.setRenderTarget(s),U.setClearColor(h.WHITE),U.clear();var r=U.gl;return t&&(r.colorMask(!0,!1,!1,!1),Ue.COPY_SHADER.execute(st.DEFAULT,t)),e&&(r.colorMask(!1,!0,!1,!1),Ue.COPY_SHADER.execute(st.DEFAULT,e)),i&&(r.colorMask(!1,!1,!0,!1),Ue.COPY_SHADER.execute(st.DEFAULT,i)),r.colorMask(!0,!0,!0,!0),U.setRenderTarget(null),U.setClearColor(h.BLACK),n}};function Ba(){this.entity=null,this.component=null,this.point=new Z,this.faceNormal=new Z,this.t=1/0,this.mesh=null,this.barycentric=new Z,this.faceIndex=-1}function Fa(){this.meshInstance=null,this.closestDistanceSqr=0,this.objectMatrix=new Pt,this.next=null}function ka(){_n.call(this),this._potentials=null,this._potentialPool=new ln(Fa),this._localRay=new ri}function Ya(t){this._numFrames=t||1,this._frames=[],this._maxFPS=void 0,this._minFPS=void 0,this._currentFPS=0,this._averageFPS=0;for(var e=this._runningSum=0;e<this._numFrames;++e)this._frames[e]=0;this._index=0}function Qa(t){this._fpsCounter=new Ya(30),this._width=100,this._height=95,this._dpr=window.devicePixelRatio||1,this._elm=document.createElement("canvas"),this._elm.style.position="fixed",this._elm.style.left="5px",this._elm.style.top="5px",this._elm.style.width=this._width+"px",this._elm.style.height=this._height+"px",this._elm.width=this._pixelWidth=this._width*this._dpr,this._elm.height=this._pixelHeight=this._height*this._dpr;var e=10*this._dpr;this._context=this._elm.getContext("2d"),this._context.font=e+'px "Lucida Console",Monaco,monospace',(t=t||document.getElementsByTagName("body")[0]).appendChild(this._elm),Se.bind(this._update,this)}(ka.prototype=Object.create(_n.prototype)).cast=function(t,e){this._potentials=[],this._ray=t,this._scene=e,this._potentialPool.reset(),e.acceptVisitor(this),this._potentials.sort(this._sortPotentialFunc);var i=this._findClosest();return i.entity?i:null},ka.prototype.qualifies=function(t,e){return t.raycast&&t.visible&&(e||t.worldBounds.intersectsRay(this._ray))},ka.prototype.visitMeshInstance=function(t){var e=t.entity,i=this._potentialPool.getItem();i.meshInstance=t;var n=this._ray.direction,s=n.x,r=n.y,o=n.z,a=this._ray.origin,h=this.getProxiedBounds(e),u=h.center,l=h._halfExtentX,c=h._halfExtentY,_=h._halfExtentZ;l=0<s?u.x-l:u.x+l,c=0<r?u.y-c:u.y+c,_=0<o?u.z-_:u.z+_,l-=a.x,c-=a.y,_-=a.z,i.closestDistanceSqr=l*s+c*r+_*o,i.objectMatrix.inverseAffineOf(this.getProxiedMatrix(e)),this._potentials.push(i)},ka.prototype._findClosest=function(){for(var t=this._potentials,e=t.length,i=new Ba,n=this._ray,s=this._localRay,r=0;r<e;++r){var o=t[r];if(o.closestDistanceSqr>i.t*i.t)break;s.transformFrom(n,o.objectMatrix),this._testMesh(s,o.meshInstance.mesh,i)&&(i.entity=o.meshInstance.entity,i.component=o.meshInstance)}if(i.entity){var a=this.getProxiedMatrix(i.entity);a.transformPoint(i.point,i.point),a.transformNormal(i.faceNormal,i.faceNormal)}return i},ka.prototype._testMesh=function(t,e,i){for(var n=t.direction,s=t.origin,r=s.x,o=s.y,a=s.z,h=n.x,u=n.y,l=n.z,c=e.getVertexAttributeByName("hx_position"),_=e.getVertexData(c.streamIndex),d=e.getIndexData(),f=e.getVertexStride(c.streamIndex),p=d.length,g=c.offset,M=!1,A=0;A<p;A+=3){var m=d[A]*f+g,x=d[A+1]*f+g,T=d[A+2]*f+g,y=_[m],N=_[m+1],D=_[m+2],E=_[x]-y,w=_[x+1]-N,L=_[x+2]-D,I=_[T]-y,v=_[T+1]-N,S=_[T+2]-D,O=w*S-L*v,C=L*I-E*S,j=E*v-w*I,b=O*h+C*u+j*l;if(!(0<=b)){var P=O*r+C*o+j*a+-(O*y+C*N+j*D);if(!(P<0||(P/=-b)>=i.t)){var z=P*h+r,R=P*u+o,U=P*l+a,B=z-y,F=R-N,k=U-D,Y=E*E+w*w+L*L,Q=I*I+v*v+S*S,G=E*I+w*v+L*S,X=Y*Q-G*G;if(0!==X){var V=B*E+F*w+k*L,H=B*I+F*v+k*S,W=1/X,Z=(Q*V-G*H)*W,K=(Y*H-G*V)*W,q=1-Z-K;0<=q&&0<=Z&&0<=K&&(i.faceNormal.set(O,C,j,0),i.point.set(z,R,U,1),i.barycentric.set(q,Z,K,0),i.mesh=e,i.t=P,i.faceIndex=A,M=!0)}}}}return i.faceNormal.normalize(),M},ka.prototype._sortPotentialFunc=function(t,e){return t.closestDistanceSqr-e.closestDistanceSqr},Ya.prototype={update:function(t){this._currentFPS=1e3/t,this._runningSum-=this._frames[this._index],this._runningSum+=this._currentFPS,this._averageFPS=this._runningSum/this._numFrames,this._frames[this._index++]=this._currentFPS,this._index===this._numFrames&&(this._index=0),(void 0===this._maxFPS||this._currentFPS>this._maxFPS)&&(this._maxFPS=this._currentFPS),(void 0===this._minFPS||this._currentFPS<this._minFPS)&&(this._minFPS=this._currentFPS)},get lastFrameFPS(){return Math.round(this._currentFPS)},get averageFPS(){return Math.round(this._averageFPS)},get maxFPS(){return Math.round(this._maxFPS)},get minFPS(){return Math.round(this._minFPS)},reset:function(){this._maxFPS=void 0,this._minFPS=void 0}},Qa.prototype={remove:function(){this._elm.parentNode.removeChild(this._elm)},_update:function(t){0===t&&(t=16),this._fpsCounter.update(t);var e=this._context;e.fillStyle="rgba(0, 0, 0, .5)",e.fillRect(0,0,this._pixelWidth,this._pixelHeight);var i=Ce.toFixed(1),n=t.toFixed(1);e.fillStyle="#fff",e.fillText("FPS: "+this._fpsCounter.averageFPS,10*this._dpr,15*this._dpr),e.fillText("Time: "+i+" ("+n+") ",10*this._dpr,30*this._dpr),e.fillText("Draws: "+b.numDrawCalls,10*this._dpr,45*this._dpr),e.fillText("Tris: "+b.numTriangles,10*this._dpr,60*this._dpr),e.fillText("Clears: "+b.numClears,10*this._dpr,75*this._dpr)}};try{new s}catch(t){}t.ShaderLibrary=d,t.init=function(t,e){if(ve.INITIALIZED)throw new Error("Can only initialize Helix once!");ve.TARGET_CANVAS=t,ve.TARGET_CANVAS.requestPointerLock=ve.TARGET_CANVAS.requestPointerLock||ve.TARGET_CANVAS.mozRequestPointerLock,ve.AUDIO_CONTEXT=window.hx_audioContext,ti(),function(){if(navigator.getGamepads){var t=navigator.getGamepads();if(t){for(var e=0,i=t.length;e<i;++e)t[e]&&(me[e]=new Ae(t[e]));window.addEventListener("gamepadconnected",De),window.addEventListener("gamepaddisconnected",Ee)}}}(),ve.OPTIONS=e=e||new $e;var i,n={antialias:!1,alpha:ve.OPTIONS.transparentBackground,depth:!1,stencil:!1,premultipliedAlpha:!1,preserveDrawingBuffer:ve.OPTIONS.preserveDrawingBuffer},s="";if(e.webgl2&&(i=t.getContext("webgl2",n)),i?(Be.WEBGL_2=!0,console.log("WebGL 2 supported!"),u.VERSION="#version 300 es\n",s+="#define HX_GLSL_300_ES\n",ge.NUM_PASS_TYPES=4):(ve.OPTIONS.webgl2=!1,i=t.getContext("webgl",n)||t.getContext("experimental-webgl",n)),!i)throw new Error("WebGL not supported");U._setGL(i),ve.INITIALIZED=!0;var r=i.getSupportedExtensions();function o(t){var e=0<=r.indexOf(t)?i.getExtension(t):null;return e||console.warn(t+" extension not supported!"),e}a=U.gl,Fe.NEAREST={min:a.NEAREST_MIPMAP_NEAREST,mag:a.NEAREST},Fe.BILINEAR={min:a.LINEAR_MIPMAP_NEAREST,mag:a.LINEAR},Fe.TRILINEAR={min:a.LINEAR_MIPMAP_LINEAR,mag:a.LINEAR},Be.EXT_TEXTURE_FILTER_ANISOTROPIC&&(Fe.TRILINEAR_ANISOTROPIC={min:a.LINEAR_MIPMAP_LINEAR,mag:a.LINEAR}),Fe.NEAREST_NOMIP={min:a.NEAREST,mag:a.NEAREST},Fe.BILINEAR_NOMIP={min:a.LINEAR,mag:a.LINEAR},Fe.DEFAULT=Fe.TRILINEAR,Ze.RGBA=a.RGBA,Ze.RGB=a.RGB,Ze.RG=a.RG,!1!==e.useGammaCorrection&&(s+=ve.OPTIONS.usePreciseGammaCorrection?"#define HX_GAMMA_CORRECTION_PRECISE\n":"#define HX_GAMMA_CORRECTION_FAST\n"),s+="#define HX_NUM_SHADOW_CASCADES "+ve.OPTIONS.numShadowCascades+"\n",s+="#define HX_MAX_SKELETON_JOINTS "+ve.OPTIONS.maxSkeletonJoints+"\n",Be.EXT_DRAW_BUFFERS=!!Be.WEBGL_2||o("WEBGL_draw_buffers"),Be.EXT_FLOAT_TEXTURES=!!Be.WEBGL_2||o("OES_texture_float"),Be.EXT_FLOAT_TEXTURES_LINEAR=o("OES_texture_float_linear"),Be.EXT_HALF_FLOAT_TEXTURES=!!Be.WEBGL_2||o("OES_texture_half_float"),Be.EXT_HALF_FLOAT_TEXTURES_LINEAR=o("OES_texture_half_float_linear"),Be.EXT_COLOR_BUFFER_FLOAT=o("EXT_color_buffer_float")||o("WEBGL_color_buffer_float"),Be.EXT_COLOR_BUFFER_HALF_FLOAT=o("EXT_color_buffer_half_float")||Be.EXT_COLOR_BUFFER_FLOAT,Be.EXT_DEPTH_TEXTURE=o("WEBGL_depth_texture"),Be.EXT_STANDARD_DERIVATIVES=o("OES_standard_derivatives"),Be.EXT_SHADER_TEXTURE_LOD=o("EXT_shader_texture_lod"),Be.EXT_TEXTURE_FILTER_ANISOTROPIC=o("EXT_texture_filter_anisotropic"),Be.EXT_ELEMENT_INDEX_UINT=o("OES_element_index_uint"),Be.DEFAULT_TEXTURE_MAX_ANISOTROPY=Be.EXT_TEXTURE_FILTER_ANISOTROPIC?i.getParameter(Be.EXT_TEXTURE_FILTER_ANISOTROPIC.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,Be.EXT_FLOAT_TEXTURES?s+="#define HX_FLOAT_TEXTURES\n":e.useSkinningTexture=!1,Be.EXT_FLOAT_TEXTURES_LINEAR&&(s+="#define HX_FLOAT_TEXTURES_LINEAR\n"),Be.EXT_HALF_FLOAT_TEXTURES&&(s+="#define HX_HALF_FLOAT_TEXTURES\n",Ke.HALF_FLOAT=Be.WEBGL_2?i.HALF_FLOAT:Be.EXT_HALF_FLOAT_TEXTURES.HALF_FLOAT_OES),Be.WEBGL_2||Be.EXT_HALF_FLOAT_TEXTURES_LINEAR?s+="#define HX_HALF_FLOAT_TEXTURES_LINEAR\n":e.hdr=!1,Be.EXT_COLOR_BUFFER_FLOAT||(Be.EXT_COLOR_BUFFER_FLOAT=ni(Ke.FLOAT),Be.EXT_COLOR_BUFFER_FLOAT||console.warn("Float FBOs not supported")),Be.EXT_COLOR_BUFFER_HALF_FLOAT||(Be.EXT_COLOR_BUFFER_HALF_FLOAT=ni(Ke.HALF_FLOAT),Be.EXT_COLOR_BUFFER_HALF_FLOAT||console.warn("HalfFloat FBOs not supported")),Be.EXT_DEPTH_TEXTURE||(s+="#define HX_NO_DEPTH_TEXTURES\n"),Be.EXT_SHADER_TEXTURE_LOD&&(s+="#define HX_TEXTURE_LOD\n"),Be.HDR_FORMAT=e.hdr?Ke.HALF_FLOAT:i.UNSIGNED_BYTE,e.useSkinningTexture&&(s+="#define HX_USE_SKINNING_TEXTURE\n",function(){Ue.DEFAULT_SKINNING_TEXTURE=new ut;for(var t=[],e=0;e<ve.OPTIONS.maxSkeletonJoints;++e)t.push(1,0,0,0);for(e=0;e<ve.OPTIONS.maxSkeletonJoints;++e)t.push(0,1,0,0);for(e=0;e<ve.OPTIONS.maxSkeletonJoints;++e)t.push(0,0,1,0);Ue.DEFAULT_SKINNING_TEXTURE.uploadData(new Float32Array(t),ve.OPTIONS.maxSkeletonJoints,3,!1,Ze.RGBA,Ke.FLOAT),Ue.DEFAULT_SKINNING_TEXTURE.filter=Fe.NEAREST_NOMIP,Ue.DEFAULT_SKINNING_TEXTURE.wrapMode=ke.CLAMP}()),ut._initDefault(),ct._initDefault(),_t._initDefaults(),st._initDefault(),ft._initDefault(),pt._initDefault(),function(t,e){var i,n=t*e,s=1/n,r=[],o=0,a=[];for(i=0;i<n;++i)a.push(i/n);for(_.shuffle(a),i=0;i<n;++i){var h=a[i]*Math.PI*2,u=Math.cos(h),l=Math.sin(h);r[o++]=u,r[o++]=l,r[o++]=s+a[i],r[o++]=1}if(Ue.DEFAULT_2D_DITHER_TEXTURE=new ut,Ue.DEFAULT_2D_DITHER_TEXTURE.filter=Fe.NEAREST_NOMIP,Ue.DEFAULT_2D_DITHER_TEXTURE.wrapMode=ke.REPEAT,Be.EXT_FLOAT_TEXTURES)Ue.DEFAULT_2D_DITHER_TEXTURE.uploadData(new Float32Array(r),t,e,!1,Ze.RGBA,Ke.FLOAT);else{for(n=r.length,i=0;i<n;++i)r[i]=Math.round(255*(.5*r[i]+.5));Ue.DEFAULT_2D_DITHER_TEXTURE.uploadData(new Uint8Array(r),t,e,!1,Ze.RGBA,Ke.UNSIGNED_BYTE)}Ue.DARK_CUBE_TEXTURE=new ct,r=[r=new Uint8Array([0,0,0,0]),r,r,r,r,r],Ue.DARK_CUBE_TEXTURE.uploadData(r,1,!0)}(32,32),e.ambientOcclusion&&(s+="#define HX_SSAO\n",e.ambientOcclusion.init()),u.GENERAL=s+u.GENERAL,Ue.COPY_SHADER=new X,U.setClearColor(h.BLACK),ei();var a},t.destroy=function(){ii(),ve.INITIALIZED=!1,Oe.unbindAll(),Se.unbindAll(),U._setGL(null)},t.start=ei,t.stop=ii,t.META=ve,t.capabilities=Be,t.onPreFrame=Se,t.onFrame=Oe,t.TextureFilter=Fe,t.CullMode=Ye,t.StencilOp=Qe,t.Comparison=Ge,t.ElementType=Xe,t.BlendFactor=Ve,t.BlendOperation=He,t.ClearMask=We,t.InitOptions=$e,t.TextureFormat=Ze,t.DataType=Ke,t.BufferUsage=qe,t.CubeFace=Je,t.getVRDisplays=function(i){navigator.getVRDisplays?navigator.getVRDisplays().then(function(t){var e=[];t.forEach(function(t){e.push(new we(t))}),i(e)}):i([])},t.enableVR=function(t,e){if(ve.VR_DISPLAY)throw new Error("VR already enabled!");(ve.VR_DISPLAY=t).onEnabled(),Be.VR_CAN_PRESENT=t.capabilities.canPresent,Be.VR_CAN_PRESENT&&(ve.VR_LEFT_EYE_PARAMS=t.getEyeParameters("left"),ve.VR_RIGHT_EYE_PARAMS=t.getEyeParameters("right"),ve.VR_DISPLAY._display.requestPresent([{source:ve.TARGET_CANVAS}]).then(function(){Le=!0},e),ve.TARGET_CANVAS.width=Math.max(ve.VR_LEFT_EYE_PARAMS.renderWidth,ve.VR_RIGHT_EYE_PARAMS.renderWidth),ve.TARGET_CANVAS.height=Math.max(ve.VR_LEFT_EYE_PARAMS.renderHeight,ve.VR_RIGHT_EYE_PARAMS.renderHeight)),console.log("Starting VR on "+t.displayName)},t.disableVR=Ie,t.onGamepadConnected=Te,t.onGamepadDisconnected=ye,t.getGamepads=Ne,t.getGamepad=function(t){return me[t]},t.Float2=dt,t.Float4=Z,t.CenteredGaussianCurve=si,t.MathX=at,t.Matrix4x4=Pt,t.PlaneSide=q,t.PoissonDisk=ft,t.PoissonSphere=pt,t.Quaternion=Ct,t.Ray=ri,t.Transform=bt,t.Debug=l,t.DebugAxes=en,t.ShowSkeleton=sn,t.BoundingVolume=K,t.BoundingAABB=J,t.BoundingSphere=ki,t.SceneNode=Ai,t.Scene=un,t.SceneVisitor=_n,t.Skybox=pn,t.Terrain=yn,t.Entity=Ri,t.EntityProxy=Nn,t.EntitySystem=Dn,t.EntitySet=rn,t.Component=Ti,t.CompositeComponent=En,t.KeyFrame=wn,t.AnimationClip=In,t.AnimationPlayhead=vn,t.LayeredAnimation=bn,t.AnimationLayer=zn,t.AnimationLayerFloat4=Rn,t.AnimationLayerQuat=Un,t.AnimationLayerMorphTarget=Bn,t.MorphAnimation=Cn,t.MorphPose=Sn,t.MorphTarget=$,t.Skeleton=Fn,t.SkeletonAnimation=Gn,t.SkeletonBinaryLerpNode=Xn,t.SkeletonBlendNode=kn,t.SkeletonBlendTree=Qn,t.SkeletonClipNode=Yn,t.SkeletonFreePoseNode=Vn,t.SkeletonJoint=Wn,t.SkeletonJointPose=fi,t.SkeletonPose=pi,t.SkeletonXFadeNode=Zn,t.AudioClip=Kn,t.AudioDistanceModel={LINEAR:"linear",INVERSE:"inverse",EXPONENTIAL:"exponential"},t.AudioPanningModel={EQUAL_POWER:"equalpower",HRTF:"HRTF"},t.AudioEmitter=qn,t.AudioListener=ns,t.Camera=rs,t.Frustum=ss,t.PerspectiveCamera=os,t.OrthographicCamera=as,t.OrthographicOffCenterCamera=hs,t.VRCamera=cs,t.Color=h,t.DataStream=ps,t.GL=U,t.Signal=r,t.Messenger=zi,t.Bloom=ms,t.Blur=xs,t.CopyTexturePass=Ts,t.Effect=As,t.EffectPass=gs,t.FilmicToneMapping=Ns,t.Fog=Ds,t.FXAA=Es,t.GaussianBlurPass=Ms,t.HBAO=ws,t.SSAO=Ls,t.ReinhardToneMapping=Is,t.Input=vs,t.Gamepad=Ae,t.Keyboard=Ss,t.Mouse=Os,t.MouseLock=js,t.Touch=Ps,t.AssetLibrary=Fs,t.AssetLoader=Bs,t.AudioFile=ks,t.URLLoader=Rs,t.HCM=Ys,t.HMAT=Xs,t.HX=Oo,t.Importer=Us,t.JPG_EQUIRECTANGULAR=Jo,t.PNG_EQUIRECTANGULAR=$o,t.JPG_HEIGHTMAP=ea,t.PNG_HEIGHTMAP=ua,t.JPG=Qs,t.PNG=Gs,t.AmbientLight=Vs,t.DirectionalLight=Fi,t.Light=Ui,t.DirectLight=Bi,t.LightProbe=Qi,t.DynamicLightProbe=Ta,t.PointLight=Yi,t.SpotLight=Gi,t.FixedLightsSystem=ya,t.ShadowFilter=z,t.ExponentialShadowFilter=La,t.HardShadowFilter=R,t.PCFShadowFilter=Ia,t.VarianceShadowFilter=wa,t.MaterialPass=ge,t.Material=$i,t.BasicMaterial=tn,t.SkyboxMaterial=dn,t.Mesh=et,t.MeshInstance=Pi,t.SpherePrimitive=nn,t.BoxPrimitive=fn,t.Primitive=ai,t.ConePrimitive=va,t.CylinderPrimitive=hi,t.PlanePrimitive=Sa,t.TorusPrimitive=Oa,t.WireBoxPrimitive=Ca,t.WirePlanePrimitive=ja,t.BlendState=_t,t.Renderer=xa,t.VRRenderer=ba,t.LightingModel=k,t.View=function(t,e,i,n,s,r){this.scene=t,this.camera=e,this._renderer=null,this._texture=null,this._fbo=null,this.xRatio=i||0,this.yRatio=n||0,this.widthRatio=s||1,this.heightRatio=r||1},t.MultiRenderer=Pa,t.StencilState=function(t,e,i,n,s,r,o){this.enabled=!0,this.reference=t||0,this.comparison=e||Ge.ALWAYS,this.onStencilFail=i||Qe.KEEP,this.onDepthFail=n||Qe.KEEP,this.onPass=s||Qe.KEEP,this.readMask=null==r?4294967295:r,this.writeMask=null==o?4294967295:o},t.FrameBuffer=gt,t.Texture2D=ut,t.TextureCube=ct,t.TextureUtils=rt,t.WriteOnlyDepthBuffer=la,t.AsyncTaskQueue=Hs,t.ArrayUtils=_,t.BlitTexture=za,t.EquirectangularTexture=Ws,t.HeightMap=ta,t.ImageData=Ra,t.MergeSpecularTextures=Ua,t.NormalTangentGenerator=oi,t.Platform=fs,t.Raycaster=ka,t.StatsDisplay=Qa,t.VRDisplay=we,Object.defineProperty(t,"__esModule",{value:!0})});